var editar=false;var idcurso;var idclase;var idalumno;var idtema;var idtransact;var numMaxIntentos=3;var mostrarSoluciones=false;var mostrarNota=false;var puedePulsarCorregir=false;var puedeCorregir=false;var puedeEditar=false;var puedeRepetir=false;var sonidosEfectos=false;var sonidosBg=false;var hayCambiosNota=false;var hayCorreccionesProfesorSinGrabar=false;var clasificacionManual="";var currentSlideOffset=1;var _permitirFinishClass;var LESSON_STATUS_NOTATTEMPTED="not attempted";var LESSON_STATUS_PASSED="passed";var LESSON_STATUS_COMPLETED="completed";var LESSON_STATUS_FAILED="failed";var LESSON_STATUS_INCOMPLETE="incomplete";var LESSON_STATUS_BROWSED="browsed";var SLIDE_EVALUABLE=0;var SLIDE_NO_EVALUABLE=1;function showCursoCommit(e,t){var i=getUrlParameters();if(typeof e!=="undefined"&&e){idalumno=e}else{idalumno=typeof idalumno!=="undefined"&&idalumno?idalumno:""}if(t!=undefined){idgrupo=t}else if(typeof i["_idgrplanning"]!="undefined"){idgrupo=i["_idgrplanning"]}else{idgrupo=""}if(!editar&&(typeof esWeb!="undefined"&&esWeb)){try{}catch(e){blink.log.error(e)}setTimeout("showCurso('"+idalumno+"','"+idgrupo+"')",1e3)}else{window.onBeforeUnloadCalled=true;if($.browser.safari){updateSCORM()}else if(blink.isChrome||blink.isChromium){window.do_commit_sincr=true;updateSCORM()}showCurso(idalumno,idgrupo)}}function showCurso(e,t){if(e!==undefined&&typeof e!=="string")e=e.toString();if(e!=undefined&&e.length)idalumno=e;var i=0;if(t!==undefined&&typeof t!=="string")t=t.toString();if(t!=undefined&&t.length)i=t;var s=offline?"":"&editar="+(editar||window.reqEditar?1:0),o="";if(blink.theme.isAdaptative()&&blink.activity.currentStyle&&blink.activity.currentStyle.processHash){o=blink.activity.currentStyle.processHash()}if(!editar&&(typeof esWeb!="undefined"&&esWeb)&&blink.activity.currentStyle&&blink.activity.currentStyle.zipPineOpenInSameWindow&&blink.activity.currentStyle.zipPineOpenInSameWindow()){var a=false,r=false,n=document.referrer,l=n.indexOf("idclase=")+8,d=n.indexOf("&",l),u=n.substr(l,d-l);blink.getCourse(idcurso).done(function(e){if(typeof e.units!="undefined"&&e.units){e.units.forEach(function(e){if(typeof e.subunits!="undefined"&&e.subunits){var t=e.subunits.find(function(e){return e.id==u});if(t&&typeof e.esIndiceCurso!="undefined"&&e.esIndiceCurso){r=true}}})}});if(!r){blink.getActivity(idcurso,idclase).done(function(e){if(e.typeInt===6&&!!~e.fileurl.indexOf("imported")){redireccionar(n);a=true}});if(a){return false}}}redireccionar((!offline?WEBS:"")+"/coursePlayer/curso2.php?idcurso="+idcurso+(idtema?"&idtema="+idtema:"")+(idalumno&&idalumno!=""?"&idalumno="+idalumno:"")+(i&&i!=""?"&idgrupo="+i:"")+s+o);return false}function showFichaUsuarios(e,t){irFichaAlumno(t,"idgrupo="+e);return false}function repetirActividad(e){if(esInfantil&&!blink.theme.isAdaptative()){ejecutarBorradorCompleto(true);$(".gometusado").each(function(){$(this).animate({top:$(this).attr("iniy"),left:$(this).attr("inix")},"fast","swing").removeClass("gometusado")});resetAllHtmlSlides();enableFloatingObjects();return false}if(puedeRepetir){msg_alert=blink.activity.currentStyle&&blink.activity.currentStyle.repeatAlertText?blink.activity.currentStyle.repeatAlertText():textweb("course_56");if(e!=undefined&&e!="")msg_alert=e;if(confirm(msg_alert)){top.hayCambiosNota=true;window.onbeforeunload=null;window.repeatClass=true;var t="";if(offline&&(!blink.appVersion||blink.appVersion<2.1)){t="/LMS/ajax.php?op=activity.repeatClass&idcurso="+idcurso+"&idclase="+idclase+(idalumno!=""?"&idalumno="+idalumno:"");t=WEBS+t+"&modo=4&IDSESSIONDIRECT="+userToken+"&bd="+BLINKDOMAIN+"&device="+userDevice}else{t="/LMS/ajax.php?op=commitSCORM&repeatClass=yes&idcurso="+idcurso+"&idclase="+idclase+(idalumno!=""?"&idalumno="+idalumno:"")}if(offline&&(!blink.appVersion||blink.appVersion<2.1)){blink.ajax(t,onFinishRepetirActividadOk,{async:offline})}else{if(!scormAPI){scormAPI=getAPI();if(scormAPI){scormAPI.LMSInitialize("")}}var i=updateSCORM();if(i)onFinishRepetirActividadOk()}}}return false}function abrirActividad(){msg_alert=textweb("course_56");if(confirm(msg_alert)){var e="";if(offline&&(!blink.appVersion||blink.appVersion<2.1)){e="/LMS/ajax.php?op=activity.abrirActividad&idcurso="+idcurso+"&idclase="+idclase+"&idalumno="+idalumno;e=WEBS+e+"&modo=4&IDSESSIONDIRECT="+userToken+"&bd="+BLINKDOMAIN+"&device="+userDevice}else{e="/LMS/ajax.php?op=activity.abrirActividad&idcurso="+idcurso+"&idclase="+idclase+"&idalumno="+idalumno}window._permitirFinishClass=false;blink.ajax(e,onFinishAbrirActividadOK,{async:offline})}return false}function onFinishAbrirActividadOK(){location.reload()}function onFinishRepetirActividadOk(){location.reload()}function repetirTransparencia(e){if(puedeRepetir){if(confirm(e)){var t=window["t"+window.secuencia[window.activeSlide]+"_slide"];t.clearSlide()}}return false}function actualizarModoClase(){if(typeof esExamen=="undefined")esExamen=false;if(estadoCompletado>1&&modoClase==1){modoClase=esProfesor&&idalumno!=""?4:3}else if(estadoCompletado>1&&modoClase==2){modoClase=esProfesor&&idalumno!=""?4:3}if(typeof maxIntentosActividad!="undefined"&&!isNaN(maxIntentosActividad)){numIntentosActividad=maxIntentosActividad}else{numIntentosActividad=3}if(modoClase==1){numMaxIntentos=numIntentosActividad;mostrarSoluciones=true;mostrarNota=false;puedePulsarCorregir=true;puedeCorregir=false;puedeEditar=true;puedeRepetir=usuarioPuedeRepetir();sonidosEfectos=!esProfesor;sonidosBg=true}else if(modoClase==2){numMaxIntentos=1;mostrarSoluciones=esProfesor;mostrarNota=false;puedePulsarCorregir=esProfesor;puedeCorregir=false;puedeEditar=true;puedeRepetir=esProfesor;sonidosEfectos=false;sonidosBg=true}else if(modoClase==3){numMaxIntentos=numIntentosActividad;mostrarSoluciones=true;mostrarNota=true;puedePulsarCorregir=false;puedeCorregir=false;puedeEditar=false;puedeRepetir=!esPadre&&estadoCompletado==2&&!esExamen||esProfesor;sonidosEfectos=false;sonidosBg=false}else if(modoClase==4){numMaxIntentos=numIntentosActividad;mostrarSoluciones=true;mostrarNota=true;puedePulsarCorregir=false;puedeCorregir=true;puedeEditar=false;puedeRepetir=true;sonidosEfectos=false;sonidosBg=false}if(window.esExamen&&modoClase!=4&&!esProfesor)mostrarSoluciones=false;if(estadoCompletado>1&&esAlumno)puedeRepetir=false;if(esAlumno&&typeof puedeRepetirSiempre!="undefined"&&puedeRepetirSiempre=="1")puedeRepetir=true;if(evaltype==0)puedeRepetir=true;actualizarModoClaseFin();actualizarBotonesCambioModo()}function actualizarModoClaseFin(){}function actualizarBotonesCambioModo(){blink.theme.actualizarBotonesCambioModo()}function actualizarBotonesCambioModo_Aux(){}function inicializarTransparencias(e,t){onBeforeInicializarTransparencias();if(editar){if(esWeb){if(window.t0_slide)showSlide(0,true)}else{showSlide(window.activeSlide,true)}}else{scormAPI=getAPI();if(scormAPI&&(typeof scormAPI.isBlink==="undefined"||!scormAPI.isBlink)&&(modoVisualizacionLabel=="standalone"&&esPopup)){scormAPI=false}var i;loadStatusActivity(scormAPI);if(modoClase==4&&esProfesor&&!window.completed){if(window.repeatClass=="yes")modoClase=3}if(esWeb){actualizarModoClase();if(scormAPI&&typeof blink.activity.currentStyle!=="undefined"&&blink.activity.currentStyle.readSuspendData()){susp_data=scormAPI.LMSGetValue("cmi.suspend_data");loadSuspendData(susp_data)}else{loadSuspendData("")}if(window.t0_slide)showSlide(0,true)}else{if(scormAPI&&!e)e=parseInt(scormAPI.LMSGetValue("cmi.core.lesson_location"),10)+currentSlideOffset;if(typeof blink.activity.sections!=="undefined"&&(e>blink.activity.sections.length||e>blink.activity.$indicators.length))e=blink.activity.$indicators.length;else if(!e||e=="0"||e<0||e>numSlides)e=1;i=e<=0||blink.activity.pull?0:e-1;blink.activity.currentSection=i;window.activeSlide=i;actualizarModoClase();if(scormAPI){susp_data=scormAPI.LMSGetValue("cmi.suspend_data");loadSuspendData(susp_data);lastSD=getSuspendData();i=adjustLocTransp(i);if(i!=""&&i>=0&&(!blink.activity.currentStyle.permiteVerUltimaSlide||blink.activity.currentStyle.permiteVerUltimaSlide()||blink.activity.currentStyle.isSlidePreview&&blink.activity.currentStyle.isSlidePreview())){showSlide(parseInt(i),true);window.activeSlide=parseInt(i);blink.activity.currentSection=parseInt(i)}else{window.activeSlide=0;blink.activity.currentSection=0;showSlide(0,true)}}else{loadSuspendData("");showSlide(window.activeSlide,true)}}if(scormAPI)pintaNota(scormAPI.LMSGetValue("cmi.core.score.raw"));SCORMUpdate=true;if(t>0){if(checkPuedeEditar()){var s=Math.floor((initTime.getTime()-parseInt(suspdata.init_time))/1e3);if(s<t){startClock(t-s,"reloj")}else if(!window.completed){finishTime()}}}}onAfterInicializarTransparencias()}function digitalObjectWidth(){var e=$("#slider-item-"+blink.activity.currentSection+" .class_slide");var t=e.find(".bck-digital_object-embedder");if(e&&t.length&&!editar){fullWidthElement(t,e);$(window).on("resize",function(){fullWidthElement(t,e)})}}function fullWidthElement(e,t){if(e.attr("allowfullscreen")){e.css({width:t.outerWidth()||"inherit","margin-left":"-"+t.css("padding-left")})}if(e.attr("bigScreen")){var i=$("#slider-item-"+blink.activity.currentSection+" .slide-wrapper ");i.css({position:"fixed",width:"100vw",left:"0",padding:"0"});e.css({width:"100vw"})}}function loadStatusActivity(e){window.completed=false;estadoCompletado=1;if(e){e.LMSInitialize("");if(e.LMSGetValue("cmi.core.lesson_status")==LESSON_STATUS_COMPLETED||e.LMSGetValue("cmi.core.lesson_status")==LESSON_STATUS_PASSED||offline&&esWeb&&(e.LMSGetValue("cmi.completion_status")==LESSON_STATUS_COMPLETED||e.LMSGetValue("cmi.completion_status")==LESSON_STATUS_PASSED)){window.completed=true;estadoCompletado=e.LMSGetValue("cmi.core.lesson_status")==LESSON_STATUS_PASSED||offline&&esWeb&&e.LMSGetValue("cmi.completion_status")==LESSON_STATUS_PASSED?2:3}}}function onAfterInicializarTransparencias(){}function onBeforeInicializarTransparencias(){}function adjustLocTransp(e,t){return e}function checkModoExamen(){return typeof modoClase!=="undefined"&&modoClase==2}function checkModoPracticas(){return typeof modoClase!=="undefined"&&modoClase==1}function checkModoRevision(){return typeof modoClase!=="undefined"&&modoClase==3}function checkModoCorreccion(){return typeof modoClase!=="undefined"&&modoClase==4}function checkMostrarSoluciones(){return mostrarSoluciones}function checkMostrarNota(){return mostrarNota}function checkPuedeEditar(){return puedeEditar}function checkPuedePulsarCorregir(){return puedePulsarCorregir}function checkPuedeCorregir(){return puedeCorregir}function verifyPrint(){return blink.getReqParam(location.href,"printServer")=="true"}function onUnloadVentana(){if(window.onBeforeUnloadCalled)return;window.onBeforeUnloadCalled=true;if(blink.events){if(blink.events.onActivityClosed){blink.events.onActivityClosed()}if(blink.events.onSlideClose){blink.events.onSlideClose(!window.editar&&esWeb)}}if(window.editar){if(verificarHaCambiado())return textweb("edit_slide_39");blink.ajax("../LMS/ajax.php?op=session.deletevarenedicion&idcurso="+idcurso+"&idclase="+idclase,function(){},{async:false})}else{if(esWeb){try{if($("#t0_iframe").length){$("#t0_iframe").get(0).contentWindow.alert=function(){};if(blink.isIosApp&&!blink.isIosGreaterThan(13,true)&&blink.isIosGreaterThan(11,true)){document.getElementById("t0_iframe").contentWindow.location.reload()}else{$("#t0_iframe").contents().find("body, frame, frameset").unload()}}}catch(e){blink.log.error(e)}}else{blink.tools.updateNotes();blink.theme.onAfterUnloadVentana();updateSCORM();if(checkModoExamen()&&tiempoLimite>0&&!window.completed){return textweb("course_52")}}}}function styleRichTextInput(e,t){var i=$(e),s=i.attr("rows")!=undefined?parseInt(i.attr("rows")):1,o=parseInt(i.css("line-height")),t=i.closest(t);if(s==1){t.css({width:"100%","min-height":s*o+2+"px"})}else{t.css({width:"100%","min-height":s*o+2+"px"})}}function changeRichTextInput(e){var t=$(e),i=t.closest(".js-rich-group"),s=i.find(".hidden.keyboardInput");t.closest(".js-slide-wrapper").find(".js-save").prop("disabled",false);s.val(t.val());blink.activity.configureRichInput(i)}function displayCKEditor(e,t){var i=$(e.target).closest(".input-group").find(".hidden.keyboardInput");var s=$("#remote-alert-modal-rich");CKEDITOR.instances["idrich_text"].setData(i.val());if(modoClase!=3&&modoClase!=4&&i.attr("disabled")!="disabled"){blink.theme.showMask();if(blink.user&&blink.user.allowWirisByCountry){if(blink.domain){if(!blink.domain.showWiris(t)){s.find(".cke_button__ckeditor_wiris_formulaeditor, .cke_button__ckeditor_wiris_formulaeditorchemistry").hideBlink()}else{s.find(".cke_button__ckeditor_wiris_formulaeditor, .cke_button__ckeditor_wiris_formulaeditorchemistry").showBlink()}}}s.data("input",i).modal({show:true,backdrop:false}).on("shown.bs.modal",function(e){CKEDITOR.instances["idrich_text"].focus()})}}findAPITries=0;function findAPI(e){while(e.API==null&&e.parent!=null&&e.parent!=e){findAPITries++;if(findAPITries>7){return null}e=e.parent}return e.API}function getAPI(){var e=false;try{e=findAPI(window);if(e==null&&window.opener!=null&&typeof window.opener!="undefined"){e=findAPI(window.opener)}if(e==null){blink.log.warning("Unable to find an API adapter")}}catch(e){blink.log.warning("Exception thrown when looking for SCORM API adapter")}return e}function Slide(){}Slide.prototype.prefijo="";Slide.prototype.prefijo_canvas="";Slide.prototype.onShowPaint=function(){return};Slide.prototype.tipo=0;Slide.prototype.eje_categoria=0;Slide.prototype.esEjercicio=false;Slide.prototype.esAutocorregible=true;Slide.prototype.esJuegoAutoevaluable=false;Slide.prototype.esEvaluable=true;Slide.prototype.esContenido=false;Slide.prototype.clasificacion=0;Slide.prototype.clasificacionprofesor=-1;Slide.prototype.intentos=0;Slide.prototype.respuestas=[];Slide.prototype.resultados=[];Slide.prototype.numElementos=0;Slide.prototype.numElementosEvaluables=0;Slide.prototype.numMaxIntentos=0;Slide.prototype.setMaxIntentos=function(e){this.numMaxIntentos=e};Slide.prototype.esEvaluableManual=SLIDE_EVALUABLE;Slide.prototype.setEsEvaluableManual=function(e){this.esEvaluableManual=e};Slide.prototype.clasificacionContestado=0;Slide.prototype.porcentajeContestado=0;Slide.prototype.solutionShown=false;Slide.prototype.solutionPartialShown=false;Slide.prototype.resetAnswersBeforeShowPartialSolution=false;Slide.prototype.cambiosUsuario=false;Slide.prototype.tienePistas=false;Slide.prototype.comentariosprofesor="";Slide.prototype.firstElementIndex=null;Slide.prototype.exampleShown=false;Slide.prototype.exampleIndex=null;Slide.prototype.idsol=0;Slide.prototype.exampleStyleClass="solucion";Slide.prototype.solutionStyleClass="solucion";Slide.prototype.includedInPull=false;Slide.prototype.reviewButtons={principal:{"btn-send-to-correct":{btnTextDef:textweb("course_xx"),statusOptions:{}},"btn-solution":{btnTextDef:textweb("edit_slide_44"),statusOptions:{sinIntentos:{visible:true,active:true},solucion:{visible:true,active:true,customText:textweb("edit_slide_45")},pistaOculta:{visible:true,active:true},pistaMostrada:{visible:true,active:true,customText:textweb("edit_slide_45")},correccion:{visible:true,active:true},revision:{visible:true,active:true},juegoRelleno:{visible:true,active:true},juegoSinIntentos:{visible:true,active:true},solucionJuego:{visible:true,active:true,customText:textweb("edit_slide_45")},juegoCorreccion:{visible:true,active:true},juegoRevision:{visible:true,active:true}}},"btn-correct":{btnTextDef:textweb("course_53"),statusOptions:{conIntentos:{visible:true,active:true},conTodoRelleno:{visible:true,active:true},sinRespuesta:{visible:true,active:true},juegoRelleno:{visible:true,active:true},juegoSinRespuesta:{visible:true,active:true},juegoConIntentos:{visible:true,active:true},juegoCorreccion:{visible:false,active:false},juegoRevision:{visible:true,active:true}}},"btn-save":{btnTextDef:textweb("bottomSave"),statusOptions:{guardarOn:{visible:true,active:true},guardarOff:{visible:true,active:false},enviada:{visible:true,active:false,customText:textweb("edit_slide_108")},correccionGuardar:{visible:true,active:false},revisionGuardar:{visible:true,active:false}}},"btn-reset":{btnTextDef:textweb("bottomReset"),isVisible:function(e,t){if(checkModoCorreccion()||checkModoRevision()){return false}return null},statusOptions:{conIntentos:{visible:true,active:true},conTodoRelleno:{visible:true,active:true},sinIntentos:{visible:true,active:true},sinRespuesta:{visible:true,active:false},solucion:{visible:true,active:true},pistaMostrada:{visible:true,active:true},pistaOculta:{visible:true,active:true},enviada:{visible:true,active:true},guardarOn:{visible:true,active:true},guardarOff:{visible:true,active:false},correccion:{visible:false,active:false},revision:{visible:false,active:false},juegoRelleno:{visible:true,active:true},juegoSinRespuesta:{visible:true,active:false},juegoSinIntentos:{visible:true,active:true},juegoConIntentos:{visible:true,active:true},solucionJuego:{visible:true,active:true},juegoCorreccion:{visible:false,active:false},juegoRevision:{visible:false,active:false}},requiresConfirmation:[]},"btn-next":{btnTextDef:textweb("bottomNextSolution"),statusOptions:{}},attempts:{statusOptions:{conIntentos:{visible:true,active:false},conTodoRelleno:{visible:true,active:false},sinIntentos:{visible:true,active:false},solucion:{visible:true,active:false},sinRespuesta:{visible:true,active:false},correccion:{visible:true,active:false},revision:{visible:true,active:false},pistaMostrada:{visible:true,active:false},pistaOculta:{visible:true,active:false},enviada:{visible:true,active:false},guardarOn:{visible:true,active:false},guardarOff:{visible:true,active:false},juegoRelleno:{visible:true,active:false},juegoSinRespuesta:{visible:true,active:false},juegoSinIntentos:{visible:true,active:false},juegoConIntentos:{visible:true,active:false},solucionJuego:{visible:true,active:false},juegoCorreccion:{visible:true,active:false},juegoRevision:{visible:true,active:false}}}},alumno:{"btn-send-to-correct":{btnTextDef:textweb("course_xx"),statusOptions:{sendToCorrect:{visible:true,active:true}}},"btn-solution":{btnTextDef:textweb("edit_slide_44"),statusOptions:{sinIntentos:{visible:true,active:true},solucion:{visible:true,active:true,customText:textweb("edit_slide_45")},pistaOculta:{visible:true,active:true},pistaMostrada:{visible:true,active:true,customText:textweb("edit_slide_45")},correccion:{visible:true,active:true},revision:{visible:true,active:true},juegoRelleno:{visible:true,active:true},juegoSinIntentos:{visible:true,active:true},solucionJuego:{visible:true,active:true,customText:textweb("edit_slide_45")},juegoCorreccion:{visible:true,active:true},juegoRevision:{visible:true,active:true}}},"btn-correct":{btnTextDef:textweb("course_53"),statusOptions:{conIntentos:{visible:true,active:true},conTodoRelleno:{visible:true,active:true},sinRespuesta:{visible:true,active:true},juegoRelleno:{visible:true,active:true},juegoSinRespuesta:{visible:true,active:true},juegoConIntentos:{visible:true,active:true}}},"btn-save":{btnTextDef:textweb("bottomSave"),statusOptions:{guardarOn:{visible:true,active:true},guardarOff:{visible:true,active:false},enviada:{visible:true,active:false,customText:textweb("edit_slide_108")},examen:{visible:true,active:true},correccionGuardar:{visible:true,active:false},revisionGuardar:{visible:true,active:false}}},"btn-reset":{btnTextDef:textweb("bottomReset"),isVisible:function(e,t){if(checkModoCorreccion()||checkModoRevision()||typeof blink.activity.esdeber!=="undefined"&&blink.activity.esdeber){return false}return null},isActive:function(e,t){return e.clasificacionprofesor!=-1?false:null},statusOptions:{conIntentos:{visible:true,active:true},conTodoRelleno:{visible:true,active:true},sinIntentos:{visible:true,active:true},sinRespuesta:{visible:true,active:false},solucion:{visible:true,active:true},pistaMostrada:{visible:true,active:true},pistaOculta:{visible:true,active:true},enviada:{visible:true,active:true},guardarOn:{visible:true,active:true},guardarOff:{visible:true,active:false},correccion:{visible:false,active:false},revision:{visible:false,active:false},juegoRelleno:{visible:true,active:true},juegoSinRespuesta:{visible:true,active:false},juegoSinIntentos:{visible:true,active:true},juegoConIntentos:{visible:true,active:true},solucionJuego:{visible:true,active:true},juegoCorreccion:{visible:false,active:false},juegoRevision:{visible:false,active:false}},requiresConfirmation:[]},"btn-next":{btnTextDef:textweb("bottomNextSolution"),statusOptions:{}},attempts:{statusOptions:{conIntentos:{visible:true,active:false},conTodoRelleno:{visible:true,active:false},sinIntentos:{visible:true,active:false},solucion:{visible:true,active:false},sinRespuesta:{visible:true,active:false},correccion:{visible:true,active:false},revision:{visible:true,active:false},pistaMostrada:{visible:true,active:false},pistaOculta:{visible:true,active:false},enviada:{visible:true,active:false},guardarOn:{visible:true,active:false},guardarOff:{visible:true,active:false},juegoRelleno:{visible:true,active:false},juegoSinRespuesta:{visible:true,active:false},juegoSinIntentos:{visible:true,active:false},juegoConIntentos:{visible:true,active:false},solucionJuego:{visible:true,active:false},juegoCorreccion:{visible:true,active:false},juegoRevision:{visible:true,active:true}}}}};Slide.prototype.setReviewButtons=function(e,t,i){var n=this,s=$("#"+this.prefijo+"-corrector").find("button").filter(function(){return!$(this).parent().hasClass("video-interactivo-controls")&&!$(this).hasClass("btn-repeat")});reviewStatus=this.getReviewStatus(),dataButtons=blink.user.esAlumno()||blink.user.esPadre()?this.reviewButtons.alumno:this.reviewButtons.principal;if(typeof this.overwriteReviewButtons!=="undefined"){newDataButtons=blink.user.esAlumno()||blink.user.esPadre()?this.overwriteReviewButtons.alumno:this.overwriteReviewButtons.principal;dataButtons=$.extend(true,{},dataButtons,newDataButtons)}s.hideBlink().prop("disabled",true);_.each(dataButtons,function(e,t){var i=$("#"+n.prefijo+"-"+t);var s=e.statusOptions;if(typeof e.statusOptions=="function"){s=e.statusOptions()}var o=s[reviewStatus];var a=e.isVisible?e.isVisible(n,reviewStatus):null;if(a===null)a=o&&o.visible;if(a)i.showBlink();else{if(o&&o.remove){i.remove()}}var r=e.isActive?e.isActive(n,reviewStatus):null;if(r===null)r=o&&o.active;if(r)i.attr("disabled",false);o&&o.customText?i.text(o.customText):e.btnTextDef?i.text(e.btnTextDef):"";o&&o.backgroundColor?i.css("background",o.backgroundColor):i.css("background","")})};Slide.prototype.getReviewStatus=function(){if(!this.esEjercicio){return""}else if(this.esAutocorregible){if(checkPuedePulsarCorregir()){if(this.solutionShown){return"solucion"}else if(this.isDone()){if(this.checkSendToCorrectIndividual()){return"sendToCorrect"}else{return"sinIntentos"}}else{if(this.solutionPartialShown||this.tieneRespuestas()){if(this.tieneRespuestas(true)){return"conTodoRelleno"}else if(this.tieneRespuestas()){return"conIntentos"}}return"sinRespuesta"}}else if(checkModoCorreccion()){return"correccion"}else if(checkModoRevision()){return"revision"}else if(window.completed){return"finalizado"}else if(esExamen){return"examen"}}else if(this.esJuegoAutoevaluable){if(checkPuedePulsarCorregir()){if(this.solutionShown){return"solucionJuego"}else if(this.isDone()){return"juegoSinIntentos"}else{if(this.solutionPartialShown||this.tieneRespuestas()){if(this.tieneRespuestas(true)){return"juegoRelleno"}else if(this.tieneRespuestas()){return"juegoConIntentos"}}return"juegoSinRespuesta"}}else if(checkModoCorreccion()){return"juegoCorreccion"}else if(checkModoRevision()){return"juegoRevision"}else if(window.completed){return"finalizado"}else if(esExamen){return"examen"}}else{if(checkModoCorreccion()&&!this.tienePistas){return"correccionGuardar"}else if(checkModoRevision()&&!this.tienePistas){return"revisionGuardar"}else if(this.solutionShown){return"pistaMostrada"}else if(this.isDone()||checkModoCorreccion()||checkModoRevision()){if(this.tienePistas){return"pistaOculta"}else{return"enviada"}}else if(this.tieneRespuestas()){return"guardarOn"}else{return"guardarOff"}}};Slide.prototype.detectSlideChanges=function(){var e=this;$("[id='transp"+this.prefijo.substring(1)+"']").find("input,select,textarea").on("change keyup",function(){e.getSuspendData();e.setReviewButtons()});$("#botonOKRich").on("click",function(){if($("#cke_idrich_text .cke_editable").html()!=""){e.getSuspendData();e.setReviewButtons()}})};Slide.prototype.checkUpdateResponses=function(){if(esExamen&&(modoClase==3||modoClase==4))return false;else return!this.esAutocorregible||esExamen||this.solutionShown||checkPuedePulsarCorregir()&&this.getClassification()!=1&&this.intentos<this.numMaxIntentos};Slide.prototype.update=function(e,t){if(this.esEjercicio){if(!checkPuedeEditar()){this.setDisabled(this.prefijo)}if(this.esAutocorregible||this.tienePistas){var i=document.getElementById(this.prefijo+"_lCorrect");var s=document.getElementById(this.prefijo+"_bCorrect");var o=document.getElementById(this.prefijo+"_corregir");var a=document.getElementById(this.prefijo+"_bSolutionLabel");var r=document.getElementById(this.prefijo+"_solution");var n=document.getElementById(this.prefijo+"_bSendToCorrectLabel");var l=document.getElementById(this.prefijo+"_sendtocorrect");if(checkPuedePulsarCorregir()){i.innerHTML=Math.max(0,this.numMaxIntentos-this.intentos);if(this.getClassification()==1||this.intentos>=this.numMaxIntentos){$("#"+this.prefijo+"_corregir .corregir").hide();this.solutionShown=false;this.setDisabled(this.prefijo);if(this.checkSendToCorrectIndividual()){this.showSolution();this.solutionShown=true;$("#"+this.prefijo+"_sendtocorrect").show()}else{$("#"+this.prefijo+"_sendtocorrect").hide();this.refreshSolutionButton(e)}}else{$("#"+this.prefijo+"_solution").hide();$("#"+this.prefijo+"_corregir .corregir").show()}}else if(checkModoCorreccion()||checkModoRevision()){i.innerHTML=this.intentos;$("#"+this.prefijo+"_corregir .corregir").hide();this.refreshSolutionButton(e)}else if(window.completed){$("#"+this.prefijo+"_corregir").hide();this.refreshSolutionButton(e)}else if(esExamen){$("#"+this.prefijo+"_corregir .quedan").hide()}}else{$("#"+this.prefijo+"_corregir").hide()}if(mostrarNota){pintaNotaTransp(this.getClassification()*100,this.prefijo);$(".corregir_nota").show();if(!puedeCorregir&&this.getClassification()==0&&!this.tieneRespuestas())$(".corregir_nota").hide();if(puedeCorregir){$("#edicion_nota_transp").removeAttr("readonly").focus();$(".edicion_nota_transp_input").removeAttr("readonly").show();$(".comentario_profe_transp_input").removeAttr("readonly")}else{$("#edicion_nota_transp").attr("disabled",true);$(".edicion_nota_transp_input").attr("disabled",true);$(".comentario_profe_transp_input").attr("disabled",true)}}if(this.comentariosprofesor)pintaComentariosProfesor(this.comentariosprofesor,this.prefijo);$("[name="+this.prefijo+"_clasificacion]").val(this.getClassification())}else{this.clasificacion=1;$("#"+this.prefijo+"_corregir, .corregir_nota, #"+this.prefijo+"_solution").hide()}};Slide.prototype.onBeforeShow=function(){};function sendToCorrectOneSlide(e){var t=window[e+"_slide"];t.sendToCorrect()}Slide.prototype.sendToCorrect=function(){if(confirm(textweb("edit_slide_90"))){this.senttocorrect=1;$("#"+this.prefijo+"_sendtocorrect").hide();this.refreshSolutionButton();var e=textweb("edit_slide_97");if(!e||e=="")e="Your activity has been submitted for correction successfully. You can now finish your lesson";_showAlert(e)}};Slide.prototype.checkSendToCorrectIndividual=function(){return false};Slide.prototype.clearSlide=function(){if(!editar){var e=this.checkRequiresConfirmation("btn-reset"),t=textweb("course_88");if(typeof t==="undefined"||!t){t="Â¿De verdad quieres reiniciar el ejercicio?"}if(e){if(!confirm(t)){return}}}this.clearSlideComunIni();this.clearSlideComunFin()};Slide.prototype.clearSlideCustomIni=function(){};Slide.prototype.slideShowResetConfirmation=function(){return false};Slide.prototype.clearSlideComunIni=function(){$("#"+this.prefijo+"_panel").removeClass("ejercicio_ko");$("#"+this.prefijo+"_revision-budget").hide();$("#"+this.prefijo+"_solution").hide();$("#"+this.prefijo+"_done").hide();$(".corregir").show();this.intentos=0;this.clasificacion=0;this.idsol=0;$("#"+this.prefijo+"_lCorrect").html(this.numMaxIntentos);this.respuestas=new Array;this.resultados=new Array;for(var e=0;e<this.numElementos;e++){var t=document.f.elements[this.prefijo+"v"+e];if(t){if(t.tagName=="SELECT"){t.value=0}else{t.value=""}$(t).removeClass("respuesta_ko");$(t).removeClass("respuesta_ok");$(t).removeAttr("disabled");$(t).removeClass("disabled")}}$(".txt-wrap").removeClass("focus");this.hideSolution();this.hideHint();if(this.solutionShown)switchSolution(this.prefijo);this.clearSlideCustomIni()};Slide.prototype.focusElement=function(e){if(!blink.isTablet)$("#"+this.prefijo+"v"+e).filter("input,textarea").filter(":enabled").focus()};Slide.prototype.clearSlideComunFin=function(){if(this.useExamples)this.showExample();this.focusElement&&this.focusElement(this.idsol);this.solutionPartialShown=false;if(scormAPI){scormAPI.LMSCommit("")}};Slide.prototype.onAfterShowSlide=function(){};Slide.prototype.setBudget=function(e,t){setBudget(e,t)};Slide.prototype.onShow=function(){this.update(false,false);this.onAfterShowSlide();flipboxPositions(this.prefijo);this.activatePencilCanvas();this.refreshFailedImages()};Slide.prototype.evalNumElements=function(){this.numElementos=0};Slide.prototype.loadSuspendData=function(e){if(this.esEjercicio){if(!!e){this.intentos=e["intentos"];this.respuestas=e["respuestas"];this.resultados=e["resultados"];this.clasificacion=parseFloat(e["clasificacion"]);if(e["clasificacionprofesor"]!=undefined)this.clasificacionprofesor=parseFloat(e["clasificacionprofesor"]);if(e["comentariosprofesor"]!=undefined)this.comentariosprofesor=escapeHtml(e["comentariosprofesor"]);if(e["senttocorrect"]!=undefined)this.senttocorrect=e["senttocorrect"];if(e["marcadoTextBox"]!=undefined)this.marcadoTextBox=e["marcadoTextBox"];if(e["numElementos"]!=undefined)this.numElementos=e["numElementos"]}else{this.respuestas=new Array;this.resultados=new Array}this.update(false,false)}if(!!e){if(e["geogebra"]!=undefined){this.geogebra=e["geogebra"];if(e["clasificacion"]!=undefined){this.clasificacion=parseFloat(e["clasificacion"])}}if(e["sublocation"]!=undefined){this.sublocation=e["sublocation"]}if(e["pristine"]!=undefined){this.pristine=e["pristine"]}if(e["includedInPull"]!=undefined){this.includedInPull=e["includedInPull"]}}var t=this.prefijo.substring(1);if(_guardarPizarra&&e!=undefined&&e["lineax"]!=undefined){lineax[t]=e["lineax"];lineay[t]=e["lineay"];tipolinea[t]=e["tipolinea"];colorlinea[t]=e["colorlinea"]}if(_guardarPizarra&&e!=undefined&&e["notesArray"]!=undefined){notesArray[t]=e["notesArray"]}blink.events.on("managerTools:inited",function(){$.each(blink.tools.manager.tools,function(){if(e&&e.tools&&e.tools[this.name])this.setStatus("t"+t,e.tools[this.name])})});var i=this;var s=true;blink.events.on("geogebraObject:loaded_"+i.prefijo,function(){if(i.containsGeogebra()&&suspdata.status["t"+i.uid]&&suspdata.status["t"+i.uid].geogebra){if(s){i.setGeogebraObjectState(suspdata.status["t"+i.uid].geogebra);s=false}}i.geogebraLoaded=true});if(e!=undefined&&e["extraSCORM"]!=undefined){this.extraSCORM=e["extraSCORM"]}blink.events.trigger("suspendData:load")};Slide.prototype.getSuspendData=function(){var e=new Object;if(this.esEjercicio){e.intentos=this.intentos;e.respuestas=this.respuestas;e.resultados=this.resultados;e.clasificacion=this.clasificacion;e.clasificacionprofesor=this.clasificacionprofesor}if(this.comentariosprofesor){e.comentariosprofesor=this.comentariosprofesor}if(this.senttocorrect){e.senttocorrect=this.senttocorrect}if(this.marcadoTextBox){e.marcadoTextBox=this.marcadoTextBox}if(typeof this.pristine!="undefined"){e.pristine=this.pristine}if(this.numElementos){e.numElementos=this.numElementos}if(this.sublocation){e.sublocation=this.sublocation}if(this.geogebra){e.geogebra=this.geogebra;e.clasificacion=this.clasificacion}if(typeof this.includedInPull!="undefined"){e.includedInPull=this.includedInPull}var t=this.prefijo.substring(1);if(_guardarPizarra&&lineax[t]){e.lineax=lineax[t];e.lineay=lineay[t];e.tipolinea=tipolinea[t];e.colorlinea=colorlinea[t]}if(_guardarPizarra&&notesArray[t]){e.notesArray=notesArray[t]}e.tools={};$.each(blink.tools.manager.tools,function(){e.tools[this.name]=this.getStatus("t"+t)});if(this.extraSCORM){e.extraSCORM=this.extraSCORM}if(this.hasFiles){e.files="yes"}return e};Slide.prototype.getAutomaticClassification=function(){return this.clasificacion.toFixed(1)};Slide.prototype.hasGrade=function(){return!this.esAutocorregible&&this.clasificacionprofesor!=-1||this.intentos!==0||this.esJuegoAutoevaluable&&this.tieneRespuestas()};Slide.prototype.getClassification=function(){if(this.clasificacion>1)this.clasificacion=1;else if(this.clasificacion<0&&this.clasificacion!=-1||this.clasificacion=="")this.clasificacion=0;if(this.clasificacionprofesor!=undefined&&this.clasificacionprofesor!=-1)return(Math.round(this.clasificacionprofesor*100)/100).toFixed(2);if(!this.hasGrade())return"";return(Math.round(this.clasificacion*100)/100).toFixed(2)};Slide.prototype.correct=function(e,t){if(this.numMaxIntentos==this.intentos)return;if(this.esEjercicio||this.esJuegoAutoevaluable){if(e||this.intentos==0)this.intentos++;this.update(e,true);var i=0;for(var s=0;s<this.respuestas.length;s++){if(this.respuestas[s]!=null&&this.respuestas[s]!==""&&this.respuestas[s]!=undefined){i++}}if(e){var o=this.clasificacionContestado;var a=this.porcentajeContestado;if(i!=0){this.clasificacionContestado=this.clasificacion*this.numElementosEvaluables/i;this.porcentajeContestado=100*i/this.numElementosEvaluables}onCorrectSlide(this.clasificacionContestado,this.porcentajeContestado,o,a,this.intentos,Math.max(0,this.numMaxIntentos-this.intentos))}if(e&&t){updateSCORM()}if(t){if(this.clasificacionContestado!=this.clasificacion)top.hayCambiosNota=true;blink.events.trigger("slide:update:correct",this.clasificacion)}}};function correct(e,t,i){var s=window[e+"_slide"];s.evalNumElements();s.correct(t,i)}Slide.prototype.refreshSolutionButton=function(e){if(checkMostrarSoluciones()){$("#"+this.prefijo+"_bSolutionLabel").html(this.solutionShown?textweb("edit_slide_45"):textweb("edit_slide_44"));if(e)$("#"+this.prefijo+"_solution").fadeIn();else $("#"+this.prefijo+"_solution").show()}};Slide.prototype.isDone=function(){return this.numMaxIntentos<=this.intentos||this.clasificacion==1};Slide.prototype.onBeforeChangeSlide=function(){};function onClickSolutionButton(e){switchSolution(e)}function switchSolution(e){var t=window[e+"_slide"];if(t.solutionShown){t.hideSolution();t.solutionShown=false}else{t.showSolution();t.solutionShown=true}t.refreshSolutionButton(true)}Slide.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){if(this.resetAnswersBeforeShowPartialSolution&&esProfesor){this.clearSlide()}for(var e=this.firstElementIndex;e<this.numElementos;e++){this.showElemSolution(e)}this.solutionShown=true;this.idsol=this.numElementos}};Slide.prototype.showNextSolution=function(){if(this.resetAnswersBeforeShowPartialSolution&&esProfesor&&(this.idsol==(this.exampleIndex!==null)?this.exampleIndex:0)){this.clearSlide()}if(this.idsol<this.numElementos){this.solutionPartialShown=true;this.showElemSolution(this.idsol);this.idsol++}if(this.idsol==this.numElementos){this.solutionPartialShown=false;this.solutionShown=true;this.refreshSolutionButton(true)}this.setReviewButtons()};Slide.prototype.showElemSolution=function(e){};Slide.prototype.hideSolution=function(){this.idsol=this.exampleIndex!=null?this.exampleIndex+1:0};Slide.prototype.hideHint=function(){this.tienePistas?$(".hint.solucion").addClass("hidden"):null};Slide.prototype.showExample=function(){if(!this.useExamples)return;this.exampleIndex=0;this.showElemSolution(this.exampleIndex);this.idsol=this.exampleIndex+1};Slide.prototype.esRespuesta=function(e){return e!==null&&e!==undefined&&e!==""};Slide.prototype.slidePending=function(){var e=false,t=this.clasificacionprofesor==-1&&this.tieneRespuestas();if(this.esEvaluable&&(!this.esAutocorregible||this.getClassification()==-1)&&t){e=true}if(this.esEvaluableManual==SLIDE_NO_EVALUABLE&&!blink.activity.esdeber&&!esExamen||this.esJuegoAutoevaluable){e=false}return e};Slide.prototype.tieneRespuestas=function(e){var t=e!=undefined&&e;if(this.respuestas){for(var i=0;i<this.respuestas.length;i++){if(this.useExamples&&i==this.exampleIndex)continue;if(this.esRespuesta(this.respuestas[i],i)){if(!t)return true}else{if(t)return false}}}else if(t)return false;return t&&this.respuestas.length==this.numElementos||this.intentos>0};Slide.prototype.tieneProgreso=function(){return blink.domain.validarProgresoSlide(this)};Slide.prototype.setDisabled=function(e,t){var i=e!=null?e:this.prefijo,s=t?"":"^",o=s+"="+i;$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").filter("[name"+o+"], [id"+o+"]").each(function(){$(this).attr("disabled","disabled")})};Slide.prototype.disableHighlighter=function(){};Slide.prototype.setWidthElements=function(e){};Slide.prototype.checkAnswers=function(){};Slide.prototype.shouldDisabledDrawTools=function(){};Slide.prototype.shouldDisabledHighlighter=function(){return false};Slide.prototype.shuffleArray=function(e){var t=e.length,i,s;while(t>0){s=Math.floor(Math.random()*t);t--;i=e[t];e[t]=e[s];e[s]=i}return e};Slide.prototype.activatePencilCanvas=function(){if(typeof blink.tools.pencil.scope!=="undefined"){paper=blink.tools.pencil.scope}};Slide.prototype.checkRequiresConfirmation=function(e){if(!blink.activity||!blink.activity.currentStyle){return false}var t=blink.activity,i=blink.user.esAlumno()||blink.user.esPadre()?this.reviewButtons.alumno:this.reviewButtons.principal;slide=t.sections[t.currentSection][0],requires=false;_.each(i[e].requiresConfirmation,function(e){if(slide.tipo==e){requires=true}});return requires};Slide.prototype.setUrlForEmbeddedIframes=function(){if(!editar){var e=$(".swipeview-active").find(".bck-iframe-embedder");e.each(function(e,t){var i=$(t).attr("data-url");i&&i.length>0&&$(t).find("iframe").attr("src",i)});var t=$("#swipeview-slider").children().not(".swipeview-active").find(".bck-iframe-embedder");t.push($("#actividad-data").find(".bck-iframe-embedder"));t.each(function(e,t){var i=$(t).find("iframe").attr("src");if(i&&i.length>0){$(t).find("iframe").attr("src","")}})}};Slide.prototype.geogebraLoaded=false;Slide.prototype.containsGeogebra=function(){return window[this.prefijo+"_ggb"]?true:false};Slide.prototype.getGeogebraObjectState=function(){if(this.containsGeogebra()&&this.geogebraLoaded){return window[this.prefijo+"_ggb"].getBase64()}return false};Slide.prototype.setGeogebraObjectState=function(e){if(this.containsGeogebra()){window[this.prefijo+"_ggb"].setBase64(e)}};Slide.prototype.getGeogebraObjectScore=function(){if(this.containsGeogebra()){var e=window[this.prefijo+"_ggb"].getValue("SCORMRawScore");var t=window[this.prefijo+"_ggb"].getValue("SCORMMaxScore");var i=window[this.prefijo+"_ggb"].getValue("SCORMMinScore");if(e>0&&t>0){return(e-i)/(t-i)}}return-1};Slide.prototype.refreshFailedImages=function(i){var i=typeof i!=="undefined"?i:this.prefijo.substring(1),e=!editar?$("#transp"+i).find("img[src_old]"):$("#t"+i+"_multimedia").find("img[src_old]");if(e.length>0){e.each(function(){var e=$(this),t=e.attr("src_old");$.get(t).done(function(){t=t+"?"+performance.now();e.attr("src",t);e.removeAttr("src_old");if($("#slider-"+i+"-img-container").length>0&&$("#slider-"+i+"-img-container").attr("style").indexOf("load_error.png")!=-1){$("#slider-"+i+"-img-container").css("background-image",'url("'+t+'")')}})})}};Slide.prototype.useFeedback=function(){var e=false;if(typeof window[this.prefijo+"useFeedback"]!=="undefined"&&window[this.prefijo+"useFeedback"]){e=true}else{e=false}return e};Slide.prototype.allowInfinityAttempts=function(){return true};var clas=[];var suspdata=new Object;suspdata.clasificacion_ejes=new Object;suspdata.status=new Object;var initTime=new Date;var absoluteInitTime=new Date;var SCORMUpdate=false;function parseSCORMTime(e){var t=e.split(":");var i=new Date;var s=new Date;s.setHours(0);s.setMinutes(0);s.setSeconds(0);i.setHours(parseInt(t[0]));i.setMinutes(parseInt(t[1]));i.setSeconds(parseInt(t[2]));i.setTime(i.getTime()-s.getTime());return i}function printSCORMTime(e){return pintaDosCifras(e.getUTCHours())+":"+pintaDosCifras(e.getUTCMinutes())+":"+pintaDosCifras(e.getUTCSeconds())+".00"}var tiempoEnClase=0;function calculateSCORMSessionTime(){var e=new Date;var t=new Date;t.setTime(e.getTime()-initTime.getTime());blink.domain.calculateRealSessionTime(t);var i;if(tiempoEnClase!=0){i=tiempoEnClase}else if(window.scormAPI){var s=scormAPI.LMSGetValue("cmi.core.total_time");if(s!="")i=parseSCORMTime(s)}if(!i){i=new Date;i.setTime(0)}tiempoEnClase=new Date;tiempoEnClase.setTime(i.getTime()+t.getTime());initTime=e;return printSCORMTime(t)}function sessionTimeSCORM2004To12(e){$matches=e.match(/P(([0-9]+)Y)?(([0-9]+)M)?(([0-9]+)D)?T?(([0-9]+)H)?(([0-9]+)M)?(([0-9]+)(\.[0-9]+)?S)?/);hours=$matches[8]!==undefined?parseInt($matches[8]):0;minutes=$matches[10]!==undefined?parseInt($matches[10]):0;seconds=$matches[12]!==undefined?parseInt($matches[12]):0;totalseconds=(hours*3600+minutes*60+seconds)*1e3;intervalo=new Date;intervalo.setTime(totalseconds);return printSCORMTime(intervalo)}function getAbsoluteTimeElapsed(){var e=new Date;var t=new Date;t.setTime(e.getTime()-absoluteInitTime.getTime());return t}function checkUpdateSCORMConAlumno(){if(idalumno&&!window.hayCorreccionesProfesorSinGrabar&&!top.hayCambiosNota&&(checkModoRevision()||checkModoCorreccion())&&esProfesor&&(typeof herramientaPizarra=="undefined"||herramientaPizarra==0))return false;return true}function checkUpdateSCORMAlumno(){return true}function lockPreviousQualification(){return false}var lastSD=null;function updateSCORM(e){if(window.completed&&(modoClase==1||modoClase==2)&&!esProfesor){return false}if(idalumno){var t=checkUpdateSCORMConAlumno();if(!t)return false}if(!checkUpdateSCORMAlumno())return false;var i=lockPreviousQualification();if(!(SCORMUpdate&&!window.scormFailed||window.scormFailed&&window.repeatClass))return false;reloadSuspendData(e);if(scormAPI){if((modoClase==1||modoClase==2)&&!window.completed){scormAPI.LMSSetValue("cmi.core.lesson_status",LESSON_STATUS_INCOMPLETE);scormAPI.LMSSetValue("cmi.core.lesson_location",window.activeSlide);scormAPI.LMSSetValue("cmi.core.session_time",calculateSCORMSessionTime());scormAPI.LMSSetValue("cmi.core.total_time",printSCORMTime(tiempoEnClase))}lastSD=getSuspendData();scormAPI.LMSSetValue("cmi.suspend_data",lastSD);var s=calcularClasificacion();if(s!==""){if(!i){scormAPI.LMSSetValue("cmi.core.score.raw",s);guardarScoreAverageScormAPI()}}scormAPI.LMSCommit("");hayCorreccionesProfesorSinGrabar=false;if(typeof autoSaveTime!="undefined"&&!blink.user.esAnonimo()){clearInterval(autoUpdateSlides);autoUpdateSlides=setInterval(function(){suspendDataChanged(true)?updateSCORM(true):ping()},autoSaveTime)}}return true}function guardarScoreAverageScormAPI(){var e=calcularScoreAverage();if(e&&e.length==4){scormAPI.LMSSetValue("cmi.core.score.scoreAvg1",e[0]);scormAPI.LMSSetValue("cmi.core.score.scoreAvg2",e[1]);scormAPI.LMSSetValue("cmi.core.score.scoreAvg3",e[2]);scormAPI.LMSSetValue("cmi.core.score.scoreAvg4",e[3])}}function onBeforeTabletClose(){window.onBeforeUnloadCalled=true;if(window.esWeb){$("#t0_iframe").get(0).contentWindow.alert=function(){};if(blink.isIosApp){document.getElementById("t0_iframe").contentWindow.location.reload()}else{$("#t0_iframe").contents().find("body, frame, frameset").unload()}}else if(window.PDFTron){window.bpdf.tool.setDefaultMode();window.bpdf.am.saveAnnots(true)}else{$('.swipeview-active textarea, .swipeview-active input[type="text"]').blur();updateSCORM()}return"OK"}function finishSCORM(e){var e=e||"";if(window.scormFailed)return;corregirTodaClase();reloadSuspendData();if(scormAPI){var t=calcularClasificacion();scormAPI.LMSSetValue("cmi.core.lesson_status",LESSON_STATUS_PASSED);scormAPI.LMSSetValue("cmi.suspend_data",getSuspendData());if(t!==""){scormAPI.LMSSetValue("cmi.core.score.raw",t);guardarScoreAverageScormAPI()}scormAPI.LMSSetValue("cmi.core.session_time",calculateSCORMSessionTime());clasificacionManual=scormAPI.LMSGetValue("cmi.core.score.manual_raw");scormAPI.LMSFinish("",e)}}function suspendDataChanged(e){var t=getSuspendData();if(t!=lastSD)return 1;return _oldsuspendDataChanged(e)}function _oldsuspendDataChanged(e){var t=false;for(var i=0;i<secuencia.length;i++){try{var s=window["t"+secuencia[i]+"_slide"];if(s!=undefined){t|=json_encode(suspdata.status["t"+s.uid])!=json_encode(s.getSuspendData(e))}}catch(e){blink.log.error(e)}}return t}function reloadSuspendData(e){var t=false;var i=false;var s=new Object;var o=0;var a=new Array;var r=0;var n=0;var l=0;suspdata.clasificacion_ejes=new Object;suspdata.tieneCorregiblesPendientes=t;for(var d=0;d<secuencia.length;d++){try{var u=window["t"+secuencia[d]+"_slide"],c;if(suspdata.status["t"+u.uid]){c=suspdata.status["t"+u.uid].sublocation||""}if(u.esEjercicio&&(!blink.activity.pull||blink.activity.pull&&u.includedInPull)){u.evalNumElements();if(u.numElementos>0){n++}suspdata.status["t"+u.uid]=u.getSuspendData(e);suspdata.tieneCorregiblesPendientes=suspdata.tieneCorregiblesPendientes||u.slidePending();if(u.clasificacionprofesor!=-1)i=true;if(u.tieneProgreso()){if(u.eje_categoria!=0&&u.getClassification()!=-1&&(u.esAutocorregible||typeof ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES!=="undefined"&&!ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES)){var p=parseInt(u.eje_categoria);if(_.isUndefined(suspdata.clasificacion_ejes[p])||_.isNaN(suspdata.clasificacion_ejes[p]))suspdata.clasificacion_ejes[p]=10*u.getClassification();else suspdata.clasificacion_ejes[p]+=10*u.getClassification();if(_.isUndefined(s[p])||_.isNaN(s[p]))s[p]=1;else s[p]++}if(u.tieneRespuestas()&&(!blink.activity.pull||blink.activity.pull&&u.includedInPull)){o++;if(u.intentos>0){a[r++]=u.uid}}}}else{suspdata.status["t"+u.uid]=u.getSuspendData();l=d}if(u.containsGeogebra()){if(!suspdata.status["t"+u.uid]){suspdata.status["t"+u.uid]=new Object}suspdata.status["t"+u.uid].geogebra=u.getGeogebraObjectState();u.geogebra=suspdata.status["t"+u.uid].geogebra;if(!u.esEjercicio){suspdata.status["t"+u.uid].clasificacion=u.getGeogebraObjectScore();u.clasificacion=suspdata.status["t"+u.uid].clasificacion}}if(u.sublocation){suspdata.status["t"+u.uid].sublocation=u.sublocation}else if(c!=""){suspdata.status["t"+u.uid].sublocation=c;u.sublocation=c}if(typeof u.includedInPull!="undefined"){suspdata.status["t"+u.uid].includedInPull=u.includedInPull}else{suspdata.status["t"+u.uid].includedInPull=false}}catch(e){blink.log.error(e)}}_.each(suspdata.clasificacion_ejes,function(e,t){suspdata.clasificacion_ejes[t]=suspdata.clasificacion_ejes[t]/s[t]});suspdata.tieneCorrecciones=i;suspdata.avance=n!=0?100*o/n:100*(l+1)/secuencia.length;suspdata.transpHechas=a.join(",");suspdata.tools={};$.each(blink.tools.manager.tools,function(){suspdata.tools[this.name]=this.getGlobalStatus()})}function corregirTodaClase(){SCORMUpdate=false;for(var e=0;e<secuencia.length;e++){try{var t=window["t"+secuencia[e]+"_slide"];if(t.esEjercicio&&t.esAutocorregible){if(t.solutionShown)t.hideSolution();t.correct(false,true)}}catch(e){blink.log.error(e)}}blink.activity.cerrando=true;SCORMUpdate=true}function loadSuspendData(e){SCORMUpdate=false;var t=false;if(e!=""){try{suspdata=json_decode(e)}catch(e){window.scormFailed=true;blink.log.error("parse ",e)}}else{suspdata.status=new Object}if(suspdata.init_time==null&&!(blink.user.esProfesor()&&checkModoCorreccion())){suspdata.init_time=initTime.getTime()}for(var i=0;i<secuencia.length;i++){try{var s=window["t"+secuencia[i]+"_slide"];s.evalNumElements();if(s!=undefined){statusi=suspdata.status["t"+s.uid];if(!statusi&&s.uidOrig!==""){statusi=suspdata.status["t"+s.uidOrig]}if((esProfesor||typeof esEditor!=="undefined"&&esEditor||typeof esEditorial!=="undefined"&&esEditorial)&&modoClase!==4&&modoClase!==3&&(typeof statusi!=="undefined"&&typeof statusi.numElementos!=="undefined"&&s.numElementos!==statusi.numElementos)&&!t){t=true;_showAlert(textweb("notify_changes_pending"))}s.loadSuspendData(statusi)}}catch(e){window.scormFailed=true;blink.log.error("loadSuspendData "+i,e)}}blink.events.on("managerTools:inited",function(){_.each(suspdata.tools,function(e,t,i){var s=blink.tools.manager.tools[t];s&&s.setGlobalStatus(e)})});SCORMUpdate=true}function pintaNota(e){if(e=="")$("#revision_nota").html("-").removeClass("r_aprobado r_suspenso").addClass("r_aprobado");else $("#revision_nota").html(obtenerNota(e)).removeClass("r_aprobado r_suspenso").addClass(esAprobado(e)?"r_aprobado":"r_suspenso")}function pintaNotaTransp(e,t){blink.theme.pintaNotaTransp(e,t)}function pintaComentariosProfesor(e,t){}function obtenerNota(e){if(!window.maxclasificacion)return"";if(isNaN(e)||isNaN(maxclasificacion))return"";if(!e&&e!==0)return"";if(parseInt(e)<0)e=0;if(decimalesclasificacion==undefined)decimalesclasificacion=1;return ajustaDecimales(maxclasificacion*e/100,decimalesclasificacion)}function getFactorNotaRaw(){return 100/maxclasificacion}function esAprobado(e){if(isNaN(e))return true;return e>=50}function pintaNotaDecimales(e){if(isNaN(e))return"";if(decimalesclasificacion==undefined)decimalesclasificacion=1;ret=ajustaDecimales(e,decimalesclasificacion);return pintaNotaNumero(ret)}function pintaNotaNumero(e,t){if(t=="toc")return e;var i=",";if(sepDecimal)i=sepDecimal;return(""+e).replace(".",i)}function ajustaDecimales(e,t){if(isNaN(e))return"";if(e==maxclasificacion)return e;aux=Math.pow(10,t);return(Math.round(e*aux)/aux).toFixed(t)}function array_avg(e){n=0;s=0;for(a in e){if(e[a]!=null&&typeof e[a]==="string")e[a]=e[a].replace("%","");if(!isNaN(e[a])&&e[a]!=null){s+=parseFloat(e[a]);n++}}if(n==0)return 0;return s/n}function cambiaNota(prefijo,i){eval("var slide = "+prefijo+"_slide;");if(puedeCorregir){slide.cambiaNota(i)}slide.update(false,true);return true}var soloContenido=true;var pendienteCalificacionProfesor=false;function calcularClasificacion(e){var t=0,i=0;var s=0;pendienteCalificacionProfesor=false;soloContenido=true;numejercicios_connota=0;var o,a,r=false;if(esWeb){clasificacion=blink.activity.currentStyle.getClasificacionActividadWeb(cmi);p=clasificacion}else{for(var n=0;n<secuencia.length;n++){try{var l=window["t"+secuencia[n]+"_slide"];if((!blink.activity.pull||blink.activity.pull&&l.includedInPull)&&l.esEjercicio&&l.esEvaluable&&(l.esEvaluableManual!=SLIDE_NO_EVALUABLE||blink.activity.esdeber||esExamen)){soloContenido=false;o=l.getClassification();a=o!==""||l.hasGrade();r=r||a;t++;if(ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES&&l.esAutocorregible){numejercicios_connota++}if(!ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES||l.esAutocorregible){i+=a?Math.max(parseFloat(o),0):0}var d=!l.esAutocorregible||l.esJuegoAutoevaluable,u=l.clasificacion==-1,c=l.clasificacionprofesor==-1;if(d&&u&&c)pendienteCalificacionProfesor=true}else{if(l.clasificacion==1)s=n}}catch(e){blink.log.error(e);o=0}}var p=0;if(numejercicios_connota>0){p=r?parseInt(i/numejercicios_connota*100):""}else if(t>0){p=r?parseInt(i/t*100):""}else{p=""}}if(pendienteCalificacionProfesor&&e&&!ALUMNO_SIN_PROFESOR)return"P";return p}function calcularScoreAverage(){var e=-1,t=0,i=0;var s=-1,o=0,a=0;var r=-1,n=0,l=0;var d=-1,u=0,c=0;var p=0,h=secuencia.length;for(p;p<h;p++){try{var f=window["t"+secuencia[p]+"_slide"];if((!blink.activity.pull||blink.activity.pull&&f.includedInPull)&&f.esEjercicio&&f.esEvaluable&&!f.esContenido){if(f.esEvaluableManual!=SLIDE_NO_EVALUABLE||blink.activity.esdeber||esExamen){var m=f.getClassification();var v=m!==""||f.hasGrade();if(v&&m==0){if(!f.esAutocorregible&&f.clasificacionprofesor==-1){v=false}}var g=0;m=parseFloat(m)||0;g=Math.max(parseFloat(m),0);i++;t+=g;if(v){a++;o+=g;if(f.esAutocorregible||f.esJuegoAutoevaluable){c++;u+=g}}if(f.esAutocorregible||f.esJuegoAutoevaluable){l++;n+=g}}}}catch(e){blink.log.error(e)}}if(i>0){e=parseInt(t/i*100)}if(a>0){s=parseInt(o/a*100)}if(l>0){r=parseInt(n/l*100)}if(c>0){d=parseInt(u/c*100)}return[e,s,r,d]}function getSuspendData(){return json_encode(suspdata)}function onCorrectSlide(e,t,i,s,o,a){var r=e*t/100-i*s/100;var n=t-s;if(n>0)r=r/n*100;else r=0}var timeClock;var timerClock=0;function refreshClock(e,t){var i=document.getElementById(t);if(i){i.innerHTML=(""+(100+Math.floor(e/60))).substring(1,3)+":"+(""+(100+Math.floor(e%60))).substring(1,3);if(e<=0){stopClock();finishTime()}else{timeClock=e-1;if(e<=59){$(".duration-wrapper").addClass("ending").find(".duration").removeClass("bounceInDown").addClass("shake")}}}}function startClock(e,t){refreshClock(e,t);timeClock=e-1;timerClock=setInterval("refreshClock(timeClock, '"+t+"')",1e3)}function stopClock(e){if(timerClock!=0)clearInterval(timerClock)}function setDisabledLink(e,t){document.getElementById(e).disabled=t}function setLabelLink(e,t){document.getElementById(e).innerHTML=t}function loadSplitPane(o,i){var a=YAHOO.util.Dom,e=YAHOO.util.Event,r=null,n=null;e.onDOMReady(function(){var s=parseInt(a.getStyle(o+"pg","width"),10);r=a.get(o+"left");n=a.get(o+"right");if(i!=""&&i!="0"){a.setStyle(r,"width",835-i+"px");a.setStyle(n,"width",i+"px")}else{a.setStyle(r,"width","500px");a.setStyle(n,"width","335px")}var e=s-10;var t=new YAHOO.util.Resize(o+"left",{handles:["r"],minWidth:10,maxWidth:e,proxy:true});t.on("resize",function(e){var t=e.width;a.setStyle(n,"height","");var i=s-t-6;a.setStyle(n,"width",i+"px");if(document.f[o+"_imagezoom"]){document.f[o+"_imagezoom"].value=i}});t.on("endResize",function(e){autozoomElement(o+"_img1",true,false);marcarHaCambiado(getIDSlideFromPrefijo(o));adjust_IE7_img(o)})})}function updateNota(e){if(typeof e!=="undefined"&&e!==null){blink.theme.updateNota(e)}else{blink.theme.updateNota()}}function updateComentariosProfesor(){var e=$("#comentario_profe_transp").val();if(e==undefined)e=$("#comentario_profe_transp_t"+window.activeSlide).val();if(esProfesor&&idalumno){e=encodeURIComponent(e);window["t"+window.secuencia[window.activeSlide]+"_slide"].comentariosprofesor=e;updateSCORM();url="/LMS/ajax.php?op=slide.slidecorrected&idslide="+idtransact+"&idclase="+idclase+(idalumno!=""?"&idalumno="+idalumno:"");getAJAX(url,standardAJAX)}}function adjust_IE7_img(prefijo){if($.browser.msie&&$.browser.version.substr(0,1)<=7){$("#"+prefijo+"_img1").each(function(){var wdiv=$(this).parent().parent().width();var mxh=eval(prefijo+"_maxHeight");$(this).css("max-height","").width(wdiv).height("");if($(this).height()>=mxh)$(this).height(mxh)})}}var oldActiveSlide;function _inicioShowSlide(e){if(!editar){var t=window["t"+window.secuencia[e]+"_slide"];if(t)t.onBeforeShow()}}function _finShowSlide(e){updateButtons();if(!editar){var t=window["t"+window.secuencia[e]+"_slide"];if(t)t.onShow();if(!window.completed){document.getElementById("mp3player").style.display="none";if(t)t.play()}}autozoomElement("t"+window.secuencia[e]+"_img1",false);$("li[id='itemSlide_"+secuencia[oldActiveSlide]+"']").removeClass("on");$("li[id='itemSlide_"+secuencia[e]+"']").addClass("on");setTimeout(function(){pagLoad(e)},500);posicionarBorrador();redrawCanvas(true);if(!hideCanvasElement){setPizarraOn(false,0)}adjust_IE7_img("t"+secuencia[e]);blink.events.trigger("showSlide:end",window.secuencia[e])}function showSlide(e,t,i){return blink.theme.showSection(e,t,i)}function onAfterShowSlide(e){}function updateButtons(){if(!editar){if(checkModoExamen()&&!checkPuedeEditar()){}}$("[id^=transp]").each(function(){slideId=parseInt($(this).attr("id").substring(6));posSlide=0;for(k=0;k<secuencia.length;k++){if(secuencia[k]==slideId){posSlide=k;break}}if(editar){$(this).find("[id=progressbar_text]").html(posSlide+1+" / "+secuencia.length)}$(this).find("#previous_up, #previous_down").each(function(){if(posSlide>0)$(this).removeAttr("disabled").removeClass("disabled");else $(this).attr("disabled","disabled").addClass("disabled")});$(this).find("#next_up, #next_down").each(function(){if(!_permitirFinishClass&&posSlide==secuencia.length-1)$(this).attr("disabled","disabled").addClass("disabled");if((editar||window.completed)&&posSlide<secuencia.length-1)$(this).removeAttr("disabled").removeClass("disabled");if(posSlide<secuencia.length-1||!_permitirFinishClass){if($(this).html().length!=0)$(this).html(textweb("bottomcourse_2"));else $(this).attr("title",textweb("bottomcourse_2"))}else{if($(this).html().length!=0)$(this).html(textweb("bottomcourse_17"));else $(this).attr("title",textweb("bottomcourse_17"))}})})}function nextSlide(e){return blink.theme.showNextSection(e)}function onBeforeChangeSlide(){}function previousSlide(e){return blink.theme.showPrevSection(e)}function stopSlideEffects(){try{if(VKI_close)VKI_close()}catch(e){blink.log.error(e)}stopButtonPlaySoundPressed();if(esInfantil){if($(".miniaturas").is(":visible"))mostrarMiniaturasInfantil();hideLupa()}}function initClassDrag(){var r=YAHOO.util.Dom;var s=YAHOO.util.Event;var n=YAHOO.util.DragDropMgr;YAHOO.example.DDApp={init:function(){new YAHOO.util.DDTarget("listaSlides");for(i=0;i<secuencia.length;i++){new YAHOO.example.DDList("itemSlide_"+secuencia[i])}},updateIDs:function(e){var s=0;$("li[id^='itemSlide_']").each(function(e,t){if(r.getStyle(this.id,"visibility")!="hidden"){var i="itemSlide_"+secuencia[s];$("li[id='"+i+"'] > a > span").html(""+(s+1));s++}})},updateOrder:function(e){var s=secuencia[activeSlide];var o=0;$("li[id^='itemSlide_']").each(function(e,t){if(r.getStyle(this.id,"visibility")!="hidden"){var i=this.id.indexOf("_");secuencia[o]=this.id.substring(i+1);if(secuencia[o]==s){activeSlide=o}o++}});this.updateIDs()},switchStyles:function(){}};YAHOO.example.DDList=function(e,t,i){YAHOO.example.DDList.superclass.constructor.call(this,e,t,i);this.logger=this.logger||YAHOO;var s=this.getDragEl();r.setStyle(s,"opacity",.9);this.goingUp=false;this.lastX=0};YAHOO.extend(YAHOO.example.DDList,YAHOO.util.DDProxy,{startDrag:function(e,t){this.logger.log(this.id+" startDrag");var i=this.getDragEl();var s=this.getEl();r.setStyle(s,"visibility","hidden");i.innerHTML=s.innerHTML;r.setStyle(i,"text-align","center");r.setStyle(i,"border","0px solid gray")},endDrag:function(e){var t=this.getEl();var i=this.getDragEl();r.setStyle(i,"visibility","");var s=new YAHOO.util.Motion(i,{points:{to:r.getXY(t)}},.2,YAHOO.util.Easing.easeOut);var o=i.id;var a=this.id;s.onComplete.subscribe(function(){r.setStyle(o,"visibility","hidden");r.setStyle(a,"visibility","");var e=r.get("listaSlides");YAHOO.example.DDApp.updateOrder(e)});s.animate();updateButtons();marcarHaCambiado()},onDragDrop:function(e,t){if(n.interactionInfo.drop.length===1){var i=n.interactionInfo.point;var s=n.interactionInfo.sourceRegion;if(!s.intersect(i)){var o=r.get(t);var a=n.getDDById(t);o.appendChild(this.getEl());a.isEmpty=false;n.refreshCache()}}},onDrag:function(e){var t=s.getPageX(e);if(t<this.lastX){this.goingUp=true}else if(t>this.lastX){this.goingUp=false}this.lastX=t},onDragOver:function(e,t){var i=this.getEl();var s=r.get(t);if(s.nodeName.toLowerCase()=="li"){var o=i.parentNode;var a=s.parentNode;if(this.goingUp){a.insertBefore(i,s)}else{a.insertBefore(i,s.nextSibling)}n.refreshCache()}}});s.onDOMReady(YAHOO.example.DDApp.init,YAHOO.example.DDApp,true)}var offset=0;var numero_miniaturas=7;function pagLoad(e){if(blink.isTablet)return false;if($("#paginador").length){if(window.myScroll){myScroll.scrollToElement("li:nth-child("+(e+1)+")",500)}else{$("#listaSlides").width(secuencia.length*122);var t=new YAHOO.util.Anim("listaSlides",{left:{to:-122*e}});t.animate();offset=e;numSlides=secuencia.length;document.getElementById("listaSlides_pagprevious").disabled=false;if(offset>=numSlides-numero_miniaturas){document.getElementById("listaSlides_pagnext").disabled=true}}}return false}function muestraNext(){$("#listaSlides_pagnext").show()}function muestraPrev(){$("#listaSlides_pagprevious").show()}function pagNext(){if($("#paginador").length){if(window.myScroll){myScroll.scrollTo(122*3,0,500,true)}else{numSlides=secuencia.length;if(offset<numSlides-numero_miniaturas){$("#listaSlides_pagnext").hide();var e=new YAHOO.util.Anim("listaSlides",{left:{by:-366}});e.animate();setTimeout("muestraNext()",1e3);offset+=3;document.getElementById("listaSlides_pagprevious").disabled=false;if(offset>=numSlides-numero_miniaturas){document.getElementById("listaSlides_pagnext").disabled=true}}}}return false}function pagPrevious(){if($("#paginador").length){if(window.myScroll){myScroll.scrollTo(-122*3,0,500,true)}else{numSlides=secuencia.length;if(offset>0){movimiento=Math.min(offset,3);$("#listaSlides_pagprevious").hide();var e=new YAHOO.util.Anim("listaSlides",{left:{by:122*movimiento}});e.animate();setTimeout("muestraPrev()",1e3);offset-=movimiento;document.getElementById("listaSlides_pagnext").disabled=false;if(offset<=0){document.getElementById("listaSlides_pagprevious").disabled=true}}}}return false}function showNewSlideDlg(e){showMsgBox("","/LMS/msgbox.php?op=slide.newslide&idcurso="+idcurso+"&idclase="+e,771);return false}function createNewSlide(e,t,i){return blink.theme.createNewSlide(e,t,i)}function onFinishCreatingNewSlide(e,t,i,s){blink.theme.onFinishCreatingNewSlide(e,t,i,s)}function deleteSlide(){blink.theme.deleteSlide()}function cloneSlide(){blink.theme.cloneSlide()}function initRichEditorGroup(){$(".js-rich-group").each(function(e,t){blink.activity.edit.configureRichInput($(t))})}function initClone(){this.initRichEditorGroup();if(palabrasArray!=undefined){var t="t"+secuencia.max();if(palabrasArray[t]!=undefined&&palabrasArray[t].length>=1){var i=$("#transp"+t);$.each(palabrasArray[t],function(e){addPalabraImagen(t,this,e,"editar");addDraggable($("#"+t+"_thumb_"+e),i)})}}}function generaThumb(e){return generaThumbSlide(e,$("[name=t"+e+"_type]").val(),$("[name=t"+e+"_img1v]").val(),true)}function onFinishSaving(e){e=trim(e);if(e.indexOf("OK")!=0){var t="";if(e.indexOf("ERROR")==0&&e.length>5&&e.substr(5)!=textweb("error_general_AJAX"))t=e.substr(5);else t=textweb("edit_slide_47");_showAlert(t);blink.theme.buttonState.disabled(".guardar",false);return}if(blink.isApp)blink.rest.updateofflineWithoutReload();var i=e.substring(2).split(",");for(var s=0;s<secuencia.length;s++){$("input[name=t"+secuencia[s]+"_idtransp]").val(i[s])}hora=new Date;$("#msgAJAXClass").html(textweb("course_51")+" "+hora.getHours()+":"+pintaDosCifras(hora.getMinutes())+":"+pintaDosCifras(hora.getSeconds())).showBlink();haCambiado=false;slides_con_cambios=new Array;if(CKEDITOR.instances){for(inst in CKEDITOR.instances){var o=CKEDITOR.instances[inst].container.find(".bck-video-preview.saving").$;_.each(o,function(e){$(e).removeClass("saving").trigger("click")});CKEDITOR.instances[inst].resetDirty()}}}var haCambiado=false;var slides_con_cambios=new Array;function marcarHaCambiado(e){haCambiado=true;if(e!=null&&slides_con_cambios.join().indexOf(e)==-1)slides_con_cambios.push(e)}function verificarHaCambiado(){if(window.CKEDITOR)if(CKEDITOR.instances){for(ed in CKEDITOR.instances)if(CKEDITOR.instances[ed].checkDirty()){marcarHaCambiado(getIDSlideFromIdElement(ed.substring(2)))}}return haCambiado}function cambiarVisualizacion(e,t,i){if(i==1)redireccionar("/coursePlayer/clases2.php?"+(e?"editar=1&":"")+t,undefined,false);else if(i==2)redireccionar("/coursePlayer/curso2.php?"+(e?"editar=1&":"")+t,undefined,false);else if(i==3)redireccionar("/coursePlayer/productos.php?"+(e?"editar=1&":"")+t,undefined,false);else if(i==4)redireccionar("/coursePlayer/librodigital_html.php?"+(e?"editar=1&":"")+t,undefined,false)}function finishTime(){_showAlert(textweb("edit_slide_48"));finishClass(true)}function getMsgConfirmFinishClass(){return textweb("edit_slide_50")}function formatEndClassScreen(){}function getFinishMessage(e){if(e>=5){return textweb("course_64")}else{return textweb("course_65")}}function finishClass(e,t){var t=t||"";return blink.theme.finishClass(e,t)}function formatForCategories(e){}function actualizarCamposTexto(e){if(e==undefined)e=true;for(var t in CKEDITOR.instances){try{if(e){ocultarPreview(CKEDITOR.instances[t])}else{CKEDITOR.instances[t].setData(document.f[t.substring(2)].value)}}catch(e){}}}function ocultarPreview(e){if(typeof e!=="undefined"){var t=e.container.find(".bck-video-preview.enabled").$;_.each(t,function(e){$(e).removeClass("saving").trigger("click")});e.updateElement();_.each(t,function(e){$(e).addClass("saving")});var i=e.container.find(".vjs-tech video, video.vjs-tech").$;if(i.length){_.each(i,function(e){if($(e).parents(".bck-video-container2").length){var t=$($(e).parents(".bck-video-container2")[0]).find(".bck-video-preview");if(t.length){t.trigger("click");if(t.hasClass("enabled"))t.trigger("click")}}})}}return true}function saveClass(e){$("[name=secuencia]").val(secuencia.join(","));$("[name=slides_con_cambios]").val(slides_con_cambios.join(","));$("[name=t"+blink.activity.secuencia[blink.activity.currentSection]+"_title]").focus();borrarValoresDefecto();actualizarCamposTexto();var t=validarTransparencias(true);if(esInfantil)updateHtmlFromPreview();$("#msgAJAXClass, #msgAJAXClassError").html("").hideBlink();if(t!=""){mostrarMensajeTransp(t)}else getAJAX("/LMS/ajax.php?op=activity.executesaveclass"+(e?"&update_original=1":""),onFinishSaving,"mainform",undefined,undefined,true);return false}function validarTransparencias(e){var t="";var i="";var s="";for(var o=0;o<secuencia.length;o++){var a=secuencia[o];var r=window["validat"+a];if(typeof r==="function"){window.miFuncion=r();if(window.miFuncion!==true){t+=i+(o+1);i=","}}}if($("#mainform").serializeArray().length>MIV){_showAlert(textweb("edit_slide_111"));mostrarMensajeTransp(textweb("edit_slide_110"))}if(t!=""){lastSep=t.lastIndexOf(",");if(lastSep!=-1)t=t.substring(0,lastSep)+" y "+t.substring(lastSep+1);s=textweb("edit_slide_msg").replace("%s",t);if(e)_showAlert(s)}return s}function validaPreguntas(e,t){return blink.theme.validaPreguntas(e,t)}function respuestaValida(e,t){if(e=="clasificar"){var i=$.trim($("select[name='"+t+"']").find(":selected").text());return i!=""&&i!=textweb("edit_slide_6")}else if(e=="ejercicio"){return $("input[name='"+t+"']").is(":checked")}else if(e=="test"){return $.trim($("input[name='"+t+"']").val())!=""}else if(e=="vf"){var i=$.trim($("select[name='"+t+"']").find(":selected").text());return i!=""&&i!="-- "+textweb("edit_slide_6")+" --"}return true}function validaBlanks(e,t){return blink.theme.validaBlanks(e,t)}function validaBlankImages(e,t){return blink.theme.validaBlankImages(e,t)}function validaCrossWords(e,t){var i=$.trim($('input[name="'+t+'_hidden_word"]').val());$('input[name="'+t+'_hidden_word"]').val(i);var s=i.length;var o=0;$('input[name^="'+t+'_text"]').each(function(){$(this).val($.trim($(this).val()));if($(this).val()!=""&&$(this).val()!=$(this).attr("help")){o++}});var a=0;$('input[name^="'+t+'_word"]').each(function(){$(this).val($.trim($(this).val()));if($(this).val()!=""&&$(this).val()!=$(this).attr("help"))a++});if(a!=s){return false}$("#"+t+"contenidos_curso .popup_input_err").removeClass("popup_input_err");for(var r=0;r<a;r++){if($('input[name="'+t+"_word_"+r+'"]').val().toUpperCase().indexOf(i[r].toUpperCase())==-1){$('input[name="'+t+"_word_"+r+'"]').parents(".popup_input").addClass("popup_input_err");return false}}if(s==a&&s==o){return true}return false}function validaWordSearch(e,t,i,s){return blink.theme.validaWordSearch(e,t,i,s)}function validaCrossWordsPuzzle(e,t){return blink.theme.validaCrossWordsPuzzle(e,t)}function mostrarMensajeTransp(e,t,i){i=i!=undefined&&Number.isInteger(i)?i:3200;var s={success:{bg:"#3AC62A",color:"#fff"},danger:{bg:"#fc7b73",color:"#fff"},warning:{bg:"#fcf8e3",color:"#8a6d3b"},info:{bg:"#d9edf7",color:"#31708f"},false:{bg:"#fc7b73",color:"#fff"}},o={};o.bg=typeof t!=="undefined"&&typeof s[""+t]!=="undefined"?s[""+t].bg:"#fc7b73";o.text=typeof t!=="undefined"&&typeof s[""+t]!=="undefined"?s[""+t].color:"white";$("#msgAJAXClassNotification").append($("<li>").append($('<span class="msgAJAX alert alert-danger">').html(e).css({background:o.bg,color:o.text})).delay(i).slideUp(400,"linear").queue(function(){$(this).remove()}))}function getOffset(e){var t=0;var i=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;i+=e.offsetTop-e.scrollTop;e=e.parentNode}return{top:i,left:t}}function countWords(e){var t=trim(e);t=t.replace(/\s+/gi," ");if(t.length>0){return t.split(" ").length}return 0}var iframe_zoom;var iframe_forzar;var iframe_resize;function autozoomBody(){$(document.body).css("zoom",1);if($.browser.mozilla){$(document.body).css("-moz-transform","")}var e=$(document).height();var t=$(document).width();var i=$(window).width();var s=$(window).height();var o=Math.min(i/t,s/e);if(o>1)o=1;if($.browser.mozilla){$(document.body).css("-moz-transform","scale("+o+")");$(document.body).css("-moz-transform-origin","0 0");$(document.body).height(e*o)}else{$(document.body).css("zoom",o)}}function autozoomElement(e,t,i,n){if(!$("#"+e).get(0))return;iframe_zoom=e;iframe_forzar=t;iframe_resize=i;setTimeout(function(){try{var e;try{e=$("#"+iframe_zoom).contents().find("body")}catch(e){blink.log.error(e)}if(e){fix_wmode2transparent_swf();var t=e.css("zoom");if(!t&&$.browser.mozilla)t=e.css("-moz-transform");if(t=="normal"||t=="none"||!t)t=1;if(t&&(t=="1"||iframe_forzar)){try{$("#"+iframe_zoom).contents().find("body").css("zoom",1)}catch(e){blink.log.error(e)}if($.browser.mozilla){try{$("#"+iframe_zoom).contents().find("body").css("-moz-transform","")}catch(e){blink.log.error(e)}}var i=$("#"+iframe_zoom).width();var s=0;try{s=$("#"+iframe_zoom).contents().find("body").attr("scrollWidth")}catch(e){blink.log.error(e)}var o=$("#"+iframe_zoom).height();var a=0;try{a=$("#"+iframe_zoom).contents().find("body").attr("scrollHeight")}catch(e){blink.log.error(e)}var r=Math.min(i/s,o/a);if(a>o&&a>1.2*s){r=(i-30)/s}if(r>1)r=1;if(r>.98)r=1;if(n&&r<n)r=n;try{$("#"+iframe_zoom).contents().find("body").css("zoom",r)}catch(e){blink.log.error(e)}if($.browser.mozilla){try{$("#"+iframe_zoom).contents().find("body").css("-moz-transform","scale("+r+")");$("#"+iframe_zoom).contents().find("body").css("-moz-transform-origin","0 0");$("#"+iframe_zoom).contents().find("body").height(a*r)}catch(e){blink.log.error(e)}}if(iframe_resize){$("#"+iframe_zoom).width(s*r);try{if($.browser.msie)$("#"+iframe_zoom).height($("#"+iframe_zoom).contents().find("body").height()+20);else $("#"+iframe_zoom).height($("#"+iframe_zoom).contents().find("html").height())}catch(e){blink.log.error(e)}$(".canvasdivclass").height($("#"+iframe_zoom).height());$("#canvas0").attr("height",$("#"+iframe_zoom).height())}}}}catch(e){blink.log.error(e)}},1e3)}function fix_wmode2transparent_swf(){try{$("body,iframe").contents().find("embed").each(function(){var e=this.cloneNode(true);e.setAttribute("wmode","transparent");$(this).before(e);$(this).remove()});$("body,iframe").contents().find("object").each(function(e,t){var i=$(this).children("embed");if(typeof i.get(0)!="undefined"){if(typeof i.get(0).outerHTML!="undefined"){i.attr("wmode","transparent");$(this.outerHTML).insertAfter(this);$(this).remove()}return true}if(false){var s=this.attributes;var o="<OBJECT ";for(var e=0;e<s.length;e++)o+=s[e].name+'="'+s[e].value+'" ';o+=">";var a=false;$(this).children().each(function(e){if(this.nodeName=="PARAM"){if(this.name=="wmode"){a=true;o+='<PARAM NAME="'+this.name+'" VALUE="transparent">'}else o+='<PARAM NAME="'+this.name+'" VALUE="'+this.value+'">'}});if(!a)o+='<PARAM NAME="wmode" VALUE="transparent">';o+="</OBJECT>";$(o).insertAfter(this);$(this).remove()}})}catch(e){blink.log.error(e)}}var editor_global;var id_editable;function getIDSlideFromIdElement(e){var t=e.indexOf("_");return getIDSlideFromPrefijo(e.substring(0,t))}function getIDSlideFromPrefijo(e){return $("[name="+e+"_idtransp]").val()}function getIDSlideFromPrefijo2(e){return $("#transpid"+e.substring(1)).val()}function finEdicion(){if(editor_global){if(editor_global.checkDirty()){var e=editor_global.getData();$("#"+id_editable).html(e);$("#"+id_editable).prev().val(e);marcarHaCambiado(getIDSlideFromIdElement(id_editable.substring(2)))}editor_global.resetDirty();editor_global.destroy();editor_global=null}}function replaceDivWithEditor(e,t){id_editable=e;if(editor_global)finEdicion();divObj=$("#"+e);editor_global=CKEDITOR.replace(document.getElementById(e),{toolbar:t?"AdminBlinkToolbar":"BlinkToolbar",language:IDIOMA.toLowerCase(),removePlugins:"elementspath",width:divObj.width(),height:divObj.height(),resize_maxHeight:divObj.height(),sharedSpaces:{top:"topSpace"}});editor_global.on("focus",function(e){$("#topSpace").show();e.stopPropagation();e.preventDefault()});editor_global.on("click",function(e){e.stopPropagation();e.preventDefault()});$("#topSpace").show()}function initEditor(t){$(".editable").click(function(e){e.stopPropagation();e.preventDefault();replaceDivWithEditor(this.id,t)});$("#topSpace").click(function(e){e.stopPropagation();e.preventDefault()})}function readyClassSlide(){}function activateImageZoom(){blink.theme.activateImageZoom()}function navigateDigitalBooks(){if(blink.activity.currentStyle&&blink.activity.currentStyle.canNavigateDigitalBooks&&blink.activity.currentStyle.canNavigateDigitalBooks()){blink.theme.navigateDigitalBooks()}}function showSlideModal(e,t,i,s){var o=$("#transp"+blink.activity.currentSection).find("#slideModal"),e=e||"",t=t||"",i=i||"",s=s||"";o.find(".modal-title").first().html(e);o.find(".modal-body").first().html(t);o.find(".btn-primary").first().html(i);o.find(".btn-secondary").first().html(s);o.modal({backdrop:false})}function hideSlideModal(){var e=$(".swipeview-active").find(".js-slide-wrapper").data("slide-index"),t=$("#transp"+e).find("#slideModal");t.modal("toggle");t.find(".modal-title").first().html("");t.find(".modal-body").first().html("");t.find(".btn-primary").first().html("");t.find(".btn-secondary").first().html("")}function uploadedFilesInSlides(e,n){if(e!=undefined){e.forEach(function(e,t,i){if(!!e){if(typeof n==="undefined")n=0;var s=$.parseHTML(e[0])[0].innerText;var o=getMediaType(s.replace(/\s/g,""));var a={video:"uVideo",image:"uImage",sound:"uAudio"};var r=typeof a[o]!=="undefined"?a[o]:"uFile";$('[data-id="'+n+'"]').find("#inputGroup_"+t+" .uploaded-file-content").html(e[0]);$('[data-id="'+n+'"]').find("#inputGroup_"+t+" .icon-uploaded-file").attr("class","icon-uploaded-file").addClass(r);$('[data-id="'+n+'"]').find("#inputGroup_"+t+" .uploaded-file-name .deleteFileUploaded").attr("data-id",e[1]);$('[data-id="'+n+'"]').find("#inputGroup_"+t+" .uploaded-file-editor").showBlink()}})}}function inicializarFilesAsAnswers(e){$("textarea.keyboardInput.hidden, input.keyboardInput.hidden").each(function(){styleRichTextInput(this,e)});$(".js-richeditor-input").change(function(e){changeRichTextInput(this)});$(".js-richeditor").click(function(e){if(!editar){var t=$(this).attr("data-prefix");displayCKEditor(e,window[t+"_slide"].tipo)}});$(".icon-file").off().click(function(){blink.checkConnection(function(){uploadFilesAsAnswers($(this))}.bind(this),function(){_showAlert(textweb("help_conection_error"))})});$(".deleteFileUploaded").off().click(function(){blink.checkConnection(function(){confirm(textweb("borrarArchivoConfirm"))&&borrarFileAsAnswer($(this))}.bind(this),function(){_showAlert(textweb("help_conection_error"))})})}function uploadFilesAsAnswers(e){blink.activity.currentUploadSection=e.closest(".slide-wrapper").data("prefix");var t=e.parents(".input-group").attr("id");var i=e.parents(".js-slide-wrapper").data("id");var s=!$('[data-id="'+i+'"]').find("#"+t+" .uploaded-file-content a").length;if(s||confirm(textweb("subirArchivoConfirm"))){var o=e.parent().siblings(".uploaded-file-editor").find(".deleteFileUploaded");s||borrarFileAsAnswer(o);if(blink.isApp&&!blink.isOfflinePC){if(typeof app!=="undefined"&&app.version>=4.02){var a="insertarArchivoMultimediaSlides&inputGroup="+t+"";var r="/LMS/ajax.php?op=uploadFile.upload&app_id="+idclase+"&idcurso="+idcurso+"&idclase="+idclase+"&activitytype=activity&activityID="+idclase+"&prefijoSeleccionMultimedia="+t+"&callback="+a+"&ref="+encodeURIComponent(null);blink.rest.saveImage(r,t,a)}else{_showAlert(textweb("error_version_app"))}}else{seleccionarMultimedia(idcurso,t,"insertarArchivoMultimediaSlides&inputGroup="+t+"","","",null,"activity",idclase)}}}function borrarFileAsAnswer(e){if(typeof e.attr("data-id")=="undefined")return;var n=e.closest(".slide-wrapper").data("prefix").substring(1);getAJAX("/LMS/ajax.php?op=selectMultimedia2.deleteFile&obj_id="+e.attr("data-id"),function(e){if(e.startsWith("OK")){var t=window["t"+secuencia[n]+"_slide"];var i=t.uid;var s=JSON.parse(e.substr(2));var o=$(".deleteFileUploaded[data-id='"+s.id+"']");o.parents(".uploaded-file-editor").hideBlink();o.siblings(".uploaded-file-content").html("");var a=o.parents(".input-group").attr("id");var r=a.substring(a.lastIndexOf("_")+1);if(suspdata.status["t"+i].marcadoTextBox!=="undefined"){delete suspdata.status["t"+i].marcadoTextBox[r]}updateSCORM()}})}function usuarioPuedeRepetir(){return!!esRepetible&&!blink.activity.esdeber||esProfesor}function scrollToSlideConcatenate(e){if(typeof e!=="undefined"&&e){var t=$("#transp"+e);if(t.length>0){var i=blink.activity.currentStyle.calculateTopOffsetSlide(t);if(i){var s=$(".modo_revision");if(s.length>0){i-=s.height()}var o=typeof blink.activity.currentStyle!=="undefined"&&typeof blink.activity.currentStyle.customContainerScroll!=="undefined"&&blink.activity.currentStyle.customContainerScroll()?blink.activity.currentStyle.customContainerScroll():".swipeview-active > div";var a=$(o);if(a.length>0&&i){a.animate({scrollTop:i},500);return true}}}}return false}function flipboxPositions(e){var r=$("#"+e+"left .bck-flipbox");if(r.length==0){return}r.each(function(e,t){var i=$(t).find(".back"),s=$(t).find(".front");var o,a;if(i.find(".bck-flipbox-section").height()-s.find(".bck-flipbox-section").height()>=0){o=i;a=s}else{o=s;a=i}a.css("position","absolute");o.css("position","relative");r.length==e+1&&r.css("opacity",1)})}function validateParamsARIADragAndDrop(e,t){return typeof e=="string"&&e!=""&&(typeof t=="object"&&t instanceof jQuery&&t.length>0)}function showPopoverARIADragAndDrop(e,t){if(!validateParamsARIADragAndDrop(e,t)){return}var i=$("#"+e+"-aria-popover-content"),s="#"+t.attr("id");if(i.length>0){i.attr("data-id-item",s);t.popover("toggle");$(".popover .popover-content").children(":visible:first").focus()}}function addPopoverEventARIADragAndDrop(e,t,i,s){if(!validateParamsARIADragAndDrop(i,e)){return}t=t||null;e.on("keydown",t,function(e){if(e.keyCode==32){var t="#"+$(this).attr("id");e.preventDefault();if(!$(t).hasClass("disabled")){$(this).attr("aria-grabbed","true");if(typeof s!="undefined"){s($(this))}showPopoverARIADragAndDrop(i,$(t))}}})}function addPopoverARIADragAndDrop(e,t){if(!validateParamsARIADragAndDrop(t,e)){return}var i=$("#"+t+"-aria-popover-content");if(i.length>0){e.popover({html:true,placement:"bottom",trigger:"manual",content:function(){return i.html()}})}blink.popovers&&blink.popovers.register(e)}function addPopoverNavigationARIADragAndDrop(e,l,d){if(!validateParamsARIADragAndDrop(l,e)){return}var t="."+l+"-aria-list-group-item",u=$("#"+l+"-aria-popover-content");if(u.length==0){return}e.on("keydown",t,function(e){var t=e.currentTarget,i=u.attr("data-id-item"),s=$(i),o=$("#"+l+"v"+$(t).data("index"));if(!s||s.length==0){return}if(e.keyCode==13||e.keyCode==32){e.preventDefault();s.attr("aria-grabbed","false");s.popover("hide");if(typeof d=="function"){var a={currentElement:t,slidePrefix:l};d(s,o,a)}}if(e.keyCode===27){e.preventDefault();s.popover("hide");s.attr("aria-grabbed","false");s.focus()}if(e.keyCode===40){e.preventDefault();var r=$(t).next();if(r.length>0){if(r.is(":visible")==false){r=r.next()}r.focus()}}if(e.keyCode===38){e.preventDefault();var n=$(t).prev();if(n.length>0){if(n.is(":visible")==false){n=n.prev()}n.focus()}}})}$(document).ready(function(){if(typeof esExamen!=="undefined"&&esExamen&&blink.user&&blink.user.esAlumno()){$(".class_slide input:text, .class_slide textarea").bind("cut copy paste contextmenu",function(e){e.preventDefault()})}$(".canvas-paint.main-canvas").on("touchstart",function(e){e.stopPropagation();e.stopImmediatePropagation();return})});function Slide_fillblanks(){}Slide_fillblanks.prototype=new Slide;Slide_fillblanks.prototype.esEjercicio=true;Slide_fillblanks.prototype.inputSize=null;Slide_fillblanks.prototype.onBeforeShow=function(){Slide.prototype.onBeforeShow.call(this);if(mostrarSoluciones){this.checkAnswers();var e=this;$("input[id^="+this.prefijo+"]").on("keyup keydown blur update change input",function(){e.checkAnswers()})}};Slide_fillblanks.prototype.onShow=function(){this.useExamples&&this.showExample();Slide.prototype.onShow.call(this)};Slide_fillblanks.prototype.inputSizeWiris=function(e,t,i){e.height(i.height()+12).width(i.width()).parent(".img-input-container").addClass("imgFilled");t.addClass("divImgInput").height(i.height()+4).width(i.width())};Slide_fillblanks.prototype.updateElem=function(e,t,i){var s,o,a;c=$("#"+this.prefijo+"v"+e);s=document.f.elements[this.prefijo+"v"+e];if($(s).length>0){s.value="";$(s).removeClass(this.solutionStyleClass);if(this.respuestas[e]!=undefined){var r=$(s).hasClass("numeric_answer"),n=$(s).hasClass("imgInput");s.value=this.respuestas[e];blink.domain.resizeInputFillBlanks($(s),this,s.value.length);if(i){a=window[(n?"Sol":"Resp")+this.prefijo][e];if(this.isSolutionGroup(a)){this.resultados[e]=this.checkSolutionGroup(this.resultados[e],this.respuestas[e],this.solutionsGroups[a],r||n)}else if(a.indexOf("||")!=-1){this.resultados[e]=this.checkSolutionMultiple(this.resultados[e],this.respuestas[e],a.split("||"),r||n)}else{this.resultados[e]=this.checkSolutionSingle(this.respuestas[e],a,r||n)}}if(this.resultados[e]){i&&this.clasificacion++;this.setDisabled(this.prefijo,true,e)}else{this.setEnabled(this.prefijo,true,e)}if(this.intentos>=this.numMaxIntentos||modoClase!==1&&modoClase!==2){$("#"+this.prefijo+"v"+e).removeClass("droppable ui-droppable")}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[e]!=undefined)){var l="respuesta_ok respuesta_ko",d=this.resultados[e]?"ok":"ko",u="respuesta_"+d,c;c.removeClass(l).addClass(u);c.next(".droppableDiv").removeClass(l).addClass(u);if(c.hasClass("imgInput")){c.parent(".img-input-container").removeClass(l).addClass(u)}!!this.resultados[e]&&c.removeClass("keyboardInput")}$(".fillblanks-draggable input:not(.keyboardInput)").attr("disabled",true)}if(c.hasClass("droppable")){c.attr("disabled",true)}}};Slide_fillblanks.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;$("#"+this.prefijo+"left").find(".txt-wrap").removeClass(this.solutionStyleClass);for(var i=this.firstElementIndex;i<this.numElementos;i++){this.updateElem(i,e,t)}if(t){var s=this.respuestas.length;if(this.useExamples)s--;if(s>0)this.clasificacion=this.clasificacion/s}Slide.prototype.update.call(this,e,t);Slide_fillblanks.prototype.updateImages();Slide_fillblanks.prototype.updateContainer()};Slide_fillblanks.prototype.setDisabled=function(e,t,i){Slide.prototype.setDisabled.call(this,e,t);if(i==undefined)return;e=e!=null?e+"v"+i:this.prefijo;$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").filter("[name"+(!t?"^":"")+"="+e+"],[id"+(!t?"^":"")+"="+e+"]").each(function(){$(this).removeAttr("disabled").prop("readonly",true)})};Slide_fillblanks.prototype.setEnabled=function(e,t,i){e=e+"v"+i;$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").filter("[name"+(!t?"^":"")+"="+e+"],[id"+(!t?"^":"")+"="+e+"]").each(function(){$(this).removeAttr("disabled").prop("readonly",false)})};Slide_fillblanks.prototype.evalNumElements=function(){this.numElementos=0;while(document.f.elements[this.prefijo+"v"+this.numElementos]!=undefined){this.numElementos=this.numElementos+1}};Slide_fillblanks.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;var s=this.prefijo;$("[name^="+this.prefijo+"v]").change(function(){$(this).removeClass("respuesta_ko");$(this).next(".droppableDiv").removeClass("respuesta_ko");if($(this).hasClass("imgInput")){$(this).parent(".img-input-container").removeClass("respuesta_ko")}}).focus(function(){$(this).select()}).each(function(e){var i=e;$(this).keypress(function(e){if(checkEnter(e)){var t=$("[name^="+s+"v]:gt("+i+"):enabled:first");if(t.length==1){t.select()}else if($(".corregir:visible").length==1){correct(true,true)}}})});Slide.prototype.loadSuspendData.call(this,e)};Slide_fillblanks.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown)switchSolution(this.prefijo,true);for(var t=this.firstElementIndex;t<this.numElementos;t++){if(!!document.f.elements[this.prefijo+"v"+t]){this.respuestas[t]=document.f.elements[this.prefijo+"v"+t].value}}}return Slide.prototype.getSuspendData.call(this)};Slide_fillblanks.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=document.f.elements[this.prefijo+"v"+i].value}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_fillblanks.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e,i=t?this.exampleStyleClass:this.solutionStyleClass,s=$("#"+this.prefijo+"left"),o=$("#"+this.prefijo+"v"+e),a=window.decode64(window["Sol"+this.prefijo][e]),r=this.getIdenticalSolutionsCount();o.prop({isExample:t});if(this.isSolutionGroup(a)){var n=this.solutionsGroups[a].solutions,l=[];for(var d=0;d<n.length;d++){l.push(window.decode64(n[d]))}this.configElementForSeveralSolutions(o,l);a=this.getSolutionGroup(this.solutionsGroups[a],o)}else if(a.indexOf("||")!=-1){this.configElementForSeveralSolutions(o,a.split("||"));a=this.getSolutionMultiple(a.split("||"),o)}else if(a.indexOf("&&")!=-1){a=a.replace("&&",",")}var u=a.indexOf("==")==0?a.substring(2):a;a=html_entity_decode(u);var c=a.length;if(blink.isIphone)c=c+2;blink.domain.resizeInputFillBlanks(o,this,c);o.removeClass("respuesta_ok respuesta_ko keyboardInput").addClass(i).val(a).parent(".txt-wrap").addClass(i);var p=blink.isTablet?"tap":"hover";this.showTooltip(true,o,p);if(o.next().hasClass("droppableDiv")){o.next(".droppableDiv").html(a).width(o.width()).show().removeClass("respuesta_ok respuesta_ko keyboardInput")}o.removeAttr("disabled").prop("readonly",true);if(t){o.prop({readonly:true});var h=s.find("[data-dropvalue='"+a+"'] "),a=escapeQuotes(a);if(this.countIdenticalSolutions()){o.addClass("solucion");var f=!(a in r);f&&h.addClass("used solucion")}else{var l=this.getIdenticalSolutionsCount();if(!l[a]){h.addClass("used")}}o.removeClass("droppable ui-droppable");o.parent().addClass("noDroppable")}Slide_fillblanks.prototype.updateImages();Slide_fillblanks.prototype.updateContainer()};Slide_fillblanks.prototype.updateGroupsSolutionsShown=function(){var e,t,i;for(var s=this.firstElementIndex;s<this.numElementos;s++){e=$("#"+this.prefijo+"v"+s);if(e.hasClass("respuesta_ok")){t=window.decode64(window["Sol"+this.prefijo][s]);if(this.isSolutionGroup(t)){i=e.val();this.solutionsGroups[t].solutionsShown.push(i)}}}};Slide_fillblanks.prototype.hideElemSolution=function(e){var t=$("#"+this.prefijo+"v"+e);blink.domain.resizeInputFillBlanks(t,this);t.removeClass(this.solutionStyleClass+" multiple-solution").val("").attr("title","").parent(".txt-wrap").removeClass(this.solutionStyleClass);t.prop("readonly",false);if(mostrarSoluciones){t.next(".droppableDiv").html("&nbsp;")}};Slide_fillblanks.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){this.resetSolutionsShown();for(var e=this.firstElementIndex;e<this.numElementos;e++){this.hideElemSolution(e)}$(".multiple-solution-marker").remove();this.update(false,false)}};Slide_fillblanks.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){if(this.resetAnswersBeforeShowPartialSolution&&esProfesor){this.clearSlide()}var e=this.useExamples?this.exampleIndex:this.firstElementIndex;for(var t=e;t<this.numElementos;t++){this.showElemSolution(t)}this.solutionShown=true;this.idsol=this.numElementos}};Slide_fillblanks.prototype.setWidthElements=function(e){var t=0;var i="",s,o,a;if(this.ajustarCampos){this.evalNumElements();for(var r=this.firstElementIndex;r<this.numElementos;r++){o=window.decode64(window["Sol"+this.prefijo][r]);i=o.split("||").longerContent().replace(/&nbsp;/gi," ");t=blink.utils.getWidthInput(i);$("#"+this.prefijo+"v"+r).removeAttr("maxlength").removeAttr("size").css("width",t+e).data({minWidth:t+e})}}else{s=window["Sol"+this.prefijo];var a=[];for(var r=0;r<s.length;r++){a[r]=decode64(s[r]);if(a[r].indexOf("||")!=-1){a[r]=a[r].split("||").longerContent()}}i=a.longerContent();t=blink.utils.getWidthInput(i);$("input[id^="+this.prefijo).removeAttr("size").css("width",t+e).data({minWidth:t+e})}};Slide_fillblanks.prototype.getIdenticalSolutionsCount=function(){var e={};for(var t=this.firstElementIndex;t<this.numElementos;t++){var i=decode64(window["Sol"+this.prefijo][t]);e[i]=e[i]?e[i]+1:1}return e};Slide_fillblanks.prototype.countIdenticalSolutions=function(){if(blink.theme.isAdaptative()&&typeof blink.activity.currentStyle!=="undefined"&&blink.activity.currentStyle.showRepeatedSolutionsCountAlways()||this.mostrarContadorRespuestas){return true}return false};Slide_fillblanks.prototype.getRespuestasCount=function(){var e={};for(var t=this.firstElementIndex;t<this.numElementos;t++){var i=this.respuestas[t];e[i]=e[i]?e[i]+1:1}return e};Slide_fillblanks.prototype.checkAnswers=function(){this.evalNumElements();var e=this.useExamples,t=[],s=window.decode64(window["Sol"+this.prefijo][0]),o=$("#"+this.prefijo+"left").parents(".class_slide"),a=o.find(".fillblanks-draggable-wrapper"),r=$("#"+this.prefijo+"v"+i);if(s.indexOf("||")!=-1){s=this.getSolutionMultiple(s.split("||"),r)}this.hideCount={};this.isLastSolution={};var n=this.getIdenticalSolutionsCount(),l=this.getRespuestasCount(),d=this.countIdenticalSolutions(),u=this;for(var c in n){var p=l[c]||0,h=n[c]-p,f=a.find('[data-dropvalue="'+c+'"]');u.hideCount[c]=h<1;u.isLastSolution[c]=h==1;if(d){$countItem=f.find(".count");$countItem.text(h);$countItem.toggleClass("hidden",u.hideCount[c]||u.isLastSolution[c])}f.toggleClass("used",u.hideCount[c])}};Slide_fillblanks.prototype.isSolutionGroup=function(e){var t=this.solutionsGroups.__proto__||this.solutionsGroups.constructor.prototype;return e in this.solutionsGroups&&(!(e in t)||t[e]!==this.solutionsGroups[e])};Slide_fillblanks.prototype.cleanResponse=function(e){e=html_entity_decode(e);return e.replace(/[`|Â´|â]/gi,"'")};Slide_fillblanks.prototype.isCorrect=function(e,t){e=this.cleanResponse(e);var i=window.blink.String(e).trim();if(!this.caseSensitive){i.lower()}if(!this.punctuationSensitive){i.removePunctuation()}if(this.espaciosBlancos){i.replaceEspaciosBlancos()}var s=window.sha1(i.value());return s===t};Slide_fillblanks.prototype.isCorrectResponse=function(e,t,i){if(i&&!isValidSHA1(t)){return compararTexto(e,window.decode64(t),true)}else{return this.isCorrect(e,t)}};Slide_fillblanks.prototype.checkSolutionSingle=function(e,t,i){return this.isCorrectResponse(e,t,i)};Slide_fillblanks.prototype.checkSolutionMultiple=function(e,t,i,s){for(var o=0;o<i.length;o++){if(!e){e=this.isCorrectResponse(t,i[o],s)}}return e};Slide_fillblanks.prototype.isResponseUsed=function(e,t){return e.solutionsUsed.indexOf(t)!=-1};Slide_fillblanks.prototype.isResponseShown=function(e,t){return e.solutionsShown.indexOf(t)!=-1};Slide_fillblanks.prototype.checkSolutionGroup=function(e,t,i,s){var o=i.solutionsCrypt;for(var a=0;a<o.length;a++){if(!e){e=this.isCorrectResponse(t,o[a],s)&&!this.isResponseUsed(i,t)}}if(e){i.solutionsUsed.push(t)}return e};Slide_fillblanks.prototype.getSolutionGroup=function(e,t){if(t.hasClass("respuesta_ok")){var i=t.val();e.solutionsShown.push(i);return i}var s,o=e.solutions;for(var a=0;a<o.length;a++){s=window.decode64(o[a]);if(t.prop("title")==s)return s;if(!this.isResponseShown(e,s)){e.solutionsShown.push(s);return s}}};Slide_fillblanks.prototype.getSolutionMultiple=function(e,t){if(e.indexOf(t.val())!=-1){return t.val()}return e[0]};Slide_fillblanks.prototype.resetSolutionsShown=function(){for(var e in this.solutionsGroups){this.solutionsGroups[e].solutionsShown=[]}$(".fillblanks-draggable input:not(.keyboardInput)").attr("disabled",true)};Slide_fillblanks.prototype.configElementForSeveralSolutions=function(e,t){e.addClass("multiple-solution").data("solutions",t).after('<div class="multiple-solution-marker"/>').next(".multiple-solution-marker");var i="hover";var s=e.height()+2;$(".multiple-solution-marker").css("height",s);this.showMultipleMarkerTooltip(true,$(e),i)};Slide_fillblanks.prototype.showMultipleMarkerTooltip=function(e,s,t){var i=$(".multiple-solution-marker");var o={placement:function(e,t){var i=window.innerWidth,s=$(t).siblings(".multiple-solution-marker"),o=s.length>0?s.offset().left:0,a="right";if(i-o<200){a="top"}return a},content:function(){var e=$(this).prev(".solucion").data("solutions"),t='<div id="multiple-solution-tooltip">';e=$(s).data("solutions");if(e&&e.length&&e.length>0){for(var i=0;i<e.length;i++){t+="<div>"+e[i]+"</div>"}t+="</div>"}return t},template:'<div class="popover multiple-solution"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',trigger:t,html:true};if($.isFunction(i.popover)){var a=i.popover(o);blink.popovers&&blink.popovers.register(a)}else{s.val($(s).data().solutions[0]);s.siblings(".multiple-solution-marker").hide()}};Slide_fillblanks.prototype.showTooltip=function(e,t,i){var s={placement:function(e,t){var i="bottom";return i},content:function(){content='<div id="solution-tooltip">';content+="<div>"+t.val()+"</div>";content+="</div>";return content},template:'<div class="popover multiple-solution small"><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',trigger:i,html:true};if($.isFunction(t.popover)){var o=t.popover(s);blink.popovers&&blink.popovers.register(o)}else{t.val($(t).data().solutions[0]);t.siblings(".multiple-solution-marker").hide()}};Slide_fillblanks.prototype.destroyMultipleMarkerTooltip=function(e){if(blink.popovers===undefined||!blink.popovers)return;var t=blink.popovers.list;e.popover("destroy");for(i=0;i<t.length;i++){if($(t[i]).attr("id")==e.attr("id")){t.splice(i,1)}}};Slide_fillblanks.prototype.responseClick=function(e){var t=$(e).hasClass("response")?$(e):$(e).parent(".response");$(".fillblanks-draggable-wrapper .response").removeClass("selected");t.addClass("selected")};Slide_fillblanks.prototype.inputClick=function(e){var t=$("#"+this.prefijo+"contenidos_curso .fillblanks-draggable-wrapper .selected");if(t.length){$(e).val(t.attr("dropvalue")).trigger("change");t.removeClass("selected")}else{$(e).val("").trigger("change")}};Slide_fillblanks.prototype.itemDraggable=function(i,e){e=e||i.closest(".slide-wrapper");i.draggable({revert:true,containment:e,start:function(e,t){i.css({"z-index":20,opacity:.5}).find(".item").width("auto");window.isDragging=true},drag:function(e,t){i.addClass("respuesta_over");if(typeof blink.activity.currentStyle!=="undefined"&&blink.activity.currentStyle&&typeof blink.activity.currentStyle.specificDragAction!=="undefined"){blink.activity.currentStyle.specificDragAction(t)}},stop:function(e,t){i.css({opacity:1});window.isDragging=false}})};Slide_fillblanks.prototype.clearSlide=function(){this.clearSlideComunIni();$(".draggablereturnorigin").removeClass("used");for(var e=this.firstElementIndex;e<this.numElementos;e++){var t=document.f.elements[this.prefijo+"v"+e];var i=$(t).hasClass("imgInput");solution=window[(i?"Sol":"Resp")+this.prefijo][e];if(this.isSolutionGroup(solution)){this.solutionsGroups[solution].solutionsUsed=[]}}this.checkAnswers();$elems=$("[id='transp"+this.prefijo.substring(1)+"']").find("[id^="+this.prefijo+"v]").not("select");$elems.each(function(e,t){$(t).prop("readonly",false);$(t).addClass("keyboardInput");if(this.mostrarSoluciones){$(t).addClass("droppable ui-droppable");$(t).attr("disabled",true)}}.bind(this));this.clearSlideComunFin()};Slide_fillblanks.prototype.filterEvent=function(e){if(e.animationName=="imgInserted"){var t=e.target;Slide_fillblanks.prototype.idImages(t,true)}};Slide_fillblanks.prototype.idImages=function(e,t){var i=e.parentNode,s,o,a,r,t=t||false;if(i.previousSibling!==null&&i.previousSibling.nodeValue!==null){s=i.previousSibling.nodeValue;o=s.substring(s.length-2)}if(i.nextSibling!==null&&i.nextSibling.nodeValue!==null){a=i.nextSibling.nodeValue;r=a.substring(0,2)}if(o=="@@"&&r=="@@"){if(!e.hasAttribute("data-identifier")){var n=Date.now();if($('img[data-identifier="'+n+'"]').length==0){e.setAttribute("data-identifier",n)}else{while($('img[data-identifier="'+n+'"]').length>0){n++}e.setAttribute("data-identifier",n)}}if(!$(e).closest(".item-container").find('input[name$="imgRespuesta"]').first().is(":checked")&&t==false){Slide_fillblanks.prototype.checkImagesOnSave(e)}}};Slide_fillblanks.prototype.imageIsNotAllowedAnswer=function(e){var t=e.parentNode,i,s,o,a;if(t.previousSibling!==null&&t.previousSibling.nodeValue!==null){i=t.previousSibling.nodeValue.trim();s=i.substring(i.length-2)}if(t.nextSibling!==null&&t.nextSibling.nodeValue!==null){o=t.nextSibling.nodeValue.trim();a=o.substring(0,2)}if(s=="@@"&&a=="@@"){return true}return false};Slide_fillblanks.prototype.updateImages=function(){$(".fillblanks-draggable input.imgInput").each(function(){var e=this;if($(e).parent(".img-input-container").length==0){$(e).wrap('<div class="img-input-container"></div>').parent(".img-input-container").append('<div class="img-input-response"></div>')}if($(e).val()!==""){var t=$("body").find('img[data-identifier="'+$(e).val()+'"]').first();$(e).height($(t).height()+12).parent(".img-input-container").addClass("imgFilled").find(".img-input-response").first().html($(t).clone())}else{$(e).parent(".img-input-container").removeClass("imgFilled").find(".img-input-response").first().html("")}});$(".fillblanks-draggable").each(function(){var e=$(this).find("input").last();if($(e).hasClass("imgInput")){$(e).closest("p").addClass("last-image");blink.events.trigger("lastImageResponse")}})};Slide_fillblanks.prototype.updateContainer=function(){$(".fillblanks-draggable .img-input-container").each(function(){var e=this;imgInput=$(e).find(".imgInput").first();if($(imgInput).hasClass("respuesta_ok")){if(!$(e).hasClass("respuesta_ok")){$(e).addClass("respuesta_ok")}}else{$(e).removeClass("respuesta_ok")}if($(imgInput).hasClass("respuesta_ko")){if(!$(e).hasClass("respuesta_ko")){$(e).addClass("respuesta_ko")}}else{$(e).removeClass("respuesta_ko")}if($(imgInput).hasClass("solucion")){if(!$(e).hasClass("solucion")){$(e).addClass("solucion")}}else{$(e).removeClass("solucion")}})};Slide_fillblanks.prototype.checkAllowImages=function(e,t){var i=e.getSelection().getRanges()[0],s=i.startContainer.$.data,o=i.startOffset,a=i.endContainer.$.data,r=i.endOffset,n=$(".swipeview-active").find(".js-slide-wrapper").data("slide-index"),l=$("#transp"+n).find(".slideModal");if(typeof l!="undefined"&&(typeof s==="string"&&s.substring(o-2,o)=="@@")&&a.substring(r,r+2)=="@@"){var d='<p>"'+textweb("slide_img_respuesta")+'" '+textweb("is_disabled")+".</p>"+"<p>"+textweb("forbidden_unless_enabled")+"</p>"+"<p>"+textweb("do_enable")+"</p>";showSlideModal(textweb("disabled_option"),d,textweb("enable_continue"),textweb("not_enable"));l.addClass("warningModal");l.find(".close, .btn-secondary").click(function(){hideSlideModal();l.removeClass("warningModal")});l.find(".btn-primary").click(function(){hideSlideModal();l.removeClass("warningModal");$(".swipeview-active").find('input[name$="imgRespuesta"]').first().prop("checked",true);t(e.name)})}else{t(e.name)}};Slide_fillblanks.prototype.checkImagesOnSave=function(e){var t=$(".swipeview-active").find(".js-slide-wrapper").data("slide-index"),i=$("#transp"+t).find(".slideModal");if(typeof i!="undefined"&&$(".content").find('input[name$="imgRespuesta"]').length!=0){var s='<p>"'+textweb("slide_img_respuesta")+'" '+textweb("is_disabled")+".</p>"+"<p>"+textweb("continue_without_enable")+"</p>"+"<p>"+textweb("do_enable")+"</p>";showSlideModal(textweb("disabled_option"),s,textweb("enable"),textweb("not_enable"));i.addClass("warningModal");$(".slideModal .close").click(function(){hideSlideModal();i.removeClass("warningModal")});$(".slideModal .btn-primary").click(function(){hideSlideModal();i.removeClass("warningModal");$(e).closest(".item-container").find('input[name$="imgRespuesta"]').first().prop("checked",true);saveClass(false)});$(".slideModal .btn-secondary").click(function(){hideSlideModal();i.removeClass("warningModal")})}};Slide_fillblanks.prototype.switchInputDiv=function(e,t,i){if(!mostrarSoluciones||!t.hasClass("droppableDiv"))return;e.addClass("fakeHideField");t.html(i).width(e.width()).show()};$(document).ready(function(){var i=100;blink.events.on("style:loaded",function(){$.when($(".fillblanks-draggable-wrapper .response").each(function(){var e=$(this).find("img").first()||null;var t=typeof blink.activity.currentStyle!=="undefined"&&blink.activity.currentStyle.styleDraggableContainment($(this));Slide_fillblanks.prototype.itemDraggable($(this),t);if(e&&e.attr("height")){e.attr("style","height: "+e.attr("height")+"px !important;");i=e.attr("height")}})).then(function(){if(i>100){blink.events.on("lastImageResponse",function(){$(".last-image").css("margin-bottom",i+"px")})}})});$(".fillblanks-draggable-wrapper").on("mouseenter",".response",function(e){var t=$(this);if(!t.hasClass("disabled")){t.addClass("respuesta_over")}}).on("mouseleave",".response",function(e){var t=$(this);if(!t.hasClass("disabled")){t.removeClass("respuesta_over")}});$.fn.droppable&&$(".fillblanks-draggable input.droppable:not(.keyboardInput)").droppable({accept:".response:not(.solucion)",drop:function(e,t){var i=t.helper,s=String(i.data("dropvalue")),o=$(this);o.removeClass("drag-over");o.parent(".img-input-container").removeClass("drag-over");if(o.hasClass("droppable")&&!o.hasClass("respuesta_ok")&&!o.hasClass("solucion")){if($(i).find("img").length==0&&!o.hasClass("imgInput")){o.val(s).trigger("change")}else if($(i).find("img").length>0&&o.hasClass("imgInput")){o.val(s).trigger("change");o.height($(i).height()+12).parent(".img-input-container").addClass("imgFilled").find(".img-input-response").first().html($(i).find('img[data-identifier="'+s+'"]').first().clone())}}},over:function(e,t){$(this).addClass("drag-over");$(this).parent(".img-input-container").addClass("drag-over")},out:function(e,t){$(this).removeClass("drag-over");$(this).parent(".img-input-container").removeClass("drag-over")}}).each(function(){$(this).wrap('<span class="droppable-container"></span>')});$(".droppable-container").click(function(){var e=$(this).find("input.droppable").first();if($(e).val()!=""&&!$(e).hasClass("respuesta_ok")&&!$(e).hasClass("solucion")){$(e).val("").trigger("change");if($(this).find(".img-input-response").length>0){$(this).find(".img-input-container").first().removeClass("imgFilled");$(this).find(".img-input-response").first().html("")}}});document.addEventListener("animationstart",Slide_fillblanks.prototype.filterEvent,false);document.addEventListener("MSAnimationStart",Slide_fillblanks.prototype.filterEvent,false);document.addEventListener("webkitAnimationStart",Slide_fillblanks.prototype.filterEvent,false)});function Slide_audiorecorder(){}Slide_audiorecorder.prototype=new Slide;Slide_audiorecorder.prototype.esEjercicio=true;Slide_audiorecorder.prototype.esAutocorregible=false;Slide_audiorecorder.prototype.overwriteReviewButtons={principal:{"btn-reset":{}},alumno:{"btn-reset":{}}};Slide_audiorecorder.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_audiorecorder.prototype.onShow=function(){Slide.prototype.onShow.call(this)};Slide_audiorecorder.prototype.update=function(e,t){if(t)this.clasificacion=0;for(var i=0;i<this.numElementos;i++){var s=this.respuestas[i]?this.respuestas[i].replace(/\\n/g,"\n"):"";this._updateFile(i,s);if(mostrarNota){this.pintaNota(i,this.resultados[i])}if(t&&this.resultados[i]!=null){this.clasificacion+=this.resultados[i]/2}}if(t){if(this.numElementos>0)this.clasificacion=this.clasificacion/this.numElementos}!checkPuedeEditar()&&this.setDisabled();Slide.prototype.update.call(this,e,t)};Slide_audiorecorder.prototype.evalNumElements=function(){this.numElementos=$("[id^='"+this.prefijo+"_brec']").filter("input").size()};Slide_audiorecorder.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_audiorecorder.prototype.getSuspendData=function(){for(var e=0;e<this.numElementos;e++){this.respuestas[e]=$("#"+this.prefijo+"_brec"+e+"_h").val()}return Slide.prototype.getSuspendData.call(this)};Slide_audiorecorder.prototype.correct=function(e,t){for(var i=0;i<this.numElementos;i++){this.respuestas[i]=$("#"+this.prefijo+"_brec"+i+"_h").val()}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_audiorecorder.prototype.clearSlide=function(){this.clearSlideComunIni();var t=this.prefijo;$("."+t+"_brec").each(function(e){if($(this).val()!=""){$(this).val("").after('<button id="'+t+"_brec"+e+'" class="btnaudiorecorder btn btn-primary" data-id="'+e+'" tabindex="">'+textweb("slide_audiorecorder_button_label")+"</button>");$(this).siblings("audio").detach()}$("#"+t+"_brec"+e).attr("disabled",false)});this.clearSlideComunFin()};Slide_audiorecorder.prototype.pintaNota=function(e,t){var i="sin_corregir";if(t==0){i="respuesta_ko"}else if(t==1){i="respuesta_regular"}else if(t==2){i="respuesta_ok"}$("[id='"+this.prefijo+"nota"+e+"']").html("<img src='../images/i/"+i+".gif'/>").parent().height($("[id='"+this.prefijo+"v"+e+"']").height())};Slide_audiorecorder.prototype.cambiaNota=function(e){var t=this.resultados[e];if(t==2){t=null}else if(t==null){t=0}else{t++}this.resultados[e]=t;this.pintaNota(e,t);this.clasificacionprofesor=0;for(var i=0;i<this.numElementos;i++){this._updateFile(i,response);this.pintaNota(e,this.resultados[i]);if(this.resultados[i]!=null){this.clasificacionprofesor+=this.resultados[i]/2}}if(this.numElementos>0)this.clasificacionprofesor=this.clasificacionprofesor/this.numElementos;$("#nota_revision").val(numGradeToView(maxclasificacion*this.clasificacionprofesor),"slide_audiorecorder");$("#edicion_nota_transp").val(numGradeToView(maxclasificacion*this.clasificacionprofesor,"slide_audiorecorder"));var s=this.prefijo.split("t")[1];updateNota(s)};Slide_audiorecorder.prototype._updateFile=function(e,t){var i=$("#"+this.prefijo+"_brec"+e),s=$("#"+this.prefijo+"_brec"+e+"_h"),o=s.val();if(!s.size()||!i.size())return;if(t==""||t==o)return;$("#"+this.prefijo+"_brec"+e+"_h").val(t);var a=this.prefijo+"_brec_audio_"+e;var r='<audio id="'+a+'" controls src="/useruploads/r/w/'+window.idclase+"/"+t+'"></audio>';i.replaceWith(r);this.hasFiles=true;$("#"+a).on("play",function(){stopButtonPlaySoundPressed();blink.theme.audio.restartNativePlayers()})};Slide_audiorecorder.prototype.setDisabled=function(){$("#"+this.prefijo+"left").find("button.btnaudiorecorder").prop("disabled",true)};Slide_audiorecorder.prototype.showSolution=function(){return;Slide.prototype.showSolution.call(this);if(checkMostrarSoluciones()){$("#"+this.prefijo+"_saq .hint").show()}};Slide_audiorecorder.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);this.update(false,false)};function Slide_chooseblanks(){}Slide_chooseblanks.prototype=new Slide;Slide_chooseblanks.prototype.esEjercicio=true;Slide_chooseblanks.prototype.onShow=function(){var s=this;for(var e=0;e<s.numElementos;e++){var t=$("#"+this.prefijo+"v"+e);if(!t.length||!t.is("select")){continue}var i=$('[data-id="'+s.prefijo+"v"+e+'"]');i.length&&this.checkSizeEmptyAnswer(i);var o=t.val();var a=i.find("selected").data("value");if(o!=a){i.find("a").removeClass("selected").end().find('[data-value="'+o+'"]').addClass("selected")}i.data("index",e).find("a").click(function(){var e=$(this).parent().data("index");var t=$("#"+s.prefijo+"v"+e);if(t.is(":disabled")||$(this).parent().hasClass("solution-shown"))return;$(this).removeClass("not-selected").addClass("selected").siblings().addClass("not-selected").removeClass("selected respuesta_ko");var i=$(this).data("value");t.val(i).change()})}if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_chooseblanks.prototype.updateElem=function(e,t,i){if(this.respuestas[e]!=""&&this.respuestas[e]!=undefined){var s=document.f.elements[this.prefijo+"v"+e];if($(s).length>0){s.value=this.respuestas[e];if(i){var o=window["Resp"+this.prefijo][e];var a=o.indexOf("||")==-1?[o]:o.split("||");for(var r=0;r<a.length;r++){if(!this.resultados[e]){this.resultados[e]=window.sha1(this.respuestas[e])==a[r]}}}}}if(this.resultados[e]){if(i)this.clasificacion++;this.setDisabled(this.prefijo+"v"+e,true)}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[e]!=undefined)){$("#"+this.prefijo+"v"+e).removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[e]?"ok":"ko")).parent(".select-wrap").removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[e]?"ok":"ko"));$('[data-id="'+this.prefijo+"v"+e+'"]').find("a").removeClass("respuesta_ok respuesta_ko").end().find(".selected").addClass("respuesta_"+(this.resultados[e]?"ok":"ko"))}};Slide_chooseblanks.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){this.updateElem(i,e,t)}if(t){var s=this.respuestas.length;if(this.useExamples)s--;if(s>0)this.clasificacion=this.clasificacion/s}Slide.prototype.update.call(this,e,t)};Slide_chooseblanks.prototype.evalNumElements=function(){this.numElementos=0;while(document.f.elements[this.prefijo+"v"+this.numElementos]!=undefined){this.numElementos=this.numElementos+1}};Slide_chooseblanks.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;var s=this.prefijo;$("[name^="+this.prefijo+"v]").change(function(){$(this).removeClass("respuesta_ko").parent(".select-wrap").removeClass("respuesta_ko")}).focus(function(){$(this).select()}).each(function(e){var i=e;$(this).keypress(function(e){if(checkEnter(e)){var t=$("[name^="+s+"v]:gt("+i+"):enabled:first");if(t.length==1)t.select();else if($(".corregir:visible").length==1){correct(true,true)}}})});Slide.prototype.loadSuspendData.call(this,e)};Slide_chooseblanks.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown){switchSolution(this.prefijo,true)}for(var t=this.firstElementIndex;t<this.numElementos;t++){if(!!document.f.elements[this.prefijo+"v"+t]){this.respuestas[t]=document.f.elements[this.prefijo+"v"+t].value}}}return Slide.prototype.getSuspendData.call(this)};Slide_chooseblanks.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=document.f.elements[this.prefijo+"v"+i].value}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_chooseblanks.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;var i,s;i=window["Sol"+this.prefijo][e];s=window.decode64(i.split("|")[0]);if(this.useExamples&&this.exampleIndex==e){$('[data-name="'+this.prefijo+"v"+e+'"]').addClass("example-w")}$("#"+this.prefijo+"v"+e).removeClass("respuesta_ok respuesta_ko").addClass(t).prop({disabled:true}).val(s).parent(".select-wrap").removeClass("respuesta_ok respuesta_ko").addClass(t);$('[data-id="'+this.prefijo+"v"+e+'"]').children().removeClass("respuesta_ok respuesta_ko");$('[data-id="'+this.prefijo+"v"+e+'"]').addClass("solution-shown").find('[data-value="'+s+'"]').addClass(t)};Slide_chooseblanks.prototype.hideElemSolution=function(e){$("#"+this.prefijo+"v"+e).removeClass(this.solutionStyleClass).val("").parent(".select-wrap").removeClass(this.solutionStyleClass);$('[data-id="'+this.prefijo+"v"+e+'"]').removeClass("solution-shown").find("a").removeAttr("disabled").removeClass(this.solutionStyleClass)};Slide_chooseblanks.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){for(var e=this.firstElementIndex;e<this.numElementos;e++){this.hideElemSolution(e)}this.update(false,false)}};Slide_chooseblanks.prototype.esRespuesta=function(e){return e!==null&&e!==undefined&&e!==""&&e!=="0"};Slide_chooseblanks.prototype.clearSlide=function(){this.clearSlideComunIni();$(".draggablereturnorigin").removeClass("used");$("select[id^="+this.prefijo+"v]").removeAttr("disabled").parent(".select-wrap").removeClass("filled respuesta_ko respuesta_ok");$("span[data-id^="+this.prefijo+"v]").find("a").removeClass();this.clearSlideComunFin()};Slide_chooseblanks.prototype.checkSizeEmptyAnswer=function(e){var t=e.find('[data-value="0"]');if(!t.length){return}var i=e.find('[data-value!="0"]'),s=0,o=0,a,r;i.each(function(){s+=$(this).height();o+=$(this).width()});a=s/i.length;r=o/i.length;t.height(a).width(r)};function Slide_classify(){}Slide_classify.prototype=new Slide;Slide_classify.prototype.esEjercicio=true;Slide_classify.prototype.itemSelected=null;Slide_classify.prototype.onShow=function(){if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_classify.prototype.onAfterShowSlide=function(){var e=$("#"+this.prefijo+"_lista_conceptos").find("img").length,t=$(".swipeview-active").find(".js-slide-wrapper").data("slide-index"),i=!!e;this.setHeightDraggables(i);if(blink.domain.useAriaDragAndDrop()&&t==this.prefijo.substring(1)){this.handleWaitLoad(i,"setFocusFirstItem")}};Slide_classify.prototype.handleWaitLoad=function(e,t){if(e&&!blink.isLoaded){$(window).on("load",function(){this[t]()}.bind(this))}else{this[t]()}};Slide_classify.prototype.setFocusFirstItem=function(){var e=$("#"+this.prefijo+"_lista_conceptos");if(e.length&&e.children(":first").length){e.children(":first").focus()}else{var t=$(".conjunto");if(t.length>=1){var i=0,s=null;do{s=$("#"+this.prefijo+"_lista_grupo"+i);if(s.children(":first").length){s.children(":first").focus();i=t.length}i++}while(i<t.length)}}};Slide_classify.prototype.update=function(e,t){blink.popovers&&blink.popovers.hideAll();if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=null){var s=this.prefijo+"v"+i;if(t){var o=window[this.prefijo+"_resp"][i];this.resultados[i]=o==sha1(this.respuestas[i]);if(!this.resultados[i]){var a=window[this.prefijo+"_preguntas"][i];for(var r=this.firstElementIndex;r<this.numElementos;r++){var n=window[this.prefijo+"_resp"][r];if(r!=i&&n==sha1(this.respuestas[i])){var l=window[this.prefijo+"_preguntas"][r];if(l==a){this.resultados[i]=true;break}}}}}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){$("#"+this.prefijo+"caja"+i).removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[i]?"ok":"ko"));var d=$("#"+this.prefijo+"caja"+i).parent().siblings().children();for(var u=0;u<d.length;u++){if($(d[u]).html()==$("#"+this.prefijo+"caja"+i).html()&&$(d[u]).hasClass("respuesta_ok")){$("#"+this.prefijo+"caja"+i).removeClass("respuesta_ok").addClass("respuesta_ko");this.resultados[i]=false}}}if(this.resultados[i]){if(t)this.clasificacion++;$("#"+s).addClass("disabled")}}}if(t){var c=this.numElementos;if(this.useExamples)c--;if(c>0)this.clasificacion=this.clasificacion/c}Slide.prototype.update.call(this,e,t);if(!blink.theme.isAdaptative()){return}var p=$("#"+this.prefijo+"_lista_conceptos").find("img").length,h=!!p;this.setHeightDraggables(h);this.setHeightTitles()};Slide_classify.prototype.evalNumElements=function(){this.numElementos=window[this.prefijo+"_preguntas"].length;this.numElementosEvaluables=this.numElementos};Slide_classify.prototype.loadSuspendData=function(e){this.evalNumElements();Slide.prototype.loadSuspendData.call(this,e);this.respuestas.join(",");$("#"+this.prefijo+"_lista_conceptos").html("");$("[id^="+this.prefijo+"_lista_grupo]").html("");for(var t=this.firstElementIndex;t<this.numElementos;t++){if(this.respuestas[t]!=null&&this.respuestas[t]!=undefined){this.pintaItemConjunto("lista_grupo"+this.respuestas[t],t)}else{this.respuestas[t]=null;this.pintaItem(t)}}};Slide_classify.prototype.showElemSolution=function(e){if(e==(this.exampleIndex!==null)?this.exampleIndex+1:0){$(".clasificar_conjuntos [id^="+this.prefijo+"caja]").filter(".respuesta_ko").remove();$(".clasificar_conjuntos [id^="+this.prefijo+"caja]").removeClass(".respuesta_ok, .respuesta_ko")}var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;var i=window.decode64(window[this.prefijo+"_sol"][e]);$("#"+this.prefijo+"_lista_conceptos li[id="+this.prefijo+"v"+e+"]").remove();$(".clasificar_conjuntos #"+this.prefijo+"v"+e).remove();this.pintaItemConjunto("lista_grupo"+i,e);$("[id="+this.prefijo+"caja"+e+"]").addClass(t);$("[id="+this.prefijo+"v"+e+"]").addClass("disabled "+t)};Slide_classify.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){var e=this;$("[id^="+this.prefijo+"v]").remove();for(var t=this.firstElementIndex;t<this.numElementos;t++){if(this.respuestas[t]==null){this.pintaItem(t)}else{this.pintaItemConjunto("lista_grupo"+this.respuestas[t],t)}}this.update(false,false);$("[id^="+this.prefijo+"v]").addClass("disabled");if(this.useExamples)this.showExample()}};Slide_classify.prototype.setDisabled=function(e){$("[id='transp"+this.prefijo.substring(1)+"'] .clasificar [id^="+(e!=null?e:this.prefijo)+"]").each(function(){$(this).addClass("disabled")});for(var t=0;t<this.numElementos;t++){try{$("#"+this.prefijo+"v"+t).draggable("destroy").unbind("click")}catch(e){}}};Slide_classify.prototype.addItemGrupo=function(e){if(this.itemSelected!=null){var t=$("#"+this.prefijo+"v"+this.itemSelected);var i=t.find(".bck-audio-container, .bck-video-container2, .player.js-audio-player, .player.js-video-player");if(i.length){blink.theme.removeVideoJS(i,false)}t.remove();this.pintaItemConjunto("lista_grupo"+e,this.itemSelected);this.respuestas[this.itemSelected]=e;this.itemSelected=null;this.setReviewButtons()}};Slide_classify.prototype.removeItemGrupo=function(e,t){$("#"+this.prefijo+"v"+e).remove();this.pintaItem(e);this.setReviewButtons()};Slide_classify.prototype.pintaItem=function(e){var t=$("#"+this.prefijo+"_lista_conceptos"),i=$("#"+this.prefijo+"-mock").clone(),s=window[this.prefijo+"_preguntas"][e];i.attr("id",this.prefijo+"v"+e);if(blink.domain.useAriaDragAndDrop()){i.attr("tabindex","1").attr("draggable","true").attr("aria-grabbed","false").attr("role","button").attr("data-toggle","popover").attr("aria-label",s)}i.data("index",e).find(".caja_inner").attr("id",this.prefijo+"caja"+e).end().find("p").html(s).end().appendTo(t);if(i.find(".class_sonido").length){blink.theme.createAudioButtons(i)}else if(i.find(".class_video").length){blink.theme.createVideoButtons(i)}if(blink.theme.audio.isEmbedded()&&i.find(".bck-audio-player").length){i.css("min-width","235px")}if(!i.hasClass("disabled")&&e!=this.exampleIndex){this.itemDraggable(i)}if(blink.domain.useAriaDragAndDrop()){var o="#"+this.prefijo+"v"+e;var a=this.prefijo;addPopoverARIADragAndDrop($(o),a)}if($.fn.corner){$("#"+this.prefijo+"caja"+e).corner("round 8px").parent().css("padding","3px").corner("round 10px")}};Slide_classify.prototype.setHeightDraggables=function(e){var t=$("#"+this.prefijo+"_lista_conceptos"),i=t.find(".classify-item");if(e&&!blink.isLoaded){$(window).on("load",function(){this.setHeightListElements(i)}.bind(this))}else{this.setHeightListElements(i)}};Slide_classify.prototype.setHeightTitles=function(){var e=$("#"+this.prefijo+"der").find(".conjunto"),t=e.find(".group-name-top");this.setHeightListElements(t)};Slide_classify.prototype.setHeightListElements=function(e){var i=[],t=0,s=e.parent(),o=s.find("img");if(e.length>0){e.each(function(){var e=$(this).height();if(e<=0){var t=$(this.firstElementChild);if(t.length>0){e=t.height()}}if(i.indexOf(e)<0){i.push(e)}});if(s.hasClass("hidden-classify")){s.css({opacity:0,visibility:"visible"}).animate({opacity:1},500)}t=Math.max.apply(null,i);if(t>0){if(i.length>1){e.height(t*1.2)}else{e.height(t)}}s.removeClass("hidden-classify")}};Slide_classify.prototype.pintaItemConjunto=function(e,t){var i=$("#"+this.prefijo+"_"+e),s=$("#"+this.prefijo+"-suit-mock").clone(),o=window[this.prefijo+"_preguntas"][t];if(!i.find($("#"+this.prefijo+"v"+t)).length){s.attr("id",this.prefijo+"v"+t);if(blink.domain.useAriaDragAndDrop()){s.attr("tabindex","1").attr("aria-grabbed","false").attr("role","button").attr("draggable","true").attr("aria-label",o)}s.data("index",t).find("span").attr("id",this.prefijo+"caja"+t).html(o).end().appendTo(i);if(blink.domain.useAriaDragAndDrop()){var a="#"+this.prefijo+"v"+t;var r=this.prefijo;addPopoverARIADragAndDrop($(a),r)}if(s.find(".class_sonido").length){blink.theme.createAudioButtons(s)}else if(s.find(".class_video").length){blink.theme.createVideoButtons(s)}}if(!s.hasClass("disabled")&&t!=this.exampleIndex){this.itemDraggable(s)}};Slide_classify.prototype.itemDraggable=function(o){var a,r,n;o.draggable({revert:true,cancel:".ui-draggable.disabled, .vjs-button, .vjs-slider, .js-audio-player, .js-video-player, .bck-video-player",containment:o.closest(".workspace.clasificar"),start:function(e,t){a=moment(Date.now());n=$(this).parents(".clasify-group");var i=$(this).closest(".slide_main");var s=i.find(".group-box").length&&i.find(".group-box").width()-40;if(s&&$(this).width()>s){$(this).css("width",s);$(this).attr("data-height",$(this).height());$(this).height("auto")}o.css("z-index",20);window.isDragging=true;o.find(".item").length&&o.find(".item").width("auto")},drag:function(e,t){o.addClass("respuesta_over");if(typeof blink.activity.currentStyle!=="undefined"&&blink.activity.currentStyle&&typeof blink.activity.currentStyle.specificDragAction!=="undefined"){blink.activity.currentStyle.specificDragAction(t)}},stop:function(e,t){r=moment(Date.now());if(blink.isAndroid&&n.length){var i=r.diff(a,"miliseconds");if(i<700){var s=$(this).attr("id");$("#"+s).trigger("click")}}if(typeof $(this).data("height")!=="undefined"){$(this).height($(this).data("height"));$(this).attr("data-height","")}$(this).css("width","auto");$(this).css("left","0px");o.css("z-index",0);window.isDragging=false}})};Slide_classify.prototype.tieneRespuestas=function(e){var t=e!=undefined&&e;if(this.respuestas){for(var i=this.firstElementIndex;i<this.respuestas.length;i++){if(this.respuestas[i]!=null&&this.respuestas[i]!==""&&this.respuestas[i]!=undefined){if(!t)return true}else{if(t)return false}}}else if(t)return false;return t||this.intentos>0};Slide_classify.prototype.clearSlide=function(){blink.popovers&&blink.popovers.hideAll();this.clearSlideComunIni();$(".clasificar_conjuntos [id^="+this.prefijo+"v]").remove();for(var e=this.firstElementIndex;e<this.numElementos;e++){$("#"+this.prefijo+"v"+e).removeClass("disabled")}this.exampleShown=false;this.clearSlideComunFin()};Slide_classify.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".js-query"),o=i.find(".js-answer"),a=s.siblings(".js-richeditor-input");i.attr("name",e+"_exer_"+t);if(a.length>0){a.attr({placeholder:a.attr("placeholder")+" "+t});s.attr({name:s.attr("name")+(t-1),id:s.attr("name")+(t-1)})}else{s.attr({name:s.attr("name")+(t-1),placeholder:s.attr("placeholder")+" "+t})}o.attr({name:o.attr("name")+(t-1)});$("#"+e+"pg").find(".js-form-questions").append(i)};function calculaGrupos(e,t,i){var s=_.filter(_.map(t.split(i),function(e){return $.trim(e)}),function(e){return!!e});$("[name^="+e+"_grupos]").val(s.join(i));return s}function updateGrupos(s,e){if(e.indexOf("|")!=-1)var o=calculaGrupos(s,e,"|");else var o=calculaGrupos(s,e,",");if(o){var t={};o=o.filter(function(e){return t.hasOwnProperty(e)?false:t[e]=true});if(!blink.theme.isAdaptative()&&o.length>4){_showAlert(textweb("edit_slide_77"));$("[name='"+s+"_grupos']").focus()}else{var a=[];$("[name^='"+s+"_s_'] option:selected").each(function(){a.push($.trim($(this).text()))});for(var i=0;i<o.length;i++){var r=$("[name^='"+s+"_s_'] option[value = "+i+"]");if(r.length==0){$("[name^='"+s+"_s_']").append($("<option>",{value:i,text:o[i]}))}else{r.text(o[i])}}var n=$("[name^='"+s+"_s_0'] option[value!='']").length;if(n>o.length)for(var i=o.length;i<n;i++)$("[name^='"+s+"_s_'] option[value = "+i+"]").remove();$("[name^='"+s+"_s_']").each(function(e){var t=o.indexOf(a[e]);var i=$("[name='"+s+"_c_"+e+"']").val()=="";if(t<0||i){$(this).find("option:first").prop("selected",true)}else{$(this).find("option[value="+t+"]").prop("selected",true)}})}}else{var n=$("[name^='"+s+"_s_0'] option[value!='']").length;for(var i=0;i<n;i++)$("[name^='"+s+"_s_'] option[value = "+i+"]").remove();$("[name^='"+s+"_s_']").each(function(e){$(this).find("option:first").prop("selected",true)})}}$(document).ready(function(){var l=$(".clasificar_lista").parents(".slide-wrapper").data("prefix");$(document).on("click",".slide-classify .js-add-option",function(e){var t=$(this).closest(".slide-classify").data("prefix");Slide_classify.prototype.addOption(t)});$(".clasificar_lista").on("mouseenter",".classify-item",function(e){$(this).addClass("respuesta_over")}).on("focusin",".classify-item",function(e){$(this).addClass("respuesta_over")}).on("mouseleave",".classify-item",function(e){if(!$(this).hasClass("disabled")){$(this).removeClass("respuesta_over")}}).on("focusout",".classify-item",function(e){if(!$(this).hasClass("disabled")){$(this).removeClass("respuesta_over")}}).on("click",".classify-item",function(e){var t=$(this),i=t.data("index"),s=t.closest(".slide-wrapper").data("prefix");if(!s){s=t.closest(".resizable-content").find(".slide-wrapper").data("prefix")}if(!t.hasClass("disabled")&&!t.hasClass("respuesta_ok")){var o=window[s+"_slide"];if(o.itemSelected==i){t.removeClass("respuesta_checked");o.itemSelected=null}else{$("[id^="+s+"v]").removeClass("respuesta_checked");t.addClass("respuesta_checked");o.itemSelected=i}}$(this).css("width","auto");$(this).css("left","0px")});$(".clasificar_conjuntos").on("click",".conjunto",function(e){var t=$(this),i=t.closest(".slide-wrapper").data("prefix"),s=t.data("index"),o=window[i+"_slide"];o.addItemGrupo(s)}).on("click",".classify-item",function(e){if(blink.domain.useAriaDragAndDrop()&&$(".popover ").length>0&&$(".popover ").is(":visible")){$(".classify-item").popover("hide")}if($(e.target).is("a:not('.player')")){blink.rest.openUrl("viewer",e.target.href);return false}else if($(e.target).is("a.js-audio-player, .vjs-control, .vjs-big-play-button, video.vjs-tech")){return false}var t=$(this),i=t.closest(".slide-wrapper").data("prefix"),s=t.data("index");if(!i){i=$(this).closest(".resizable-content").find(".slide-wrapper").data("prefix")}var o=window[i+"_slide"];if(!t.hasClass("disabled")){var a=t.find(".bck-audio-container, .bck-video-container2, .player.js-audio-player, .player.js-video-player");if(a.length){blink.theme.removeVideoJS(a,false)}t.remove();o.pintaItem(s);o.respuestas[s]=null;o.setReviewButtons();blink.theme.isAdaptative()&&o.setHeightDraggables();$(".swipeview-active .column").length&&$(".swipeview-active .column").trigger("column:resize")}});$.fn.droppable&&$(".clasificar_conjuntos .conjunto").droppable({accept:".classify-item",hoverClass:"conjunto-hover",drop:function(e,t){var i=t.helper,s=i.closest(".slide-wrapper").length?i.closest(".slide-wrapper"):i.closest(".class_slide").find(".slide-wrapper"),o=s.data("prefix"),a=i.data("index"),r=$(this).data("index"),n=window[o+"_slide"];n.itemSelected=a;n.addItemGrupo(r);$(".swipeview-active .column").length&&$(".swipeview-active .column").trigger("column:resize")}});if(blink.domain.useAriaDragAndDrop()){addPopoverEventARIADragAndDrop($(".clasificar_lista"),".classify-item",l,function(){var e=$("#"+l+"-aria-popover-content");if(e.length>0){e.children("a").show();e.children("[data-index='-1']").css("display","none")}});addPopoverEventARIADragAndDrop($(".clasificar_conjuntos"),".classify-item",l,function(e){var t=e.parents(".conjunto.ui-droppable").data("index"),i=$("#"+l+"-aria-popover-content");if(i.length>0){i.children("a").show();i.children('[data-index="'+t+'"]').css("display","none")}});addPopoverNavigationARIADragAndDrop($(document),l,function(e,t,i){var s=$(i.currentElement).length>0?$(i.currentElement):null;if(!e.hasClass("disabled")&&s){var o=s.data("index"),a=window[l+"_slide"],r=e.data("index"),n=e.parent();a.itemSelected=r;if(o>=0){a.addItemGrupo(o)}else if(o==-1){e.remove();a.pintaItem(r);a.respuestas[r]=null;a.setReviewButtons();blink.theme.isAdaptative()&&a.setHeightDraggables();a.itemSelected=null}if(n&&n.children(".classify-item").length>0){n.children(".classify-item:first").focus()}}})}});function Slide_content(){}Slide_content.prototype=new Slide;Slide_content.prototype.esContenido=true;Slide_content.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};function Slide_crosswords(){}Slide_crosswords.prototype=new Slide;Slide_crosswords.prototype.esEjercicio=true;Slide_crosswords.prototype.onShow=function(){if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_crosswords.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=""&&this.respuestas[i]!=undefined){var s=$("#"+this.prefijo+"w"+i);if(s.length>0){s.attr("value",this.respuestas[i]);for(var o=0;o<s.val().length;o++){$("#"+this.prefijo+"letra"+i+"n"+o).html(s.val().charAt(o))}}if(t){var a=window["Resp"+this.prefijo][i];this.resultados[i]=window.sha1(this.respuestas[i].toLowerCase())===a}if(this.resultados[i]){if(t)this.clasificacion++}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){if(this.resultados[i]){$("#"+this.prefijo+"_res_"+i).parent(".respuesta").removeClass("respuesta_ok respuesta_ko").addClass("respuesta_ok");$("#"+this.prefijo+"w"+i).attr("disabled","disabled")}else{$("#"+this.prefijo+"_res_"+i).parent(".respuesta").removeClass("respuesta_ok respuesta_ko").addClass("respuesta_ko")}}}}if(t){var r=this.respuestas.length;if(this.useExamples)r--;if(r>0)this.clasificacion=this.clasificacion/r}Slide.prototype.update.call(this,e,t)};Slide_crosswords.prototype.evalNumElements=function(){this.numElementos=0;while(document.f.elements[this.prefijo+"w"+this.numElementos]){this.numElementos++}this.numElementosEvaluables=this.numElementos};Slide_crosswords.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;var s=this.prefijo;$("[name^="+this.prefijo+"w]").change(function(){$(this).parent(".respuesta").children(".resultado").removeClass("respuesta_ko")}).each(function(e){var i=e;$(this).keypress(function(e){if(checkEnter(e)){var t=$("[name^="+s+"w]:gt("+i+"):enabled:first");if(t.length==1)t.select();else if($(".corregir:visible").length==1){correct(true,true)}}})});Slide.prototype.loadSuspendData.call(this,e)};Slide_crosswords.prototype.getSuspendData=function(){if(this.checkUpdateResponses()){for(var e=0;e<this.numElementos;e++){this.respuestas[e]=$("#"+this.prefijo+"w"+e).val()}}return Slide.prototype.getSuspendData.call(this)};Slide_crosswords.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=$("#"+this.prefijo+"w"+i).val()}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_crosswords.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;var i=this.useExamples&&this.exampleIndex==e;var s=window.decode64(window["Sol"+this.prefijo][e]);var o=0;$("#"+this.prefijo+"w"+e).parent(".respuesta").removeClass("respuesta_ok respuesta_ko").addClass(t).children(".caracter").each(function(){$("span",this).html(s.charAt(o));o++;if(i)$(this).unbind("click")})};Slide_crosswords.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){for(var e=this.firstElementIndex;e<this.numElementos;e++){var t=this.respuestas[e]||"";$("#"+this.prefijo+"w"+e).parent(".respuesta").removeClass("solucion").children(".caracter").each(function(){$("span",this).html(t.charAt(e)||" ")})}if(this.useExamples)this.showExample();this.update(false,false)}};Slide_crosswords.prototype.clearSlide=function(){this.clearSlideComunIni();for(var e=this.firstElementIndex;e<this.numElementos;e++){$("#"+this.prefijo+"w"+e).val("");$("#"+this.prefijo+"w"+e).removeAttr("disabled")}$(".respuesta").removeClass("respuesta_ok respuesta_ko");$(".respuesta").each(function(){$(this).children(".caracter").each(function(){$("span",this).html("")})});this.clearSlideComunFin()};Slide_crosswords.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".js-query"),o=i.find(".js-answer");s.attr({name:s.attr("name")+(t-1),placeholder:s.attr("placeholder")+" "+t});o.attr({name:o.attr("name")+(t-1),placeholder:o.attr("placeholder")+" "+t});$("#"+e+"pg").find(".js-form-questions").append(i)};function updateLabels(e){var t=$("input[name='"+e+"_trueLabel']").val();var i=$("input[name='"+e+"_falseLabel']").val();$("[name^='"+e+"_v']").each(function(){this.options[1].text=t;this.options[2].text=i})}function mostrarInput(e){if(!e.siblings("input").attr("disabled")){var t="";var i=e.parent(".respuesta");i.addClass("activa");i.children(".caracter").each(function(){t+=$(this).children("span").html()});i.children(".caracter").css("display","none");i.children(".resultado").css("display","none");var s=i.children("input[type='text']");s.attr("value",t);s.css("display","block");s.focus();s.select()}}function ocultarInput(e){var t=e.children("input[type='text']");var i=t.attr("value");t.css("display","none");e.children(".caracter").css("display","block");e.children(".resultado").css("display","block");var s=0;e.children(".caracter").each(function(){$(this).children("span").html(i.substr(s,1));s++});e.removeClass("activa")}$(function(){$(document).on("click",".slide-crosswords .js-add-option",function(e){var t=$(this).closest(".slide-crosswords").data("prefix");Slide_crosswords.prototype.addOption(t)})});function Slide_crosswordspuzzle(){}Slide_crosswordspuzzle.prototype=new Slide;Slide_crosswordspuzzle.prototype.esEjercicio=true;Slide_crosswordspuzzle.prototype.clues=null;Slide_crosswordspuzzle.prototype.data=null;Slide_crosswordspuzzle.prototype.puzzleData=null;Slide_crosswordspuzzle.prototype.widget=null;Slide_crosswordspuzzle.prototype.update=function(manual,corregir){if(this.clues==null){this.clues=eval("Clues"+this.prefijo);this.data=eval("Data"+this.prefijo);this.puzzleData=this.getPuzzleData();if(!this.puzzleData.length)return;this.widget=$("#"+this.prefijo+"-puzzle-wrapper").crossword(this.puzzleData,this.prefijo,this)}if(!this.widget)return;if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;this.widget.update(this.respuestas,corregir);if(this.useExamples)this.showExample();if(corregir)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=""&&this.respuestas[i]!=undefined){if(corregir){var solution=window["Resp"+this.prefijo][i].word;this.resultados[i]=this.checkResponse(this.respuestas[i].toLowerCase(),solution)}if(this.resultados[i]){if(corregir)this.clasificacion++}}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){this.widget.correct(i)}}if(corregir){var numt=this.numElementos;if(this.useExamples)numt--;if(numt>0)this.clasificacion=this.clasificacion/numt}Slide.prototype.update.call(this,manual,corregir)};Slide_crosswordspuzzle.prototype.checkResponse=function(e,t){var i=window.blink.String(e).trim(),s=window.sha1(i.value());return s===t};Slide_crosswordspuzzle.prototype.evalNumElements=function(){this.numElementos=window["Resp"+this.prefijo].length;this.numElementosEvaluables=this.numElementos};Slide_crosswordspuzzle.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_crosswordspuzzle.prototype.getSuspendData=function(){if(!this.widget)return;if(this.checkUpdateResponses()){this.respuestas=this.widget.getResponses();this.resultados=this.widget.getResults()}return Slide.prototype.getSuspendData.call(this)};Slide_crosswordspuzzle.prototype.correct=function(e,t){if(!this.widget)return;this.widget.correct();this.getSuspendData();this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_crosswordspuzzle.prototype.showSolution=function(){if(!this.widget)return;Slide.prototype.showSolution.call(this);if(checkMostrarSoluciones()){this.widget.showSolutions(window["Sol"+this.prefijo])}};Slide_crosswordspuzzle.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e;var i=window["Sol"+this.prefijo][e];this.widget.showElemSolution(e,decode64(i).toUpperCase());for(var s=1;s<=e+1;s++){var o=this.useExamples&&this.exampleIndex==s?this.exampleStyleClass:this.solutionStyleClass;$("#"+this.prefijo+"-puzzle-wrapper .entry-"+s).addClass(o);$("#"+this.prefijo+"-puzzle-wrapper .entry-"+s+" .cell").addClass("solution")}};Slide_crosswordspuzzle.prototype.hideSolution=function(){if(!this.widget)return;Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){this.widget.hideSolutions();this.update(false,false);this.showExample()}};Slide_crosswordspuzzle.prototype.getPuzzleData=function(){var e=this.data,t=this.clues,i=[],s=window["Resp"+this.prefijo];for(var o=0;o<t.length;o++){i.push(new Array(s[o].width+1).join("x"))}var a=[];for(var r in e){for(var n in e[r]){var l=e[r][n];if(l!=null&&typeof l=="object"){var d={};if(l.across!=null&&l.across.is_start_of_word){d.position=l.across.index;d.clue=t[d.position];d.answer=i[d.position];d.solution=s[d.position].word;d.orientation="across";d.startx=parseInt(n,10);d.starty=parseInt(r,10);a.push(d)}d={};if(l.down!=null&&l.down.is_start_of_word){d.position=l.down.index;d.clue=t[d.position];d.answer=i[d.position];d.solution=s[d.position].word;d.orientation="down";d.startx=parseInt(n,10);d.starty=parseInt(r,10);a.push(d)}}}}return a};Slide_crosswordspuzzle.prototype.clearSlide=function(){this.clearSlideComunIni();this.widget.clearAll();this.clearSlideComunFin()};Slide_crosswordspuzzle.prototype.setAnswer=function(e,t){this.respuestas[e]=t;this.setReviewButtons()};function CrosswordCell(e){this.character=e;this.across=null;this.down=null}function CrosswordCellNode(e,t){this.is_start_of_word=e;this.index=t}function WordElement(e,t){this.word=e;this.index=t}function isValidCoordinate(e){if(e=="")return false;if(parseInt(e,10)!=e)return false;return true}function getMaxSide(e){var t={x:0,y:0};for(var i=0;i<e.length;i++){t.x=Math.max(e[i].x,t.x);t.y=Math.max(e[i].y,t.y)}return t}function Crossword(d,u,r){var p=50;var h=50;var c={};var f;var s={};var n=function(e,t,i){s={};s.index=e;s.row=t;s.column=i};this.getManualSquareGrid=function(){var e,t,i,s;w();for(var o=0;o<k.length;o++){t=k[o];e=r[t.index];i=e.column;s=e.row;if(e.direction=="across"){for(var a=0;a<t.word.length;a++){try{l(t.word,t.index,a,s,i,e.direction);i++}catch(e){n(t.index,s,i);return null}}}else if(e.direction=="down"){for(var a=0;a<t.word.length;a++){try{l(t.word,t.index,a,s,i,e.direction);s++}catch(e){n(t.index,s,i);return null}}}else{}}return m()};this.isValidCoordinates=function(){var e;for(var t in r){e=r[t];if(typeof e=="object"){if(!isValidCoordinate(e.row)||!isValidCoordinate(e.column)||e.direction==""){n(t,null,null);return false}}}return true};this.getBadCoordinate=function(){return bad_coordinate};this.getErrorInfo=function(){return s};this.getSquareGrid=function(e){var t=null;var i=0;for(var s=0;s<e;s++){var o=this.getGrid(1);if(o==null)continue;var a=Math.min(o.length,o[0].length)*1/Math.max(o.length,o[0].length);if(a>i){t=o;i=a}if(i==1)break}return t};this.getGrid=function(e){for(var t=0;t<e;t++){w();var i=_();var s=Math.floor(y.length/2);var o=Math.floor(y[0].length/2);var a=k[0];if(i=="across"){o-=Math.floor(a.word.length/2)}else{s-=Math.floor(a.word.length/2)}if(S(a.word,s,o,i)!==false){v(a.word,a.index,s,o,i)}else{f=[a];return null}var r=[];r.push(k.slice(1));for(var n=0;n<r.length;n++){word_has_been_added_to_grid=false;for(var l=0;l<r[n].length;l++){var a=r[n][l];var d=b(a.word);if(!d){if(r.length-1==n)r.push([]);r[n+1].push(a)}else{var s=d["row"],o=d["col"],u=d["direction"];v(a.word,a.index,s,o,u);word_has_been_added_to_grid=true}}if(!word_has_been_added_to_grid)break}if(word_has_been_added_to_grid)return m()}f=r[r.length-1];return null};this.getBadWords=function(){return f};this.getLegend=function(e){var t={across:[],down:[]};var i=1;for(var s=0;s<e.length;s++){for(var o=0;o<e[s].length;o++){var a=e[s][o];var r=false;for(var n in t){if(a&&a[n]&&a[n]["is_start_of_word"]){var l=a[n]["index"];t[n].push({position:i,index:l,clue:u[l],word:d[l]});r=true}}if(r)i++}}return t};var m=function(){var e=p-1,t=0,i=h-1,s=0;for(var o=0;o<p;o++){for(var a=0;a<h;a++){var r=y[o][a];if(r!=null){if(o<e)e=o;if(o>t)t=o;if(a<i)i=a;if(a>s)s=a}}}var n=t-e+1;var l=s-i+1;var d=new Array(n);for(var o=0;o<n;o++){for(var a=0;a<l;a++){d[o]=new Array(l)}}for(var o=e,u=0;u<n;o++,u++){for(var a=i,c=0;c<l;a++,c++){d[u][c]=y[o][a]}}return d};var l=function(e,t,i,s,o,a){var r=e.charAt(i);if(y[s][o]==null){y[s][o]=new CrosswordCell(r);if(!c[r])c[r]=[];c[r].push({row:s,col:o})}else if(y[s][o].character!=e.charAt(i)){throw Error("No coincide")}var n=i==0;y[s][o][a]=new CrosswordCellNode(n,t)};var v=function(e,t,i,s,o){if(o=="across"){for(var a=s,r=0;a<s+e.length;a++,r++){l(e,t,r,i,a,o)}}else if(o=="down"){for(var n=i,r=0;n<i+e.length;n++,r++){l(e,t,r,n,s,o)}}else{}};var g=function(e,t,i){if(y[t][i]==null)return 0;if(y[t][i]["character"]==e)return 1;return false};var S=function(e,t,i,s){if(t<0||t>=y.length||i<0||i>=y[t].length)return false;if(s=="across"){if(i+e.length>y[t].length)return false;if(i-1>=0&&y[t][i-1]!=null)return false;if(i+e.length<y[t].length&&y[t][i+e.length]!=null)return false;for(var o=t-1,a=i,r=0;o>=0&&a<i+e.length;a++,r++){var n=y[o][a]==null;var l=y[t][a]!=null&&y[t][a]["character"]==e.charAt(r);var d=n||l;if(!d)return false}for(var o=t+1,a=i,r=0;o<y.length&&a<i+e.length;a++,r++){var n=y[o][a]==null;var l=y[t][a]!=null&&y[t][a]["character"]==e.charAt(r);var d=n||l;if(!d)return false}var u=0;for(var a=i,r=0;a<i+e.length;a++,r++){var c=g(e.charAt(r),t,a);if(c===false)return false;u+=c}}else if(s=="down"){if(t+e.length>y.length)return false;if(t-1>=0&&y[t-1][i]!=null)return false;if(t+e.length<y.length&&y[t+e.length][i]!=null)return false;for(var a=i-1,o=t,r=0;a>=0&&o<t+e.length;o++,r++){var n=y[o][a]==null;var l=y[o][i]!=null&&y[o][i]["character"]==e.charAt(r);var d=n||l;if(!d)return false}for(var a=i+1,o=t,r=0;o<t+e.length&&a<y[o].length;o++,r++){var n=y[o][a]==null;var l=y[o][i]!=null&&y[o][i]["character"]==e.charAt(r);var d=n||l;if(!d)return false}var u=0;for(var o=t,r=0;o<t+e.length;o++,r++){var c=g(e.charAt(r,1),o,i);if(c===false)return false;u+=c}}else{}return u};var _=function(){return Math.floor(Math.random()*2)?"across":"down"};var b=function(e){var t=[];for(var i=0;i<e.length;i++){var s=c[e.charAt(i)];if(!s)continue;for(var o=0;o<s.length;o++){var a=s[o];var r=a["row"];var n=a["col"];var l=S(e,r,n-i,"across");var d=S(e,r-i,n,"down");if(l!==false)t.push({intersections:l,row:r,col:n-i,direction:"across"});if(d!==false)t.push({intersections:d,row:r-i,col:n,direction:"down"})}}if(t.length==0)return false;var u=t[Math.floor(Math.random()*t.length)];return u};var w=function(){for(var e=0;e<y.length;e++){for(var t=0;t<y[e].length;t++){y[e][t]=null}}c={}};var y=new Array(p);for(var e=0;e<p;e++){y[e]=new Array(h)}var k=[];for(var e=0;e<d.length;e++){k.push(new WordElement(d[e],e))}k.sort(function(e,t){return t.word.length-e.word.length})}var CrosswordUtils={PATH_TO_PNGS_OF_NUMBERS:"numbers/",toHtml:function(e,t){if(e==null)return;var i=[];i.push("<table class='crossword'>");var s=1;for(var o=0;o<e.length;o++){i.push("<tr>");for(var a=0;a<e[o].length;a++){var r=e[o][a];var n=false;if(r==null){var l="&nbsp;";var d="no-border"}else{var l=r["character"];var d="";var n=r["across"]&&r["across"]["is_start_of_word"]||r["down"]&&r["down"]["is_start_of_word"]}if(n){var u=CrosswordUtils.PATH_TO_PNGS_OF_NUMBERS+s+".png";i.push("<td class='"+d+"' title='"+(o+1)+", "+(a+1)+"' style=\"background-image:url('"+u+"')\">");s++}else{i.push("<td class='"+d+"' title='"+(o+1)+", "+(a+1)+"'>")}if(t){i.push(l)}else{i.push("&nbsp;")}}i.push("</tr>")}i.push("</table>");return i.join("\n")}};function Slide_dictation(){}Slide_dictation.prototype=new Slide;Slide_dictation.prototype.esEjercicio=true;Slide_dictation.prototype.esAutocorregible=true;Slide_dictation.prototype.update=function(manual,corregir){var response=this.respuestas[0]||"";$('[name="'+this.prefijo+'_v"]').val(response);if(corregir){this.resultados[0]=true}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[0]!=undefined)){var dmp=new diff_match_patch;eval("var sol = decode64("+this.prefijo+"_sol);");dmp.Diff_Timeout=1;dmp.Diff_EditCost=4;sol=replaceAccents(sol);response=replaceAccents(response);var d=dmp.diff_main(response,sol);dmp.diff_cleanupEfficiency(d);var ds=this.diff_prettyHtml(d);$('[name="'+this.prefijo+'_v"]').hide();$('[name="'+this.prefijo+'_diff"]').html(ds).show();var equals=true;for(var i=0;i<d.length;i++){var subject=d[i][1];if(d[i][0]!=0&&encodeURI(subject)!="%0D"){equals=false;break}}if(equals){this.clasificacion=1;$('[name="'+this.prefijo+'_diff"]').addClass("respuesta_ok")}else{this.clasificacion=-1}}Slide.prototype.update.call(this,manual,corregir)};Slide_dictation.prototype.evalNumElements=function(){this.numElementos=1};Slide_dictation.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=1;Slide.prototype.loadSuspendData.call(this,e)};Slide_dictation.prototype.getSuspendData=function(){this.respuestas[0]=$('[name="'+this.prefijo+'_v"]').val();var e=Slide.prototype.getSuspendData.call(this);return e};Slide_dictation.prototype.correct=function(e,t){this.respuestas[0]=$('[name="'+this.prefijo+'_v"]').val();this.update(e,t);Slide.prototype.correct.call(this,e,t)};Slide_dictation.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){eval("var sol = decode64("+this.prefijo+"_sol);");solhtml=sol.replace(/\n/g,"<BR>");$('[name="'+this.prefijo+'_diff"]').addClass("solucion").html(solhtml).show();$('[name="'+this.prefijo+'_v"]').hide()}};Slide_dictation.prototype.hideSolution=function(){if(checkMostrarSoluciones()){$('[name="'+this.prefijo+'_diff"]').removeClass("solucion").hide();$('[name="'+this.prefijo+'_v"]').show();this.update(false,false)}};function ocultaCorreccionesDictado(e){$('[name="'+e+'_v"]').show();$('[name="'+e+'_diff"]').hide()}Slide_dictation.prototype.diff_prettyHtml=function(e){var t=[];var i=0;for(var s=0;s<e.length;s++){var o=e[s][0];var a=e[s][1];var r=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(o){case DIFF_DELETE:t[s]='<DEL STYLE="background:#FFE6E6;">'+r+"</DEL>";break;case DIFF_EQUAL:t[s]=r;break}if(o!==DIFF_DELETE){i+=a.length}}return t.join("")};Slide_dictation.prototype.clearSlide=function(){this.clearSlideComunIni();$page=$("#"+this.prefijo+"pg");$page.find(".dictation").find("textarea").removeAttr("disabled");this.clearSlideComunFin()};var Pos=[];var palabrasArray=[];function Slide_draganddrop(){}Slide_draganddrop.prototype=new Slide;Slide_draganddrop.prototype.esEjercicio=true;Slide_draganddrop.prototype.mostrarPosicionSol=true;function calculaPalabras(e,t){var i=_.filter(_.map(e.split(t),function(e){var t={posX:-1,posY:-1,text:$.trim(e)};return t}),function(e){return!!e.text});return i}function crearPalabras(e,t,i){$("#"+e+"_base").html("");$("#"+e+"_multimedia").find(".circulo_gris").remove();var s="";if(t.indexOf("|")!=-1)s="|";else s=",";palabrasArray[e]=calculaPalabras(t,s);if(palabrasArray[e].length>0&&i)inicializarPalabras(e)}function actualizarPosicionesAntiguas(o,e,t,i,a,s){var r=t.split(","),n=i.split(",");crearPalabras(o,e,false);var l=$("#"+o+"_img1");l.load(function(){$.each(palabrasArray[o],function(e){var t=l.get(0).naturalHeight*a/l.get(0).naturalWidth,i=r[e],s=n[e];palabrasArray[o][e].posX=i>0?Math.round(i/a*100):-1;palabrasArray[o][e].posY=s>0?Math.round(s/t*100):-1});if(editar){$("#"+o+"_palabrasArray").val(json_encode(palabrasArray[o]));posicionarPalabras(o)}else{posicionarPalabrasVer(o,s)}});if(l[0]&&l[0].complete){l.load()}}function inicializarPalabras(t){if(!palabrasArray[t])return;$.each(palabrasArray[t],function(e){addPalabraBase(t,this,e)});var e=$("#transp"+t.replace(/^t/,""));addDraggable($("[id^="+t+"_thumb_]"),e);if(!window.editar)addDroppable($("#"+t+"_multimedia"),$("[id^="+t+"_thumb_]"));$("#"+t+"_palabrasArray").val(json_encode(palabrasArray[t]))}function addPalabraBase(e,t,i,s){if(!s)s="";$("#"+e+"_base").append(""+'<li id="'+e+"_li"+i+'" class="dnd-base">'+'<div class="circulo_gris '+e+'_thumb" id="'+e+"_thumb"+s+"_"+i+'">'+"<p>"+t.text+"</p>"+"</div>"+"</li>")}function deletePalabraBase(e){$("#"+e).remove()}function posicionarPalabras(t){if(!palabrasArray[t])return;var i=$("#transp"+t.replace(/^t/,""));$(window).on("load",function(){$.each(palabrasArray[t],function(e){if(this.posX==-1||this.posY==-1){addPalabraBase(t,this,e)}else{addPalabraImagen(t,this,e,"editar")}addDraggable($("#"+t+"_thumb_"+e),i)})})}function addDraggable(e,t){if(!blink.theme.isAdaptative())t="";e.draggable({revert:function(e){return editar?!this.data().dropped:true},start:function(e,t){t.helper.css("z-index",9).data("dropped",false)},stop:function(e,t){t.helper.data("dropped")&&terminaDD($(this).attr("id"))},containment:t})}function addDroppable(e,t){e.droppable({accept:t,tolerance:"touch",drop:function(e,t){if(t.draggable.data("dropped")){return}var i=$(this);if(i.hasClass("drop_ok")){return}if(i.hasClass("respuesta")){return}t.draggable.data("dropped",true);if(!editar){var s=$(this).attr("id").split("_"),o=$(t.helper).attr("id").split("_"),a=s[0],r=parseInt(s[2]),n=parseInt(o[2]);if(r==window[a+"_slide"].exampleIndex)return;Pos[a][r]=n;$(this).attr("data-content-user",palabrasArray[a][n].text).addClass("respuesta");$("#"+a+"_thumbaux_"+n).addClass("dropped").hideBlink();addDraggedRevert(a,$(this),r,n)}}})}function addDraggedRevert(t,e,i,s){e.on("click",function(e){$(this).removeAttr("data-content-user").removeClass("respuesta").off("click");$("#"+t+"_thumbaux_"+s).removeClass("dropped").showBlink();Pos[t][i]=undefined;window[t+"_slide"]._refreshStatus();e.stopPropagation()})}function addPalabraImagen(e,t,i,s){if(editar)$("#"+e+"_base").append("<li></li>");$("#"+e+"_multimedia").append('<div class="circulo_gris '+e+"_thumb "+s+'" id="'+e+"_thumb_"+i+'" style="position:absolute;left:'+t.posX+"%;top:"+t.posY+'%;"></div>');$("#"+e+"_thumb_"+i).data("content",t.text);if(editar){$("#"+e+"_thumb_"+i).attr("data-content",t.text)}}function posicionarPalabrasVer(prefijo,mostrarPosicionSol){eval(prefijo+"_slide.mostrarPosicionSol = "+(mostrarPosicionSol==1)+";");var $imgContainer=$("#"+prefijo+"_multimedia");var $containment=$("#transp"+prefijo.replace(/^t/,""));if(!palabrasArray[prefijo])return;var classPalabra="";if(mostrarPosicionSol)classPalabra="ver";$imgContainer.css("position","relative");$.each(palabrasArray[prefijo],function(e){if(this.posX!=-1||this.posY!=-1){addPalabraImagen(prefijo,this,e,classPalabra);addPalabraBase(prefijo,this,e,"aux")}});var $drags=$containment.find(".drag-and-drop").find(".circulo_gris");var $drops=$imgContainer.find("."+prefijo+"_thumb");addDraggable($drags,$containment);addDroppable($drops,$drags)}function terminaDD(e){var t=e.split("_");pref=t[0];a=t[2];var i=$("#transp"+pref.replace(/^t/,""));xy=$("#"+e).offset();xydrop=$("#"+pref+"_img1").offset();relx=xy.left-xydrop.left;rely=xy.top-xydrop.top;if(editar){var s=palabrasArray[pref][a].posX,o=palabrasArray[pref][a].posY;palabrasArray[pref][a].posX=Math.round(relx/$("#"+pref+"_img1").width()*100);palabrasArray[pref][a].posY=Math.round(rely/$("#"+pref+"_img1").height()*100);if(s==-1||o==-1){deletePalabraBase(e);addPalabraImagen(pref,palabrasArray[pref][a],a,"editar");addDraggable($("#"+pref+"_thumb_"+a),i)}else $("#"+pref+"_thumb_"+a).attr("style","cursor:pointer;position:absolute;z-index:3;left:"+palabrasArray[pref][a].posX+"%;top:"+palabrasArray[pref][a].posY+"%");$("#"+pref+"_palabrasArray").val(json_encode(palabrasArray[pref]));marcarHaCambiado()}else{window[pref+"_slide"]._refreshStatus()}}Slide_draganddrop.prototype._refreshStatus=function(){this.getSuspendData();this.setReviewButtons()};Slide_draganddrop.prototype.onShow=function(){if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_draganddrop.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=null&&this.respuestas[i]!=undefined&&this.respuestas[i]>=0){var s=this.prefijo+"_thumb_"+i,o=$("#"+s),a=$("#"+this.prefijo+"_thumbaux_"+Pos[this.prefijo][i]),r=a.find("p"),n=this.elementHasBeenMoved(i),l=this.elementHasBeenMovedCorrectly(i);if(!e){Pos[this.prefijo][i]=this.respuestas[i];o.attr("data-content-user",palabrasArray[this.prefijo][this.respuestas[i]].text).addClass("respuesta");a.hideBlink();if(l||this.intentos==this.numMaxIntentos){}else{addDraggedRevert(this.prefijo,o,i,this.respuestas[i])}}if(t){this.resultados[i]=l}if(this.resultados[i]){if(t)this.clasificacion++}if(checkMostrarSoluciones()){if(this.resultados[i]!=undefined){if(this.intentos==this.numMaxIntentos||this.resultados[i]){o.removeClass("drop_ok drop_ko ver").addClass("drop_"+(this.resultados[i]?"ok":"ko")).unbind("click");a.addClass("dropped")}else if(t){o.trigger("click")}}}}}if(t){var d=this.numElementosEvaluables;if(this.useExamples)d--;if(d>0)this.clasificacion=this.clasificacion/d}Slide.prototype.update.call(this,e,t)};Slide_draganddrop.prototype.elementHasBeenMoved=function(e){var t=Pos[this.prefijo][e];return t==0||!!t&&t!=-1};Slide_draganddrop.prototype.elementHasBeenMovedCorrectly=function(e){var t=Pos[this.prefijo][e];return this.elementHasBeenMoved(e)&&t==e};Slide_draganddrop.prototype.evalNumElements=function(){this.numElementos=palabrasArray[this.prefijo]?palabrasArray[this.prefijo].length:0;this.numElementosEvaluables=this.numElementos;if(typeof Pos[this.prefijo]=="undefined"||Pos[this.prefijo].length!=this.numElementos){Pos[this.prefijo]=new Array(this.numElementos)}};Slide_draganddrop.prototype.loadSuspendData=function(t){if(t){$.each(t.respuestas,function(e){if(t.respuestas[e]=="-1")t.respuestas[e]=undefined})}this.evalNumElements();Slide.prototype.loadSuspendData.call(this,t)};Slide_draganddrop.prototype.getSuspendData=function(){for(var e=0;e<this.numElementos;e++){this.respuestas[e]=Pos[this.prefijo][e]}var t=Slide.prototype.getSuspendData.call(this);return t};Slide_draganddrop.prototype.correct=function(e,t){for(var i=0;i<this.numElementos;i++){this.respuestas[i]=Pos[this.prefijo][i]}Slide.prototype.correct.call(this,e,t)};Slide_draganddrop.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;$("[id="+this.prefijo+"_thumbaux_"+e+"]").hideBlink();$("[id="+this.prefijo+"_thumb_"+e+"]").each(function(){$(this).attr("data-content",$(this).data("content")).removeClass("respuesta drop_ok drop_ko").addClass("ver drop_"+t)})};Slide_draganddrop.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){var t=this;$("[id^="+this.prefijo+"_thumb_]").each(function(e){if(t.exampleIndex!=e){$(this).removeClass("drop_"+t.solutionStyleClass).removeClass("ver");if(t.resultados[e]!=undefined){$(this).addClass("drop_"+(t.resultados[e]?"ok":"ko")).addClass("respuesta")}}});$("[id^="+t.prefijo+'_thumbaux_]:not(".dropped")').each(function(e){if(t.exampleIndex!=e)$(this).showBlink()});this.update(false,false)}};Slide_draganddrop.prototype.setDisabled=function(){$("[id^="+this.prefijo+"_thumbaux_]").draggable("disable");$("."+this.prefijo+"_thumb").unbind("click")};Slide_draganddrop.prototype.clearSlide=function(){this.clearSlideComunIni();Pos[this.prefijo]=new Array(this.numElementos);$("[id^='"+this.prefijo+"_li']").remove();$("[id^='"+this.prefijo+"_thumbaux_']").remove();$("."+this.prefijo+"_thumb").remove();posicionarPalabrasVer(this.prefijo,this.mostrarPosicionSol);this.clearSlideComunFin()};Slide_draganddrop.prototype.onAfterShowSlide=function(){Slide.prototype.onAfterShowSlide.call(this)};Slide_draganddrop.prototype.onChangeWindowSize=function(){this.onAfterShowSlide()};function Slide_essay(){}Slide_essay.prototype=new Slide;Slide_essay.prototype.esEjercicio=true;Slide_essay.prototype.esAutocorregible=false;Slide_essay.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_essay.prototype.setText=function(e,t,i,s){var o=CKEDITOR.instances["id"+this.prefijo+"_text"];if(o&&(i||!o.checkDirty())){this.setReadOnly(o,t);if(typeof e!="undefined"){o.setData(e);o.resetDirty()}if(!blink.theme.isAdaptative()){var a=o.document?o.document.getBody():undefined;if(a)a.setStyle("background-color",s?"#00BDFF":"white")}}};Slide_essay.prototype.setDisabled=function(){this.setText(this.respuestas[0],false,true)};Slide_essay.prototype.setReadOnly=function(t,e){var i=!e||this.clasificacionprofesor!=-1;try{t.setReadOnly(i)}catch(e){t.on("instanceReady",function(){this.setReadOnly(i)})}};Slide_essay.prototype.update=function(e,t){this.setText(this.respuestas[0],checkPuedeEditar(),false);Slide.prototype.update.call(this,e,t);if(window.editar)return;if($("#"+this.prefijo+"right").find(".multimedia-container").length)$("#"+this.prefijo+"left").addClass("aux-image-active");else $("#"+this.prefijo+"left").width("auto");$("#"+this.prefijo+"pg").find(".workspace.essay").resize()};Slide_essay.prototype.evalNumElements=function(){this.numElementos=1};Slide_essay.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=1;Slide.prototype.loadSuspendData.call(this,e)};Slide_essay.prototype.refreshAnswer=function(){var e=CKEDITOR.instances["id"+this.prefijo+"_text"];if(e&&e.checkDirty()){this.respuestas[0]=e.getData();if(this.respuestas[0]){this.respuestas[0]=this.respuestas[0].replace(/[\n\r\t]/g,"")}}};Slide_essay.prototype.getSuspendData=function(){this.refreshAnswer();var e=Slide.prototype.getSuspendData.call(this);return e};Slide_essay.prototype.correct=function(e,t){this.refreshAnswer();Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_essay.prototype.showSolution=function(){Slide.prototype.showSolution.call(this);if(this.tienePistas&&checkMostrarSoluciones()){var e=window[this.prefijo+"_textoPista"],t=$("#"+this.prefijo+"_ta-pista");$("#"+this.prefijo+"_slide-essay").addClass("mostrar-pista");$("#"+this.prefijo+"_ta-respuesta").html(this.respuestas[0]).addClass("mostrar-pista");t.html(decode64(e)).addClass("mostrar-pista");blink.theme.createAudioButtons(t);blink.theme.createVideoButtons(t)}};Slide_essay.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("#"+this.prefijo+"_slide-essay").removeClass("mostrar-pista");$("#"+this.prefijo+"_ta-respuesta").removeClass("mostrar-pista");$("#"+this.prefijo+"_ta-pista").removeClass("mostrar-pista");this.update(false,false)}};Slide_essay.prototype.clearSlide=function(){this.setText("",true,true);this.clearSlideComunIni();this.clearSlideComunFin()};Slide_essay.prototype.detectSlideChanges=function(){var e=this,t=CKEDITOR.instances["id"+this.prefijo+"_text"];t.on("change",function(){if(this.checkDirty()){e.getSuspendData();e.setReviewButtons()}})};function Slide_fillblankimages(){}Slide_fillblankimages.prototype=new Slide;Slide_fillblankimages.prototype.esEjercicio=true;Slide_fillblankimages.prototype.onBeforeShow=function(){Slide.prototype.onBeforeShow.call(this);if(mostrarSoluciones){this.checkAnswers();var e=this;$("input[id^="+this.prefijo+"]").on("keyup keydown blur update change input",function(){e.checkAnswers()})}};Slide_fillblankimages.prototype.onShow=function(){this.useExamples&&this.showExample();Slide.prototype.onShow.call(this)};Slide_fillblankimages.prototype.handleWaitLoad=function(e,t){if(e&&!blink.isLoaded){$(window).on("load",function(){this[t]()}.bind(this))}else{this[t]()}};Slide_fillblankimages.prototype.onAfterShowSlide=function(){var e=$(".swipeview-active").find(".js-slide-wrapper").data("slide-index"),t=!!$("#fbdw").find("div.ui-draggable").length;if(blink.domain.useAriaDragAndDrop()&&e==this.prefijo.substring(1)){this.handleWaitLoad(t,"setFocusFirstItem")}};Slide_fillblankimages.prototype.setFocusFirstItem=function(){var e=$(".swipeview-active #fbdw");if(e.length>0&&e.children(":first").length>0){e.children(":first").focus()}};Slide_fillblankimages.prototype.updateElem=function(e,t,i){var s,o,a;c=$("#"+this.prefijo+"v"+e);s=document.f.elements[this.prefijo+"v"+e];if($(s).length>0){s.value="";$(s).removeClass(this.solutionStyleClass);if(this.respuestas[e]!=undefined){var r=$(s).hasClass("numeric_answer"),n=$(s).hasClass("imgInput");s.value=this.respuestas[e];if(i){a=window["Resp"+this.prefijo][e];if(this.isSolutionGroup(a)){this.resultados[e]=this.checkSolutionGroup(this.resultados[e],this.respuestas[e],this.solutionsGroups[a],r)}else if(a.indexOf("||")!=-1){this.resultados[e]=this.checkSolutionMultiple(this.resultados[e],this.respuestas[e],a.split("||"),r)}else{this.resultados[e]=this.checkSolutionSingle(this.respuestas[e],a,r)}}if(this.resultados[e]){i&&this.clasificacion++;this.setDisabled(this.prefijo,true,e)}else{this.setEnabled(this.prefijo,true,e)}if(this.intentos>=this.numMaxIntentos||modoClase!==1&&modoClase!==2){$("#"+this.prefijo+"v"+e).removeClass("droppable ui-droppable")}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[e]!=undefined)){var l="respuesta_ok respuesta_ko",d=this.resultados[e]?"ok":"ko",u="respuesta_"+d,c;c.removeClass(l).addClass(u);if(c.hasClass("imgInput")){c.parent(".img-input-container").removeClass(l).addClass(u)}!!this.resultados[e]&&c.removeClass("keyboardInput")}$(".fillblankimages-draggable input:not(.keyboardInput)").attr("disabled",true)}if(c.hasClass("droppable")){c.attr("disabled",true)}}};Slide_fillblankimages.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;$("#"+this.prefijo+"left").find(".txt-wrap").removeClass(this.solutionStyleClass);for(var i=this.firstElementIndex;i<this.numElementos;i++){this.updateElem(i,e,t)}if(t){var s=this.respuestas.length;if(this.useExamples)s--;if(s>0)this.clasificacion=this.clasificacion/s}Slide.prototype.update.call(this,e,t);Slide_fillblankimages.prototype.updateImages();Slide_fillblankimages.prototype.updateContainer()};Slide_fillblankimages.prototype.setDisabled=function(e,t,i){Slide.prototype.setDisabled.call(this,e,t);if(i==undefined)return;e=e!=null?e+"v"+i:this.prefijo;$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").filter("[name"+(!t?"^":"")+"="+e+"],[id"+(!t?"^":"")+"="+e+"]").each(function(){$(this).removeAttr("disabled").prop("readonly",true)})};Slide_fillblankimages.prototype.setEnabled=function(e,t,i){e=e+"v"+i;$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").filter("[name"+(!t?"^":"")+"="+e+"],[id"+(!t?"^":"")+"="+e+"]").each(function(){$(this).removeAttr("disabled").prop("readonly",false)})};Slide_fillblankimages.prototype.evalNumElements=function(){this.numElementos=0;while(document.f.elements[this.prefijo+"v"+this.numElementos]!=undefined){this.numElementos=this.numElementos+1}};Slide_fillblankimages.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;var s=this.prefijo;$("[name^="+this.prefijo+"v]").change(function(){$(this).removeClass("respuesta_ko");if($(this).hasClass("imgInput")){$(this).parent(".img-input-container").removeClass("respuesta_ko")}}).focus(function(){$(this).select()}).each(function(e){var i=e;$(this).keypress(function(e){if(checkEnter(e)){var t=$("[name^="+s+"v]:gt("+i+"):enabled:first");if(t.length==1){t.select()}else if($(".corregir:visible").length==1){correct(true,true)}}})});Slide.prototype.loadSuspendData.call(this,e)};Slide_fillblankimages.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown)switchSolution(this.prefijo,true);for(var t=this.firstElementIndex;t<this.numElementos;t++){if(!!document.f.elements[this.prefijo+"v"+t]){this.respuestas[t]=document.f.elements[this.prefijo+"v"+t].value}}}return Slide.prototype.getSuspendData.call(this)};Slide_fillblankimages.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=document.f.elements[this.prefijo+"v"+i].value}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_fillblankimages.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e,i=t?this.exampleStyleClass:this.solutionStyleClass,s=$("#"+this.prefijo+"left"),o=$("#"+this.prefijo+"v"+e),a=window.decode64(window["Sol"+this.prefijo][e]),r=this.getIdenticalSolutionsCount();o.prop({isExample:t});if(this.isSolutionGroup(a)){var n=this.solutionsGroups[a].solutions,l=[];for(var d=0;d<n.length;d++){l.push(window.decode64(n[d]))}this.configElementForSeveralSolutions(o,l);a=this.getSolutionGroup(this.solutionsGroups[a],o)}else if(a.indexOf("||")!=-1){this.configElementForSeveralSolutions(o,a.split("||"));a=this.getSolutionMultiple(a.split("||"),o)}else if(a.indexOf("&&")!=-1){a=a.replace("&&",",")}var u=a.indexOf("==")==0?a.substring(2):a;a=html_entity_decode(u);o.removeClass("respuesta_ok respuesta_ko keyboardInput").addClass(i).val(a).attr("title",a).parent(".txt-wrap").addClass(i);o.removeAttr("disabled").prop("readonly",true);if(t){o.prop({readonly:true});var a=escapeQuotes(a),c=s.find("[data-dropvalue='"+a+"'] ");if(this.countIdenticalSolutions()){o.addClass("solucion");var p=!(a in r);p&&c.addClass("used solucion")}else{c.addClass("used")}}Slide_fillblankimages.prototype.updateImages();Slide_fillblankimages.prototype.updateContainer()};Slide_fillblankimages.prototype.updateGroupsSolutionsShown=function(){var e,t,i;for(var s=this.firstElementIndex;s<this.numElementos;s++){e=$("#"+this.prefijo+"v"+s);if(e.hasClass("respuesta_ok")){t=window.decode64(window["Sol"+this.prefijo][s]);if(this.isSolutionGroup(t)){i=e.val();this.solutionsGroups[t].solutionsShown.push(i)}}}};Slide_fillblankimages.prototype.hideElemSolution=function(e){var t=$("#"+this.prefijo+"v"+e);t.removeClass(this.solutionStyleClass+" multiple-solution").val("").attr("title","").parent(".txt-wrap").removeClass(this.solutionStyleClass);t.prop("readonly",false);this.destroyMultipleSolutionTooltip(t)};Slide_fillblankimages.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){this.resetSolutionsShown();for(var e=this.firstElementIndex;e<this.numElementos;e++){this.hideElemSolution(e)}$(".multiple-solution-marker").remove();this.update(false,false)}};Slide_fillblankimages.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){if(this.resetAnswersBeforeShowPartialSolution&&esProfesor){this.clearSlide()}var e=this.useExamples?this.exampleIndex:this.firstElementIndex;for(var t=e;t<this.numElementos;t++){this.showElemSolution(t)}this.solutionShown=true;this.idsol=this.numElementos}};Slide_fillblankimages.prototype.setWidthElements=function(e){var t=0;var i="",s,o,a;if(this.ajustarCampos){this.evalNumElements();for(var r=this.firstElementIndex;r<this.numElementos;r++){o=window.decode64(window["Sol"+this.prefijo][r]);i=o.split("||").longerContent().replace(/&nbsp;/gi," ");t=blink.utils.getWidthInput(i);$("#"+this.prefijo+"v"+r).removeAttr("maxlength").removeAttr("size").css("width",t+e).data({minWidth:t+e})}}else{s=window["Sol"+this.prefijo];var a=[];for(var r=0;r<s.length;r++){a[r]=decode64(s[r]);if(a[r].indexOf("||")!=-1){a[r]=a[r].split("||").longerContent()}}i=a.longerContent();t=blink.utils.getWidthInput(i);$("input[id^="+this.prefijo).removeAttr("size").css("width",t+e).data({minWidth:t+e})}};Slide_fillblankimages.prototype.getIdenticalSolutionsCount=function(){var e={};for(var t=this.firstElementIndex;t<this.numElementos;t++){var i=decode64(window["Sol"+this.prefijo][t]);e[i]=e[i]?e[i]+1:1}return e};Slide_fillblankimages.prototype.getRespuestasCount=function(){var e={};for(var t=this.firstElementIndex;t<this.numElementos;t++){var i=this.respuestas[t];e[i]=e[i]?e[i]+1:1}return e};Slide_fillblankimages.prototype.countIdenticalSolutions=function(){return false};Slide_fillblankimages.prototype.checkAnswers=function(){var i=this.useExamples,s=[],o=window.decode64(window["Sol"+this.prefijo][0]),a=$("#"+this.prefijo+"left").find(".fillblankimages-draggable-wrapper"),e=$("#"+this.prefijo+"v"+d);if(o.indexOf("||")!=-1){o=this.getSolutionMultiple(o.split("||"),e)}if(this.countIdenticalSolutions()){this.hideCount={};this.isLastSolution={};var t=this.getIdenticalSolutionsCount(),r=this.getRespuestasCount(),n=this;return _.each(t,function(e,t){var i=r[t]||0,e=e-i,s=a.find('[data-dropvalue="'+t+'"]'),o=s.find(".count");n.hideCount[t]=e<1;n.isLastSolution[t]=e==1;o.text(e).toggleClass("hidden",n.hideCount[t]||n.isLastSolution[t]);s.toggleClass("used",n.hideCount[t])})}a.find(".response").removeClass("used").each(function(e,t){s.push($(this).attr("data-dropvalue"));if($(this).attr("data-dropvalue")==o&&i){$(this).addClass("used")}});var l;for(var d=this.firstElementIndex;d<this.numElementos;d++){l=s.indexOf($("#"+this.prefijo+"v"+d).val());if(l!=-1){a.find(".response").eq(l).addClass("used")}}};Slide_fillblankimages.prototype.isSolutionGroup=function(e){var t=this.solutionsGroups.__proto__||this.solutionsGroups.constructor.prototype;return e in this.solutionsGroups&&(!(e in t)||t[e]!==this.solutionsGroups[e])};Slide_fillblankimages.prototype.cleanResponse=function(e){e=html_entity_decode(e);return e.replace(/[`|Â´|â]/gi,"'")};Slide_fillblankimages.prototype.isCorrect=function(e,t){e=this.cleanResponse(e);var i=window.blink.String(e).trim();if(!this.caseSensitive){i.lower()}if(!this.punctuationSensitive){i.removePunctuation()}if(this.espaciosBlancos){i.replaceEspaciosBlancos()}var s=window.sha1(i.value());return s===t};Slide_fillblankimages.prototype.isCorrectResponse=function(e,t,i){if(i&&!isValidSHA1(t)){return compararTexto(e,window.decode64(t),true)}else{return this.isCorrect(e,t)}};Slide_fillblankimages.prototype.checkSolutionSingle=function(e,t,i){return this.isCorrectResponse(e,t,i)};Slide_fillblankimages.prototype.checkSolutionMultiple=function(e,t,i,s){for(var o=0;o<i.length;o++){if(!e){e=this.isCorrectResponse(t,i[o],s)}}return e};Slide_fillblankimages.prototype.isResponseUsed=function(e,t){return e.solutionsUsed.indexOf(t)!=-1};Slide_fillblankimages.prototype.isResponseShown=function(e,t){return e.solutionsShown.indexOf(t)!=-1};Slide_fillblankimages.prototype.checkSolutionGroup=function(e,t,i,s){var o=i.solutionsCrypt;for(var a=0;a<o.length;a++){if(!e){e=this.isCorrectResponse(t,o[a],s)&&!this.isResponseUsed(i,t)}}if(e){i.solutionsUsed.push(t)}return e};Slide_fillblankimages.prototype.getSolutionGroup=function(e,t){if(t.hasClass("respuesta_ok")){var i=t.val();e.solutionsShown.push(i);return i}var s,o=e.solutions;for(var a=0;a<o.length;a++){s=window.decode64(o[a]);if(t.prop("title")==s)return s;if(!this.isResponseShown(e,s)){e.solutionsShown.push(s);return s}}};Slide_fillblankimages.prototype.getSolutionMultiple=function(e,t){if(e.indexOf(t.val())!=-1){return t.val()}return e[0]};Slide_fillblankimages.prototype.resetSolutionsShown=function(){for(var e in this.solutionsGroups){this.solutionsGroups[e].solutionsShown=[]}$(".fillblankimages-draggable input:not(.keyboardInput)").attr("disabled",true)};Slide_fillblankimages.prototype.configElementForSeveralSolutions=function(e,t){e.addClass("multiple-solution").data("solutions",t).after('<div class="multiple-solution-marker"/>').next(".multiple-solution-marker");var i=blink.isTablet?"tap":"hover";this.showMultipleSolutionTooltip(true,$(e),i)};Slide_fillblankimages.prototype.showMultipleSolutionTooltip=function(e,t,i){var s={placement:function(e,t){var i=window.innerWidth,s=$(t).siblings(".multiple-solution-marker"),o=s.length>0?s.offset().left:0,a="right";if(i-o<200){a="top"}return a},content:function(){var e=$(this).data("solutions"),t='<div id="multiple-solution-tooltip">';for(var i=0;i<e.length;i++){t+="<div>"+e[i]+"</div>"}t+="</div>";return t},template:'<div class="popover multiple-solution"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>',trigger:i,html:true};if($.isFunction(t.popover)){var o=t.popover(s);blink.popovers&&blink.popovers.register(o)}else{t.val($(t).data().solutions[0]);t.siblings(".multiple-solution-marker").hide()}};Slide_fillblankimages.prototype.destroyMultipleSolutionTooltip=function(e){if(blink.popovers===undefined||!blink.popovers)return;var t=blink.popovers.list;e.popover("destroy");for(i=0;i<t.length;i++){if($(t[i]).attr("id")==e.attr("id")){t.splice(i,1)}}};Slide_fillblankimages.prototype.responseClick=function(e){var t=$(e).hasClass("response")?$(e):$(e).parent(".response");$(".fillblankimages-draggable-wrapper .response").removeClass("selected");t.addClass("selected")};Slide_fillblankimages.prototype.inputClick=function(e){var t=$("#"+this.prefijo+"contenidos_curso .fillblankimages-draggable-wrapper .selected");if(t.length){$(e).val(t.attr("dropvalue")).trigger("change");t.removeClass("selected")}else{$(e).val("").trigger("change")}};Slide_fillblankimages.prototype.itemDraggable=function(i){i.draggable({revert:true,containment:i.closest(".slide-wrapper"),start:function(e,t){i.css({"z-index":20,opacity:.5}).find(".item").width("auto");window.isDragging=true},drag:function(e,t){i.addClass("respuesta_over")},stop:function(e,t){i.css({opacity:1});window.isDragging=false}})};Slide_fillblankimages.prototype.clearSlide=function(){this.clearSlideComunIni();$(".draggablereturnorigin").removeClass("used");for(var e=this.firstElementIndex;e<this.numElementos;e++){var t=document.f.elements[this.prefijo+"v"+e];var i=$(t).hasClass("imgInput");solution=window[(i?"Sol":"Resp")+this.prefijo][e];if(this.isSolutionGroup(solution)){this.solutionsGroups[solution].solutionsUsed=[]}}this.checkAnswers();$elems=$("[id='transp"+this.prefijo.substring(1)+"']").find("[id^="+this.prefijo+"v]");$elems.each(function(e,t){$(t).prop("readonly",false);$(t).addClass("keyboardInput");$(t).addClass("droppable ui-droppable")}.bind(this));this.clearSlideComunFin()};Slide_fillblankimages.prototype.filterEvent=function(e){if(e.animationName=="imgInserted"){var t=e.target;Slide_fillblankimages.prototype.idImages(t,true)}};Slide_fillblankimages.prototype.idImages=function(e,t){var i=e.parentNode,s,o,a,r,t=t||false;if(i.previousSibling!==null&&i.previousSibling.nodeValue!==null){s=i.previousSibling.nodeValue;o=s.substring(s.length-2)}if(i.nextSibling!==null&&i.nextSibling.nodeValue!==null){a=i.nextSibling.nodeValue;r=a.substring(0,2)}if(o=="@@"&&r=="@@"){if(!e.hasAttribute("data-identifier")){var n=Date.now();if($('img[data-identifier="'+n+'"]').length==0){e.setAttribute("data-identifier",n)}else{while($('img[data-identifier="'+n+'"]').length>0){n++}e.setAttribute("data-identifier",n)}}}};Slide_fillblankimages.prototype.updateImages=function(){$(".fillblankimages-draggable input.imgInput").each(function(){var e=this;if($(e).parent(".img-input-container").length==0){$(e).wrap('<div class="img-input-container"></div>').parent(".img-input-container").append('<div class="img-input-response"></div>')}$(e).parent(".img-input-container").attr({tabindex:"1"});if($(e).val()!==""){var t=$("body").find('img[data-identifier="'+$(e).val()+'"]').first();$(e).parent(".img-input-container").addClass("imgFilled").find(".img-input-response").first().html($(t).clone());if(blink.domain.useAriaImageDragAndDrop()){var i=Slide_fillblankimages.prototype.getImgFileName($(t));if(i!=""){$(e).parent(".img-input-container").attr("aria-label",i)}}}else{$(e).parent(".img-input-container").removeClass("imgFilled").find(".img-input-response").first().html("")}});$(".fillblankimages-draggable").each(function(){var e=$(this).find("input").last();if($(e).hasClass("imgInput")){$(e).closest("p").addClass("last-image");blink.events.trigger("lastImageResponse")}})};Slide_fillblankimages.prototype.updateContainer=function(){$(".fillblankimages-draggable .img-input-container").each(function(){var e=this;imgInput=$(e).find(".imgInput").first();if($(imgInput).hasClass("respuesta_ok")){if(!$(e).hasClass("respuesta_ok")){$(e).addClass("respuesta_ok")}}else{$(e).removeClass("respuesta_ok")}if($(imgInput).hasClass("respuesta_ko")){if(!$(e).hasClass("respuesta_ko")){$(e).addClass("respuesta_ko")}}else{$(e).removeClass("respuesta_ko")}if($(imgInput).hasClass("solucion")){if(!$(e).hasClass("solucion")){$(e).addClass("solucion")}}else{$(e).removeClass("solucion")}})};Slide_fillblankimages.prototype.countIdenticalSolutions=function(){return true};Slide_fillblankimages.prototype.dropItem=function(e,t,i){var s=String(e.data("dropvalue"));t.removeClass("drag-over");t.parent(".img-input-container").removeClass("drag-over");if(t.hasClass("droppable")&&!t.hasClass("respuesta_ok")&&!t.hasClass("solucion")){if(e.find("img").length==0&&!t.hasClass("imgInput")){t.val(s).trigger("change")}else if(e.find("img").length>0&&t.hasClass("imgInput")){t.val(s).trigger("change");t.parent(".img-input-container").addClass("imgFilled").find(".img-input-response").first().html(e.find('img[data-identifier="'+s+'"]').first().clone());if(blink.domain.useAriaImageDragAndDrop()){var o=e.attr("aria-label");if(o){t.parent(".img-input-container").attr("aria-label",o)}}}}};Slide_fillblankimages.prototype.getImgFileName=function(e){var t="",i="";if(e&&e instanceof jQuery&&e.length>0){i=e.attr("src").replace(/^.*[\\\/]/,"");i=i.split(".");if(i&&i.length>0){t=i[0]}}return t};$(document).ready(function(){var i=100,s=$(".fillblankimages-draggable-wrapper").parents(".slide-wrapper").data("prefix");$.when($(".fillblankimages-draggable-wrapper .response").each(function(){var e=$(this).find("img").first()||null;Slide_fillblankimages.prototype.itemDraggable($(this));if(blink.domain.useAriaImageDragAndDrop()){$(this).attr("aria-grabbed",false);$(this).attr("role","button");$(this).attr("tabindex",1);addPopoverARIADragAndDrop($(this),s);if(e&&e.length>0){var t=Slide_fillblankimages.prototype.getImgFileName(e);if(t!=""){$(this).attr("aria-label",t);e.attr("aria-label",t);e.attr("alt",t)}}}if(e&&e.attr("height")){e.attr("style","height: "+e.attr("height")+"px !important;");if(i<e.attr("height")){i=e.attr("height")}}if(e&&(e.attr("height")<=100||!e.attr("height"))){i=250}})).then(function(){if(i>100){blink.events.on("lastImageResponse",function(){$(".last-image").css("margin-bottom",i+"px")})}});$(".fillblankimages-draggable-wrapper").on("mouseenter focusin",".response",function(e){var t=$(this);if(!t.hasClass("disabled")){t.addClass("respuesta_over")}}).on("mouseleave focusout",".response",function(e){var t=$(this);if(!t.hasClass("disabled")){t.removeClass("respuesta_over")}});$.fn.droppable&&$(".fillblankimages-draggable input.droppable:not(.keyboardInput)").droppable({accept:".response:not(.solucion)",drop:function(e,t){e.stopPropagation();var i=t.helper,s=$(this);Slide_fillblankimages.prototype.dropItem(i,s)},over:function(e,t){$(this).addClass("drag-over");$(this).parent(".img-input-container").addClass("drag-over")},out:function(e,t){$(this).removeClass("drag-over");$(this).parent(".img-input-container").removeClass("drag-over")}}).each(function(){$(this).wrap('<span class="droppable-container"></span>')});$(".droppable-container").on("click keydown",function(e){if(e.keyCode&&e.keyCode!=32){return}var t=$(this).find("input.droppable").first();if($(t).val()!=""&&!$(t).hasClass("respuesta_ok")&&!$(t).hasClass("solucion")){$(t).val("").trigger("change");if($(this).find(".img-input-response").length>0){$(this).find(".img-input-container").first().removeClass("imgFilled");$(this).find(".img-input-response").first().html("")}}});if(blink.domain.useAriaImageDragAndDrop()){addPopoverEventARIADragAndDrop($(".ui-draggable"),"",s);addPopoverNavigationARIADragAndDrop($(document),s,function(e,t,i){Slide_fillblankimages.prototype.dropItem(e,t,i);e.focus()})}document.addEventListener("animationstart",Slide_fillblankimages.prototype.filterEvent,false);document.addEventListener("MSAnimationStart",Slide_fillblankimages.prototype.filterEvent,false);document.addEventListener("webkitAnimationStart",Slide_fillblankimages.prototype.filterEvent,false)});function Slide_fillblankschoosemixed(){}Slide_fillblankschoosemixed.prototype=new Slide_fillblanks;Slide_fillblankschoosemixed.prototype.onShow=function(){Slide_chooseblanks.prototype.onShow.call(this);Slide_fillblanks.prototype.onShow.call(this)};Slide_fillblankschoosemixed.prototype.checkSizeEmptyAnswer=function(e){Slide_chooseblanks.prototype.checkSizeEmptyAnswer.call(this,e)};Slide_fillblankschoosemixed.prototype.esRespuesta=function(e,t){if(t===undefined)return false;$element=$("#"+this.prefijo+"v"+t);if($element.is("select")){return Slide_chooseblanks.prototype.esRespuesta.call(this,e,t)}else{return Slide_fillblanks.prototype.esRespuesta.call(this,e,t)}};Slide_fillblankschoosemixed.prototype.updateElem=function(e,t,i){$element=$("#"+this.prefijo+"v"+e);if($element.is("select")){Slide_chooseblanks.prototype.updateElem.call(this,e,t,i)}else{Slide_fillblanks.prototype.updateElem.call(this,e,t,i)}};Slide_fillblankschoosemixed.prototype.showElemSolution=function(e){$element=$("#"+this.prefijo+"v"+e);if($element.is("select")){Slide_chooseblanks.prototype.showElemSolution.call(this,e)}else{Slide_fillblanks.prototype.showElemSolution.call(this,e)}};Slide_fillblankschoosemixed.prototype.hideElemSolution=function(e){$element=$("#"+this.prefijo+"v"+e);if($element.is("select")){Slide_chooseblanks.prototype.hideElemSolution.call(this,e)}else{Slide_fillblanks.prototype.hideElemSolution.call(this,e)}};Slide_fillblankschoosemixed.prototype.clearSlide=function(){Slide_chooseblanks.prototype.clearSlide.call(this);Slide_fillblanks.prototype.clearSlide.call(this)};Slide_fillblankschoosemixed.prototype.checkSizeEmptyAnswer=function(e){Slide_chooseblanks.prototype.checkSizeEmptyAnswer.call(this,e)};Slide_fillblankschoosemixed.prototype.getIdenticalSolutionsCount=function(){var e={};var t=typeof this.numRespuestasDrag!=="undefined"&&this.numRespuestasDrag?this.numRespuestasDrag:this.numElementos;for(var i=this.firstElementIndex;i<t;i++){var s=decode64(window["Sol"+this.prefijo][i]);e[s]=e[s]?e[s]+1:1}return e};Slide_fillblankschoosemixed.prototype.getRespuestasCount=function(){var e={};var t=typeof this.numRespuestasDrag!=="undefined"&&this.numRespuestasDrag?this.numRespuestasDrag:this.numElementos;for(var i=this.firstElementIndex;i<t;i++){var s=this.respuestas[i];e[s]=e[s]?e[s]+1:1}return e};function Slide_htmlbook(){}Slide_htmlbook.prototype=new Slide;Slide_htmlbook.prototype.esEjercicio=true;Slide_htmlbook.prototype.esAutocorregible=false;Slide_htmlbook.prototype.esEvaluable=false;Slide_htmlbook.prototype.esContenido=true;Slide_htmlbook.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_htmlbook.prototype.onShow=function(){uploadedFilesInSlides(this.marcadoTextBox,this.uid);Slide.prototype.onShow.call(this)};Slide_htmlbook.prototype.update=function(e,t){if(t)this.clasificacion=0;for(var i=0;i<this.numElementos;i++){var s=this.respuestas[i]||"";$("[id^='"+this.prefijo+"v"+i+"']").val(s);if(mostrarNota){this.pintaNota(i,this.resultados[i])}if(t&&this.resultados[i]!=null){this.clasificacion+=this.resultados[i]/2}}if(t){if(this.numElementos>0)this.clasificacion=this.clasificacion/this.numElementos}blink.events.trigger("afterShortanswersUpdate",this.prefijo);Slide.prototype.update.call(this,e,t)};Slide_htmlbook.prototype.evalNumElements=function(){this.numElementos=$("[id^='"+this.prefijo+"v']").size()};Slide_htmlbook.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_htmlbook.prototype.getSuspendData=function(){for(var e=0;e<this.numElementos;e++){this.respuestas[e]=$("[id^='"+this.prefijo+"v"+e+"']").val()}return Slide.prototype.getSuspendData.call(this)};Slide_htmlbook.prototype.correct=function(e,t){for(var i=0;i<this.numElementos;i++){this.respuestas[i]=document.f.elements[this.prefijo+"v"+i].value}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_htmlbook.prototype.pintaNota=function(e,t){var i="sin_corregir";if(t==0){i="respuesta_ko"}else if(t==1){i="respuesta_regular"}else if(t==2){i="respuesta_ok"}$("[id='"+this.prefijo+"nota"+e+"']").html("<img src='../images/i/"+i+".gif'/>").parent().height($("[id='"+this.prefijo+"v"+e+"']").height())};Slide_htmlbook.prototype.cambiaNota=function(e){var t=this.resultados[e];if(t==2){t=null}else if(t==null){t=0}else{t++}this.resultados[e]=t;this.pintaNota(e,t);this.clasificacionprofesor=0;for(var e=0;e<this.numElementos;e++){$("[id^='"+this.prefijo+"v"+e+"']").val(this.respuestas[e]);this.pintaNota(e,this.resultados[e]);if(this.resultados[e]!=null){this.clasificacionprofesor+=this.resultados[e]/2}}if(this.numElementos>0)this.clasificacionprofesor=this.clasificacionprofesor/this.numElementos;$("#edicion_nota_transp").val(maxclasificacion*this.clasificacionprofesor);var i=this.prefijo.split("t")[1];updateNota(i)};Slide_htmlbook.prototype.showSolution=function(){Slide.prototype.showSolution.call(this);if(checkMostrarSoluciones()){$("#"+this.prefijo+"_saq .hint").show()}};Slide_htmlbook.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("#"+this.prefijo+"_saq .hint").hide()}};Slide_htmlbook.prototype.clearSlide=function(){this.clearSlideComunIni();$("#"+this.prefijo+"pg").find(".js-richeditor-input").val("");$("#"+this.prefijo+"pg").find("textarea").removeAttr("disabled");this.reiniciarArchivoComoRespuesta();this.clearSlideComunFin()};Slide_htmlbook.prototype.reiniciarArchivoComoRespuesta=function(){if($(".uploaded-file-content","#"+this.prefijo+"pg").length){$(".uploaded-file-content","#"+this.prefijo+"pg").html("");$(".uploaded-file-editor","#"+this.prefijo+"pg").hideBlink();if(suspdata.status["t"+this.uid].marcadoTextBox!=="undefined"){delete suspdata.status["t"+this.uid].marcadoTextBox}}};$(document).ready(function(){inicializarFilesAsAnswers(".js-rich-group")});function Slide_html(){}Slide_html.prototype=new Slide;Slide_html.prototype.reset=function(){$("#"+this.prefijo+"_html").html($("#"+this.id+"_init").html())};function resetAllHtmlSlides(){$("div[id$='_html']").each(function(){$(this).html($("#"+this.id+"_init").html())});$("div[id$='_html'] .class_sonido").remove()}function preview_slide(e,t,i){contenido=$("[name='"+e+"_html']").val();contenido=contenido.replace(new RegExp("##urlmedia##","g"),MEDIA_URL+"/r/s/"+i);$("div[id='"+e+"_html_init']").html(contenido);enableFloatingObjects()}function updateHtmlFromPreview(){$("div[id$='_html_init']").each(function(){contenido=$(this).html();$("[name='"+this.id.substring(0,this.id.length-5)+"']").val(contenido)})}function Slide_imageslider(){}Slide_imageslider.prototype=new Slide;Slide_imageslider.prototype.esEvaluable=false;Slide_imageslider.prototype.esContenido=true;Slide_imageslider.prototype.numMaxRows=25;Slide_imageslider.prototype.maxHeight=300;Slide_imageslider.prototype.shouldShowArrows=true;Slide_imageslider.prototype.slickDefOptions={defaultMain:{swipe:false,arrows:true,fade:true,draggable:false,infinite:false,slide:"div",speed:300,swipeToSlide:true,lazyLoad:"progressive",nextArrow:'<button class="'+this.prefijo+'_arrow slick-next slick-arrow0"></button>',prevArrow:'<button class="'+this.prefijo+'_arrow slick-prev slick-arrow0"></button>'},defaultThumbs:{slidesToShow:9,focusOnSelect:false,centerMode:true,infinite:false,draggable:false,slide:"div",speed:300,nextArrow:'<button class="'+this.prefijo+'_arrow slick-next slick-arrow1"></button>',prevArrow:'<button class="'+this.prefijo+'_arrow slick-prev slick-arrow1"></button>',responsive:[{breakpoint:929,settings:{slidesToShow:7}},{breakpoint:629,settings:{slidesToShow:5}},{breakpoint:460,settings:{slidesToShow:3}}]}};Slide_imageslider.prototype.onShow=function(){if(this.includedInPull){this.unSlickIt($("#"+this.prefijo+"_slider-container .slick-initialized"))}var e=this.prefijo,t=$("#"+e+"_slider-container"),i=t.children(".slick-initialized"),s=$("#"+e+"left").find(".bck-audio-container, .bck-video-container2, .js-audio-player, .js-video-player"),o=$("#"+e+"_multimedia"),a=$("#"+e+"-play");if(i.length){return Slide.prototype.onShow.call(this)}var r=t.find(".img-main"),n=t.find(".img-title"),l=t.find(".img-thumbs");if(s.length==0){a.remove();o.remove()}if(this.shouldShowThumbs){var d={asNavFor:l,adaptiveHeight:false},u={};var c={focusOnSelect:true,swipeToSlide:true,touchThreshold:10,edgeFriction:.2,mobileFirst:true};$.extend(u,{swipeToSlide:true,touchThreshold:10,edgeFriction:.2})}else{var d={arrows:this.shouldShowArrows}}this.startSlideEvents(e);n.removeClass("hidden");this.slickIt(r,this.setSlickOptions(this.slickDefOptions["defaultMain"],d,c));l.length&&this.slickIt(l,this.setSlickOptions(this.slickDefOptions["defaultThumbs"],u,c));if(blink.activity.currentStyle.customizedMultimediaImageSlider()){this.playButtonBehaviour(e)}Slide.prototype.onShow.call(this);this.adaptSliderImageHeight()};Slide_imageslider.prototype.onSlideChange=function(e){this.changeHover(e);this.changeTitle(e)};Slide_imageslider.prototype.adaptHeight=function(e){var t=$("#"+e+"pg"),i=t.find(".img-main"),s=t.find(".img-title"),o=i.find(".slick-current > img");var a=this.maxHeight-s.outerHeight(true);if(o.outerHeight()>a)o.css("height",a)};Slide_imageslider.prototype.onResize=function(e){var t=$("#"+e+"_img-slider"),i=t.find(".slick-slider"),s=t.slick("slickCurrentSlide");this.alignMiddle(i);t.slick("slickGoTo",s)};Slide_imageslider.prototype.loadSuspendData=function(e){if(e===undefined){return}Slide.prototype.loadSuspendData.call(this,e)};Slide_imageslider.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);var t=new Array;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(e.respuestas[i]!=null&&e.respuestas[i]!="-"){t[i]=this.resp[i]}}e.respuestas=t;return e};Slide_imageslider.prototype.getIdSlide=function(){return this.prefijo.replace(/^\D+/g,"")};Slide_imageslider.prototype.addOption=function(e){var t=$("#"+e+"pg"),i=t.find(".js-form-questions .js-row").length,s=i+1,o=t.find(".js-add-new-row").clone(),a=o.find(".js-img-slider-title"),r=o.find(".js-img-slider-name"),n=o.find(".js-img-slider-path"),l=o.find(".js-img-slider-upload"),d=o.find(".js-img-slider-delete");if(this.checkNumMax(i)){t.find(".js-add-option").addClass("disabled");return false}o.showBlink().removeClass("js-add-new-row").attr("name",e+"_row_"+i);a.attr({name:a.attr("name")+i,placeholder:a.attr("placeholder")+" "+s});r.attr({id:e+"_img-name_"+i});n.attr({name:n.attr("name")+i,id:e+"_img-path_"+i});l.data("slide-index",i);d.data("slide-index",i).attr({id:d.attr("id")+i});t.find(".js-form-questions").append(o);if(this.checkNumMax(s)){t.find(".js-add-option").addClass("disabled")}};Slide_imageslider.prototype.playButtonBehaviour=function(prefijo){var $multimedia=$("#"+prefijo+"left").find(".bck-audio-container, .bck-video-container2, .js-audio-player, .js-video-player"),$firstMM=$multimedia.first(),$playerContainer=$("#"+prefijo+"_multimedia"),$boton=$("#"+prefijo+"-play");$multimedia.hide();if($firstMM.hasClass("bck-audio-container")||$firstMM.hasClass("audio")){var $audio=$firstMM.find(".js-audio-player");if($audio.length===0){$audio=$firstMM}$firstMM.prependTo($playerContainer).addClass("shownAudioPlayer");var id=$audio.data("id"),url=$audio.attr("alt");$boton.on("click",function(e){if(!$(e.target).hasClass("active")){$playerContainer.removeClass("hidden");$(e.target).addClass("active").attr("onclick",_onclick)}else{$playerContainer.addClass("hidden");$(e.target).removeClass("active")}buttonPlaySoundPressed(id,url,prefijo,false);blink.events.once("multimedia:created",function(){$playerContainer.find(".vjs-close").hide()})})}else{var $video=$firstMM.find(".bck-video-player a"),_onclick=$video.attr("onclick");$playerContainer.remove();$boton.on("click",function(){eval(_onclick)});$video.removeAttr("onclick")}};Slide_imageslider.prototype.clearSlide=function(e){var t=$("#"+e+"_img-main");t.slick("slickGoTo",0)};Slide_imageslider.prototype.showNextSolution=function(){var e=this.prefijo,t=$("#"+e+"_img-main");t.slick("slickNext")};Slide_imageslider.prototype.showSolution=function(e){var t=$("#"+e+"_img-main");slickIndex=t.find(".slick-slide").length-1;t.slick("slickGoTo",slickIndex)};Slide_imageslider.prototype.changeTitle=function(e){var t=$("#"+e+"_img-main").find(".slick-current"),i=$("#"+e+"_img-title").find("h5"),s=t.find("img").attr("data-title");if(i.html()!=s){i.animate({opacity:0},50,function(){$(this).html(s).animate({opacity:1},150,Slide_imageslider.prototype.adaptHeight(e))})}};Slide_imageslider.prototype.changeHover=function(e){var t=$("#"+e+"_img-thumbs"),i=t.find(".slick-current img");if(i.hasClass("img-notCurrent")){t.find(".slick-slide img:not(.img-notCurrent)").addClass("img-notCurrent");i.removeClass("img-notCurrent")}};Slide_imageslider.prototype.alignMiddle=function(e){var s=e.parent().height();e.each(function(){var e=$(this),t=e.outerHeight(true),i=s/2-t/2+"px";e.css({position:"relative",top:i})})};Slide_imageslider.prototype.configSliderButtons=function(e){var t=$("#"+e+"_img-main"),i=$("#"+e+"_buttons"),s=t.find(".slick-slide").length;if(s==1){i.find('.slide_buttons:not(".slide_play")').addClass("disabled").off()}t.on("afterChange",function(){if(t.slick("slickCurrentSlide")==s-1){i.children().not(".js-reset, .js-play").addClass("disabled");i.find(".js-reset").removeClass("disabled")}else if(t.slick("slickCurrentSlide")==0){i.children().not(".js-reset, .js-play").removeClass("disabled");i.find(".js-reset").addClass("disabled")}else{i.find(".disabled").removeClass("disabled")}});i.find(".js-show-solution, .js-reset").off("click");i.find(".js-show-solution").click(function(){this.showSolution(e)}.bind(this));i.find(".js-reset").click(function(){this.clearSlide(e)}.bind(this));var o=blink.hasTouch?"touchstart":"mouseenter",a=blink.hasTouch?"touchend touchmove":"mouseleave";i.children().on(o,function(e){!$(e.target).hasClass("disabled")&&$(e.target).addClass("hover")});i.children().on(a,function(e){$(e.target).removeClass("hover")})};Slide_imageslider.prototype.startSlideEvents=function(t){var e=this.shouldShowThumbs;if(e){var i=$("#"+t+"_img-thumbs");i.on("init",function(e){this.alignMiddle($(e.target).find(".slick-slide"));$(e.target).on("afterChange",function(){Slide_imageslider.prototype.onSlideChange(t)}).on("setPosition",function(){Slide_imageslider.prototype.alignMiddle($(e.target).find(".slick-slide"))}).find(".slick-current img").removeClass("img-notCurrent");$(window).on("resize",function(){Slide_imageslider.prototype.onResize(t)});this.startSlideTouchEvents()}.bind(this))}else{var s=$("#"+t+"_img-main");s.on("init",function(e){this.configSliderButtons(t);$(e.target).on("afterChange",function(){this.changeTitle(t)}.bind(this)).parent().find(".js-reset").addClass("disabled")}.bind(this))}};Slide_imageslider.prototype.startSlideTouchEvents=function(){var e=this.prefijo,t=$("#"+e+"_slider-container");var i=t.find("#"+e+"_img-thumbs .slick-slider, img");i.on("touchstart",function(e){!$(e.target).hasClass("img-notCurrent")&&$(e.target).addClass("img-notCurrent")}).on("touchend touchmove",function(e){$(e.target).removeClass("img-notCurrent")})};Slide_imageslider.prototype.slickIt=function(e,t){if(!this.isSlickInitialized(e)){e.hasClass("hidden")&&e.removeClass("hidden");e.slick(t)}};Slide_imageslider.prototype.unSlickIt=function(e){if(this.isSlickInitialized(e)){e.addClass("hidden");e.slick("unslick")}};Slide_imageslider.prototype.reSlickIt=function(e){var t=this.getSlickOptions(e);if(this.isSlickInitialized(e)){this.unSlickIt(e)}this.slickIt(e,t)};Slide_imageslider.prototype.isSlickInitialized=function(e){return e.hasClass("slick-initialized")};Slide_imageslider.prototype.setSlickOptions=function(e,t,i){var s={};if(!t&&!e){return s}s=t?$.extend(e,t):e;if(i){if(!s["responsive"]){s["responsive"]=this.setSlickBreakpoints([1024,768,480])}$.each(s["responsive"],function(e,t){$.extend(t["settings"],i)})}return s};Slide_imageslider.prototype.setSlickBreakpoints=function(e){var i=[];if(!e){return}$.each(e,function(e,t){$.merge(i,[{breakpoint:t,settings:{}}])});return i};Slide_imageslider.prototype.getSlickOptions=function(i){var e=["accessibility","adaptiveHeight","appendArrows","appendDots","arrows","asNavFor","autoplay","autoplaySpeed","centerMode","centerPadding","cssEase","customPaging","dots","dotsClass","draggable","easing","edgeFriction","fade","focusOnChange","infinite","initialSlide","lazyLoad","mobileFirst","nextArrow","pauseOnDotsHover","pauseOnFocus","pauseOnHover","prevArrow","respondTo","responsive","rows","rtl","slide","slidesPerRow","slidesToScroll","slidesToShow","speed","swipe","swipeToSlide","touchMove","touchThreshold","useCSS","useTransform","variableWidth","vertical","verticalSwiping","waitForAnimate","zIndex"],s=[];e.forEach(function(e){var t=i.slick("slickGetOption",e);s[e]=t});return s};Slide_imageslider.prototype.onBeforeChangeSlide=function(){var e=this.prefijo,t=$("#"+e+"_multimedia"),i=$("#"+e+"-play");if(i.hasClass("active")){t.addClass("hidden");i.removeClass("active")}if(t.find(".video-js").length>0){window.cerrarIframe(e)}};Slide_imageslider.prototype.adaptSliderImageHeight=function(){if(!blink.activity.currentStyle||!blink.activity.currentStyle.adaptSliderImageHeight||!blink.activity.currentStyle.adaptSliderImageHeight()){return false}var e=this.prefijo,t=$("#"+e+"pg"),i=t.find(".pregunta"),s=t.find(".img-main"),o=t.find(".img-slider"),a=t.find(".img-title"),r=$("#"+e+"_buttons");var n=s.outerHeight(true)-s.outerHeight(),l=t.height()-(i.outerHeight(true)+a.outerHeight(true)+r.outerHeight(true)+o.outerHeight());Slide_imageslider.prototype.maxHeight=l;s.find("img").css("max-height",l-n);Slide_imageslider.prototype.adaptHeight(e)};Slide_imageslider.prototype.checkNumMax=function(e){if(typeof this.numMaxRows!=="undefined"&&this.numMaxRows){if(typeof e==="undefined"||e>=this.numMaxRows){return true}}return false};$(function(){$(document).on("click",".slide-imageslider .js-add-option",function(e){var t=$(this),i=t.closest(".slide-imageslider").data("prefix"),s=t.hasClass("disabled");!s&&Slide_imageslider.prototype.addOption(i)});$(document).on("click",".slick-slide",function(e){var t=$(this).attr("data-slick-index");var i=$(this);var s=i.closest(".slide_main").data("prefix");var o=$("#"+s+"_img-main");o.slick("slickGoTo",t)});$(document).on("click",".slick-arrow1",function(e){var t=$(this);var i=t.closest(".slide_main").data("prefix");var s=$("#"+i+"pg .slick-current");var o=$("#"+i+"_img-main");var a=o[0].slick.currentSlide;$("#"+i+"pg .slick-current").removeClass("slick-current");var r=$("#"+i+"pg .slick-slide[data-slick-index="+a+"]");r.addClass("slick-current")});$(document).on("click",".slick-arrow0",function(e){var t=$(this);var i=t.closest(".slide_main").data("prefix");var s=$("#"+i+"pg .slick-current");var o=$("#"+i+"_img-main");var a=o[0].slick.currentSlide})});function Slide_img(){}Slide_img.prototype=new Slide;Slide_img.prototype.esContenido=true;function Slide_markwords(){}Slide_markwords.prototype=new Slide;Slide_markwords.prototype.esEjercicio=true;Slide_markwords.prototype.update=function(e,t){if(t)this.clasificacion=0;if(0!==this.respuestas.length){for(var i=0;i<this.respuestas.length;i++){$("span.markwords-word#"+this.respuestas[i]+".markwords_"+this.prefijo).addClass("markword-active").attr("aria-selected",true);if(this.isDone()||this.intentos>0){if(-1!=$.inArray(this.respuestas[i],this.evaluableElements)){$("span.markwords-word#"+this.respuestas[i]).addClass("markword-correct").attr("aria-selected",true)}else{$("span.markwords-word#"+this.respuestas[i]).addClass("markword-false").attr("aria-selected",true)}}}}if(t||this.isDone()){var s=$('span[aria-selected="true"].markwords-word.markwords_'+this.prefijo);var o=0;var a=0;var r=0;var n=0;if(0!==s.length){for(var i=0;i<s.length;i++){var l=$(s[i]);if(-1!=$.inArray(l.attr("id"),this.evaluableElements)){l.addClass("markword-correct");o++}else{l.addClass("markword-false");a++}}r=o-a;if(r<0){r=0}this.clasificacion=r/this.evaluableElements.length}$("span.markword-correct").prop("onclick",null).off("click").css("cursor","text");if(this.isDone()){$("span.markwords-word.markwords_"+this.prefijo).prop("onclick",null).off("click").css("cursor","text");for(var i=0;i<$("span.markword-correct.markwords_"+this.prefijo).length;i++){var d=$("span.markword-correct.markwords_"+this.prefijo)[i];this.correctAnswers[i]=$(d).attr("id")}for(var i=0;i<$("span.markword-false.markwords_"+this.prefijo).length;i++){var d=$("span.markword-false.markwords_"+this.prefijo)[i];this.wrongAnswers[i]=$(d).attr("id")}}}Slide.prototype.update.call(this,e,t)};Slide_markwords.prototype.evalNumElements=function(){this.useExamples&&this.showExample();if(this.useExamples&&!this.exampleShown){$("span.markwords-word#"+this.evaluableElements.shift()).addClass("markword-solution").prop("onclick",null).off("click").css("cursor","text");this.exampleShown=!this.exampleShown}this.numElementosEvaluables=0;if(0!==this.evaluableElements.length){this.numElementosEvaluables=this.evaluableElements.length;this.numElementos=this.numElementosEvaluables}};Slide_markwords.prototype.loadSuspendData=function(e){this.evalNumElements();if(typeof e==="undefined"){return}Slide.prototype.loadSuspendData.call(this,e)};Slide_markwords.prototype.getSuspendData=function(){this.setMarkedAnswers();if(this.solutionShown||this.solutionPartialShown){switchSolution(this.prefijo,true);this.solutionCounter=0}return Slide.prototype.getSuspendData.call(this)};Slide_markwords.prototype.correct=function(e,t){this.respuestas=[];this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_markwords.prototype.clearSlideCustomIni=function(){var e=$("span[aria-selected=true].markword-correct.markwords_"+this.prefijo);e.each(function(){$(this).prop("onclick",null).off("click").css("cursor","text");Slide_markwords.prototype.setActiveMarkword(this)})};Slide_markwords.prototype.setMarkedAnswers=function(){var e=$("span[aria-selected=true].markword-active.markwords_"+this.prefijo);this.respuestas=[];for(var t=0;t<e.length;t++){this.respuestas[t]=e[t].id}};Slide_markwords.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){this.solutionShown=false;for(var e=0;e<this.evaluableElements.length;e++){$("span.markwords-word#"+this.evaluableElements[e]).removeClass("markword-solution")}for(var e=0;e<this.correctAnswers.length;e++){$("span.markwords-word#"+this.correctAnswers[e]+".markwords_"+this.prefijo).addClass("markword-active markword-correct").attr("aria-selected",true)}for(var e=0;e<this.wrongAnswers.length;e++){$("span.markwords-word#"+this.wrongAnswers[e]+".markwords_"+this.prefijo).addClass("markword-active markword-false").attr("aria-selected",true)}this.setMarkedAnswers()}};Slide_markwords.prototype.showSolution=function(){if(checkMostrarSoluciones()){Slide.prototype.showSolution.call(this);this.solutionShown=true;this.solutionCounter=0;this.uncheckAllWords();for(var e=0;e<this.evaluableElements.length;e++){$("span.markwords-word#"+this.evaluableElements[e]+".markwords_"+this.prefijo).addClass("markword-solution")}}};Slide_markwords.prototype.showNextSolution=function(){this.uncheckAllWords();if(this.evaluableElements.length<=this.solutionCounter){this.solutionCounter=0;this.hideSolution()}else{$("span.markwords-word#"+this.evaluableElements[this.solutionCounter]).addClass("markword-solution");this.solutionCounter++}};Slide_markwords.prototype.uncheckAllWords=function(){var e=$("span[aria-selected=true].markwords_"+this.prefijo);e.each(function(){var e=$(this);e.removeAttr("aria-selected");e.removeClass("markword-active markword-correct markword-false markword-solution")})};Slide_markwords.prototype.clearSlide=function(){this.correctAnswers=[];this.wrongAnswers=[];if(this.isDone()){var e=$(".markwords-word.markwords_"+this.prefijo);e.each(function(){$(this).removeAttr("style");Slide_markwords.prototype.setActiveMarkword(this)})}this.clearSlideComunIni();this.uncheckAllWords();this.respuestas=[];this.clearSlideComunFin();this.update(false,false)};Slide_markwords.prototype.setActiveMarkword=function(e){$(e).css("cursor","pointer");$(e).on("click",function(){var e=$(this);if((e.attr("aria-selected")||e.hasClass("markword-false"))&&!e.hasClass("markword-correct")){e.removeAttr("aria-selected");e.removeClass("markword-active markword-false")}else{e.attr("aria-selected",true);e.addClass("markword-active")}Slide_markwords.prototype.getSuspendData()})};Slide_markwords.prototype.initWordBehaviour=function(){var e=$(".markwords-word");e.each(function(){Slide_markwords.prototype.setActiveMarkword(this)})};$(document).ready(function(){Slide_markwords.prototype.initWordBehaviour()});function Slide_matching(){}var ctxMatch,storedCanvasObj=[];function lineasCanvas(e,t,i,s,o){this.id="l_"+s+"_o_"+e;this.origen=e;this.destino=t;this.color=i;this.slide=s;this.inicio=o;this.pintarLineasCanvas=function(e,t){if(this.slide==t&&(this.origen!=0&&this.destino!=0)){e.beginPath();e.moveTo(0,this.origen);e.bezierCurveTo((e.canvas.width-e.canvas.width/10)/2,this.origen,(e.canvas.width-e.canvas.width/10)/2,this.destino,e.canvas.width-e.canvas.width/10,this.destino);e.strokeStyle=this.color;ctxMatch.fillStyle=this.color;ctxMatch.lineWidth=2.5;e.stroke();this.dibujarFlechaCanvas(e,e.canvas.width,this.destino)}};this.resetLineasCanvas=function(e){if(this.inicio===0&&window["t"+e+"_slide"].useExamples){return}if(this.slide==e){delete this.origen;delete this.destino;delete this.color}};this.dibujarFlechaCanvas=function(e,t,i){e.beginPath();e.moveTo(t,i);e.lineTo(t-1*(e.canvas.width/10),i-e.canvas.width/30-1);e.lineTo(t-1*(e.canvas.width/10),i+e.canvas.width/30+1);e.closePath();e.fill()}}Slide_matching.prototype=new Slide;Slide_matching.prototype.esEjercicio=true;Slide_matching.prototype.maxHeight=0;Slide_matching.prototype.onShow=function(){this.useExamples&&this.showExample();Slide.prototype.onShow.call(this)};Slide_matching.prototype.onAfterShowSlide=function(){var e=this;if($("#"+this.prefijo+"_matchingRelaciones").length){this.inicializarCanvas();$(".img-relaciones img").css("display","none");$(".img-relaciones div").css("display","none")}setTimeout(function(){e.updateMatch();Slide.prototype.onAfterShowSlide.call(e)},1)};Slide_matching.prototype.inicializarCanvas=function(){var e=this.getcanvasHeight();$("#"+this.prefijo+"_matchingRelaciones").css("height",e);ctxMatch=this.getContext();ctxMatch.canvas.height=parseInt($("#"+this.prefijo+"_matchingRelaciones").css("height"));ctxMatch.canvas.width=parseInt($("#"+this.prefijo+"_matchingRelaciones").css("width"))};Slide_matching.prototype.calculaMaxHeight=function(e){return Math.max.apply(null,e.map(function(){return $(this).outerHeight()}).get())};Slide_matching.prototype.updateMatch=function(){if(this.solutionShown){return}if(!(blink.theme.styles&&blink.theme.styles.legacy&&blink.activity.currentStyle instanceof blink.theme.styles.legacy)){var e=$("[id^='"+this.prefijo+"_d_'],[id^='"+this.prefijo+"_o_']"),t=$("[id^='"+this.prefijo+"_b_']");var i=this.calculaMaxHeight(e);if(this.maxHeight<40&&i>45){this.maxHeight=i;e.css("height",this.maxHeight);e.find("img").css("max-height",this.maxHeight);!this.usarLineas&&t.css("height",this.maxHeight);blink.activity.updateCanvasSize&&blink.activity.updateCanvasSize()}}this.firstElementIndex=this.useExamples?1:0;if(!this.usarLineas){if(this.showed||!this.orden){return}for(var s=this.firstElementIndex;s<this.numElementos;s++){var o=this.orden.origen[s],a=this.orden.destino[s];if(a!==undefined&&a!==null&&a===this.respuestas[o]){var r=this.resultados[o]!==null,n=r&&(this.resultados[o]?" ok":" ko");$("#"+this.prefijo+"_o_"+o).addClass("emparejado").addClass(n);$("#"+this.prefijo+"_b_"+o).addClass("emparejado").addClass(n);$("#"+this.prefijo+"_d_"+a).addClass("emparejado").addClass(n)}}this.showed=true;this.useExamples&&this.showExample();return}for(var s=this.firstElementIndex;s<this.numElementos;s++){$("[id^='"+this.prefijo+"_line_"+s+"_']").remove();if(this.respuestas[s]!=null&&this.respuestas[s]!=undefined&&this.respuestas[s]!="-"){this.match(s,this.respuestas[s]);if(this.resultados[s]){$("#"+this.prefijo+"_o_"+s).addClass("disabled");$("#"+this.prefijo+"_d_"+this.respuestas[s]).addClass("disabled")}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[s]!=null)){if(this.resultados[s]!=null)this.match(s,this.respuestas[s],this.resultados[s]?"ok":"ko")}}else{this.resultados[s]=null}}this.useExamples&&this.showExample()};Slide_matching.prototype.update=function(e,t){this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){$("[id^='"+this.prefijo+"_line_"+i+"_']").remove();if(this.respuestas[i]!=null&&this.respuestas[i]!=undefined&&this.respuestas[i]!="-"){this.match(i,this.respuestas[i]);if(t){this.resultados[i]=this.checkVisual2Real(i,this.respuestas[i])}if(this.resultados[i]){t&&this.clasificacion++;$("#"+this.prefijo+"_o_"+i).addClass("disabled");$("#"+this.prefijo+"_b_"+i).addClass("disabled");$("#"+this.prefijo+"_d_"+this.respuestas[i]).addClass("disabled")}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=null)){$("#"+this.prefijo+"_line_"+i).remove();if(this.resultados[i]!=null){this.match(i,this.respuestas[i],this.resultados[i]?"ok":"ko",true)}}}else{this.resultados[i]=null}}if(t){var s=this.numElementos;this.useExamples&&s--;if(s>0){this.clasificacion=this.clasificacion/s}}Slide.prototype.update.call(this,e)};Slide_matching.prototype.evalNumElements=function(){this.numElementos=$("li[id^='"+this.prefijo+"_o']").size();this.numElementosEvaluables=this.numElementos};Slide_matching.prototype.loadSuspendData=function(e){this.evalNumElements();$.fn.corner&&$("[id^="+this.prefijo+"caja]").each(function(){$(this).corner("round 8px").parent().css("padding","3px").corner("round 10px")});this.usarLineas=blink.domain.showLinesMatching?blink.domain.showLinesMatching(this):this.usarLineas;if(this.usarLineas){$("#"+this.prefijo+"_matchingBlockRelaciones").remove()}else{$("#"+this.prefijo+"_matchingRelaciones").remove();$(".workspace.matching").removeClass("lineas").addClass("blocks")}if(e===undefined){return}this.firstElementIndex=this.useExamples?1:0;for(var t=this.firstElementIndex;t<this.numElementos;t++){if(e.respuestas[t]!=null){e.respuestas[t]=this.traduceReal2Visual(e.respuestas[t])}}if(!this.usarLineas){var i=this;if(e.orden){this.orden={origen:e.orden.origen,destino:[]};_.each(e.orden.destino,function(e,t){i.orden.destino[t]=i.traduceReal2Visual(e)});this.orderMatchFromArrays(i.orden.origen,i.orden.destino)}else if(e.respuestas){this.getActualOrder(e);this.orden={origen:e.orden.origen,destino:e.respuestas};this.orderMatchFromArrays(i.orden.origen,e.respuestas)}}Slide.prototype.loadSuspendData.call(this,e)};Slide_matching.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);var t=new Array;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(e.respuestas[i]!=null&&e.respuestas[i]!="-"){t[i]=this.traduceVisual2Real(e.respuestas[i])}}if(!this.usarLineas){this.getActualOrder(e)}e.respuestas=t;return e};Slide_matching.prototype.getActualOrder=function(i){var e=$("#"+this.prefijo+"pg"),s=this;i.orden={origen:[],destino:[]};e.find(".origen").each(function(e){var t=$(this).data("id");i.orden.origen[e]=t});e.find(".destino").each(function(e){var t=$(this).data("id");i.orden.destino[e]=s.traduceVisual2Real(t)})};Slide_matching.prototype.correct=function(e,t){Slide.prototype.correct.call(this,e,t);if(!this.usarLineas){return!t&&this.onShow()}this.onShow()};Slide_matching.prototype.showSolution=function(){if(this.usarLineas){return Slide.prototype.showSolution.call(this)}if(!checkMostrarSoluciones()){return}var t=this,e=[],i=[],s=$("#"+this.prefijo+"pg");this.orden={origen:[],destino:[]};this.matchings={origen:[],destino:[]};var o=s.find(".origen").each(function(){var e=$(this).data("id");t.orden.origen.push(e);t.matchings.origen[e]=$(this).hasClass("emparejado")});var a=s.find(".destino").each(function(){var e=$(this).data("id");t.orden.destino.push(e);t.matchings.destino[e]=$(this).hasClass("emparejado")});o.removeClass("ok ko").addClass("emparejado sol");a.removeClass("ok ko").addClass("emparejado sol");s.find(".block").removeClass("ok ko").addClass("emparejado sol");for(var r=this.firstElementIndex;r<this.numElementos;r++){e.push(r);i.push(this.traduceReal2Visual(r))}this.orderMatchFromArrays(e,i)};Slide_matching.prototype.showElemSolution=function(e){if(this.usarLineas){$("[id^='"+this.prefijo+"_line_"+e+"']").remove();return this.match(e,this.traduceReal2Visual(e),"sol")}var t=$("#"+this.prefijo+"_b_"+e),i=$("#"+this.prefijo+"_o_"+e),s=$("#"+this.prefijo+"_d_"+this.traduceReal2Visual(e));t.addClass("emparejado sol disabled").parent("ul").prepend(t);i.addClass("emparejado sol disabled").parent("ul").prepend(i);s.addClass("emparejado sol disabled").parent("ul").prepend(s)};Slide_matching.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){if(!this.usarLineas){this.orderMatchFromArrays(this.orden.origen,this.orden.destino);for(var e=this.firstElementIndex;e<this.numElementos;e++){var t=this.orden.origen[e],i=this.orden.destino[e],s=$("#"+this.prefijo+"_o_"+t).removeClass("sol"),o=$("#"+this.prefijo+"_b_"+t).removeClass("sol"),a=$("#"+this.prefijo+"_d_"+i).removeClass("sol");if(this.matchings){!this.matchings.origen[t]&&s.removeClass("emparejado");!this.matchings.origen[t]&&o.removeClass("emparejado");!this.matchings.destino[i]&&a.removeClass("emparejado")}}return this.update()}$("[id^='"+this.prefijo+"_line_']").remove();$("[id^="+this.prefijo+"_o_]").removeClass("disabled");$("[id^="+this.prefijo+"_d_]").removeClass("disabled");storedCanvasObj=new Array;if(this.respuestas&&this.respuestas.length>0){for(var e=0;e<this.numElementos;e++){if(this.respuestas[e]!=null&&this.respuestas[e]!=undefined){$("[id^='"+this.prefijo+"_line_"+e+"_']").remove();this.match(e,this.respuestas[e],this.resultados[e]?"ok":"ko")}}}else{this.inicializarCanvas()}this.update();this.useExamples&&this.showExample()}};Slide_matching.prototype.orderMatchFromArrays=function(e,t){var i=this.prefijo,s=$("#"+i+"_o_0").parent(),o=$("#"+i+"_b_0").parent(),a=$("#"+i+"_d_0").parent();for(var r=e.length-1;r>=0;r--){if(typeof t[r]!=="undefined"&&t[r]!==null){s.prepend($("#"+i+"_o_"+e[r]));o.prepend($("#"+i+"_b_"+e[r]));a.prepend($("#"+i+"_d_"+t[r]))}}};Slide_matching.prototype.traduceReal2Visual=function(opcion){var shai=sha1(opcion);for(var j=0;j<this.numElementos;j++){eval("var resp = "+this.prefijo+"_resp["+j+"]");if(shai==resp)return j}return null};Slide_matching.prototype.traduceVisual2Real=function(opcion){eval("var resp = "+this.prefijo+"_resp["+opcion+"]");for(var j=this.firstElementIndex;j<this.numElementos;j++){var shaj=sha1(j);if(shaj==resp)return j}};Slide_matching.prototype.checkVisual2Real=function(real,visual){eval("var resp = "+this.prefijo+"_resp["+visual+"]");var shaj=sha1(real);if(shaj!=resp){return trim($("#"+this.prefijo+"_d_"+visual).html())==trim($("#"+this.prefijo+"_d_"+this.traduceReal2Visual(real)).html())||trim($("#"+this.prefijo+"_o_"+visual).html())==trim($("#"+this.prefijo+"_o_"+this.traduceReal2Visual(real)).html())}return true};Slide_matching.prototype.marcarOrigen=function(e){var t=window.event&&event.target;if(t&&($(t).hasClass("sound-player")||$(t).hasClass("video-player"))||$(t).parents(".video-js").length){return true}var i=this.prefijo,s=$("#"+i+"_o_"+e),o;if(this.usarLineas){o=!s.hasClass("disabled")}else{o=!this.isDisabled&&!s.hasClass("disabled");s.hasClass("emparejado")&&this.removeMatch(s)}if(o){for(var a=this.firstElementIndex;a<this.numElementos;a++){if(this.respuestas[a]=="-")this.respuestas[a]=null}$("[id^='"+i+"_o_']").removeClass("respuesta_checked");if(this.respuestas[e]!=null){$("[id^='"+i+"_line_"+e+"_']").remove();s.addClass("respuesta_checked");this.respuestas[e]="-"}else{this.respuestas[e]="-";s.addClass("respuesta_checked");!this.usarLineas&&blink.events.trigger("matching:marcar:origen")}if(ctxMatch!==undefined){var r=this.prefijo;var n=this.getIdSlide();ctxMatch=this.getContext();if(storedCanvasObj[parseInt(n+e)]!==undefined){storedCanvasObj[parseInt(n+e)].resetLineasCanvas(n)}ctxMatch.clearRect(0,0,ctxMatch.canvas.width,ctxMatch.canvas.height);storedCanvasObj.map(function(e){e.pintarLineasCanvas(ctxMatch,n)})}}this.setReviewButtons();return true};Slide_matching.prototype.marcarDestino=function(e){var t=window.event&&event.target;if(t&&($(t).hasClass("sound-player")||$(t).hasClass("video-player"))){return true}var i=$("#"+this.prefijo+"_d_"+e),s=this.prefijo,o,a=null;if(this.usarLineas){o=!i.hasClass("disabled")}else{o=!this.isDisabled&&!i.hasClass("disabled");i.hasClass("emparejado")&&this.removeMatch(i)}for(var r=this.firstElementIndex;r<this.numElementos;r++){if(this.respuestas[r]=="-"){a=r;break}}if(o){if(a!=null){if(i.hasClass("respuesta_checked")){i.removeClass("respuesta_checked")}else{this.respuestas[a]=e;$("#"+s+"_o_"+a).removeClass("respuesta_checked");$("[id^='"+s+"_line_"+a+"_']").remove();this.match(a,e,false,true);!this.usarLineas&&blink.events.trigger("matching:marcar:destino")}}}this.setReviewButtons();return true};Slide_matching.prototype.removeMatch=function(e){var t=e.index(),i=$("#"+this.prefijo+"pg"),s=i.find(".destino:eq("+t+")"),o=i.find(".origen:eq("+t+")"),a=i.find(".block:eq("+t+")");var r=e.hasClass("block"),n=this.respuestas.indexOf("-")==e.data("id");if(e.hasClass("disabled")||r&&n){return false}else if(e.hasClass("origen")){this.respuestas[e.data("id")]=null;$match=e.add(a).add(s)}else if(e.hasClass("destino")){var l=this.respuestas.indexOf(e.data("id"));this.respuestas[l]=null;$match=e.add(a).add(o)}else{this.respuestas[e.data("id")]=null;$match=e.add(o).add(s)}$match.removeClass("emparejado ko ok sol")};Slide_matching.prototype.setDisabled=function(e){if(!this.usarLineas){this.isDisabled=true;$("#"+this.prefijo+"pg").find(".origen").addClass("disabled").end().find(".block").addClass("disabled").end().find(".destino").addClass("disabled");return this.isDisabled}$("[id='transp"+this.prefijo.substring(1)+"'] li[id^='"+this.prefijo+"_o']").addClass("disabled");$("[id='transp"+this.prefijo.substring(1)+"'] li[id^='"+this.prefijo+"_d']").addClass("disabled")};Slide_matching.prototype.match=function(e,t,i,s){if(this.usarLineas){return this.pintaLinea(e,t,i)}s&&!this.animating&&this.emparejar(e,t,i)};Slide_matching.prototype.pintaLinea=function(e,t,i){var s=this.prefijo+"_line_"+e+"_"+t;var o=blink.activity.currentStyle.matchingLinesColors(i);$("#"+s).remove();var a=$("#"+this.prefijo+"_o_"+e);var r=$("#"+this.prefijo+"_d_"+t);if(a.length&&r.length){var n=a.index()*a.outerHeight(true)+a.outerHeight(true)/2;var l=r.index()*r.outerHeight(true)+r.outerHeight(true)/2;var d=a.index();var u=Math.min(n,l);var c=u;var p=Math.abs(n-l);var h=$("#"+this.prefijo+"_relaciones").width();if(ctxMatch!==undefined){if($("#"+this.prefijo+"_matchingRelaciones").length&&ctxMatch.canvas.height!=parseInt($("#"+this.prefijo+"pg .opciones.relacion").css("height"))){this.inicializarCanvas()}var f=this.prefijo;var m=this.getIdSlide();ctxMatch=this.getContext();storedCanvasObj[parseInt(m+e)]=new lineasCanvas(n,l,o,m,d);ctxMatch.clearRect(0,0,ctxMatch.canvas.width,ctxMatch.canvas.height);storedCanvasObj.map(function(e){e.pintarLineasCanvas(ctxMatch,m)})}else{if(this.origen!=0&&this.destino!=0){var v="../images/relacion_"+(t>e?"down":"up")+(i?"_"+i:"")+(this.thinLines?"_thin":"")+".gif",g="position:absolute; z-index:89; "+"width: 100%;"+"height:"+p+"px !important; "+"margin-top:"+c+"px; "+"border-top: "+(p<40?3:0)+"px solid "+o+";";if(p<40){var S='<div id="'+s+'" src="" style="'+g+'" />'}else{var S='<img id="'+s+'" src="'+v+'" style="'+g+'" />'}$("#"+this.prefijo+"_relaciones").append(S)}}if(i=="sol"){a.addClass("disabled");r.addClass("disabled")}}};Slide_matching.prototype.emparejar=function(e,t,i){var s=this.prefijo,o=$("#"+s+"_o_"+e),a=$("#"+s+"_b_"+e),r=$("#"+s+"_d_"+t),n=o.add(a).add(r);if(i){n.removeClass("ko ok sol");return o.hasClass("emparejado")&&n.addClass(i)}if(o.index()>r.index()){var l=r.prev();if(l.hasClass("ok")||l.hasClass("ko")){this.moverArriba(a);return this.moverArriba(o,r)}this.moverArriba(r);this.moverArriba(o);this.moverArriba(a);return}if(r.index()>o.index()){var l=o.prev();if(l.hasClass("ok")||l.hasClass("ko")){return this.moverArriba(r,o,a)}}this.moverArriba(o);this.moverArriba(a);this.moverArriba(r)};Slide_matching.prototype.moverArriba=function(e,t,i){var s=e.prevAll().not(".emparejado"),o=e.prevAll(".ok, .ko");if(!s.length){e.addClass("emparejado");return o.length&&this.mover(e,o)}else if(o.length){var a=$(s[0]);return this.mover(e,a,t,i)}e.removeClass("emparejado");this.mover(e,s,t,i)};Slide_matching.prototype.mover=function(s,o,a,r){var e=$(o[o.length-1]),t=$(o[0]),i=s.offset().top-e.offset().top,n=s.offset().top+s.outerHeight(),l=t.offset().top+t.outerHeight(),d=n-l+1;this.animating=true;s.css("position","relative").animate({top:-i});o.css("position","relative").animate({top:d},{complete:function(){var e=s.parent();e.find(".opcion").sort(function(e,t){return $(e).offset().top>$(t).offset().top?1:-1}).appendTo(e);s.css({position:"static",top:0});o.css({position:"static",top:0});var t=s.prevAll().not(".emparejado"),i=s.prevAll(".ok, .ko");if(t.length){this.moverArriba(s);if(!!a){this.moverArriba(a);a.hasClass("origen")&&this.moverArriba(r)}}else if(i.length){this.mover(s,i);if(!!a){this.moverArriba(a);a.hasClass("origen")&&this.moverArriba(r)}}s.addClass("emparejado");this.animating=false}.bind(this)})};Slide_matching.prototype.esRespuesta=function(e){return e!==null&&e!==undefined&&e!==""&&e!=="-"};Slide_matching.prototype.clearSlide=function(){this.isDisabled=false;var t="disabled emparejado ok ko",e=["_o_","_b_","_d_"],i=this.prefijo;this.clearSlideComunIni();_.each(e,function(e){$("[id^="+i+e+"]").removeClass(t)});this.clearSlideComunFin();if(ctxMatch!==undefined){ctxMatch=this.getContext();var s=this.getIdSlide();storedCanvasObj.map(function(e){e.resetLineasCanvas(s)});ctxMatch.clearRect(0,0,ctxMatch.canvas.width,ctxMatch.canvas.height);storedCanvasObj.map(function(e){e.pintarLineasCanvas(ctxMatch,s)})}};Slide_matching.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".js-query"),o=i.find(".js-answer"),a=s.siblings(".js-richeditor-input"),r=o.siblings(".js-richeditor-input");i.attr("name",e+"_exer_"+t);if(a.length>0){a.attr({placeholder:a.attr("placeholder")+" "+t});s.attr({name:s.attr("name")+(t-1),id:s.attr("name")+(t-1)});r.attr({placeholder:r.attr("placeholder")+" "+t});o.attr({name:o.attr("name")+(t-1),id:o.attr("name")+(t-1)})}else{s.attr({name:s.attr("name")+(t-1),placeholder:s.attr("placeholder")+" "+t});o.attr({name:o.attr("name")+(t-1),placeholder:o.attr("placeholder")+" "+t})}$("#"+e+"pg").find(".js-form-questions").append(i)};Slide_matching.prototype.getIdSlide=function(){return this.prefijo.replace(/^\D+/g,"")};Slide_matching.prototype.getContext=function(){return $("#"+this.prefijo+"_matchingRelaciones")[0].getContext("2d")};Slide_matching.prototype.getcanvasHeight=function(){return $("#"+this.prefijo+"pg .workspace .opciones.relacion").css("height")||$("#"+this.prefijo+"pg .workspace .opciones.relacion-reducida").css("height")};function relacion_over(e){if(!$("#"+e).hasClass("disabled")||!this.usarLineas){$("#"+e).addClass("respuesta_over")}}function relacion_out(e){if(!$("#"+e).hasClass("disabled")||!this.usarLineas){$("#"+e).removeClass("respuesta_over")}}$(window).on("load",function(){blink.events.trigger("window:load")});$(function(){$(document).on("click",".slide-matching .js-add-option",function(e){var t=$(this).closest(".slide-matching").data("prefix");Slide_matching.prototype.addOption(t)})});function Slide_mathcalculations(){}Slide_mathcalculations.prototype=new Slide;Slide_mathcalculations.prototype.esEjercicio=true;Slide_mathcalculations.prototype.onShow=function(){Slide.prototype.onShow.call(this)};Slide_mathcalculations.prototype.update=function(e,t){if(t)this.clasificacion=0;this.recuperarRespuestas(t);if(t){var i=this.numElementos;if(i>0)this.clasificacion=this.clasificacion/i}Slide.prototype.update.call(this,e)};Slide_mathcalculations.prototype.recuperarRespuestas=function(corregir){for(var i=0;i<this.numElementos;i++){var oki=true;if(this.tieneRespuestas()){var algunacifra=false;$('[id^="'+this.prefijo+"_resultado_"+i+'_"]').each(function(){if($(this).val()!="")algunacifra=true});if(corregir)this.resultados[i]=new Array;eval("var resularr = "+this.prefijo+"_sol["+i+"]");if(typeof resularr!=="undefined"&&resularr){for(var k=0;k<resularr.length;k++){var primerasCifrasSonCero=true;var resul=decode64(resularr[k]);if(corregir){this.resultados[i][k]=new Array}for(var j=0;j<resul.length;j++){if(this.respuestas[i][k][j]!=undefined&&this.respuestas[i][k][j]!=""){document.f.elements[this.prefijo+"_resultado_"+i+"_"+k+"_"+j].value=this.respuestas[i][k][j]}if(corregir){var cifra=(resul+"")[j];if(cifra!="0")primerasCifrasSonCero=false;if(this.respuestas[i][k][j]!="")this.resultados[i][k][j]=cifra==this.respuestas[i][k][j];else if(this.respuestas[i][k][j]==""&&primerasCifrasSonCero){this.resultados[i][k][j]=true;if(resularr.length==1)this.resultados[i][k][j]=null}else this.resultados[i][k][j]=null}if(checkMostrarSoluciones()&&((algunacifra||this.intentos==this.numMaxIntentos)&&(this.resultados[i]!=undefined&&this.resultados[i][k]!=undefined&&this.resultados[i][k][j]!=null))){$("#"+this.prefijo+"_resultado_"+i+"_"+k+"_"+j).removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[i][k][j]?"ok":"ko"))}if(this.resultados[i]&&this.resultados[i][k]&&this.resultados[i][k][j]){this.setDisabled(this.prefijo+"_resultado_"+i+"_"+k+"_"+j,true)}else oki=false}}}if(corregir&&oki)this.clasificacion++;if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||algunacifra)&&(this.intentos==this.numMaxIntentos||this.haSidoCorregida(this.resultados[i]))){$("#"+this.prefijo+"_ej_"+i).removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(oki?"ok":"ko"))}}}};Slide_mathcalculations.prototype.haSidoCorregida=function(e){var t=false;if(typeof e!=="undefined"){for(var i=0;i<e[0].length;i++){if(e[0][i]!==null){t=true;break}}}return t};Slide_mathcalculations.prototype.evalNumElements=function(){this.numElementos=$("li[id^='"+this.prefijo+"_ej_']").size()};Slide_mathcalculations.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_mathcalculations.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown){switchSolution(this.prefijo,true)}this._readData()}return Slide.prototype.getSuspendData.call(this)};Slide_mathcalculations.prototype.correct=function(e,t){this._readData();Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_mathcalculations.prototype._readData=function(){for(var e=0;e<this.numElementos;e++){this.respuestas[e]=new Array;var t=0;while(document.f.elements[this.prefijo+"_resultado_"+e+"_"+t+"_0"]){var i=0;this.respuestas[e][t]=new Array;while(document.f.elements[this.prefijo+"_resultado_"+e+"_"+t+"_"+i]){this.respuestas[e][t][i]=document.f.elements[this.prefijo+"_resultado_"+e+"_"+t+"_"+i].value;i++}t++}}};Slide_mathcalculations.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){for(var i=0;i<this.numElementos;i++){eval("var resularr = "+this.prefijo+"_sol["+i+"]");for(var k=0;k<resularr.length;k++){var resul=decode64(resularr[k]);for(var j=0;j<resul.length;j++){$("#"+this.prefijo+"_resultado_"+i+"_"+k+"_"+j).val((resul+"")[j])}}}$("[id^='"+this.prefijo+"_ej_']").removeClass("respuesta_ok respuesta_ko");$("input[id^='"+this.prefijo+"_resultado']").removeClass("respuesta_ok respuesta_ko").addClass("solucion")}};Slide_mathcalculations.prototype.hideSolution=function(){if(checkMostrarSoluciones()){$("input[id^='"+this.prefijo+"_resultado']").val("").removeClass("solucion");this.update(false,false)}};Slide_mathcalculations.prototype.tieneRespuestas=function(){if(this.respuestas){return!!this.checkResponsesArray(this.respuestas)}return this.intentos>0};Slide_mathcalculations.prototype.checkResponsesArray=function(e){e||(e=[]);var t=false;for(var i=0,s=e.length;i<s;i++){var o=e[i];if(_.isArray(o)){t=this.checkResponsesArray(o)}else{if(o!=null&&o!=""){t=true}}if(t)return t}};Slide_mathcalculations.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-one-operation").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".js-oper1"),o=i.find(".js-operator"),a=i.find(".js-oper2");i.attr("name",e+"_operacion_"+t);s.attr({name:s.attr("name")+t,placeholder:s.attr("placeholder")+" "+t});o.attr("name",i.attr("name"));a.attr({name:a.attr("name")+t,placeholder:a.attr("placeholder")+" "+t});$("#"+e+"pg").find(".js-form-questions").append(i)};Slide_mathcalculations.prototype.clearSlide=function(){this.clearSlideComunIni();$("input[id^='"+this.prefijo+"_resultado_']").removeAttr("disabled").removeClass("respuesta_ok respuesta_ko resultado");$("[id^='"+this.prefijo+"_ej_']").removeClass("respuesta_ok respuesta_ko");this.clearSlideComunFin()};var MAX_CIFRAS=10;var tabindex=0;function keyPress(e,t,i){if(keyPressNumerico(e)){if(i&&!blink.isTablet){onCifraChange(t)}return true}return false}function onCifraChange(e){var t=parseInt($("#"+e).attr("tabindex"));if(blink.isTablet)$("[tabindex="+(t+1)+"]").focus();else setTimeout('$("[tabindex='+(t+1)+']").focus()',100);return true}function calculaNumCifras(e){return(e+"").length}function calculaCerosIzquierda(e){var t=e+"";for(var i=0;i<t.length;i++){if(t[i]!="0")return i}return t.length}function calculaCifras(e){var t=new Array;var i=calculaNumCifras(e);for(var s=0;s<i;s++){t[s]=(e+"").substring(s,s+1)}return t}function pintaEspacio(){return'<td class="cifra">&nbsp;</td>'}function pintaNumero(e,t){var i=calculaCifras(e);var s="";for(var o=0;o<t-i.length;o++)s+=pintaEspacio();for(var o=0;o<i.length;o++){s+='<td class="cifra">'+i[o]+"</td>"}return s}function pintaNumeroInput(e,t,i,s,o){var a=calculaNumCifras(i);var r="";for(var n=0;n<s-a;n++)r+=pintaEspacio();for(var n=0;n<a;n++){var l=tabindex+(a-n);var d=e+"_resultado_"+t+"_"+n;r+='<td class="cifra"><input type="tel" id="'+d+'" class="keyboardInput numeric" '+(o?'tabindex="'+l:"")+'" size="1" maxlength="1" value="'+'" onkeypress="return keyPress(event, id, '+o+');"/></td>'}tabindex+=a;return r}function pintaOperacion(prefijo,id,oper1,operacion,oper2){var ret='<table class="marco" align="center"><tr><td></td><td width="40" rowspan="2"></td></tr><tr><td><table>';eval("var sol = "+prefijo+"_sol["+id+"]");var parciales=new Array;for(var i=0;i<sol.length;i++)parciales[i]=decode64(sol[i]);var offsets=new Array;var operacionLabel=operacion;if(operacion=="*"){operacionLabel="x"}if(operacion=="/"){ret+='<tr valign="top"><td><table>';ret+='<tr style="height:1px;"><td></td></tr>';ret+='<tr valign="top" style="height:24px;">'+pintaNumero(oper1,maxcifras)+"</tr>";var cociente=parciales[parciales.length-1];var k=0;var cocientecifras=calculaNumCifras(cociente);var offset=0;for(var k=0;k<parciales.length-1;k++){offset+=1+(calculaCerosIzquierda(k==0?oper1:parciales[k-1])-1);ret+="<tr>"+pintaNumeroInput(prefijo,id+"_"+k,parciales[k],offset+parciales[k].length,true)+"</tr>"}ret+='</table></td><td><table><tr style="valign:top;height:22px;"><td style="border-bottom:1px solid black;border-left:1px solid black;"><table><tr>'+pintaNumero(oper2)+"</tr></table></td></tr>";ret+='<tr><td><table><tr valign="top">'+pintaNumeroInput(prefijo,id+"_"+(parciales.length-1),cociente,0,true)+"</tr></table></td></tr></table></td></tr>"}else{var maxcifras=parciales[parciales.length-1].length;ret+="<tr>"+pintaEspacio()+pintaNumero(oper1,maxcifras)+"</tr>";ret+='<tr><td class="cifra">'+operacionLabel+"</td>"+pintaNumero(oper2,maxcifras)+"</tr>";ret+='<tr><td colspan="'+(maxcifras+1)+'"><hr style="margin:0px;width:100%"/>';if(operacion=="+"||operacion=="-"){ret+="<tr>"+pintaEspacio()+pintaNumeroInput(prefijo,id+"_"+0,parciales[0],0,true)+"</tr>"}else if(operacion=="*"){var pos=0;var k=0;var oper2cifras=calculaNumCifras(oper2);if(parciales.length>1){while(pos<oper2cifras){if((""+oper2)[oper2cifras-1-pos]!="0"){ret+="<tr>"+pintaNumeroInput(prefijo,id+"_"+k,parciales[k],maxcifras+1-(k!=0?pos:0),true)+"</tr>";k++}pos++}ret+='<tr><td colspan="'+(maxcifras+1)+'"><hr style="margin:0px;width:100%"/>'}ret+="<tr>"+pintaNumeroInput(prefijo,id+"_"+(parciales.length-1),parciales[parciales.length-1],maxcifras+1,true)+"</tr>"}}ret+="</table></td></tr></table>";document.getElementById(prefijo+"_ej_"+id).innerHTML=ret}function registerNumericFields(e){blink.theme.registerNumericFields(e)}function validaOperacion(e,t){var i=parseInt($("[name='"+e+"_operando1_"+t+"']").val(),10);var s=$("[name='"+e+"_operacion_"+t+"']").val();var o=parseInt($("[name='"+e+"_operando2_"+t+"']").val(),10);if(o>i){if(s=="-")return"edit_slide_74";else if(s=="/")return"edit_slide_75"}if(s=="/"&&o==0)return"edit_slide_100";return"ok"}$(function(){$(document).on("click",".slide-mathcalculations .js-add-option",function(e){var t=$(this).closest(".slide-mathcalculations").data("prefix");Slide_mathcalculations.prototype.addOption(t)})});function Slide_memory(){}Slide_memory.prototype=new Slide;Slide_memory.prototype.esEjercicio=true;Slide_memory.prototype.esJuegoAutoevaluable=true;Slide_memory.prototype.esAutocorregible=false;Slide_memory.prototype.examplesShown=false;Slide_memory.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_memory.prototype.maxHeight=0;Slide_memory.prototype.preventShuffling=false;Slide_memory.prototype.onShow=function(){Slide.prototype.onShow.call(this)};Slide_memory.prototype.onAfterShowSlide=function(){Slide.prototype.onAfterShowSlide.call(this)};Slide_memory.prototype.update=function(e,t){this.showExamples();this.clasificacion=0;var i=!!this.useExamples?2:0;for(var s=0;s<this.numElementos;s++){if(this.respuestas[s]!=null&&this.respuestas[s]!=undefined&&this.respuestas[s]!="-"){this.resultados[s]=this.checkVisual2Real(s,this.respuestas[s]);if(this.resultados[s]){if(!this.respuestas[this.orden.indexOf(this.respuestas[s])]){this.respuestas[this.orden.indexOf(this.respuestas[s])]=this.orden[s]}if(s>=i){this.preventShuffling=true}this.clasificacion++;$("#"+this.prefijo+"_o_"+this.orden[s]).closest(".flipper").removeClass("on checking").addClass("still")}else{$("#"+this.prefijo+"_o_"+this.orden[s]+", #"+this.prefijo+"_o_"+this.respuestas[s]).closest(".flipper").addClass("ko");this.removeMatch(s);this.resultados[s]=null}}else{this.resultados[s]=null}}var o=this.numElementos;this.useExamples&&(o-=2);o>0&&(this.clasificacion/=o);if(this.clasificacion===1){Slide.prototype.correct.call(this,e,t)}if(modoClase==3||modoClase==4||this.numMaxIntentos===this.intentos){$("#"+this.prefijo+"pg .flipper").not(".still").removeClass("off").addClass("on ko checking corregido");$("#"+this.prefijo+"pg .flipper").addClass("still disable_card")}Slide.prototype.update.call(this,e)};Slide_memory.prototype.evalNumElements=function(){this.numElementos=$("div[id^='"+this.prefijo+"_o']").size();this.numElementosEvaluables=this.numElementos/2};Slide_memory.prototype.loadSuspendData=function(e){this.evalNumElements();if(this.respuestasAleatorias==0){this.preventShuffling=true}this.getCurrentOrder(e);if(e===undefined){return}this.firstElementIndex=this.useExamples?1:0;for(var t=this.firstElementIndex;t<this.numElementos;t++){if(e.respuestas[t]!=null){e.respuestas[t]=this.resp[t]}}Slide.prototype.loadSuspendData.call(this,e)};Slide_memory.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);var t=new Array;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(e.respuestas[i]!=null&&e.respuestas[i]!="-"){t[i]=this.resp[i]}}e.respuestas=t;return e};Slide_memory.prototype.getCurrentOrder=function(e){if(this.respuestasAleatorias==1){$("#"+this.prefijo+"pg .flip-container").shuffle()}this.orden=[];this.resp=[];for(var t=0;t<this.numElementos;t++){for(var i=0;i<this.numElementos;i++){if(sha1(i)==window[this.prefijo+"_ord"][t]){this.orden[t]=i}}}for(var t=0;t<this.numElementos;t++){for(var i=0;i<this.numElementos;i++){if(sha1(i)==window[this.prefijo+"_resp"][t]){this.resp[t]=i}}}};Slide_memory.prototype.correct=function(e,t){Slide.prototype.correct.call(this,e,t);$("#"+this.prefijo+"pg .flipper").not(".still").removeClass("off").addClass("on checking ko corregido");$("#"+this.prefijo+"pg .flipper").addClass("disable_card");this.onShow()};Slide_memory.prototype.showSolution=function(){this.firstElementIndex=this.useExamples?1:0;if(checkMostrarSoluciones()){Slide.prototype.showSolution.call(this)}};Slide_memory.prototype.showNextSolution=function(e){for(var e=0;e<this.numElementos;e++){if(!$("#"+this.prefijo+"_o_"+this.orden[e]).closest(".flipper").hasClass("still")){this.showElemSolution(e);this.showElemSolution(this.orden.indexOf(this.resp[e]));this.idsol++;if(this.idsol==this.numElementos/2){this.solutionShown=true;this.refreshSolutionButton(true);this.setReviewButtons()}return}}};Slide_memory.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;$("#"+this.prefijo+"_o_"+this.orden[e]).closest(".flipper").addClass("still on checking ko corregido "+t)};Slide_memory.prototype.hideSolution=function(e){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("#"+this.prefijo+"pg .flipper").removeClass("solucion");this.update(false,false)}};Slide_memory.prototype.checkVisual2Real=function(e,t){return this.resp[e]==t};Slide_memory.prototype.esRespuesta=function(e){return e!==null&&e!==undefined&&e!==""&&e!=="-"};Slide_memory.prototype.clearSlide=function(){this.isDisabled=false;var e="disabled on still ko checking solucion disable_card",t=this.prefijo;this.clearSlideComunIni();this.preventShuffling=!this.respuestasAleatorias;this.getCurrentOrder();$("[id^="+t+"_o_]").closest(".flipper").removeClass(e);this.clearSlideComunFin();this.examplesShown=false;this.showExamples()};Slide_memory.prototype.getIdSlide=function(){return this.prefijo.replace(/^\D+/g,"")};Slide_memory.prototype.addOption=function(e){var t=$("#"+e+"pg"),i=19,s=t.find(".js-exercise").length,o=t.find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),a=o.find(".js-query"),r=o.find(".js-answer"),n=a.siblings(".js-richeditor-input"),l=r.siblings(".js-richeditor-input");o.attr("name",e+"_exer_"+s);if(!!n.length){n.attr({placeholder:n.attr("placeholder")+" "+s});a.attr({name:a.attr("name")+(s-1),id:a.attr("name")+(s-1)});l.attr({placeholder:l.attr("placeholder")+" "+s});r.attr({name:r.attr("name")+(s-1),id:r.attr("name")+(s-1)})}else{a.attr({name:a.attr("name")+(s-1),placeholder:a.attr("placeholder")+" "+s});r.attr({name:r.attr("name")+(s-1),placeholder:r.attr("placeholder")+" "+s})}t.find(".js-form-questions").append(o);if(s==i){t.find(".js-add-option").addClass("disabled")}};Slide_memory.prototype.flipOption=function(e,t){var i=$("#"+t+"pg .flipper.checking").length,s=true,o=$(e),a=parseInt(o.find(".opcion").first().attr("data-id"));oldOrigin=this.origin;if(o.hasClass("still")||o.hasClass("disable_card")||(modoClase==3||modoClase==4)){return}!!this.flipTimeout&&clearTimeout(this.flipTimeout);if(i==0){o.removeClass("off").addClass("on checking")}else if(i==1){this.flipTimeout=setTimeout(function(){$(".flipper.ko").not(".corregido").removeClass("ko on checking").addClass("off")},parseInt(this.timeToFlip)*1e3);if(o.hasClass("checking")){return o.removeClass("on checking").addClass("off")}else{o.removeClass("off").addClass("on checking");s=false}}else{$("#"+t+"pg .flipper.checking").not(o).removeClass("on checking ko").addClass("off");this.removeMatch(oldOrigin);if(!o.hasClass("on checking")){o.removeClass("off").addClass("on checking")}else{return o.removeClass("on checking ko").addClass("off")}}this.markCouple(a,s,t);this.update(true,true)};Slide_memory.prototype.markCouple=function(e,t,i){if(t){this.origin=e}else{this.idsol++;this.respuestas[this.orden.indexOf(this.origin)]=e;this.update(false,false)}};Slide_memory.prototype.removeMatch=function(e){this.respuestas[e]=null};Slide_memory.prototype.showExamples=function(){if(this.useExamples&&!this.examplesShown){this.showElemSolution(0);this.showElemSolution(this.orden.indexOf(this.resp[0]));this.examplesShown=true}};Slide_memory.prototype.allowInfinityAttempts=function(){return false};$(function(){$(document).on("click",".slide-memory .js-add-option",function(e){var t=$(this),i=t.closest(".slide-memory").data("prefix"),s=t.hasClass("disabled");!s&&Slide_memory.prototype.addOption(i)}).ready(function(){$(".flipper").click(function(){var e=$(this),t=e.closest(".js-slide-wrapper"),i="t"+t.data("slide-index"),s=window[i+"_slide"];s.flipOption(e,i)})})});function Slide_multiplechoice(){}Slide_multiplechoice.prototype=new Slide;Slide_multiplechoice.prototype.esEjercicio=true;Slide_multiplechoice.prototype.onShow=function(){if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_multiplechoice.prototype.update=function(manual,corregir){if(corregir)this.clasificacion=0;if(corregir){var numOpcionesMarcadas=0;for(var i=0;i<this.respuestas.length;i++){if(this.respuestas[i]==1)numOpcionesMarcadas++}if(numOpcionesMarcadas==this.numElementos||this.useExamples&&numOpcionesMarcadas==this.numElementos-1){this.intentos=this.numMaxIntentos}}var nresp=0;var nerrores=0;for(var i=0;i<this.numElementos;i++){if(this.respuestas[i]==1){nresp++;var opcionId=this.prefijo+"v"+i;$("#"+opcionId).addClass("respuesta_checked");if(corregir){eval("var resp = Resp"+this.prefijo+"["+i+"]");this.resultados[i]=resp==sha1(this.respuestas[i])}if(this.resultados[i]){if(corregir)this.clasificacion++;$("#"+opcionId).addClass("disabled")}else{nerrores++;if(corregir)this.clasificacion--}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){$("#"+opcionId).removeClass("respuesta_checked respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[i]?"ok":"ko"));if(this.useFeedback()){$(".multiplechoice_horizontal").find($("#"+this.prefijo+"_lista")).addClass("move-text")}$("[id^='"+this.prefijo+"feedback"+i+"']").removeClass("fb_right fb_wrong").addClass("fb_"+(this.resultados[i]?"right":"wrong"));var fbright=window["FbRight"+this.prefijo][i],fbwrong=window["FbWrong"+this.prefijo][i];$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.right-fb-dropdown").find(".bck-dropdown-content").html(fbright);$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.wrong-fb-dropdown").find(".bck-dropdown-content").html(fbwrong);if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_right")){$("[id^='"+this.prefijo+"wrongfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"rightfb"+i+"']").removeClass("hidden")}if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_wrong")){$("[id^='"+this.prefijo+"rightfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb"+i+"']").removeClass("hidden")}}}}if(corregir){var numt=this.numElementosEvaluables;if(this.useExamples)numt--;if(numt>0)this.clasificacion=this.clasificacion/numt;if(this.clasificacion<0)this.clasificacion=0}if(checkMostrarSoluciones()&&this.intentos>0&&nresp<this.numElementosEvaluables&&nerrores==0){$("#"+this.prefijo+"_panel").addClass("ejercicio_ko")}else{$("#"+this.prefijo+"_panel").removeClass("ejercicio_ko")}$("[id^='"+this.prefijo+"feedback']").length&&createAudioButtons();Slide.prototype.update.call(this,manual,corregir)};Slide_multiplechoice.prototype.evalNumElements=function(){this.numElementos=0;while(document.getElementById(this.prefijo+"v"+this.numElementos)){this.numElementos++}this.numElementosEvaluables=0;for(var e=0;e<this.numElementos;e++){var t=window["Resp"+this.prefijo][e]===sha1(1);if(t)this.numElementosEvaluables++}};Slide_multiplechoice.prototype.loadSuspendData=function(e){this.evalNumElements();if($.fn.corner){$("[id^="+this.prefijo+"caja]").each(function(){$(this).corner("round 8px").parent().css("padding","3px").corner("round 10px")})}Slide.prototype.loadSuspendData.call(this,e)};Slide_multiplechoice.prototype.showSolution=function(){Slide.prototype.showSolution.call(this);if(checkMostrarSoluciones()){$("[id^="+this.prefijo+"v]").removeClass("respuesta_checked respuesta_ok respuesta_ko");for(var e=0;e<this.numElementos;e++){if(this.useExamples&&this.exampleIndex==e)continue;this.showElemSolution(e)}}};Slide_multiplechoice.prototype.showNextSolution=function(){var e=-1;var t=true;for(var i=0;i<this.numElementos;i++){if(this.useExamples&&this.exampleIndex==i)continue;var s=$("[id*="+this.prefijo+"v"+i+"]."+this.solutionStyleClass);if(e==-1){if(this.isSolution(i)){if(s.length==0){e=i;this.solutionPartialShown=true;this.showElemSolution(e)}}}else{if(s.length==0){t=false;break}}}if(t){switchSolution(this.prefijo);this.setReviewButtons()}};Slide_multiplechoice.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass;$("[id^="+this.prefijo+"v]").removeClass("respuesta_checked respuesta_ok respuesta_ko");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");if(this.useFeedback()){$(".multiplechoice_horizontal").find($("#"+this.prefijo+"_lista")).addClass("move-text")}if(this.isSolution(e)){$("#"+this.prefijo+"v"+e).addClass(t).addClass("disabled");$("[id^='"+this.prefijo+"feedback"+e+"']").addClass("fb_solucion");$("[id^='"+this.prefijo+"rightfb"+e+"']").removeClass("hidden")}};Slide_multiplechoice.prototype.hideSolution=function(){if(checkMostrarSoluciones()){for(var e=0;e<this.numElementos;e++){if(this.useExamples&&this.exampleIndex==e)continue;if(this.isSolution(e)){$("#"+this.prefijo+"v"+e).removeClass(this.solutionStyleClass);$("[id^='"+this.prefijo+"feedback"+e+"']").removeClass("fb_solucion");$("[id^='"+this.prefijo+"rightfb"+e+"']").addClass("hidden");if(this.useFeedback()){$(".multiplechoice_horizontal").find($("#"+this.prefijo+"_lista")).removeClass("move-text")}}}this.update(false,false)}};Slide_multiplechoice.prototype.isSolution=function(i){eval("var esSol = decode64(Sol"+this.prefijo+'[i]) == "1";');return esSol};Slide_multiplechoice.prototype.showExample=function(){for(var e=0;e<this.numElementos;e++){if(this.isSolution(e)){this.exampleIndex=e;this.showElemSolution(e);break}}};Slide_multiplechoice.prototype.marcarOpcion=function(opcion){var opcionId=this.prefijo+"v"+opcion;eval("var permitirMultiple = "+this.prefijo+"permitirMultiple");if(!$("#"+opcionId).hasClass("disabled")){if(this.respuestas[opcion]==1){$("#"+opcionId).removeClass("respuesta_checked respuesta_ko");this.respuestas[opcion]=null}else{$("#"+opcionId).removeClass("respuesta_over").addClass("respuesta_checked");$("[id^='"+this.prefijo+"rightfb']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");this.respuestas[opcion]=1}if(this.numElementosEvaluables==1&&permitirMultiple!=1){for(var i=0;i<this.numElementos;i++){if(i!=opcion&&this.respuestas[i]==1){$("#"+this.prefijo+"v"+i).removeClass("respuesta_checked respuesta_ko");this.respuestas[i]=null}}}this.setReviewButtons()}return false};Slide_multiplechoice.prototype.setDisabled=function(e){$("[id^="+(e!=null?e:this.prefijo)+"v]").each(function(){$(this).addClass("disabled")})};Slide_multiplechoice.prototype.tieneRespuestas=function(e){if(this.respuestas){for(var t=0;t<this.respuestas.length;t++){if(this.respuestas[t]==1){return true}}}return this.intentos>0};Slide_multiplechoice.prototype.clearSlide=function(){this.clearSlideComunIni();for(var e=0;e<this.numElementos;e++){var t=this.prefijo+"v"+e;$("#"+t).removeClass("respuesta_checked");$("#"+t).removeClass("disabled");$("#"+t).removeClass("respuesta_ko");$("#"+t).removeClass("respuesta_ok");$("[id^='"+this.prefijo+"rightfb']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[id^='"+this.prefijo+"feedback']").removeClass("fb_right fb_wrong");if(this.useFeedback()){$(".multiplechoice_horizontal").find($("#"+this.prefijo+"_lista")).removeClass("move-text")}}this.clearSlideComunFin()};function caja_ejercicio_over(e){if(!$("#"+e).hasClass("disabled")&&!$("#"+e).hasClass("respuesta_checked")){$("#"+e).addClass("respuesta_over")}}function caja_ejercicio_out(e){if(!$("#"+e).hasClass("disabled")){$("#"+e).removeClass("respuesta_over")}}Slide_multiplechoice.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".question"),o=i.find(".fbright"),a=i.find(".fbwrong"),r=i.find(".js-answer"),n=s.siblings('input[inputtype="question-input"]'),l=o.siblings('input[inputtype="fbright-input"]'),d=a.siblings('input[inputtype="fbwrong-input"]'),u=i.find(".base_feedback");i.attr("name",e+"_exer_"+t);if(n.length>0){n.attr({placeholder:n.attr("placeholder")+" "+t});l.attr({placeholder:textweb("feedback_good_job")});d.attr({placeholder:textweb("feedback_try_again")});s.attr({name:s.attr("name")+t,id:s.attr("name")+t});o.attr({name:o.attr("name")+t,id:o.attr("name")+t});a.attr({name:a.attr("name")+t,id:a.attr("name")+t});u.attr({id:u.attr("id")+t});if($("#"+e+"_addFeedback").prop("checked")==true){u.removeClass("hidden")}else{u.addClass("hidden")}}else{s.attr({name:s.attr("name")+t,placeholder:s.attr("placeholder")+" "+t})}r.attr({id:r.attr("name")+t,name:r.attr("name")+t});r.siblings("label").attr("for",r.attr("name"));$("#"+e+"pg").find(".js-form-questions").append(i)};$(document).ready(function(){$(".ejercicio.multiple-choice").on("mouseover",".js-item",function(e){var t=$(this);if(!t.hasClass("disabled")&&!t.hasClass("respuesta_checked")){t.addClass("respuesta_over")}}).on("mouseout",".js-item",function(e){var t=$(this);if(!t.hasClass("disabled")){t.removeClass("respuesta_over")}}).on("click",".js-item",function(event){var target=event&&event.target;if(target&&($(target).hasClass("sound-player")||$(target).hasClass("video-player"))||$(target).parents(".video-js").length){return true}if($(event.target).is("a:not('.player'):not('.js-zoom-flag')")){blink.rest.openUrl("viewer",event.target.href);return false}var $this=$(this),prefix=$this.data("prefix"),index=$this.data("index"),slide=eval("window."+prefix+"_slide");slide.marcarOpcion(index)});$(document).on("click",".slide-multiplechoice .js-add-option",function(e){var t=$(this).closest(".slide-multiplechoice").data("prefix");Slide_multiplechoice.prototype.addOption(t)})});function Slide_paint_2020(){this.CANVAS_PROPORTION=.7;this.CANVAS_WIDTH=708;this.IMG_ORIGINALWIDTH=false;this.IMG_ORIGINALHEIGHT=false;this.IMG_POSITION_BACKGROUND=1;this.IMG_POSITION_FOREGROUND=2}Slide_paint_2020.prototype=new Slide;Slide_paint_2020.prototype.esAutocorregible=false;Slide_paint_2020.prototype.esEjercicio=true;Slide_paint_2020.prototype.onShow=function(){var e=$("#"+this.prefijo+"containerImage");var t=$("#"+this.prefijo+"_canvas"),i=$("#"+this.prefijo+"imagenCanvas");var s=t.width()<=this.CANVAS_WIDTH?t.width():this.CANVAS_WIDTH,o=s/this.CANVAS_WIDTH,a=Math.round(s*this.CANVAS_PROPORTION)||0,r=this.IMG_ORIGINALWIDTH||i.width()||0,n=this.IMG_ORIGINALHEIGHT||i.height()||0;this.IMG_ORIGINALWIDTH=this.IMG_ORIGINALWIDTH||r;this.IMG_ORIGINALHEIGHT=this.IMG_ORIGINALHEIGHT||n;var l=this.CANVAS_WIDTH>r&&a>n,d=r>=n,u=n>r;if(!!e.length&&!!i.length){if(l&&o<=1){var c=r*o;i.width(c)}else{d&&i.width(s);u&&i.height(a)}e.height(a);e.width(s);e.css({display:" flex","justify-content":" center","align-items":" center"});i.css({position:"unset","text-align":"center",transform:"none"})}!!t.length&&t.height(a);if(!this.projectPaint){this.projectPaint=new paper.PaperScope;this.workerPaint=new this.projectPaint.Project(this.prefijo+"_canvas")}var p=this.projectPaint,h=p.project,f=h.view;h.activate();var m=this.workerPaint.view.getViewSize().width;f.setViewSize(s,a);f.zoom=f.zoom*s/m;f.setCenter(p.view.getViewSize().width/(f.zoom*2),p.view.getViewSize().height/(f.zoom*2));if(!!i.length){i.css({"z-index":window[this.prefijo+"_slide"].imgPosition})}p.settings.handleSize=0;if(!this.toolPaint){this.toolPaint=new p.Tool;this.toolPaint.onMouseDown=this.onMouseDown.bind(this);this.toolPaint.onMouseDrag=this.onMouseDrag.bind(this);this.toolPaint.onMouseUp=this.onMouseUp.bind(this);this.toolPaint.minDistance=10;this.toolPaint.maxDistance=30;this.toolPaint.activate()}this.setToolsView();if(this.drawingPaint&&this.drawingPaint.length>2){h.importJSON(this.drawingPaint);f.draw();this.drawingPaint="[]"}Slide.prototype.onShow.call(this)};Slide_paint_2020.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_paint_2020.prototype.evalNumElements=function(){this.numElementos=1};Slide_paint_2020.prototype.loadSuspendData=function(e){if(e===undefined){return}Slide.prototype.loadSuspendData.call(this,e);this.drawingPaint=e.respuestas};Slide_paint_2020.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);this.workerPaint&&this.workerPaint.activate();this.workerPaint&&(e.respuestas=this.workerPaint.exportJSON());return e};Slide_paint_2020.prototype.correct=function(e,t){Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_paint_2020.prototype.clearSlideCustomIni=function(){this.projectPaint.project.clear();this.projectPaint.project.view.draw();this.setToolsView();this.path=undefined};Slide_paint_2020.prototype.tieneRespuestas=function(){return!!this.respuestas&&this.respuestas.length&&this.respuestas!=="[]"};Slide_paint_2020.prototype.shouldDisabledDrawTools=function(){return true};Slide_paint_2020.prototype.shouldDisabledHighlighter=function(e){if(typeof e==="undefined"){e=true}return e};Slide_paint_2020.prototype.getImgCanvasZoom=function(e){var t=1,i=e.width,s=e.height,o=$("#"+this.prefijo+"imagenCanvas"),a=o.length&&o.width(),r=o.length&&o.height();if(i<a){t=i/a}if(s<r){var n=s/r;t=n<t?n:t}return t};Slide_paint_2020.prototype.getFloatingSliderMarkup=function(e){return""+'<div id="'+e+'-tool-slider" class="slider-container">'+"<input "+'class="thickness-slider"'+'type="text"'+'data-slider-min="1"'+'data-slider-max="30"'+'data-slider-step="1"'+'data-slider-value="10"'+'data-slider-orientation="vertical"'+'data-slider-tooltip="hide"/>'+"</div>"};Slide_paint_2020.prototype.appendFloatingSlider=function(e){var t=$("#"+e+"_paint_popoverColors").find(".thickness");if(t.hasClass("floating")){var i=this.getFloatingSliderMarkup(e);t.append(i);t.find(".thickness-slider").bootstrapSlider().on("slide change",function(e){var t=$(e.target),i=parseInt(t.val()),s=Math.max(i-5,1),o=i+5;this.toolPaint.setMinDistance(s);this.toolPaint.setMaxDistance(o);t.closest(".tool.thickness").find(".thickness-value").text(i)}.bind(this))}};Slide_paint_2020.prototype.setToolsView=function(){$("#"+this.prefijo+"_tools").find(".tool").each(function(e,t){$(t).toggleClass("disabled",this.isDone())}.bind(this))};Slide_paint_2020.prototype.onMouseDown=function(e){var t=$("#"+this.prefijo+"_paint_popoverColors"),i=t.find(".opacity-value").text()/100,s=t.find(".thickness-value").text(),o=t.find(".color.active").data("color"),a=blink.tools.manager.colors,r=a[o]?a[o].hex:"#000",n={segments:[e.point],strokeColor:r,opacity:i||1};if(this.isDone()){return false}this.brushMode=!!t.find(".brush.active").length;this.eraseMode=!!t.find(".erase.active").length;if(this.brushMode){n.fillColor=r;n.opacity=.7;this.path=new this.projectPaint.Path(n)}else{n.fullySelected=false;n.strokeWidth=s||10;n.strokeJoin="round";this.path=new this.projectPaint.Path(n);if(this.eraseMode){this.path.blendMode="destination-out";this.path.opacity=1}}};Slide_paint_2020.prototype.onMouseDrag=function(e){if(this.isDone()){return false}if(!this.brushMode){return this.path.add(e.point)}if(e.count==0){this.addStrokes(e.middlePoint,e.delta)}else{var t=e.delta.divide(2);t.angle+=90;var i=e.middlePoint.add(t);bottom=e.middlePoint.subtract(t);this.path.add(i);this.path.insert(0,bottom)}this.path.smooth();this.lastPoint=e.middlePoint};Slide_paint_2020.prototype.onMouseUp=function(e){if(this.isDone()){return false}if(this.brushMode){var t=10,i=e.point.subtract(this.lastPoint);i.length=t;this.addStrokes(e.point,i);this.path.closed=true;this.path.smooth()}else{var s=this.path.segments.length;this.path.simplify(10);this.path.fullySelected=false}this.respuestas=this.path;this.setReviewButtons()};Slide_paint_2020.prototype.addStrokes=function(e,t){var i=3,s=t.rotate(90);strokePoints=i*2+1;e=e.subtract(s.divide(2));s=s.divide(strokePoints-1);for(var o=0;o<strokePoints;o++){var a=e.add(s.multiply(o));offset=t.multiply(Math.random()*.3+.1);if(o%2){offset=offset.multiply(-1)}a=a.add(offset);this.path.insert(0,a)}};Slide_paint_2020.prototype.activatePencilCanvas=function(){return false};function Slide_paint(){this.CANVAS_PROPORTION=.8;this.IMG_POSITION_BACKGROUND=1;this.IMG_POSITION_FOREGROUND=2}Slide_paint.prototype=new Slide;Slide_paint.prototype.esAutocorregible=false;Slide_paint.prototype.esEjercicio=true;Slide_paint.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_paint.prototype.onShow=function(){var e=$("#"+this.prefijo+"_canvas"),t=$("#"+this.prefijo+"_canvasImg");if(!this.projectPaint){this.projectPaint=new paper.PaperScope;this.workerPaint=new this.projectPaint.Project(this.prefijo+"_canvas")}var i=this.projectPaint,s=i.project,o=s.view;s.activate();var a=e.length&&e.width(),r=this.workerPaint.view.getViewSize().width;o.setViewSize(a,a*this.CANVAS_PROPORTION);o.zoom=o.zoom*a/r;o.setCenter(i.view.getViewSize().width/(o.zoom*2),i.view.getViewSize().height/(o.zoom*2));if(t.length!=0){t.css({"max-height":e.height(),"max-width":e.width()})}i.settings.handleSize=0;if(!this.toolPaint){this.toolPaint=new i.Tool;this.toolPaint.onMouseDown=this.onMouseDown.bind(this);this.toolPaint.onMouseDrag=this.onMouseDrag.bind(this);this.toolPaint.onMouseUp=this.onMouseUp.bind(this);this.toolPaint.minDistance=10;this.toolPaint.maxDistance=30;this.toolPaint.activate()}this.setToolsView();if(this.drawingPaint&&this.drawingPaint.length>2){s.importJSON(this.drawingPaint);o.draw();this.drawingPaint="[]"}this.imgPosition&&!this.imgLoaded&&this.createImgCanvas();Slide.prototype.onShow.call(this)};Slide_paint.prototype.evalNumElements=function(){this.numElementos=1};Slide_paint.prototype.loadSuspendData=function(e){if(e===undefined){return}Slide.prototype.loadSuspendData.call(this,e);this.drawingPaint=e.respuestas};Slide_paint.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);this.workerPaint&&this.workerPaint.activate();this.workerPaint&&(e.respuestas=this.workerPaint.exportJSON());return e};Slide_paint.prototype.correct=function(e,t){Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_paint.prototype.clearSlideCustomIni=function(){this.projectPaint.project.clear();this.projectPaint.project.view.draw();this.setToolsView();this.path=undefined};Slide_paint.prototype.tieneRespuestas=function(){return!!this.respuestas&&this.respuestas.length&&this.respuestas!=="[]"};Slide_paint.prototype.shouldDisabledDrawTools=function(){return true};Slide_paint.prototype.shouldDisabledHighlighter=function(e){if(typeof e==="undefined"){e=true}return e};Slide_paint.prototype.createImgCanvas=function(){var e=$("#"+this.prefijo+"_canvas"),t=$("#"+this.prefijo+"_canvasImg"),i=$("#"+this.prefijo+"_canvas").parents("#actividad"),s=e.parents(".workspace.paint");if(!i.length){return false}else{e.width(s.width()-s.width()*.2)}if(this.imgPosition===this.IMG_POSITION_BACKGROUND){e.addClass("background");t.removeClass("background")}t.showBlink();this.canvasImagen=new paper.PaperScope;this.imageWorker=new this.canvasImagen.Project(this.prefijo+"_canvasImg");var o=e.width(),a=e.height(),r=this.getImgCanvasZoom({width:o,height:a});if(o<=0||a<=0){return false}this.canvasImagen.project.view.setViewSize(o,a);this.canvasImagen.project.view.zoom=r;this.canvasImagen.project.view.setCenter(this.canvasImagen.view.getViewSize().width/(this.canvasImagen.project.view.zoom*2),this.canvasImagen.view.getViewSize().height/(this.canvasImagen.project.view.zoom*2));this.raster=new this.canvasImagen.Raster(this.prefijo+"imagenCanvas",this.imageWorker.view.center);this.imgLoaded=true;t.css({"max-height":a,"max-width":o})};Slide_paint.prototype.getImgCanvasZoom=function(e){var t=1,i=e.width,s=e.height,o=$("#"+this.prefijo+"imagenCanvas"),a=o.length&&o.width(),r=o.length&&o.height();if(i<a){t=i/a}if(s<r){var n=s/r;t=n<t?n:t}return t};Slide_paint.prototype.getFloatingSliderMarkup=function(e){return""+'<div id="'+e+'-tool-slider" class="slider-container">'+"<input "+'class="thickness-slider"'+'type="text"'+'data-slider-min="1"'+'data-slider-max="30"'+'data-slider-step="1"'+'data-slider-value="10"'+'data-slider-orientation="vertical"'+'data-slider-tooltip="hide"/>'+"</div>"};Slide_paint.prototype.appendFloatingSlider=function(e){var t=$("#"+e+"_paint_popoverColors").find(".thickness");if(t.hasClass("floating")){var i=this.getFloatingSliderMarkup(e);t.append(i);t.find(".thickness-slider").bootstrapSlider().on("slide change",function(e){var t=$(e.target),i=parseInt(t.val()),s=Math.max(i-5,1),o=i+5;this.toolPaint.setMinDistance(s);this.toolPaint.setMaxDistance(o);t.closest(".tool.thickness").find(".thickness-value").text(i)}.bind(this))}};Slide_paint.prototype.setToolsView=function(){$("#"+this.prefijo+"_tools").find(".tool").each(function(e,t){$(t).toggleClass("disabled",this.isDone())}.bind(this))};Slide_paint.prototype.onMouseDown=function(e){var t=$("#"+this.prefijo+"_paint_popoverColors"),i=t.find(".opacity-value").text()/100,s=t.find(".thickness-value").text(),o=t.find(".color.active").data("color"),a=blink.tools.manager.colors,r=a[o]?a[o].hex:"#000",n={segments:[e.point],strokeColor:r,opacity:i||1};if(this.isDone()){return false}this.brushMode=!!t.find(".brush.active").length;this.eraseMode=!!t.find(".erase.active").length;if(this.brushMode){n.fillColor=r;n.opacity=.7;this.path=new this.projectPaint.Path(n)}else{n.fullySelected=false;n.strokeWidth=s||10;n.strokeJoin="round";this.path=new this.projectPaint.Path(n);if(this.eraseMode){this.path.blendMode="destination-out";this.path.opacity=1}}};Slide_paint.prototype.onMouseDrag=function(e){if(this.isDone()){return false}if(!this.brushMode){return this.path.add(e.point)}if(e.count==0){this.addStrokes(e.middlePoint,e.delta)}else{var t=e.delta.divide(2);t.angle+=90;var i=e.middlePoint.add(t);bottom=e.middlePoint.subtract(t);this.path.add(i);this.path.insert(0,bottom)}this.path.smooth();this.lastPoint=e.middlePoint};Slide_paint.prototype.onMouseUp=function(e){if(this.isDone()){return false}if(this.brushMode){var t=10,i=e.point.subtract(this.lastPoint);i.length=t;this.addStrokes(e.point,i);this.path.closed=true;this.path.smooth()}else{var s=this.path.segments.length;this.path.simplify(10);this.path.fullySelected=false}this.respuestas=this.path;this.setReviewButtons()};Slide_paint.prototype.addStrokes=function(e,t){var i=3,s=t.rotate(90);strokePoints=i*2+1;e=e.subtract(s.divide(2));s=s.divide(strokePoints-1);for(var o=0;o<strokePoints;o++){var a=e.add(s.multiply(o));offset=t.multiply(Math.random()*.3+.1);if(o%2){offset=offset.multiply(-1)}a=a.add(offset);this.path.insert(0,a)}};Slide_paint.prototype.activatePencilCanvas=function(){return false};function Slide_rank(){}Slide_rank.prototype=new Slide;Slide_rank.prototype.esEjercicio=true;Slide_rank.prototype.onShow=function(){Slide.prototype.onShow.call(this);this.redondear()};Slide_rank.prototype.update=function(e,t){if(typeof this.useExamples!="undefined"){this.firstElementIndex=this.useExamples?1:0}var i=checkMostrarSoluciones()&&this.intentos,s=this.numElementos,o="ejercicio_ok ejercicio_ko",a=$("#"+this.prefijo+"_panel");if(this.showLastItemAsExample()){s--}if(t){this.clasificacion=0}for(var r=this.firstElementIndex;r<s;r++){var n=this.useExamples&&this.exampleIndex&&this.exampleIndex.indexOf(r)!=-1;if(!n&&this.respuestas[r]!=null&&this.respuestas[r]!=undefined){var l=r==this.respuestas[r],d="ejercicio_"+(l?"ok":"ko");if(t){this.resultados[r]=l;l&&this.clasificacion++}if(i){if(this.corregirPorPosicion){a.find(".js-rank-item").eq(r).removeClass(o).addClass(d)}else{a.removeClass(o).addClass(d)}}}}if(t&&s){if(this.corregirPorPosicion){if(this.useExamples)s--;if(s>0)this.clasificacion=this.clasificacion/s}else{if(this.useExamples)s--;this.clasificacion=s==this.clasificacion?1:0}}if(!this.corregirPorPosicion){if(checkMostrarSoluciones()&&(this.intentos>0||this.intentos==this.numMaxIntentos)){a.removeClass(o).addClass("ejercicio_"+(this.clasificacion==1?"ok":"ko"))}}Slide.prototype.update.call(this,e)};Slide_rank.prototype.evalNumElements=function(){eval("this.numElementos = "+this.prefijo+"_preguntas.length");this.numElementosEvaluables=this.numElementos};Slide_rank.prototype.loadSuspendData=function(e){this.evalNumElements();Slide.prototype.loadSuspendData.call(this,e);this.useExamples&&this.orderExamples();var i=this.prefijo,t=$("#"+i+"_lista"),s=window[i+"_preguntas"];var o,a,r;if(e&&e.respuestas&&e.respuestas.length){for(var n=0;n<this.numElementos;n++){o=n<this.respuestas.length?this.respuestas[n]:n;r=this.traduceReal2Visual(o);a=s[r];this.pintaItem(n+1,o,a)}}else{for(var n=0;n<this.numElementos;n++){r=this.traduceVisual2Real(n);a=s[n];this.pintaItem(n+1,r,a);this.respuestas[n]=r}}this.useExamples&&this.showExample();this.redondear();t.sortable({start:function(e,t){$(e.target).data("ui-sortable").floating=true;$(".item").width("auto");window.isDragging=true;t.item.addClass("dragging")},update:function(e,t){updateOrder(i);t.item.removeClass("ejercicio_ko")},stop:function(e,t){window.isDragging=false;t.item.removeClass("dragging")},items:"> li:not(."+this.solutionStyleClass+"):not(."+this.exampleStyleClass+")",cancel:".disabled"}).disableSelection()};Slide_rank.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);return e};Slide_rank.prototype.correct=function(e,t){Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_rank.prototype.tieneRespuestas=function(){return true};Slide_rank.prototype.showLastItemAsExample=function(){return false};Slide_rank.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){$("#"+this.prefijo+"_panel").removeClass("ejercicio_ok ejercicio_ko");$("li[id^="+this.prefijo+"v]").remove();for(var i=0;i<this.numElementos;i++){var visual=this.traduceReal2Visual(i);eval("var p = "+this.prefijo+"_preguntas["+visual+"]");this.pintaItem(i+1,i,p)}$("li[id^="+this.prefijo+"v]").addClass("solucion");this.redondear()}};Slide_rank.prototype.showElemSolution=function(e){if(this.useExamples&&this.exampleIndex.indexOf(e)!=-1){$("li[id="+this.prefijo+"v"+e+"]").removeClass("ejercicio_ok ejercicio_ko").addClass(this.exampleStyleClass)}else{$("li[id^="+this.prefijo+"v]").remove();for(var t=0;t<=e;t++){var i=this.traduceReal2Visual(t),s=window[this.prefijo+"_preguntas"][i];this.pintaItem(t+1,t,s);var o=this.useExamples&&this.exampleIndex[e]==t?this.exampleStyleClass:this.solutionStyleClass;$("li[id="+this.prefijo+"v"+t+"]").removeClass("ejercicio_ok ejercicio_ko").addClass(o)}}};Slide_rank.prototype.showExample=function(){if(!this.useExamples)return;this.exampleIndex=[0];if(this.showLastItemAsExample()){this.exampleIndex.push(this.numElementos-1)}for(i=0;i<this.exampleIndex.length;i++){this.showElemSolution(this.exampleIndex[i])}};Slide_rank.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("li[id^="+this.prefijo+"v]").remove();for(var i=0;i<this.numElementos;i++){var visual=this.respuestas[i]!=null&&this.respuestas[i]!=undefined?this.traduceReal2Visual(this.respuestas[i]):i;eval("var p = "+this.prefijo+"_preguntas["+visual+"]");this.pintaItem(i+1,i,p)}$("#"+this.prefijo+"_panel").removeClass("ejercicio_ok ejercicio_ko");if(this.useExamples)this.showExample();this.redondear();this.update(false,false)}};Slide_rank.prototype.setDisabled=function(e){$("[id='transp"+this.prefijo.substring(1)+"'] .ordenar [id^="+(e!=null?e:this.prefijo)+"]").each(function(){$(this).addClass("disabled").attr("disabled","disabled")});try{$("#"+this.prefijo+"_lista").sortable("disable")}catch(e){}};Slide_rank.prototype.traduceReal2Visual=function(opcion){var shai=sha1(opcion);for(var j=0;j<this.numElementos;j++){eval("var resp = "+this.prefijo+"_resp["+j+"]");if(shai==resp)return j}return null};Slide_rank.prototype.traduceVisual2Real=function(opcion){eval("var resp = "+this.prefijo+"_resp["+opcion+"]");for(var j=0;j<this.numElementos;j++){var shaj=sha1(j);if(shaj==resp)return j}};function updateOrder(prefijo){eval("var t= "+prefijo+"_slide;");t.cambiosUsuario=true;var liIndex=0;$("li[id^="+prefijo+"v]").each(function(index,value){var pos=this.id.indexOf("v");eval(prefijo+"_slide.respuestas[liIndex] = this.id.substring(pos+1)");liIndex++;$(this).find(".posicion").html(index+1+". ")});t.setReviewButtons()}Slide_rank.prototype.pintaItem=function(e,t,i){var s=$("#"+this.prefijo+"_lista"),o=$("#"+this.prefijo+"-mock").clone();o.attr("id",this.prefijo+"v"+t).find(".caja_inner").attr("id",this.prefijo+"caja"+t).end().find(".posicion").text(e+". ").end().find(".texto").html(i).end().appendTo(s);blink.theme.createVideoButtons(o);blink.theme.createAudioButtons(o)};Slide_rank.prototype.redondear=function(){if($("#"+this.prefijo+"_panel").hasClass("ordenar_horizontal")){ajustarAltos(this.prefijo)}if(jQuery.fn.corner){$("[id^="+this.prefijo+"caja]").corner("round 8px").parent().css("padding","3px").corner("round 10px")}};Slide_rank.prototype.orderExamples=function(){var e=window[this.prefijo+"_sol"],t=[],i=window[this.prefijo+"_resp"],s=window[this.prefijo+"_preguntas"];for(var o=0;o<e.length;o++){t[o]=decode64(e[o])}var a=0,r=this.numElementos-1;var n=t.indexOf(a.toString());firstSolution=e[n],firstResponse=i[n],firstQuestion=s[n];e.splice(n,1);i.splice(n,1);s.splice(n,1);t.splice(n,1);e.unshift(firstSolution);i.unshift(firstResponse);s.unshift(firstQuestion);t.unshift(a);if(this.showLastItemAsExample()){var l=t.indexOf(r.toString());lastSolution=e[l];lastResponse=i[l];lastQuestion=s[l];e.splice(l,1);i.splice(l,1);s.splice(l,1);e.push(lastSolution);i.push(lastResponse);s.push(lastQuestion)}n=this.respuestas.indexOf(a);if(n!=-1){this.respuestas.splice(n,1);this.respuestas.unshift(a)}if(this.showLastItemAsExample()){l=this.respuestas.indexOf(r);if(l!=-1){this.respuestas.splice(l,1);this.respuestas.push(r)}}};Slide_rank.prototype.clearSlide=function(){this.clearSlideComunIni();$("#"+this.prefijo+"_panel").removeClass("ejercicio_ok ejercicio_ko");$("li[id^="+this.prefijo+"v]").remove();var e=window[this.prefijo+"_preguntas"];for(var t=0;t<this.numElementos;t++){position=this.traduceVisual2Real(t);text=e[t];this.pintaItem(t+1,position,text);this.respuestas[t]=position}this.redondear();var i=this.prefijo;$("#"+this.prefijo+"_lista").sortable("enable").removeClass("disabled").removeAttr("disabled").disableSelection().find("li").removeClass(this.solutionStyleClass).removeClass("disabled").removeAttr("disabled");this.clearSlideComunFin()};Slide_rank.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".js-query"),o=s.siblings(".js-richeditor-input");i.attr("name",e+"_exer_"+t);if(o.length>0){o.attr({placeholder:o.attr("placeholder")+" "+t});s.attr({name:s.attr("name")+(t-1),id:s.attr("name")+(t-1)})}else{s.attr({name:s.attr("name")+(t-1),placeholder:s.attr("placeholder")+" "+t})}$("#"+e+"pg").find(".js-form-questions").append(i)};function ajustarAltos(e){var t=0;$("[id^='"+e+"caja'] p").each(function(){if($(this).height()>t)t=$(this).height()});if(t!=0)$("[id^='"+e+"caja'] p").each(function(){$(this).height(t)})}$(document).ready(function(){$(".js-rank-list").on("mouseover",".js-rank-item",function(e){var t=$(this);if(!t.hasClass("disabled")){t.addClass("respuesta_over")}}).on("mouseout",".js-rank-item",function(e){var t=$(this);if(!t.hasClass("disabled")){t.removeClass("respuesta_over")}});$(document).on("click",".slide-rank .js-add-option",function(e){var t=$(this).closest(".slide-rank").data("prefix");Slide_rank.prototype.addOption(t)})});function Slide_reading(){}Slide_reading.prototype=new Slide;Slide_reading.prototype.esEjercicio=true;Slide_reading.prototype.esAutocorregible=false;Slide_reading.prototype.isReading=false;Slide_reading.prototype.initTime=0;Slide_reading.prototype.numWords=0;Slide_reading.prototype.onShow=function(){var e=this;$("#"+this.prefijo+"_reading").change(function(){Slide_reading.prototype.countWords.call(e)}).change();$("#"+this.prefijo+"_start").click(function(){Slide_reading.prototype.toogleReading.call(e)});Slide.prototype.onShow.call(this)};Slide_reading.prototype.update=function(e,t){if(checkPuedeEditar()){$("#"+this.prefijo+"_start").show()}if(this.respuestas!=undefined&&this.respuestas[0]){$("#"+this.prefijo+"_start").hideBlink();$("#"+this.prefijo+"_reading").hideBlink();var i=this.respuestas[0];$("#"+this.prefijo+"_time").html(i);$("#"+this.prefijo+"_speed").html(Math.ceil(60*this.numWords/i));$("#"+this.prefijo+"_resultado").showBlink();var s=parseInt($("#"+this.prefijo+"_resultado").css("width"));var o=parseInt($("#"+this.prefijo+"left").css("width"));var a=""+(o-s)/2+"px";$("#"+this.prefijo+"_resultado").css("margin-left",a)}Slide.prototype.update.call(this,e,t)};Slide_reading.prototype.evalNumElements=function(){this.numElementos=1};Slide_reading.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=1;Slide.prototype.loadSuspendData.call(this,e)};Slide_reading.prototype.getSuspendData=function(){var e=Slide.prototype.getSuspendData.call(this);return e};Slide_reading.prototype.correct=function(e,t){this.update(e,t);Slide.prototype.correct.call(this,e,t)};Slide_reading.prototype.toogleReading=function(){if(!this.isReading){var e=textweb("reading_8");if(e==undefined)e="Finalizar";$("#"+this.prefijo+"_start_txt").html(e);$("#"+this.prefijo+"_reading").showBlink();this.initTime=new Date}else{var t=new Date;var i=Math.ceil((t.getTime()-this.initTime.getTime())/1e3);this.respuestas=new Array;this.respuestas[0]=i;this.update(false,false)}this.isReading=!this.isReading};Slide_reading.prototype.countWords=function(){var e=$("#"+this.prefijo+"_reading_texto").html();this.numWords=countWords(stripHTML(e," "));$("#"+this.prefijo+"_wordcounter").html(this.numWords);return this.numWords};function Slide_shortanswers(){}Slide_shortanswers.prototype=new Slide;Slide_shortanswers.prototype.esEjercicio=true;Slide_shortanswers.prototype.esAutocorregible=false;Slide_shortanswers.prototype.showHintInline=false;Slide_shortanswers.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_shortanswers.prototype.onShow=function(){if(this.useExamples)this.showExample();if(!blink.isTablet&&!this.isConcatenate){if(blink.activity.currentStyle.focusFirstShortAnswer&&blink.activity.currentStyle.focusFirstShortAnswer()){for(var e=0;e<this.numElementos;e++){var t=$("[id^='"+this.prefijo+"v"+e+"']").filter("input,textarea").filter(":enabled");if(t.hasClass("hidden")){t=t.parent().siblings(".textarea-answer").children(".js-richeditor-input")}if(t.length>0&&!t.get(0).disabled){t.focus();break}}}}uploadedFilesInSlides(this.marcadoTextBox,this.uid);Slide.prototype.onShow.call(this)};Slide_shortanswers.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){var s=this.respuestas[i]?this.respuestas[i].replace(/\\n/g,"\n"):"",o=$("[id^='"+this.prefijo+"v"+i+"']"),a=o.parent().siblings(".preview.js-richeditor");if(o.length>0){o.css("height","");o.val(s);var r=parseInt(o.css("line-height")),n=false,l=o.get(0).scrollHeight+2;if(o.attr("rows")!=undefined){n=parseInt(o.attr("rows"))*r+2}var d=n&&n>=l?n:l;o.css({"min-height":n?n:"",height:d});a.css({"min-height":n?n:""});if(mostrarNota){this.pintaNota(i,this.resultados[i])}if(t&&this.resultados[i]!=null){this.clasificacion+=this.resultados[i]/2}}}if(t){var u=this.numElementos;if(this.useExamples)u--;if(u>0)this.clasificacion=this.clasificacion/u}blink.events.trigger("afterShortanswersUpdate",this.prefijo);Slide.prototype.update.call(this,e,t);this.disableFieldsRicheditor()};Slide_shortanswers.prototype.disableFieldsRicheditor=function(){if($(".js-richeditor-input").length>0){$(".shortanswer-container textarea[disabled]").parent().siblings(".textarea-answer").children("textarea.js-richeditor-input").attr("disabled",true);$(".shortanswer-container textarea[disabled]").parent().siblings(".preview").css("cursor","not-allowed");$(".shortanswer-container input[disabled]").siblings("input.js-richeditor-input").attr("disabled",true);$(".shortanswer-container textarea[disabled]").parent().siblings(".input-group-addon").css("display","none");$(".shortanswer-container textarea[disabled]").parent().siblings(".js-richeditor").addClass("disabled");$(".shortanswer-container input[disabled]").siblings(".input-group-addon").css("display","none");$(".shortanswer-container input.solucion").siblings("input.js-richeditor-input").addClass("solucion").css("pointer-events","none");$(".shortanswer-container textarea.solucion").parent().siblings(".textarea-answer").children("textarea.js-richeditor-input").addClass("solucion").css("pointer-events","none");$(".shortanswer-container textarea.solucion").parent().siblings(".preview").addClass("solucion").css({"font-size":"1.4rem","pointer-events":"none",color:"#555"});$(".shortanswer-container input.solucion").css("pointer-events","none")}};Slide_shortanswers.prototype.evalNumElements=function(){this.numElementos=$("[id^='"+this.prefijo+"v']").size()};Slide_shortanswers.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_shortanswers.prototype.getSuspendData=function(){for(var e=0;e<this.numElementos;e++){var t=$("[id^='"+this.prefijo+"v"+e+"']");var i=t.val();if(t.hasClass("hidden")&&i==""){i=t.parent().siblings(".textarea-answer").children(".js-richeditor-input").val()}this.respuestas[e]=i}return Slide.prototype.getSuspendData.call(this)};Slide_shortanswers.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=document.f.elements[this.prefijo+"v"+i].value}this.onShow();Slide.prototype.correct.call(this,e,t)};Slide_shortanswers.prototype.pintaNota=function(e,t){var i="sin_corregir";if(t==0){i="respuesta_ko"}else if(t==1){i="respuesta_regular"}else if(t==2){i="respuesta_ok"}var s=$("[id='"+this.prefijo+"nota"+e+"']");s.html("<img src='../images/i/"+i+".gif'/>");if(modoClase==1||modoClase==2){s.parent().height($("[id='"+this.prefijo+"v"+e+"']").height())}};Slide_shortanswers.prototype.cambiaNota=function(e){var t=this.resultados[e];if(t==2){t=null}else if(t==null){t=0}else{t++}this.resultados[e]=t;this.pintaNota(e,t);this.clasificacionprofesor=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){$("[id^='"+this.prefijo+"v"+i+"']").val(this.respuestas[i]);this.pintaNota(i,this.resultados[i]);if(this.resultados[i]!=null){this.clasificacionprofesor+=this.resultados[i]/2}}var s=this.numElementos;if(this.useExamples)s--;if(s>0)this.clasificacionprofesor=this.clasificacionprofesor/s;$("#edicion_nota_transp").val(numGradeToView(maxclasificacion*this.clasificacionprofesor,"slide_shortanswers"));$("#nota_revision").val(numGradeToView(maxclasificacion*this.clasificacionprofesor,"slide_shortanswers"));var o=this.prefijo.split("t")[1];updateNota(o)};Slide_shortanswers.prototype.showElemSolution=function(e){var t=this.useExamples&&this.exampleIndex==e?this.exampleStyleClass:this.solutionStyleClass,i=$("#"+this.prefijo+"v"+e),s=i.parents(".shortanswer-container").find(".hint"),o=e==this.exampleIndex;if(s.is(".solucion.decoding")){s.html(window.base64_encode(s.html()))}s.html(window.decode64(s.html()));s.addClass("decoding");if(o||this.showHintInline){i.val(s.html()).addClass(t).prop({readonly:true,disabled:true,isExample:o});i.parents(".shortanswer-container").find(".js-richeditor-input").val(s.html())}else{s.css("display","").showBlink().prevAll(".input-container, .textarea-container").addClass("hint-active").closest(".shortanswer-container").addClass("hint-active-container")}};Slide_shortanswers.prototype.hideElemSolution=function(e){var t=$("#"+this.prefijo+"v"+e),i=t.parents(".shortanswer-container").find(".hint"),s=e==this.exampleIndex;if(s||this.showHintInline){t.val("").removeClass(styleClass).prop({readonly:false,disabled:false})}else{i.hideBlink().prevAll(".input-container, .textarea-container").removeClass("hint-active").closest(".shortanswer-container").removeClass("hint-active-container")}$("div.textarea-answer").removeClass("near-max");if($("[id='"+this.prefijo+"v"+e+"']").val()==""){var o=$("[id='"+this.prefijo+"v"+e+"']").size();$("div.textarea-answer #"+this.prefijo+"v"+e).height(o)}};Slide_shortanswers.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){for(var e=this.firstElementIndex;e<this.numElementos;e++){this.hideElemSolution(e)}}this.update(false,false)};Slide_shortanswers.prototype.clearSlide=function(){$(".shortanswer-container").find(".solucion:not(.hidden)").each(function(e){$(this).html(window.base64_encode($(this).html()));$(this).removeClass("decoding")});this.clearSlideComunIni();var e="#"+this.prefijo+"pg";$(".js-richeditor-input",e).val("");$(".js-richeditor:not(.solucion)",e).html("");$("textarea",e).removeAttr("disabled");$(".js-richeditor",e).removeClass("disabled");$(".input-group-addon",e).css("display","block");$(".js-richeditor-input:not(.solucion)",e).each(function(e){changeRichTextInput(this)});this.reiniciarArchivoComoRespuesta();this.clearSlideComunFin();this.disableFieldsRicheditor()};Slide_shortanswers.prototype.setDisabled=function(){$("[id='transp"+this.prefijo.substring(1)+"']").find("input, select, textarea").each(function(){$(this).attr("disabled","disabled")}).end().find(".uploaded-file-editor, .icon-file, .icon-edit").each(function(){$(this).addClass("disabled")})};Slide_shortanswers.prototype.setBudget=function(e,t){var i=window[e+"_slide"];if(i.useExamples)i.showExample();setBudget(e,t)};Slide_shortanswers.prototype.reiniciarArchivoComoRespuesta=function(){$(".deleteFileUploaded","#"+this.prefijo+"pg").each(function(){borrarFileAsAnswer($(this))});$(".input-group-addon *","#"+this.prefijo+"pg").removeClass("disabled")};$(document).ready(function(){inicializarFilesAsAnswers(".shortanswer-container")});var Sintaxis=function(){};Sintaxis.prototype={chars:{spacer:[" ",",",";","Â¿","?","Â¡","!",":","'",'"'],left:"â",center:"â",right:"â"},tipos:[{nombre:"gramatical",opciones:[],opciones_antiguas:["adjetivo","adverbio","conjunciÃ³n","determinante","locuciÃ³n","preposiciÃ³n","pronombre","sustantivo","verbo"],opciones_nuevas:["oraciÃ³n subordinada sustantiva (OSS)","oraciÃ³n subordinada adjetiva (OSAdj)","oraciÃ³n subordinada adverbial (OSAdv)","sintagma verbal (SV)","sintagma nominal (SN)","sintagma adjetival (SAdj)","sintagma adverbial (SAdv)","sintagma preposicional (SP)"]},{nombre:"gramatical de grupo",opciones:["grupo adjetival","grupo adverbial","grupo nominal","grupo preposicional","grupo verbal","oraciÃ³n simple","oraciÃ³n subordinada","oraciÃ³n principal","preposiciÃ³n"]},{nombre:"estructura de grupo",opciones:["actualizador","enlace","marca impersonal","marca pasiva","nexo","nÃºcleo"]},{nombre:"funciÃ³n de grupo",opciones:[],opciones_antiguas:["adyacente","aposiciÃ³n","atributo","complemento agente","complemento circustancial","complemento del adjetivo","complemento del adverbio","complemento de rÃ©gimen","complemento del nombre","complemento directo","complemento indirecto","complemento predicativo","modificador","predicado nominal","predicado verbal","sujeto","tÃ©rmino"],opciones_nuevas:["sujeto (Suj)","sujeto paciente (SPac)","predicado verbal (PV)","predicado nominal (PN)","complemento directo (CD)","complemento indirecto (CI)","complemento de rÃ©gimen (CRÃ©g)","complemento circunstancial de lugar (CCL)","complemento circunstancial de modo (CCM)","complemento circunstancial de tiempo (CCT)","complemento circunstancial de cantidad (CCC)","complemento circunstancial de instrumento (CCI)","complemento circunstancial de compaÃ±Ã­a (CCComp)","complemento predicativo (CPred)","complemento predicativo del CD (CPred CD)","complemento agente (CAg)","complemento del nombre (CN)","complemento del adjetivo (CAdj)","complemento del adverbio (CAdv)","atributo (Atr)","adyacente (Ady)","aposiciÃ³n (Apos)","determinante (DT)","nexo (NX)","enlace (E)","complemento circunstancial de negaciÃ³n (CNN)","tÃ©rmino(T)","cuantificador(Ct)"]}],selected:null,data:[],frase:"",fraseNode:null,solucion:[],disabled:false,numSol:0,sintaxis:[],prefijo:"",fecha_opciones_antiguas:"",fecha_ult_cambio:"",empezar:function(e){if(this.frase){sintaxis=this;$("#"+e+"pg").find(".sintaxis_ejercicio").fadeIn();if(this.tipo=="editar"){if(this.frase)this.renderizarEjercicioProfesor(e)}else this.renderizarEjercicioAlumno(e)}else $("#"+e+"pg").find(".sintaxis_ejercicio").fadeOut()},add:function(e){var t=$("#"+e+"pg").find(".new_block");var i=t.find(".sintaxis_adder_categorias select").val();var s=t.find(".sintaxis_adder_opciones select").val();if(i&&s&&i>=0&&s>=0){this.closeAdder();this.selected.categoria=i;this.selected.opcion=s;this.data.push(this.selected);var o=$("#"+e+"pg").find(".sintaxis_frase").find(".selecion").addClass("bloque").removeClass("selecion").attr("data-id",this.selected.id);o.get(0).normalize();var a=$("#"+e+"pg").find("[data-id="+this.selected.parentID+"]").get(0);a.normalize();this.paintBlanksBlock(a);var r=$("#"+e+"pg").find(".sintaxis_adder").length+1,n=$("#"+e+"pg").find(".new_block").clone().css("visibility","visible").removeClass("new_block").addClass("sintaxis_adder");$("#"+e+"pg").find("[data-id="+this.selected.id+"]").attr("data-contador",r);n.find(".sintaxis_adder_boton").remove();n.find(".sintaxis_adder_numero").attr("data-id-num",this.selected.id).text(r).showBlink();n.find(".sintaxis_adder_categorias").removeClass("col-xs-offset-1").find("select").attr("data-id-cat",this.selected.id).val(i);this.setOpciones(n.find(".sintaxis_adder_categorias select"));n.find(".sintaxis_adder_opciones select").attr("data-id-opt",this.selected.id).val(s);n.find(".sintaxis_adder_boton_upd").attr("onclick","window['"+e+"_edit'].updateBlock('"+e+"',"+this.selected.id+")").showBlink();$("#"+e+"pg").find(".answer-container").append(n);marcarHaCambiado(idtransact);$(this.solucionID).val(this.serializar())}},updateBlock:function(e,t){var i=$("#"+e+"pg").find("[data-id-cat="+t+"]").val(),s=$("#"+e+"pg").find("[data-id-opt="+t+"]").val();if(i&&s){var o=_.pluck(this.data,"id").indexOf(t);if(o!=-1){this.closeAdder();this.data[o].categoria=i;this.data[o].opcion=s;marcarHaCambiado(idtransact);$(this.solucionID).val(this.serializar())}}},check:function(e,t){if(!this.disabled){var i=$("#"+e+"pg").find("[data-id-cat="+t+"]").val(),s=$("#"+e+"pg").find("[data-id-opt="+t+"]").val();if(i&&s){var o={id:t,categoria:i,opcion:s};var a=_.pluck(this.data,"id").indexOf(t);if(a==-1)this.data.push(o);else this.data[a]=o;var r=this;$("#"+e+"pg").find(".bloque[data-id="+t+"]").removeClass("empty respuesta_ko").addClass("filled").attr("data-original-title",r.tipos[i].opciones[s]).tooltip({placement:"bottom"});$("#"+e+"pg").find("[data-id-num="+t+"]").addClass("filled")}}},getCategoriasHTML:function(){var i="",e=this;$.each(e.tipos,function(e,t){i+='<option value="'+e+'">'+t.nombre+"</option>"});return i},setOpciones:function(e,t){var i=this;if(!i.disabled)$(e).addClass("filled");var s=$(e).val();if(s!=-1){var o="";if(typeof t!=="undefined"){o='<option value="-1" disabled>'+textweb("slidesyntax.tipo")+"</option>"}else{o='<option value="-1" disabled selected>'+textweb("slidesyntax.tipo")+"</option>"}switch(s){case"0":case"3":var a=[];if(i.fecha_opciones_antiguas>i.fecha_ult_cambio){if(i.tipo=="ver"){a=i.tipos[s].opciones_antiguas}else if(i.tipo=="editar"){if(typeof t!=="undefined")o+='<option value="-2" disabled selected>'+i.tipos[s].opciones_antiguas[t];+"</option>";a=i.tipos[s].opciones_nuevas}}else{a=i.tipos[s].opciones_nuevas}$.each(a,function(e,t){o+='<option value="'+e+'">'+t+"</option>"});break;default:$.each(i.tipos[s].opciones,function(e,t){o+='<option value="'+e+'">'+t+"</option>"})}$(e).parent().siblings(".sintaxis_adder_opciones").find("select").html(o)}},del:function(e){marcarHaCambiado(idtransact)},getFrase:function(){return this.frase},getTextSelected:function(){if(window.getSelection)return window.getSelection();else if(document.getSelection)return document.getSelection();else{var e=document.selection&&document.selection.createRange();if(e.text)return e.text;return false}return false},checkSelected:function(){var e=false;var t=Sintaxis.prototype.getTextSelected(),i=t.toString();if(t.anchorNode!=null){var s=t.anchorNode.textContent;var o=Math.min(t.anchorOffset,t.focusOffset),a=Math.max(t.anchorOffset,t.focusOffset);if(o!=-1){while(o>=0&&$.inArray(s.substr(o,1),Sintaxis.prototype.chars.spacer)==-1)o--;while(a<s.length&&$.inArray(s.substr(a,1),Sintaxis.prototype.chars.spacer)==-1)a++;while(o<s.length&&$.inArray(s.substr(o+1,1),Sintaxis.prototype.chars.spacer)!=-1)o++;while(a>0&&$.inArray(s.substr(a-1,1),Sintaxis.prototype.chars.spacer)!=-1)a--;o++;if(o>=a)return;i=s.substr(o,a-o);var r=this.data.length?this.data.length+1:1;this.selected={id:r,inicio:o,fin:a,length:i.length};if(this.selected.length>0)this.openAdder(t)}}},quitSelection:function(e){$("#"+e+"pg").find(".selecion").contents().unwrap().end();$("#"+e+"pg").find(".sintaxis_ejercicio").get(0).normalize();sintaxis.closeAdder();this.selected=null},openAdder:function(e){var t=e.getRangeAt(0);var i=document.createElement("span");i.className="selecion";i.setAttribute("data-id",this.selected.id);t.setStart(e.anchorNode,this.selected.inicio);t.setEnd(e.anchorNode,this.selected.inicio+this.selected.length);t.surroundContents(i);e.removeAllRanges();e.addRange(t);this.selected.parentID=parseInt(t.endContainer.getAttribute("data-id"));if(isNaN(this.selected.parentID)||this.selected.parentID>this.data.length){this.quitSelection("t"+blink.activity.currentSection);return}$(".new_block").css("visibility","visible")},closeAdder:function(){$(".new_block").css("visibility","hidden").find("[value=-1]").prop("selected",true)},paintBlock:function(e,t,i){var s=$("#"+e+"pg").find("[data-id="+t.parentID+"]").get(0);var o=document.createRange(),a=document.createElement("span");a.className="bloque empty";a.setAttribute("data-id",t.id);a.setAttribute("data-contador",i);o.setStart(s.childNodes[0],t.inicio);o.setEnd(s.childNodes[0],t.fin);o.surroundContents(a);if(this.tipo=="editar"){var r=this;var n=[];if(r.fecha_opciones_antiguas>r.fecha_ult_cambio){if(t.categoria=="0"||t.categoria=="3")n=r.tipos[t.categoria].opciones_antiguas}else{if(t.categoria=="0"||t.categoria=="3")n=r.tipos[t.categoria].opciones_nuevas}switch(t.categoria){case"0":case"3":$(a).attr("data-original-title",r.tipos[t.categoria].nombre+"\n  "+n[t.opcion]).tooltip({placement:"bottom"});break;default:$(a).attr("data-original-title",r.tipos[t.categoria].nombre+"\n  "+r.tipos[t.categoria].opciones[t.opcion]).tooltip({placement:"bottom"})}}this.paintBlanksBlock(s,t.id)},paintBlanksBlock:function(e,t){e.normalize();var i=e.childNodes.length,s=0;for(var o=0;o<i;o++){e.normalize();var a=e.childNodes[o];if(a.nodeType==3){var r={parentID:parseInt(e.getAttribute("data-id")),inicio:0,fin:a.length,length:a.length,categoria:null,opcion:null};if(this.selected!=null){var n=this.data.length?this.data.length+1:1;r.id=n;this.data.push(r)}else{var n=t+ ++s}span=document.createElement("span");span.setAttribute("data-id",n);range=document.createRange();range.setStart(a,0);range.setEnd(a,a.length);range.surroundContents(span)}a.normalize();e.normalize()}},renderizarEjercicioProfesor:function(e){$("#"+e+"pg").find(".sintaxis_ejercicio").parent().showBlink();$(this.solucionID).val(this.serializar());this.renderizar(e,this.data,"profesor");this.mostrarSolucion(e,this.data)},renderizarEjercicioAlumno:function(e){this.renderizar(e,this.solucion,"alumno")},renderizar:function(e,t,i){var s=this;var o=$("#"+e+"pg").find(".sintaxis_frase");o.text(s.getFrase());s.fraseNode=o.get(0).childNodes[0];var a=t.length;s.numSol=0;for(var r=0;r<a;r++){if(t[r].categoria!=null){s.paintBlock(e,t[r],++s.numSol)}}},serializar:function(){var i=[];var e=this;if(e.tipo=="editar"){$.each(this.data,function(e,t){i.push({id:t.id,p:t.parentID,i:t.inicio,l:t.length,c:t.categoria,o:t.opcion})})}else{$.each(e.data,function(e,t){if(t){i.push({id:t.id,c:t.categoria,o:t.opcion})}})}return JSON.stringify(i)},setFrase:function(e,t){t=t.replace(/[\s]+/g," ");t=t.replace(/<.*>/g,"");$("#"+e+"pg").find(".sintaxis_frase").text(t);$("#"+e+"pg").find(".sintaxis_frase_input").val(t);this.frase=t;this.selected=null;this.data=[];this.solucion=[]},procesarSolucion:function(e){if(!e)return[];var i=[];$.each(e,function(e,t){i.push({id:t.id,parentID:t.p,inicio:t.i,fin:t.i+t.l,length:t.l,categoria:t.c,opcion:t.o})});return i},procesarRespuestas:function(s,e){if(!e||!e.length)return[];var o=this;var t=jQuery.parseJSON(e);$.each(t,function(e,t){o.data.push({id:t.id,categoria:t.c,opcion:t.o});var i=$("#"+s+"pg").find("[data-id-cat="+t.id+"]");i.val(t.c);o.setOpciones(i);$("#"+s+"pg").find("[data-id-opt="+t.id+"]").val(t.o);o.check(s,t.id)})},mostrarSolucion:function(o,e){var a=this;$("#"+o+"pg").find(".bloque").removeClass("respuesta_ok respuesta_ko");$.each(e,function(e,t){if(t.categoria!=null){var i=$("#"+o+"pg").find("[data-id-cat="+t.id+"]");i.val(t.categoria);a.setOpciones(i,t.opcion);var s=[];if(a.fecha_opciones_antiguas<a.fecha_ult_cambio){$("#"+o+"pg").find("[data-id-opt="+t.id+"]").val(t.opcion);if(t.categoria=="0"||t.categoria=="3")s=a.tipos[t.categoria].opciones_nuevas}else{if(a.tipo=="ver")$("#"+o+"pg").find("[data-id-opt="+t.id+"]").val(t.opcion);if(t.categoria=="0"||t.categoria=="3")s=a.tipos[t.categoria].opciones_antiguas}switch(t.categoria){case"0":case"3":$("#"+o+"pg").find(".bloque[data-id="+t.id+"]").attr("data-original-title",s[t.opcion]).tooltip({placement:"bottom"});break;default:$("#"+o+"pg").find(".bloque[data-id="+t.id+"]").attr("data-original-title",a.tipos[t.categoria].opciones[t.opcion]).tooltip({placement:"bottom"})}}})},mostrarCategorias:function(){var s=this;$("#"+this.prefijo+"pg").find(".bloque").removeClass("respuesta_ok respuesta_ko");$.each(this.solucion,function(e,t){if(t.categoria!=null){var i=$("#"+s.prefijo+"pg").find("[data-id-cat="+t.id+"]");i.val(t.categoria);s.setOpciones(i);i.prop("disabled",true)}})},updateFrase:function(e,t){$("#"+e+"pg").find(".sintaxis_adder").remove();this.setFrase(e,t);this.empezar(e)},obtenerResultados:function(){var s=[],e=0,o;var a=_.pluck(this.solucion,"id");var r=this;$.each(r.data,function(e,t){var i=a.indexOf(t.id);if(i!=-1){o=r.solucion[i];s.push(t.categoria==o.categoria&&t.opcion==o.opcion)}});return s},pintarFallos:function(e,t){var i=this;$("#"+e+"pg").find('[data-id != ""]').removeClass("respuesta_ok respuesta_ko").end().find('[data-id-opt != ""]').removeClass("respuesta_ok respuesta_ko").end().find('[data-id-cat != ""]').removeClass("respuesta_ok respuesta_ko").end().find('[data-id-num != ""]').removeClass("respuesta_ok respuesta_ko");if(t)var s=t;else var s=i.obtenerResultados();for(var o=0;o<s.length;o++){if(s[o]){$("#"+e+"pg").find("[data-id = "+i.data[o].id+"]").addClass("respuesta_ok").end().find("[data-id-opt = "+i.data[o].id+"]").addClass("respuesta_ok").attr("disabled","disabled").end().find("[data-id-cat = "+i.data[o].id+"]").addClass("respuesta_ok").attr("disabled","disabled").end().find("[data-id-num = "+i.data[o].id+"]").addClass("respuesta_ok")}else{$("#"+e+"pg").find("[data-id = "+i.data[o].id+"]").addClass("respuesta_ko").end().find("[data-id-opt = "+i.data[o].id+"]").addClass("respuesta_ko").end().find("[data-id-cat = "+i.data[o].id+"]").addClass("respuesta_ko").end().find("[data-id-num = "+i.data[o].id+"]").addClass("respuesta_ko")}}},getAciertos:function(e){var i=0;$.each(e,function(e,t){if(t)i++});return i}};function Slide_syntax(){}Slide_syntax.prototype=new Slide;Slide_syntax.prototype.esEjercicio=true;Slide_syntax.prototype.update=function(e,t){if(this.respuestas.length==0||json_decode(this.respuestas).length==0&&this.showCategory){this.widget.mostrarCategorias()}this.numElementos=this.widget.numSol;if(t){this.resultados=this.widget.obtenerResultados();if(checkMostrarSoluciones()){this.widget.pintarFallos(this.prefijo)}var i=this.widget.getAciertos(this.resultados);this.clasificacion=i/this.numElementos}if(this.intentos==this.numMaxIntentos){$("#"+this.prefijo+"pg").find(".sintaxis_adder select").attr("disabled","disabled");$("#"+this.prefijo+"pg").find(".sintaxis_adder button").hide()}Slide.prototype.update.call(this,e,t)};Slide_syntax.prototype.correct=function(e,t){this.respuestas=this.widget.serializar();this.update(e,correct);Slide.prototype.correct.call(this,e,t)};Slide_syntax.prototype.getSuspendData=function(){this.respuestas=this.widget.serializar();return Slide.prototype.getSuspendData.call(this)};Slide_syntax.prototype.loadSuspendData=function(e){if(e){this.widget.procesarRespuestas(this.prefijo,e.respuestas);if(checkMostrarSoluciones()){this.widget.pintarFallos(this.prefijo,e.resultados)}}Slide.prototype.loadSuspendData.call(this,e)};Slide_syntax.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){this.widget.disabled=true;this.widget.mostrarSolucion(this.prefijo,this.widget.solucion);$("#"+this.prefijo+"pg").find(".workspace.syntax").addClass("solucion")}};Slide_syntax.prototype.hideSolution=function(){$page=$("#"+this.prefijo+"pg");this.widget.renderizarEjercicioAlumno(this.prefijo);$page.find(".workspace.syntax").removeClass("solucion");$page.find(".sintaxis_adder select").val("-1");that=this;$.each(this.widget.data,function(e,t){$page.find("[data-id-cat = "+t.id+"]").val(t.categoria);that.widget.setOpciones($page.find("[data-id-cat = "+t.id+"]"));$page.find("[data-id-opt = "+t.id+"]").val(t.opcion);var i=[];if(that.widget.fecha_opciones_antiguas>that.widget.fecha_ult_cambio){if(t.categoria=="0"||t.categoria=="3")i=that.widget.tipos[t.categoria].opciones_antiguas}else{if(t.categoria=="0"||t.categoria=="3")i=that.widget.tipos[t.categoria].opciones_nuevas}switch(t.categoria){case"0":case"3":$("#"+that.prefijo+"pg").find(".bloque[data-id="+t.id+"]").attr("data-original-title",i[t.opcion]).tooltip({placement:"bottom"});default:$("#"+that.prefijo+"pg").find(".bloque[data-id="+t.id+"]").attr("data-original-title",that.widget.tipos[t.categoria].opciones[t.opcion]).tooltip({placement:"bottom"})}});this.widget.pintarFallos(this.prefijo)};Slide_syntax.prototype.clearSlide=function(){this.clearSlideComunIni();this.widget.data=[];this.widget.disabled=false;this.update(false,false);$page=$("#"+this.prefijo+"pg");$page.find(".workspace.syntax").removeClass("solucion");$page.find(".sintaxis_adder select").val("-1");$page.find(".answer-container select").removeAttr("disabled").removeClass("filled").removeClass("respuesta_ok").removeClass("respuesta_ko");$page.find(".answer-container div").removeClass("filled").removeClass("respuesta_ok").removeClass("respuesta_ko");$("#"+this.prefijo+"pg").find(".sintaxis_adder select").removeAttr("disabled");$("#"+this.prefijo+"pg").find(".sintaxis_adder button").show();$page.find(".sintaxis_ejercicio div").removeClass("respuesta_ok").removeClass("respuesta_ko");$page.find(".sintaxis_ejercicio span").removeClass("respuesta_ok").removeClass("respuesta_ko");this.clearSlideComunFin()};Slide_syntax.prototype.evalNumElements=function(){this.numElementos=this.widget.numSol};$(function(){$(".sintaxis_adder_opciones select").on("change",function(){$(this).addClass("filled")})});function Slide_test(){}Slide_test.prototype=new Slide;Slide_test.prototype.esEjercicio=true;Slide_test.prototype.preventShuffling=true;Slide_test.prototype.onShow=function(){if(this.useExamples)this.showExample();Slide.prototype.onShow.call(this)};Slide_test.prototype.update=function(manual,corregir){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(corregir)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=""&&this.respuestas[i]!=undefined){var rarr=this.respuestas[i].split(",");for(var j=0;j<rarr.length;j++)$("[name="+this.prefijo+"v"+i+"][value="+rarr[j]+"]").attr("checked","checked");if(corregir){eval("var resp = Resp"+this.prefijo+"["+i+"]");this.resultados[i]=resp==sha1(this.respuestas[i])}if(this.resultados[i]){if(corregir)this.clasificacion++;this.setDisabled(this.prefijo+"v"+i)}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){$('[id^="'+this.prefijo+"l"+i+'_"]').removeClass("respuesta_ok respuesta_ko");$("#"+this.prefijo+"pregunta"+i+" .enunciado").removeClass("respuesta_ok respuesta_ko");$("[id^='"+this.prefijo+"feedback"+i+"']").removeClass("fb_right fb_wrong").addClass("fb_"+(this.resultados[i]?"right":"wrong"));var fbright=window["FbRight"+this.prefijo][i],fbwrong=window["FbWrong"+this.prefijo][i];$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.right-fb-dropdown").find(".bck-dropdown-content").html(fbright);$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.wrong-fb-dropdown").find(".bck-dropdown-content").html(fbwrong);if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_right")){$("[id^='"+this.prefijo+"wrongfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"rightfb"+i+"']").removeClass("hidden")}if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_wrong")){$("[id^='"+this.prefijo+"rightfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb"+i+"']").removeClass("hidden")}var $items=$();for(var j=0;j<rarr.length;j++){$items=$items.add($("#"+this.prefijo+"l"+i+"_"+rarr[j]))}$items.addClass("respuesta_"+(this.resultados[i]?"ok":"ko"))}}}if(corregir){var numt=this.respuestas.length;if(this.useExamples)numt--;if(numt>0)this.clasificacion=this.clasificacion/numt}$("[id^='"+this.prefijo+"feedback']").length&&createAudioButtons();Slide.prototype.update.call(this,manual,corregir)};Slide_test.prototype.evalNumElements=function(){this.numElementos=0;while(document.f.elements[this.prefijo+"v"+this.numElementos]){this.numElementos=this.numElementos+1}this.numElementosEvaluables=this.numElementos};Slide_test.prototype.shuffleOrder=function(e){var s=[],t=$("li[id^="+this.prefijo+"pregunta]"),o=this;if(!!e){var a=0;for(i=0;i<e.respuestas.length;i++){if(!!e.respuestas[i]){a++}}this.preventShuffling=!this.respuestasAleatorias||e.intentos>0||a>0}if(this.preventShuffling&&!!e&&!!e.ordenPrevio&&e.ordenPrevio.length==t.length){this.resp=this.ordenPrevio=e.ordenPrevio.slice(0)}else if(this.preventShuffling&&!!this.ordenPrevio&&this.ordenPrevio.length==t.length){this.resp=this.ordenPrevio.slice(0)}else{t.each(function(){var e=[],t=$(this).find(".test-option").length;for(var i=0;i<t;i++){e.push(i)}s.push(e)});if(this.preventShuffling==false){for(var r=0;r<s.length;r++){s[r]=Slide.prototype.shuffleArray(s[r])}}this.resp=this.ordenPrevio=s.slice(0)}if(!!this.respuestasAleatorias){t.each(function(t){var i=[];$(this).find(".test-option").each(function(){i.push($(this).html());$(this).html("")}).each(function(e){$(this).html(i[o.resp[t][e]])})})}};Slide_test.prototype.loadSuspendData=function(e){this.evalNumElements();if(this.respuestasAleatorias==1){this.preventShuffling=false}this.shuffleOrder(e);Slide.prototype.loadSuspendData.call(this,e)};Slide_test.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown){switchSolution(this.prefijo,true)}for(var t=this.firstElementIndex;t<this.numElementos;t++){this.respuestas[t]=dameRespuestaTest(this.prefijo+"v"+t)}}return Slide.prototype.getSuspendData.call(this)};Slide_test.prototype.correct=function(e,t){this.preventShuffling=true;for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=dameRespuestaTest(this.prefijo+"v"+i)}Slide.prototype.correct.call(this,e,t)};Slide_test.prototype.showSolution=function(){Slide.prototype.showSolution.call(this);if(checkMostrarSoluciones()){$("[id^='"+this.prefijo+"l'], .enunciado").removeClass("respuesta_ok respuesta_ko");Slide.prototype.showSolution.call(this)}};Slide_test.prototype.showElemSolution=function(i){$("[name^="+this.prefijo+"v"+i+"]").each(function(){$(this).removeAttr("checked")});var styleClass=this.useExamples&&this.exampleIndex==i?this.exampleStyleClass:this.solutionStyleClass;$("[id^='"+this.prefijo+"l"+i+"'], .enunciado").removeClass("respuesta_ok respuesta_ko");$("[id^='"+this.prefijo+"feedback"+i+"']").removeClass("fb_right fb_wrong");eval("var s = decode64(Sol"+this.prefijo+"["+i+"]);");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[id^='"+this.prefijo+"feedback"+i+"']").addClass("fb_solucion");var sols=s.split(",");for(var j=0;j<sols.length;j++){$("#"+this.prefijo+"l"+i+"_"+sols[j]).addClass(styleClass);$("[name="+this.prefijo+"v"+i+"][value="+sols[j]+"]").attr("checked",true)}this.setDisabled(this.prefijo+"v"+i)};Slide_test.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("[id^='"+this.prefijo+"l']").removeClass("respuesta_ok respuesta_ko "+this.solutionStyleClass);$("[name^="+this.prefijo+"v]").each(function(){$(this).removeAttr("checked")});$("[id^='"+this.prefijo+"feedback']").removeClass("fb_solucion");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");this.useExamples&&this.showExample();this.update(false,false)}};Slide_test.prototype.clearSlide=function(){this.clearSlideComunIni();this.preventShuffling=!!this.respuestasAleatorias?false:true;this.shuffleOrder();$("[name^="+this.prefijo+"v]").each(function(){$(this).removeAttr("checked")});$(".rbt").each(function(){$(this).parent(".rb-wrap").css("background-image","url(../../domains/wallstreet/themes/default/images/boton-off.png)")});$("[id^='"+this.prefijo+"rightfb']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[id^='"+this.prefijo+"feedback']").removeClass("fb_right fb_wrong");this.clearSlideComunFin()};function dameRespuestaTest(e){var t="";$("[name="+e+"]").each(function(){if(this.checked)t+=(t!=""?",":"")+this.value});return t}Slide_test.prototype.addOption=function(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".question"),o=i.find(".fbright"),a=i.find(".fbwrong"),r=i.find(".js-answer"),n=s.siblings('input[inputtype="question-input"]'),l=o.siblings('input[inputtype="fbright-input"]'),d=a.siblings('input[inputtype="fbwrong-input"]'),u=r.siblings(".js-richeditor-input"),c=i.find(".base_feedback");i.attr("name",e+"_exer_"+t);if(n.length>0){n.attr({placeholder:n.attr("placeholder")+" "+t});l.attr({placeholder:textweb("feedback_good_job")});d.attr({placeholder:textweb("feedback_try_again")});s.attr({name:s.attr("name")+t,id:s.attr("name")+t});o.attr({name:o.attr("name")+t,id:o.attr("name")+t});a.attr({name:a.attr("name")+t,id:a.attr("name")+t});c.attr({id:c.attr("id")+t});if($("#"+e+"_addFeedback").prop("checked")==true){c.removeClass("hidden")}else{c.addClass("hidden")}}else{s.attr({name:s.attr("name")+t,placeholder:s.attr("placeholder")+" "+t})}s.parent().siblings("label").attr("for",s.attr("name"));o.parent().siblings("label").attr("for",o.attr("name"));a.parent().siblings("label").attr("for",a.attr("name"));if(u.length>0){u.attr({placeholder:u.attr("placeholder")+" "+t});r.attr({name:r.attr("name")+t,id:r.attr("name")+t})}else{r.attr({name:r.attr("name")+t,placeholder:r.attr("placeholder")+" "+t})}r.removeClass("js-answer");r.addClass("js-query");r.parent().siblings("label").attr("for",r.attr("name"));$("#"+e+"pg").find(".js-form-questions").append(i);$("#"+e+"pg").find(".js-form-questions").append("<hr>")};$(function(){$(document).on("click",".slide-test .js-add-option",function(e){Slide_test.prototype.addOption($(this).closest(".slide-test").data("prefix"))})});function Slide_truefalse(){}Slide_truefalse.prototype=new Slide;Slide_truefalse.prototype.esEjercicio=true;Slide_truefalse.prototype.setMaxIntentos=function(e){this.numMaxIntentos=1};Slide_truefalse.prototype.onShow=function(){if(this.useExamples)this.showExample();$("[name^="+this.prefijo+"v]").change(function(){var e=$(this).attr("name");$("[id^="+e.replace("v","l")+"]").removeClass("respuesta_ko")});Slide.prototype.onShow.call(this)};Slide_truefalse.prototype.update=function(e,t){if(typeof this.useExamples!="undefined")this.firstElementIndex=this.useExamples?1:0;if(t)this.clasificacion=0;for(var i=this.firstElementIndex;i<this.numElementos;i++){if(this.respuestas[i]!=""&&this.respuestas[i]!=undefined){$("[name="+this.prefijo+"v"+i+"][value="+this.respuestas[i]+"]").attr("checked","checked");if(t){var s=window["Resp"+this.prefijo][i];this.resultados[i]=s==sha1(this.respuestas[i])}if(this.resultados[i]){if(t)this.clasificacion++;this.setDisabled(this.prefijo+"v"+i)}if(checkMostrarSoluciones()&&(this.intentos==this.numMaxIntentos||this.resultados[i]!=undefined)){$("#"+this.prefijo+"l"+i+this.respuestas[i]).removeClass("respuesta_ok respuesta_ko").addClass("respuesta_"+(this.resultados[i]?"ok":"ko"));$("[id^='"+this.prefijo+"feedback"+i+"']").removeClass("fb_right fb_wrong").addClass("fb_"+(this.resultados[i]?"right":"wrong"));var o=window["FbRight"+this.prefijo][i],a=window["FbWrong"+this.prefijo][i];$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.right-fb-dropdown").find(".bck-dropdown-content").html(o);$("[id^='"+this.prefijo+"feedback"+i+"']").find(".bck-dropdown.wrong-fb-dropdown").find(".bck-dropdown-content").html(a);if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_right")){$("[id^='"+this.prefijo+"wrongfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"rightfb"+i+"']").removeClass("hidden")}if($("[id^='"+this.prefijo+"feedback"+i+"']").hasClass("fb_wrong")){$("[id^='"+this.prefijo+"rightfb"+i+"']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb"+i+"']").removeClass("hidden")}}}}if(t){var r=this.respuestas.length;if(this.useExamples)r--;if(r>0)this.clasificacion=this.clasificacion/r}$("[id^='"+this.prefijo+"feedback']").length&&createAudioButtons();Slide.prototype.update.call(this,e,t)};Slide_truefalse.prototype.evalNumElements=function(){this.numElementos=0;this.numElementos=$("[id^='"+this.prefijo+"pregunta']").length;this.numElementosEvaluables=this.numElementos};Slide_truefalse.prototype.loadSuspendData=function(e){this.evalNumElements();Slide.prototype.loadSuspendData.call(this,e)};Slide_truefalse.prototype.getSuspendData=function(e){if(typeof e=="undefined")e=false;if(!e&&this.checkUpdateResponses()){if(this.solutionShown||this.solutionPartialShown){switchSolution(this.prefijo,true)}for(var t=this.firstElementIndex;t<this.numElementos;t++){this.respuestas[t]=dameRespuestaVF(this.prefijo+"v"+t)}}return Slide.prototype.getSuspendData.call(this)};Slide_truefalse.prototype.correct=function(e,t){for(var i=this.firstElementIndex;i<this.numElementos;i++){this.respuestas[i]=dameRespuestaVF(this.prefijo+"v"+i)}Slide.prototype.correct.call(this,e,t)};Slide_truefalse.prototype.showSolution=function(){if(checkMostrarSoluciones()||blink.getReqParam(location.href,"printServer")=="true"){$("[id^='"+this.prefijo+"l']").removeClass("respuesta_ok respuesta_ko");Slide.prototype.showSolution.call(this)}};Slide_truefalse.prototype.showElemSolution=function(i){var styleClass=this.useExamples&&this.exampleIndex==i?this.exampleStyleClass:this.solutionStyleClass;$("[id^='"+this.prefijo+"l"+i+"']").removeClass("respuesta_ok respuesta_ko");$("[id^='"+this.prefijo+"feedback"+i+"']").removeClass("fb_right fb_wrong");eval("var sol = decode64(Sol"+this.prefijo+"["+i+"]);");$("#"+this.prefijo+"l"+i+""+sol).addClass(styleClass);$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[id^='"+this.prefijo+"feedback"+i+"']").addClass("fb_solucion");$("[name="+this.prefijo+"v"+i+"][value="+sol+"]").attr("checked",true);this.setDisabled(this.prefijo+"v"+i)};Slide_truefalse.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){$("[id^='"+this.prefijo+"l']").removeClass("respuesta_ok respuesta_ko "+this.solutionStyleClass);$("[id^='"+this.prefijo+"feedback']").removeClass("fb_solucion");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[name^="+this.prefijo+"v]").each(function(){$(this).removeAttr("checked")});this.useExamples&&this.showExample();this.update(false,false)}};Slide_truefalse.prototype.clearSlide=function(){this.clearSlideComunIni();$("[name^="+this.prefijo+"v]").each(function(){$(this).removeAttr("checked")});$(".rbt").each(function(){var e=$(this).attr("name");$("input[name='"+e+"']").removeAttr("checked").parent(".rb-wrap").css("background-image","url(../../domains/wallstreet/themes/default/images/boton-off.png)")});$("[id^='"+this.prefijo+"rightfb']").addClass("hidden");$("[id^='"+this.prefijo+"wrongfb']").addClass("hidden");$("[id^='"+this.prefijo+"feedback']").removeClass("fb_right fb_wrong");this.clearSlideComunFin()};function dameRespuestaVF(e){var t="";$("[name="+e+"]").each(function(){if(this.checked)t=this.value});return t}function updateLabels(e){var t=$("input[name='"+e+"_trueLabel']").val();var i=$("input[name='"+e+"_falseLabel']").val();$("[name^='"+e+"_v']").each(function(){this.options[1].text=t;this.options[2].text=i})}function addOption(e){var t=$("#"+e+"pg").find(".js-exercise").length,i=$("#"+e+"pg").find(".js-add-new-row").clone().showBlink().removeClass("js-add-new-row"),s=i.find(".question"),o=i.find(".fbright"),a=i.find(".fbwrong"),r=i.find(".js-answer"),n=s.siblings('input[inputtype="question-input"]'),l=o.siblings('input[inputtype="fbright-input"]'),d=a.siblings('input[inputtype="fbwrong-input"]'),u=i.find(".base_feedback");i.attr("name",e+"_exer_"+t);if(n.length>0){n.attr({placeholder:n.attr("placeholder")+" "+t});l.attr({placeholder:textweb("feedback_good_job")});d.attr({placeholder:textweb("feedback_try_again")});s.attr({name:s.attr("name")+t,id:s.attr("name")+t});o.attr({name:o.attr("name")+t,id:o.attr("name")+t});a.attr({name:a.attr("name")+t,id:a.attr("name")+t});u.attr({id:u.attr("id")+t});if($("#"+e+"_addFeedback").prop("checked")==true){u.removeClass("hidden")}else{u.addClass("hidden")}}else{s.attr({name:s.attr("name")+t,placeholder:s.attr("placeholder")+" "+t})}r.attr("name",r.attr("name")+t);$("#"+e+"pg").find(".js-form-questions").append(i)}function Slide_video(){}Slide_video.prototype=new Slide;function Slide_wordsearch(){}Slide_wordsearch.prototype=new Slide;Slide_wordsearch.prototype.widget=null;Slide_wordsearch.prototype.numMaxIntentos=1;Slide_wordsearch.prototype.esEjercicio=true;Slide_wordsearch.prototype.esJuegoAutoevaluable=true;Slide_wordsearch.prototype.esAutocorregible=false;Slide_wordsearch.prototype.exampleStyleClass="ejemplo";Slide_wordsearch.prototype.onShow=function(){if(this.hasOwnProperty("widget")&&this.widget.model.isValid===false){this.setDisabled();var e,t;if(typeof window.modoEditar!=="undefined"&&window.modoEditar===1){e=textweb("error_generate_wordsearchgame");t=function(){blink.currentPage.enterEditMode()}}else{e=textweb("error_generate_activity");var i=parseInt(this.prefijo.split("t")[1]);if(typeof i!=="undefined"&&i+1<blink.activity.secuencia.length){t=function(){blink.activity.showSection(i+1)}}else{t=function(){redireccionar("/coursePlayer/curso2.php?idcurso="+window.idcurso,false,undefined)}}}showModalError(e,"",t)}else{if(this.useExamples)this.showExample();this.update(false,false,true)}};Slide_wordsearch.prototype.update=function(e,t,i){if(typeof i==="undefined")i=false;this.numMaxIntentos=1;if(this.widget==null){this.widget=$("#"+this.prefijo+"pool").data().blinkWordsearchwidget}this.widget.reloadOffset();if(t)this.clasificacion=0;var s=!!this.useExamples?1:0;if(!i)this.widget.update(this.respuestas||[]);if(t)this.resultados=true;if(this.resultados&&t&&!this.isExample)this.clasificacion=this.useExamples?this.respuestas.length-1:this.respuestas.length;if(checkMostrarSoluciones()&&this.intentos==this.numMaxIntentos&&this.resultados){this.setDisabled();this.refreshSolutionButton(e)}else{$("#"+this.prefijo+"_corregir .corregir").show()}if(t&&!this.isExample){var o=this.widget.getWordListLength();if(this.useExamples)o--;if(o>0)this.clasificacion=this.clasificacion/o;if(this.clasificacion===1){this.correct(e,t)}}Slide.prototype.update.call(this,e,t)};Slide_wordsearch.prototype.evalNumElements=function(){this.numElementos=eval("Sol"+this.prefijo+".length");this.numElementosEvaluables=this.numElementos};Slide_wordsearch.prototype.loadSuspendData=function(e){this.evalNumElements();this.numElementosEvaluables=this.numElementos;Slide.prototype.loadSuspendData.call(this,e)};Slide_wordsearch.prototype.getSuspendData=function(){return Slide.prototype.getSuspendData.call(this)};Slide_wordsearch.prototype.correct=function(e,t){var i=$("#"+this.prefijo+"pg"),s=i.find(".rf-wordcontainer").find("ul"),o=$("#"+this.prefijo+"pool .rf-selected");$(this.widget.model.wordList.words).each(function(e,t){if(!this.isFound){s.find("li:eq("+e+")").addClass("not-found")}else{s.find("li:eq("+e+")").addClass("found");o.addClass("right-word")}});Slide.prototype.correct.call(this,e,t);this.onShow()};Slide_wordsearch.prototype.showElemSolution=function(i){if(i===null){i=0}this.isExample=this.useExamples&&this.exampleIndex==i,solutions=eval("Sol"+this.prefijo),tmpSolutions=[];tmpSolutions.push(decode64(solutions[i]).toUpperCase());this.widget.update(tmpSolutions);if(this.isExample){exampleWord=this.widget.model.wordList.get(this.exampleIndex);if(this.respuestas.indexOf("BKEXAMPLE")===-1){this.addResponse("BKEXAMPLE")}var exampleStyleClass=this.exampleStyleClass;$(exampleWord.cellsUsed).each(function(){$(this.td).removeClass("rf-selected").addClass(exampleStyleClass)})}for(var i=0;i<this.widget.model.wordList.words.length;i++){this.widget.model.wordList.words[i].isFound=this.useExamples&&this.exampleIndex==i?true:false}if(!this.isExample){for(var k=1;k<=i+1;k++){var styleClass=this.useExamples&&this.exampleIndex==k?this.exampleStyleClass:this.solutionStyleClass;$("#"+this.prefijo+"pool .rf-selected").addClass(styleClass)}}};Slide_wordsearch.prototype.hideSolution=function(){Slide.prototype.hideSolution.call(this);if(checkMostrarSoluciones()){if($(".rf-wordcontainer").find("li").length==this.numElementos){$("#"+this.prefijo+"pool ."+this.solutionStyleClass).removeClass("rf-selected "+this.solutionStyleClass)}else{$("#"+this.prefijo+"pool .rf-selected.right-word").removeClass(this.solutionStyleClass)}this.update(false,false)}};Slide_wordsearch.prototype.addResponse=function(e){var i=$("#"+this.prefijo+"pool .rf-selected");$(this.widget.model.wordList.words).each(function(e,t){if(this.isFound){i.addClass("right-word")}});this.respuestas.push(e.toUpperCase());this.getSuspendData();this.update(true,true,true)};Slide_wordsearch.prototype.setDisabled=function(){this.widget.disable();$("#"+this.prefijo+"_corregir .corregir").hide();$("#"+this.prefijo+"_solution").show();$("#"+this.prefijo+"_bSolutionLabel").html(this.solutionShown?textweb("edit_slide_45"):textweb("edit_slide_44"))};Slide_wordsearch.prototype.clearSlide=function(){this.clearSlideComunIni();$page=$("#"+this.prefijo+"pg");$page.find(".rf-wordcontainer").find("li").removeClass("rf-foundword found not-found");$(".rf-tgrid").removeClass("right-word");if(this.widget){this.widget.hideSolutions();this.widget.clean()}for(var e=0;e<this.widget.model.wordList.words.length;e++){this.widget.model.wordList.words[e].isFound=false}this.widget.model.wordList.words;this.widget.enable();this.clearSlideComunFin()};Slide_wordsearch.prototype.showExample=function(){if(!this.useExamples)return;this.exampleIndex=0;this.showElemSolution(this.exampleIndex);this.idsol=this.exampleIndex+1;if(this.isExample)this.numElementos++;this.isExample=false};