(function(B){"use strict";B.theme=B.theme||{};var theme=B.theme;theme.iframeWidth=1100;theme.maxAnnotLength=190;theme.isAdaptative=function(){return true};theme.useIndependentEraser=true;theme.showSection=function(e,t){stopSlideEffects(e);var i=parseInt(e);if(t){blink.events.on("style:loaded",function(){blink.activity.showSection(i);blink.theme.audio.restartNativePlayers()})}else{blink.activity.showSection(i)}};theme.showNextSection=function(){blink.activity.showNextSection()};theme.showPrevSection=function(){blink.activity.showPrevSection()};theme.showGradeOnCorrect=function(){return false};theme.types={2:{cl:"video",bg:"video"},3:{cl:"musica",bg:"musica"},5:{cl:"archivo",bg:"archivo"},6:{cl:"actividad",bg:"actividad"},7:{cl:"url",bg:"url"},8:{cl:"img",bg:"img"}};theme.getTypes=function(){return blink.specialicons?$.extend(this.types,blink.specialicons):this.types};theme.fixResourceType=function(e,t){if(t=="default"||t=="-1"||!t||!this.types[t]){if(!this.types[e]){return"5"}else{return e}}else{return parseInt(t)}};theme.updateWindowSizes=function(){blink.window=$(window);blink.windowWidth=blink.window.width();blink.windowHeight=blink.window.height()};theme.toggleMainNav=function(e){var t=$("#main-nav"),i=$(".content-wrapper");if(e===undefined){mainNavOpen=!mainNavOpen}else{mainNavOpen=!!e}t.toggleClass("open",mainNavOpen);if(!MobileEsp.isAndroidPhone&&!blink.isIphone)setCookie("mainNavOpen",mainNavOpen?1:0);if(blink.windowWidth>767){i.css({top:mainNavOpen?144:64});blink.theme.centrarTools()}theme.setMainContainerDimensionForDefaultHeader();blink.events.trigger("mainNav:toggled")};theme.setMainContainerDimensionForDefaultHeader=function(){if($("#mensajes").length)return;var e=$(".footer").outerHeight(true),t=$(".navbar").outerHeight(true),i=$(".content-main-tabs").outerHeight(true),a=e+t+i,n=blink.windowHeight-a-(mainNavOpen&&blink.windowWidth>767?80:0),o=$(".content-box");if(offline)n-=49;o.css({"min-height":n})};theme.getWaitingHTML=function(){if($("#spinner")&&$("#spinner").get(0)){return $("#spinner").clone().showBlink().addClass("ias").attr("id","responseimg").get(0).outerHTML}return""};theme.setBackgroundImage=function(e,t){$("#"+t+"pg").css({backgroundImage:"url("+encodeURI(e)+")",backgroundRepeat:"no-repeat"})};theme.setWaitingAjax=function(e){$(e).html(theme.getWaitingHTML()).parent("button").addClass("disabled waiting")};theme.clearWaitingAjax=function(e){$(e).html("").parent("button").removeClass("disabled waiting")};theme.hidePopupColores=function(){$(".navbar.libro .libro-right span:not(:first):not(:last)").not(this).popover("hide")};theme.showPopupColores=function(e){$("#"+e).popover("show")};theme.selectPizarraColor=function(e,t){try{var i=new URLSearchParams(window.location.search);var a=i.has("_fromUX")}catch(e){var a=window.location.search.indexOf("_fromUX")>=0}if(a){this.updateWindowSizes()}if(typeof window.MIN_CANVAS_SIZE==="undefined"||blink.windowWidth<window.MIN_CANVAS_SIZE)return;if(!puedeUsarHerramienta(false,t))return;if(esInfantil){hideLupa();if(miniaturasInfantil)mostrarMiniaturasInfantil()}if(window.pizarraOff||t!=herramientaPizarra){t==blink.tools.ERASER&&(blink.popovers&&blink.popovers.hideAll());window.setPizarraOn(false,t)}else{window.setPizarraOff(false)}};theme.writePlayerFacade=function(e,t,i){switch(i.type){case"image":writeImgPlayer(e,t,"",i.center,i.imgAlt);break;case"doc":writeDocPlayer(e,t,i.edit);break;case"flash":writeFlashPlayer(e,t);break;case"video":writeVideoPlayer(e,t,i.flash,"100%",0,0,i.idVideo,i.imgPortadaVideo,i.videoMarkers);break;case"sound":writeVideoPlayer(e,t,i.flash,0,0,0,i.imgAlt);break;case"geogebra":writeGeogebraPlayer(e,t);break;default:writeOtherPlayer(e,t);break}blink.events.trigger("write-player-"+e,i.type,e)};theme.finSeleccionarVideo=function(n,e){var o=n;if(idAppSeleccionarMultimedia==""||idAppSeleccionarMultimedia==undefined||nameAppSeleccionarMultimedia==""||nameAppSeleccionarMultimedia==undefined){nameAppSeleccionarMultimedia="slide";idAppSeleccionarMultimedia=idtransact}if(e){n=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")n+="/ctx/a/"+window.idclase;n+="/r/"+nameAppSeleccionarMultimedia.substr(0,1)+"/"+idAppSeleccionarMultimedia+"/"+e}else{getAJAX("/LMS/ajax.php?op=files.getfilemultimedia&filename="+encodeURIComponent(n)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia+"&editar=1",function(e){if(e.startsWith("OK")&&e.length>2){var t="NEWURLS";if(e.indexOf(t)!=-1){var i=e.substr(e.indexOf(t)+t.length);var a=i.indexOf("|");n=i.substr(0,a);if(nameAppSeleccionarMultimedia=="slide"&&n.startsWith(MEDIA_URL)&&!n.startsWith(BLINKDB_URL))n=MEDIA_URL+"/ctx/a/"+window.idclase+n.substr(MEDIA_URL.length);o=i.substr(a+1)}}else{}},false,undefined,undefined,true)}var t=n.substring(n.lastIndexOf("/")+1);var i=CKEDITOR.instances[editorNameMultimedia];var a=t;var s=this.getVideoMarkUp(n,a);if(CKEDITOR.env.ie){var r=i.getData();i.setData(r+s)}else{i.insertHtml(s)}this.addVideoSubtitlesButton($(s).find(".bck-subtitles").attr("id"));marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));closeMsgBox()};theme.finSeleccionarVideo2=function(n,e){var o=n;if(idAppSeleccionarMultimedia==""||idAppSeleccionarMultimedia==undefined||nameAppSeleccionarMultimedia==""||nameAppSeleccionarMultimedia==undefined){nameAppSeleccionarMultimedia="slide";idAppSeleccionarMultimedia=idtransact}if(e){n=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")n+="/ctx/a/"+window.idclase;n+="/r/"+nameAppSeleccionarMultimedia.substr(0,1)+"/"+idAppSeleccionarMultimedia+"/"+e}else{getAJAX("/LMS/ajax.php?op=files.getfilemultimedia&filename="+encodeURIComponent(n)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia+"&editar=1",function(e){if(e.startsWith("OK")&&e.length>2){var t="NEWURLS";if(e.indexOf(t)!=-1){var i=e.substr(e.indexOf(t)+t.length);var a=i.indexOf("|");n=i.substr(0,a);if(nameAppSeleccionarMultimedia=="slide"&&n.startsWith(MEDIA_URL)&&!n.startsWith(BLINKDB_URL))n=MEDIA_URL+"/ctx/a/"+window.idclase+n.substr(MEDIA_URL.length);o=i.substr(a+1)}}else{}},false,undefined,undefined,true)}var t=CKEDITOR.instances[editorNameMultimedia];var i=t.getSelection();var a=i.getRanges();var s=i.getSelectedElement().findOne(".bck-video-container2");if(!!n&&isOnlineServiceUrlVideo(n)){var r=s.findOne(".bck-video-controls");r.findOne(".bck-video-add-srt").addClass("hidden")}var l=n.substring(n.lastIndexOf("/")+1);var d=s.findOne(".class_video");var c=s.findOne(".bck-video-player");var u=s.getAscendant(function(e){return e.hasClass("cke_contents")});var f=u.find(".bck-video-container2").count();var h=u.find(".bck-video-player");if($("#"+prefijoSeleccionMultimedia+"_bck_video_"+editorNameMultimedia+"_"+f).length>0){var p=[];for(var m=0;m<h.$.length;m++){var v=h.$[m];var g=v.getAttribute("id");if(g){var b=g.split("_");var k=b.length&&b[b.length-1]?b[b.length-1].length:1;var w=parseInt(g.substring(g.length-k,g.length)),_=typeof w=="number";_&&p.push(w)}}if(p.length>0){var y=Math.max.apply(null,p)+1;s.setAttribute("id",prefijoSeleccionMultimedia+"_bck_video_"+editorNameMultimedia+"_"+y);c.setAttribute("id",prefijoSeleccionMultimedia+"_bck_video_player_"+editorNameMultimedia+"_"+y)}}else{s.setAttribute("id",prefijoSeleccionMultimedia+"_bck_video_"+editorNameMultimedia+"_"+f);c.setAttribute("id",prefijoSeleccionMultimedia+"_bck_video_player_"+editorNameMultimedia+"_"+f)}var C=l.replace(/\W/g,"_")+"_"+(new Date).valueOf();d.setAttribute("id",C);d.setAttribute("alt",n);t.updateElement();marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));closeMsgBox()};theme.videoPlayerIndex=0;theme.addVideoSubtitlesButton=function(e){if(!e)var t=".bck-subtitles";else var t='[id="'+e+'"]';$(document).on("click",t,function(e){if($(e.target).hasClass("bck-file-label"))return;CKEDITOR.instances[CKEDITOR.currentInstance.name].execCommand("blink_file");e.stopImmediatePropagation()})};theme.getVideoMarkUp=function(e,t){var i="",t=t&&t.toString().replace(".","_");if(blink.courseInfo.isInPublisherDomain){i=""+"<div class='bck-video-edit-title'>"+textweb("video_subtitles")+"</div>"+"<div  id='"+t+"_subtitles' class='bck-subtitles'>"+"<br>&nbsp"+"</div>"}return"<div class='bck-video-container'>"+"<img class='class_video player video bck-v-inline' id='"+t+"' alt='"+e+"' src=''>"+"<div id='"+t+"_inline_preview' class='bck-video-preview'>cargando video...</div>"+i+"</div>"};theme.video={player:[]};theme.video.isEmbedded=function(){var e=blink.theme.styles[blink.activity.originalStyleName],t=e?new e:new blink.theme.styles["basic"];return t&&t.isEmbeddedVideo()};theme.video.videojs=function(t,e,i){if(!e){return videojs(t)}var a={controlBar:{volumeMenuButton:{inline:false,vertical:true}}},e=_.extend({},e,a);this.player[t]=videojs(t,e);this.player[t].metadataLoaded=false;this.player[t].on("loadedmetadata",function(){this.metadataLoaded=true});_.each(i,function(e){this.player[t].addRemoteTextTrack(e)}.bind(this));return this.setVideoJSPlayer(this.player[t])};theme.video.setVideoJSPlayer=function(e){var t=e.controlBar,i=t.getChild("durationDisplay"),a=t.getChild("fullscreenToggle"),n=t.getChild("volumeMenuButton"),o=t.getChild("remainingTimeDisplay");t.addChild(i);t.addChild(n);t.removeChild(o);this.setFullscreenButton(a);this.setFullscreenToggle(a);this.setTranscriptButton(t);return e};theme.video.reassignMarkup=function(e){if(e.closest(".bck-video-container").length>0){var t=$(e).attr("id").replace(".","_"),i=$(e).closest(".bck-video-container"),a=$(e).closest(".bck-video-container2"),n=i.find(".class_video").first(),o=i.find(".jwplayer").first(),s=o.attr("id")||"video_"+$.now(),r=n.hasClass("bck-v-inline")?" bck-v-inline":"";if(a.length>0){i.after(a);i.remove()}else{$(e).attr("id",t);i.addClass("bck-video-container2"+r).removeClass("bck-video-container").attr("id",s).css("width",o.css("width")).children('div[id*="_preview"], .bck-video-edit-title, .jwplayer').remove();n.removeClass("bck-v-inline").wrap('<div class="bck-video-player" id="'+s+'"></div>');i.append('<div class="bck-video-controls">'+'<button class="bck-video-add-srt btn btn-primary" contenteditable="false"></button>'+'<button class="bck-video-add-portada btn" contenteditable="false"></button>'+'<button class="bck-video-preview btn" contenteditable="false"></button>'+"</div>")}}return true};theme.video.activateCaptionsbyDefault=function(){return blink.activity.currentStyle.activateCaptionsbyDefault()};theme.video.launchVideoJS=function(r){var e=r.find(".bck-video-player"),l=r.find(".bck-video-srt"),t=e.find("img.player.video"),n=e.attr("id")+"_player",i=t.attr("alt"),a=getExt(i),o=[],s=e.attr("data-video-poster"),d=e.attr("data-video-markers");r.toggleClass("external-url-player",isOnlineServiceUrlVideo(i));if(!e.find("video-js").length){var c=this.getMarkUp(n,i,e);e.append($(c));l.each(function(e,t){var i=$(t),a={kind:i.data("srt-kind"),label:i.data("srt-label"),src:i.data("srt-file"),id:n+"_track_"+e};if(theme.video.activateCaptionsbyDefault()){a["mode"]="showing"}o.push(a)}.bind(this))}var u=this.videojs(n,{autoplay:false,poster:s,html5:{nativeCaptions:false,nativeTextTracks:false,markers:d}},o);u.on("ready",function(){if(this.cache_&&this.cache_.src&&isVimeoUrl(this.cache_.src)){var e="https://vimeo.com/api/oembed.json?url="+encodeURIComponent(this.cache_.src);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===2){if(n.status!=200){var e="<b>Error "+this.techName_+"</b>: "+textweb("error_video_privacy");var t=$(this.el_.parentElement),i=$(document.createElement("div")).addClass("no-connection-video"),a='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>'+"<span>"+e+"</span>";t.append(i.append($(a)))}}}.bind(this);n.open("HEAD",e);n.send()}if(!l.length||editar){return}var t=blink.theme.video,i=l.data("srt-file"),a=i.indexOf("transcript")!==-1;if(theme.video.activateCaptionsbyDefault()&&typeof u.controlBar!=="undefined"&&u.controlBar){var o=u.controlBar,s=o.getChild("captionsButton");s.addClass("on")}t.setCaptionsButton(this);t.shouldUseTranscript()&&t.transcript.init(this,r,a)}).on("play",function(){this.restartPlayers(u);this.startPlayerManually(u);this.playing=u.id();if(a==="mov"&&blink.isFirefox){this.player[this.playing].pause();this.player[this.playing].reset();showModalError(textweb("error_format_mov"),"",function(){cerrarIframe()})}theme.audio.playing=undefined}.bind(this)).on("ended",function(){this.restartPlayer(u)}.bind(this)).on("error",function(e){var t=$(this.el_.parentElement),i=$(document.createElement("div")).addClass("no-connection-video"),a='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>'+"<span><b>Error"+(this.techName_?" "+this.techName_:"")+"</b>: "+(this.error_&&this.error_.code?this.error_.code===4?textweb("upload_error_8"):this.error_.code:textweb("error_video_privacy"))+"</span>";t.append(i.append($(a)))}).on("texttrackchange",function(){if(!blink.isFirefox){return false}var e=u.controlBar.getChild("captionsButton"),t=e.items;if(t[0].hasClass("vjs-texttrack-settings")){t.splice(0,1);e.off();this.setCaptionsButton(e)}}.bind(this));theme.stopPropagationOnTouchstartButtons(u)};theme.video.getMarkUp=function(e,t,i){var a=getExt(t),n=a==="flv",o=n?"x-flv":"mp4",s={sources:[{type:"video/"+o+"",src:t}]};if(isYoutubeUrl(t)){this.checkConnection(e,i);s={sources:[{type:"video/youtube",src:getOriginalYoutubeUrl(t)}]};s.techOrder=["youtube"];s.youtube={iv_load_policy:1}}else if(isVimeoUrl(t)){this.checkConnection(e,i);s={sources:[{type:"video/vimeo",src:t}]};s.techOrder=["vimeo"];s.vimeo={iv_load_policy:1}}return"<video "+"id='"+e+"' "+"class='video-js vjs-default-skin video' "+"controls "+"data-setup= '"+JSON.stringify(s)+"'"+">"+"</video>"};theme.video.checkConnection=function(n,o){var e=blink.isOfflinePC||blink.isApp;e&&blink.rest.connection(function(e){if(!parseInt(e)){var t=o||$("#"+n).parent(),i=$(document.createElement("div")).addClass("no-connection-video"),a='<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>'+"<span>"+textweb("help_conection_error")+"</span>";t.append(i.append($(a)))}})};theme.video.setFullscreenButton=function(e){var t=e.player(),i=t.currentSrc(),a=isYoutubeUrl(i)&&blink.isIos?"remove":"add";t.controlBar[a+"Child"](e)};theme.video.setFullscreenToggle=function(e){return false};theme.video.setCaptionsButton=function(e){if(typeof e.controlBar!=="undefined"&&e.controlBar){var t=e.controlBar,i=t.getChild("captionsButton");var a=i.items.length;for(var n=0;n<a;n++){if(i.items[n].controlText_.indexOf("settings")>0){a--}}if(a>2){return false}var o=i.menu.children(),s=o[o.length-2],r=o[o.length-1],l=$(i.el());l.addClass("single-caption");i.on("click",function(){var e=r.hasClass("vjs-selected");l.toggleClass("on",!e);e?s.handleClick():r.handleClick()});i.on("touchstart",function(){var e=r.hasClass("vjs-selected");l.toggleClass("on",!e);e?s.handleClick():r.handleClick()})}};theme.video.setTranscriptButton=function(e){this.shouldUseTranscript()&&this.transcript.setButton(e)};theme.video.shouldUseTranscript=function(){var e=blink.courseInfo&&blink.courseInfo.shouldUseTranscript,t=blink.theme.styles[blink.activity.originalStyleName],i=blink.theme.styles["basic"],a=t?new t:new i;return e&&a.shouldUseTranscript()&&!editar};theme.video.startPlayerManually=function(e){e&&e.addClass("vjs-has-started")};theme.video.restartPlayer=function(e){e&&e.hasStarted()&&!e.paused()&&e.pause().currentTime(0).removeClass("vjs-has-started")};theme.video.restartPlayers=function(i){var e=videojs.getPlayers();_.each(e,function(e,t){if(!e){return false}else if(!e.isAudio()){(!i||i.id())!==t&&this.playing==t&&this.restartPlayer(e)}else{theme.audio.playing==t&&theme.audio.restartPlayer(e);$(".vjs-close").length&&$(".vjs-close").click()}}.bind(this))};theme.video.generalRecreateVideoJS=function(e){var t=/youtube|vimeo/i;var i=videojs.players[e];if(i!==null){if(i.currentType().toLowerCase().search(t)>-1){var a=$("#"+i.id());var n=a.parent().find(".class_video");if(n.length===0){var o=i.currentSrc();var s=e.substr(0,e.indexOf("_"));var r=i.id().split("-player")[0]}blink.theme.removeVideoJS(a.parent().parent(),false);if(n.length>0){$(writeVideoPlayerButton(n,true)).insertBefore(n)}else{writeVideoPlayer(s,o,false,"100%",0,0,r)}}}};theme.video.recreateVideoJS=function(e){var t=0;var i=this;if(!editar){if(typeof e!=="undefined"&&e!==null){var a=Object.keys(videojs.players);if(a.length>0){for(var n=0;n<e.length;n++){t=e[n];a.filter(function(e){if(e.indexOf("t"+t+"_")===0){i.generalRecreateVideoJS(e)}else if(typeof i.playing!=="undefined"&&i.playing==e){i.generalRecreateVideoJS(i.playing)}})}}}}else{var a=Object.keys(videojs.players);if(a.length>0){a.filter(function(e){if(e.indexOf("t"+blink.activity.currentSection+"_")===0){i.generalRecreateVideoJS(e)}else if(typeof i.playing!=="undefined"&&i.playing==e){i.generalRecreateVideoJS(i.playing)}})}}};theme.video.setPoster=function(n,o){$("#"+n+"_imagen_portada_video").val(o);var e=videojs.players;_.each(e,function(e){var t="#"+e.id(),i=n+"_multimedia";if($(t).parent().attr("id")==i){var a=blink.theme.video.videojs(t);a.poster(o)}})};theme.video.removeChild=function(e,t){if(!e||!t){return false}e.removeChild(t)};theme.setSlideBackImg=function(e){var t="t"+blink.activity.currentSection;$("#"+t+"_imagen_back_slide").val(e)};theme.fixOldInlineVideos=function(e,t,i){var a=$("<div></div>"),n=e.find(".class_video").find("img"),o=e.find(".bck-subtitles"),s=t,r="img"+s,l=$("<img/>");e.removeClass("bck-video-container");e.addClass("bck-video-container2");e.addClass("bck-v-inline");e.html("");e.attr("id",s);a.addClass("bck-video-player");a.attr("id",s);a.appendTo(e);l.addClass("class_video");l.addClass("player");l.addClass("video");l.attr("id",r);l.attr("alt",i);l.attr("data-cke-saved-src","");l.appendTo(a);o.removeClass("hidden");o.removeAttr("id");o.appendTo(e);var d=$("<div></div>"),c=$("<button></button>"),u=$("<button></button>"),f=$("<button></button>");c.addClass("bck-video-add-srt");c.addClass("btn");c.addClass("btn-primary");c.appendTo(d);c.attr("contenteditable","false");u.addClass("btn");u.addClass("bck-video-preview");u.appendTo(d);u.attr("contenteditable","false");f.addClass("btn");f.addClass("bck-view-transcript");f.addClass("hidden");f.appendTo(d);f.attr("contenteditable","false");d.addClass("bck-video-controls");d.appendTo(e)};theme.finSeleccionarSonido=function(e,t,i,a){t=preprocess_server_data_swf_upload(t);var n="ERROR";var o=false};theme.getAudioDims=function(e){return e};theme.finSeleccionarSonido=function(n,e){var o=n;if(idAppSeleccionarMultimedia==""||idAppSeleccionarMultimedia==undefined||nameAppSeleccionarMultimedia==""||nameAppSeleccionarMultimedia==undefined){nameAppSeleccionarMultimedia="slide";idAppSeleccionarMultimedia=idtransact}if(e){n=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")n+="/ctx/a/"+window.idclase;n+="/r/"+nameAppSeleccionarMultimedia.substr(0,1)+"/"+idAppSeleccionarMultimedia+"/"+e}else{getAJAX("/LMS/ajax.php?op=files.getfilemultimedia&filename="+encodeURIComponent(n)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia+"&editar=1",function(e){if(e.startsWith("OK")&&e.length>2){var t="NEWURLS";if(e.indexOf(t)!=-1){var i=e.substr(e.indexOf(t)+t.length);var a=i.indexOf("|");n=i.substr(0,a);if(nameAppSeleccionarMultimedia=="slide"&&n.startsWith(MEDIA_URL)&&!n.startsWith(BLINKDB_URL))n=MEDIA_URL+"/ctx/a/"+window.idclase+n.substr(MEDIA_URL.length);o=i.substr(a+1)}}else{}},false,undefined,undefined,true)}var t=n.substring(n.lastIndexOf("/")+1);var i=t+"_"+(new Date).valueOf();var a=CKEDITOR.instances[editorNameMultimedia];if(!theme.audio.isEmbedded()){var s=t,r=this.getSoundMarkUp(n,s);CKEDITOR.env.ie?a.setData(a.getData()+r):a.insertHtml(r);marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));return closeMsgBox()}var l=a.getSelection();var d=l.getRanges();var c=l.getSelectedElement().findOne(".bck-audio-container");var u=c.findOne(".class_sonido");var f=c.findOne(".bck-audio-player");var h=c.getAscendant(function(e){return e.hasClass("cke_contents")});var p=h.find(".bck-audio-container").count();var m=h.find(".bck-audio-player");var v=prefijoSeleccionMultimedia+"_bck_audio_"+editorNameMultimedia;if($("#"+v+"_"+p).length){var g=[];for(var b=0;b<m.$.length;b++){var k=m.$[b];var w=k.getAttribute("id");if(w){var _=parseInt(w.substring(w.length-1,w.length));if(typeof _=="number")g.push(_)}}if(g.length){var y=Math.max.apply(null,g)+1;c.setAttribute("id",v+"_"+y);f.setAttribute("id",v+"_"+y)}}else{c.setAttribute("id",v+"_"+p);f.setAttribute("id",v+"_"+p)}u.setAttribute("id",i);u.setAttribute("alt",n);a.updateElement();marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));closeMsgBox()};theme.audio={player:[]};theme.audio.videojs=function(e,t){this.player[e]=videojs(e,{autoplay:t,inactivityTimeout:0});return this.setVideoJSPlayer(this.player[e])};theme.audio.setVideoJSPlayer=function(e){var t=e.getChild("bigPlayButton"),i=e.controlBar,a=["volumeMenuButton","fullscreenToggle","remainingTimeDisplay"];e.removeChild(t);_.each(a,function(e){var e=i.getChild(e);i.removeChild(e)});var n=i.getChild("durationDisplay");i.addChild(n);i.addChild("button",{text:"Close"}).addClass("vjs-close").addClass("blink-btn").on("click",function(){e.pause().currentTime(0);cerrarIframe();blink.tools.manager.disableTools();$("#iframe_div").find(".btn-close-iframe").showBlink()});if(!blink.isApp&&blink.isChrome){$("body").prepend('<div class="close-audio-aux"></div>');var o=$(".close-audio-aux");o.css("width","40px");o.css("height","40px");o.css("position","fixed");o.css("z-index","100000");o.on("click",function(){$(".vjs-close").click();o.remove()});setTimeout(function(){o.css("left",$(".vjs-close").offset().left);o.css("top",$(".vjs-close").offset().top)},300)}$("#iframe_div").find(".btn-close-iframe").hideBlink();blink.events.on("showSlide:after",function(){this.startPlayerManually(e)}.bind(this));return e};theme.audio.launchVideoJS=function(e,t,i){var a=i&&i.parents(".bck-audio-player");if(!a.length){return false}if(!a.find(".video-js").length){var e=e.replace(/\W/g,"_"),n=""+'<audio id="'+e+'" class="video-js vjs-default-skin audio" controls>'+'<source src="'+t+'" type="audio/mp3"/>'+"</audio>";a.append($(n));i.remove()}var o=this.videojs(e,false);o.on("play",function(){this.restartPlayers(o);this.playing=o.id();theme.video.playing=undefined}.bind(this)).on("ended",function(){this.restartPlayer(o)}.bind(this)).on("ready",function(){var e=this;setTimeout(function(){e.hasStarted(true)},10)});theme.stopPropagationOnTouchstartButtons(o)};theme.audio.isEmbedded=function(){var e=blink.theme.styles[blink.activity.originalStyleName],t=e?new e:new blink.theme.styles["basic"];return t&&t.isEmbeddedAudio()};theme.audio.startPlayerManually=function(e){e&&e.addClass("vjs-has-started")};theme.audio.restartPlayer=function(e){e&&e.pause().currentTime(0)};theme.audio.restartPlayers=function(i){var e=videojs.getPlayers();_.each(e,function(e,t){if(!e){return false}else if(e.isAudio()){(!i||i.id())!==t&&this.playing==t&&this.restartPlayer(e)}else{theme.video.playing==t&&theme.video.restartPlayer(e)}}.bind(this));if(blink.isApp){blink.rest.closeAudio()}};theme.audio.restartNativePlayers=function(){if(blink.isApp){$("audio").on("play",function(){blink.rest.closeAudio()})}};theme.stopPropagationOnTouchstartButtons=function(e){e&&_.each(e.controlBar.children_,function(e){$(e.el_).on("touchstart",function(e){var t=$(this).hasClass("blink-btn");!t&&e.stopPropagation()});if(blink.isIos){e.off(["touchend"])}})};theme.destroyVideoJS=function(e){try{var t=!!e&&videojs(e);if(!t.paused())t.pause();!!t&&t.dispose()}catch(e){}};theme.removeVideoJS=function(e,t){var i=e.find(".video-js"),a=i.attr("id");!!a&&theme.destroyVideoJS(a);!t&&i.remove()};theme.getSoundMarkUp=function(e,t){return"<img class='class_sonido player audio' id='"+t+"' alt='"+e+"' src=''>"};theme.finSeleccionarArchivo=function(n,e){var t=$(".js-adding-sub");var o=n;if(idAppSeleccionarMultimedia==""||idAppSeleccionarMultimedia==undefined||nameAppSeleccionarMultimedia==""||nameAppSeleccionarMultimedia==undefined){nameAppSeleccionarMultimedia="slide";idAppSeleccionarMultimedia=idtransact}if(!!n["files"]){idAppSeleccionarMultimedia=idtransact=n.files!==undefined?idclase:"";n=n.files!==undefined?n.files[0]:n;e=n.ruta;o=n;nameAppSeleccionarMultimedia="activity"}if(e){n=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")n+="/ctx/a/"+window.idclase;n+="/r/"+nameAppSeleccionarMultimedia.substr(0,1)+"/"+idAppSeleccionarMultimedia+"/"+e}else{getAJAX("/LMS/ajax.php?op=files.getfilemultimedia&filename="+encodeURIComponent(n)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia+"&editar=1",function(e){if(e.startsWith("OK")&&e.length>2){var t="NEWURLS";if(e.indexOf(t)!=-1){var i=e.substr(e.indexOf(t)+t.length);var a=i.indexOf("|");n=i.substr(0,a);o=i.substr(a+1)}}else{}},false,undefined,undefined,true)}var i=n.substring(n.lastIndexOf("/")+1);var a=CKEDITOR.instances[editorNameMultimedia];var s=i;var r=this.getFileMarkUp(n,s,t&&t.length==1);if(CKEDITOR.env.ie){var l=a.getData();a.setData(l+r)}else{a.insertHtml(r)}if(t&&t.length==1){t.removeClass("js-adding-sub");var d=t.find(".class_video").data("srt");var c=s.replace(/\W+/g,"");if(!d)d=[];var u={file:n,label:c,kind:"captions",default:d.length>0?false:true};d.push(u);t.find(".class_video").attr("data-srt",JSON.stringify(d)).end().find(".bck-subtitles").append('<span class="bck-sub-label" id="sub_label_'+c+'">&nbsp'+c+"</span>&nbsp").end()}marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));closeMsgBox()};theme.getFileMarkUp=function(e,t){var i=t.replace(/\W+/g,"");return""+'<a id="file_'+t+'" href="'+e+'" onclick="blink.rest.openUrl(\'viewer\', this.href);return false;" target="_blank" class="bck-file-attach">'+'<img src="../themes/responsive/images/contenido/recurso-icon-archivo-add.png"/>'+'<span class="bck-file-label" id="file_label_'+i+'">&nbsp'+i+"</span>&nbsp"+"</a>"};theme.finSeleccionarImagenEditor=function(n,e){var o=n;if(idAppSeleccionarMultimedia==""||idAppSeleccionarMultimedia==undefined||nameAppSeleccionarMultimedia==""||nameAppSeleccionarMultimedia==undefined){nameAppSeleccionarMultimedia="slide";idAppSeleccionarMultimedia=idtransact}if(e){n=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")n+="/ctx/a/"+window.idclase;n+="/r/"+nameAppSeleccionarMultimedia.substr(0,1)+"/"+idAppSeleccionarMultimedia+"/"+e}else{var t="";if(nameAppSeleccionarMultimedia=="message_body"){nameAppSeleccionarMultimedia="message";idAppSeleccionarMultimedia=999999999;t="tmp_messagebody"}var i="/LMS/ajax.php?op=files.getfilemultimedia&filename="+encodeURIComponent(n)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia;if(t.length>0)i+="&use_type="+t;getAJAX(i,function(e){if(e.startsWith("OK")&&e.length>2){var t="NEWURLS";if(e.indexOf(t)!=-1){var i=e.substr(e.indexOf(t)+t.length);var a=i.indexOf("|");n=i.substr(0,a);if(nameAppSeleccionarMultimedia=="slide"&&n.startsWith(MEDIA_URL)&&!n.startsWith(BLINKDB_URL))n=MEDIA_URL+"/ctx/a/"+window.idclase+n.substr(MEDIA_URL.length);o=i.substr(a+1)}}else{}},false,undefined,undefined,true)}var a=n.substring(n.lastIndexOf("/")+1);var s=CKEDITOR.instances[editorNameMultimedia];var r=getImageMarkUp(n);theme.insertarImagenEditor(r,s)};theme.insertarImagenEditor=function(a,n){var o=$(a);o.load(function(e){o.addClass("bck-i-fullscreen");if(!n.defaultInsertedImagesNoFullscreen&&(this.width>100&&this.height>100)){o.addClass("bck-i-fullscreen-enabled")}else{o.addClass("bck-i-fullscreen-disabled")}var t=o.prop("outerHTML");if(CKEDITOR.env.ie){var i=n.getData();n.setData(i+" "+a)}else{n.insertHtml(o.prop("outerHTML"))}marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));closeMsgBox()})};theme.insertarImagenPortada=function(e,t){e.attr("data-video-poster",t);e.removeAttr("data-edit-poster",false)};theme.insertarArchivoMultimediaSlides=function(f,e,t){var i=f;var a;var h;var p=this;if(!!f["files"]){i=f=f["files"][0];e=f.ruta;h=t}else{h=prefijoTextBox}if(!nameAppSeleccionarMultimedia){nameAppSeleccionarMultimedia="activity";idAppSeleccionarMultimedia=idclase}if(e){f=MEDIA_URL;if(nameAppSeleccionarMultimedia=="slide")f+="/ctx/a/"+window.idclase;f+="/r/a/"+idAppSeleccionarMultimedia+"/"+e}blink.ajax("/LMS/ajax.php?op=files.getfilemultimedia",function(e){if(!e.startsWith("OK")||e.length<=2){return}var t=JSON.parse(e.substr(e.indexOf("OK")+2)),i=t.LOGICAL_NAME_ABSOLUTO,a=t.IDFILE;f=~i.indexOf("?&id")?i.substring(0,i.lastIndexOf("?&id")):i;var n=t.LOGICAL_NAME||f.substring(f.lastIndexOf("/")+1),o=h.substring(h.lastIndexOf("_")+1),s=blink.activity.currentUploadSection.substring(1);blink.activity.currentUploadSection=null;var r=window["t"+secuencia[s]+"_slide"],l=r.prefijo,d=r.uid,c=p.getFileMarcadoSlide(f,n,h,l);reloadSuspendData();if(!suspdata.status["t"+d].marcadoTextBox){suspdata.status["t"+d].marcadoTextBox=[]}suspdata.status["t"+d].marcadoTextBox[o]=[c,a];loadSuspendData(JSON.stringify(suspdata));var u=$("#"+l+"pg #"+h);u.find(".uploaded-file-name").find(".uploaded-file-content").html(c);u.find(".uploaded-file-name").find(".deleteFileUploaded").attr("data-id",a);u.find(".uploaded-file-editor").showBlink();marcarHaCambiado(getIDSlideFromPrefijo(prefijoSeleccionMultimedia));updateSCORM()},{async:true,data:"&filename="+encodeURIComponent(f)+"&app="+nameAppSeleccionarMultimedia+"&appid="+idAppSeleccionarMultimedia+"&returnObj=true&subidaSlide=true"},{});closeMsgBox()};theme.getFileMarcadoSlide=function(e,t,i,a){var n=t.substring(t.lastIndexOf("/")+1).replace(/[_]\d{6,}/g,""),o=getMediaType(e),s={video:["uVideo","blink.rest.video('"+e+"')"],image:["uImage","blink.rest.image('"+e+"')"],sound:["uAudio","blink.rest.audio('"+e+"')"]};var r=typeof s[o]!=="undefined"?s[o][0]:"uFile";var l=typeof s[o]!=="undefined"?s[o][1]:"blink.rest.openUrl('viewer', '"+e+"')";$("#"+a+"pg #"+i+" .icon-uploaded-file").attr("class","icon-uploaded-file").addClass(r);return""+'<a id="file_'+t+'" onclick="'+l+'" target="_blank" class="bck-file-attach">'+'<span class="" id="file_label_'+n+'">&nbsp'+n+"</span>&nbsp"+"</a>"};theme.createVideoButtons=function(e){var t=e?e.find(".class_video"):$(".class_video");t.each(function(){var e=$(this);if(!$(this).next(".video-js").length){$(writeVideoPlayerButton(e,true)).insertBefore(e);if(!editar){e.hide()}}})};theme.createAudioButtons=function(e){var t=e?e.find(".class_sonido"):$(".class_sonido");t.each(function(){if(window.esInfantil||editar){return!editar&&writeAudioPlayerButtonInfantil($(this))}var e=$(this).parents(".bck-audio-player").length,t=$(this).attr("id"),i=$(this).filter("img").attr("alt");if(theme.audio.isEmbedded()&&e){theme.audio.launchVideoJS(t,i,$(this))}else{var a=writeAudioPlayerButton(t,i,true);$(a).insertBefore($(this));$(this).remove()}})};theme.writeAudioPlayerButton=function(e,t,i){var a="playersonido_"+e,n="player audio js-audio-player",o="javascript:void(0)",s="buttonPlaySoundPressed('"+e+"','"+t+"');";var r=""+'<a id="'+a+'" alt="'+t+'" class="'+n+'" data-id="'+e+'" href="'+o+'" onclick="'+s+'">'+"</a>";!i&&!$("#"+a).length&&document.write(r);return r};theme.writeVideoPlayerButton=function(e,t){if(theme.video.reassignMarkup(e)){var i=$(e).closest(".bck-video-container2"),a=i.find(".bck-video-srt"),n=i.find(".bck-video-player"),o=i.find(".class_video"),s=o.attr("alt"),r=o.attr("id"),l=[],d=e.closest(".bck-video-container"),c=i.hasClass("bck-v-inline");if(d.length){var u=o.data("srt");d.find(".bck-subtitles, .bck-video-edit-title").hideBlink();o=d.find(".class_video");c=o.hasClass("bck-v-inline");s=o.attr("alt");r=o.attr("id")}else if(!i.length){r=e.attr("id");s=e.filter("img").attr("alt")}if(c&&this.video.isEmbedded()){var f=d.length,h=f?$(e):i;if(!f){i.find('div[class*="jwplayer"]').remove();theme.video.launchVideoJS(h)}}else{if(u){l=u;$.each(l,function(e){var t=trim($('[id="sub_label_'+this.label+'"]').text());if(!!t&&t.length>0){this.label=t}})}a.length&&a.each(function(){var e=$(this),t={file:e.data("srt-file"),label:e.data("srt-label"),kind:e.data("srt-kind"),default:e.data("srt-default")};l.push(t)});var p="playervideo_"+r,m="player video js-video-player",v="javascript:void(0)",g="buttonPlayVideoPressed('"+r+"', '"+s+"', '+json_encode(videoSrt)+');";var b=""+'<a id="'+p+'" class="'+m+'" data-id="'+r+'" alt="'+s+'" href="'+v+'" onclick="'+g+'">'+"</a>"}!t&&!$("#playervideo_"+r).length&&document.write(b);return b}};theme.esAudioInline=function(){return false};theme.resizeCKeditor=function(e,t){};theme.createNewSlide=function(e,t,i){return B.activity.createNewSlide(e,t,i)};theme.onFinishCreatingNewSlide=function(e,t,i,a){return B.activity.onFinishCreatingNewSlide(e,t,i,a)};theme.deleteSlide=function(){return B.activity.deleteSlide()};theme.cloneSlide=function(){return B.activity.cloneSlide()};theme.desasignarCursoConPermiso=function(t,e,i){var a=window.event;a&&a.stopPropagation();if(confirm(textweb("js_confirmar_borrar_curso"))){var n="/LMS/ajax.php?op=course.unenrollCurso&idcurso="+t,o="";if(e)n+="&idUsr="+e;if(i){n+="&idschoolyear="+i;o='[data-idschoolyear="'+i+'"]'}getAJAX(n,function(e){if(!blink.isApp){if(e.startsWith("OK")){$('.js-course[data-id="'+t+'"]'+o).fadeOut({complete:function(){$(this).remove()}}).closest(".items-section").find(".cantidad").html(function(){return parseInt($(this).html(),10)-1})}}standardAJAX(e)})}};theme.borrarCursoConPermiso=function(i,a,n,e,t){var o=textweb("js_confirmar_borrar_curso");if(typeof e!="undefined"&&e!="")o=e;if(confirm(o)){var s="/LMS/ajax.php?op=course.deletecourse&idcurso="+i;if(t)s+="&idUsr="+t;var r="/LMS/ajax.php?op=course.checkactivitycourse&idcurso="+i,l=function(e){if(e.startsWith("OK")){if(parseInt(e.substr(2))>0){if(n==1){s+="&dact=1"}else{if(confirm(textweb("js_confirmar_mantener_actividades")))s+="&dact=0";else s+="&dact=1"}}var t=function(e){if(!blink.isApp){$('.js-course[data-id="'+i+'"]').fadeOut({complete:function(){$(this).remove()}}).closest(".items-section").find(".cantidad").html(function(){return parseInt($(this).html(),10)-1})}standardAJAX(e);if(typeof a!="undefined"&&a==1){window.location.reload()}};blink.ajax(s,t)}else{_showAlert(e.substr(5))}};var d="/LMS/ajax.php?op=course.checkRelatedCourses&idcurso="+i,c=function(e){var t=false;if(e.startsWith("OKNOT")){t=true}else if(e.startsWith("OK")){if(confirm(textweb("js_confirmar_borrar_relacion_curso_1")+": "+e.substr(2)+". "+textweb("js_confirmar_borrar_relacion_curso_2"))){t=true}}else{_showAlert(e.substr(5))}if(t){blink.ajax(r,l)}};blink.ajax(d,c)}};theme.borrarClaseConPermiso=function(e,t,i,a,n){var o="/LMS/ajax.php?op=activity.deleteclass&idcurso="+e+"&idclase="+t+"&origen="+n;getAJAX(o,standardAJAXFunc);return false};theme.scrollToSlide=function(e){var t=$("#transp"+e).closest(".item"),i=$(".content-wrapper").offset().top,a=e!=0?t.offset().top-i-20:0,n={scrollTop:a},o={duration:"fast",easing:"swing"};$("body").animate(n,o);window.posicionarBorrador()};theme.conmutarModoContinuo=function(){if($(".carousel-inner").length>0&&!window.editar&&!window.esWeb){window.modoContinuo=!window.modoContinuo;if(window.modoContinuo){theme.setModoContinuo()}else{theme.destroyModoContinuo()}$("#actividad").toggleClass("continuo");$(".navbar-bottom").toggle();conmutarEstadoBoton("boton_modoContinuo",!window.modoContinuo)}return false};theme.setModoContinuo=function(){var $carouselIndicators=$(".slider-indicators"),$carouselControls=$(".slider-control"),$items=$(".carousel-inner .item");$carouselControls.add($carouselIndicators).hide();$items.addClass("active");if(!esInfantil){$items.last().removeClass("active")}else{$(".js-slide-wrapper").show()}window.showSlide(blink.activity.currentSection);var offsets=[];for(i=0;i<secuencia.length;i++){offsets.push($("#transp"+window.secuencia[i]).offset());try{var ti=eval("t"+secuencia[i]+"_slide");ti.onShow()}catch(e){blink.log.error("conmutarModoContinuo"+i,e)}}blink.activity.slidesOffsets=offsets};theme.destroyModoContinuo=function(){var e=$(".slider-indicators"),t=$(".slider-control"),i=$(".carousel-inner .item");t.add(e).show();i.removeClass("active").eq(blink.activity.currentSection).addClass("active");blink.activity.formatCarouselControl(blink.activity.currentSection);$(document).scrollTop(0)};theme.scrollMenuLateral=function(){if(modoContinuo&&!window.completed){var e,t,i,a,n=0;if(blink.activity.modoContinuoLateral){e=$(window).scrollLeft();t=blink.windowWidth;a=_.pluck(blink.activity.slidesOffsets,"left")}else{e=$(window).scrollTop();t=blink.windowHeight;a=_.pluck(blink.activity.slidesOffsets,"top")}i=e+t/2;for(n;n<a.length;n++){if(a[n]>i)break}var o=n-1;if(o<0){o=0}else if(o>secuencia.length){o=secuencia.length}if(o!=blink.activity.currentSection){blink.activity.currentSection=o;pauseBackgroundSound();_finShowSlide(blink.activity.currentSection);blink.activity.currentStyle.setCanvasSize&&blink.activity.currentStyle.setCanvasSize(blink.activity.currentSection)}}};theme.writeImgPlayer=function(e,t,i,a,n,o,s){var r=$("#"+e+"_multimedia"),l=$("#"+e+"_img1"),d=blink.utils&&blink.utils.imgOnError?'onerror="blink.utils.imgOnError(this)"':"",c=""+'<img id="'+e+'_img1" title="'+n+'" src="'+t+'" '+'class="image_slide'+(s?" unselectable":"")+(a?" center":"")+'" '+'style="'+(i!=""?"width:"+i+"px;":"")+'" '+d+" />";r.html(c);l.remove();r.trigger("multimedia:deleted")};theme.spinner={count:0,show:function(e,t){e=e||"#spinner-backdrop, #spinner";this.count++;if(typeof t!=="undefined"){$(e).css("z-index",t)}else{$(e).css("z-index","")}$(e).showBlink()},hide:function(e,t){e=e||"#spinner-backdrop, #spinner";this.count--;if(typeof t!=="undefined"){$(e).css("z-index",t)}else{$(e).css("z-index","")}switch(this.count){case-1:blink.log.warning("El valor count del spinner es incorrecto");this.count=0;case 0:$(e).hideBlink();break}}};theme.showMask=function(e,t){hideHTMLOverflow();var i=$("#modal-backdrop");i.showBlink().removeClass(function(e,t){return $.trim(t.replace(/modal-backdrop|fade|in/g,""))});if(e){i.addClass(e)}if(t){this.spinner.show()}};theme.hideMask=function(){restoreHTMLOverflow();var e=$("#modal-backdrop");e.hideBlink()};theme.onQuitarMensaje=function(i,e){if(typeof e!=="undefined"&&e){getAJAX(e+i,function(e){if(e.startsWith("ERROR")){standardAJAXFunc(e)}else{var t=$('.js-message-wrapper[data-id="'+i+'"]');t.fadeOut(400,function(){$(this).remove();if($("#mensajes_list > div:visible:not(#msgSinMensajes)").length==0)$("#msgSinMensajes").removeClass("hidden")})}},null,null,"wi"+i)}return false};theme.introducirNotaOffline=function(e){return e.replace(".",",")};theme.indiceCursoRellenarNota=function(e,t,i){var a=$('.js-item[data-id="'+e+'"]'),n=a.find(".js-state"),o=a.find(".js-grade"),i=""+i,s=numGradeToGrade(viewToNumGrade(i)),r={VACIO:-1,EN_CURSO:0,TERMINADO_1:1,TERMINADO_2:2};switch(t){case r.VACIO:case r.EN_CURSO:n.addClass("off");break;case r.TERMINADO_1:case r.TERMINADO_2:n.removeClass("off");break;default:break}if(i!=""){if(typeof blink.activity.currentStyle!=="undefined"&&typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()){i=blink.activity.currentStyle.gradeValue(i)}if(typeof blink.courseInfo.originalStyleName!=="undefined"&&typeof blink.theme.styles[blink.courseInfo.originalStyleName]!=="undefined"){var l=blink.theme.styles[blink.courseInfo.originalStyleName],d=l?new l:new blink.theme.styles["basic"];if(typeof d.hideGrade!=="undefined"){if(d.hideGrade()){i=d.gradeValue(i)}}}o.html(!offline?i:this.introducirNotaOffline(i)).removeClass("invisible");if(i=="P"){o.addClass("removePerCent")}else if(!esAprobado(s)&&(typeof blink.activity.currentStyle!=="undefined"&&typeof blink.activity.currentStyle.hideGrade!=="undefined"&&!blink.activity.currentStyle.hideGrade()||typeof blink.courseInfo.style!=="undefined"&&blink.courseInfo.style&&blink.courseInfo.style.prototype&&!blink.courseInfo.style.prototype.hideGrade())){o.addClass("ko")}else{o.removeClass("ko")}}};theme.onCursoCambiarBloqueado=function(s,e,r){getAJAX("/LMS/ajax.php?op=activity.cambiarbloquearclase&idclase="+s+"&idcurso="+e,function(e){if(e.startsWith("ERROR")){standardAJAX(e)}else{var t=e.substring(2),i="",a=$('.js-item[data-id="'+s+'"]'),n=a.find(".js-acceso"),o={LOCK:1,UNLOCK:0};if(t==o.UNLOCK){i="unlock"}else if(t==o.LOCK){i="lock"}else{blink.log.error("ERROR: onCursoCambiarBloqueado: newType desconocido: "+t)}n.removeClass("lock unlock").addClass(i);r&&r(i);blink.isApp&&blink.rest.updateofflineWithoutReload()}})};theme.onCursoCambiarBloqueadoTema=function(e,s,r){getAJAX("/LMS/ajax.php?op=section.cambiarbloqueartema&idcurso="+e+"&idtema="+s+"&val="+r,function(e){if(e.startsWith("ERROR"))standardAJAX(e);else{var t=parseInt(r),i="",a=$('.unit-content[data-id="'+s+'"]'),n=a.find(".changeAllSectionButtons").find(".js-acceso"),o={LOCK:1,UNLOCK:0};if(t==o.UNLOCK){i="unlock";a.find(".changeAllSectionButtons").find(".acceso-0").hideBlink();a.find(".changeAllSectionButtons").find(".acceso-1").showBlink()}else if(t==o.LOCK){i="lock";a.find(".changeAllSectionButtons").find(".acceso-1").hideBlink();a.find(".changeAllSectionButtons").find(".acceso-0").showBlink()}else{blink.log.error("ERROR: onCursoCambiarBloqueadoTema: newValue desconocido: "+r)}a.find(".js-item").each(function(){$(this).find(".js-acceso").removeClass("lock unlock").addClass(i)});if(blink.isApp)blink.rest.updateofflineWithoutReload()}})};theme.onCursoCambiarBloqueadoTema=function(e,o,s){getAJAX("/LMS/ajax.php?op=section.cambiarbloqueartema&idcurso="+e+"&idtema="+o+"&val="+s,function(e){if(e.startsWith("ERROR"))standardAJAX(e);else{var t=parseInt(s),i="",a=$('.unit-content[data-id="'+o+'"]'),n={LOCK:1,UNLOCK:0};if(t==n.UNLOCK){i="unlock";a.find(".changeAllSectionButtons").find(".acceso-0").hideBlink();a.find(".changeAllSectionButtons").find(".acceso-1").showBlink()}else if(t==n.LOCK){i="lock";a.find(".changeAllSectionButtons").find(".acceso-1").hideBlink();a.find(".changeAllSectionButtons").find(".acceso-0").showBlink()}else{blink.log.error("ERROR: onCursoCambiarBloqueadoTema: newValue desconocido: "+s)}a.find(".js-item").each(function(){$(this).find(".js-acceso").removeClass("lock unlock").addClass(i)});if(blink.isApp)blink.rest.updateofflineWithoutReload()}})};theme.onCursoCambiarOnlineTema=function(e,o,s,t){getAJAX("/LMS/ajax.php?op=section.cambiaronlinetema&idcurso="+e+"&idtema="+o+"&val="+s+(t?"&reload="+t:""),function(e){if(!e.startsWith("OK")){standardAJAX(e)}else{var t=parseInt(s),i="",a=$('.unit-content[data-id="'+o+'"]'),n={OFFLINE:0,ONLINE:1};if(t==n.OFFLINE){i="fa-unlink";a.find(".changeAllSectionButtons").find(".online-0").hideBlink();a.find(".changeAllSectionButtons").find(".online-1").showBlink()}else if(t==n.ONLINE){i="fa-link";a.find(".changeAllSectionButtons").find(".online-1").hideBlink();a.find(".changeAllSectionButtons").find(".online-0").showBlink()}else{blink.log.error("ERROR: onCursoCambiarOnlineTema: newValue desconocido: "+s)}a.find(".js-item").each(function(){$(this).find(".js-online").find("i").removeClass("fa-link fa-unlink").addClass(i)});if(blink.isApp)blink.rest.updateofflineWithoutReload()}})};theme.onCursoCambiarTipoAcceso=function(s){getAJAX("/LMS/ajax.php?op=activity.cambiartipoacceso&idclase="+s,function(e){if(e.startsWith("ERROR")){standardAJAX(e)}else{var t=e.substring(2),i="",a=$('.js-item[data-id="'+s+'"]'),n=a.find(".js-acceso"),o={LOCK:3,UNLOCK:0};if(t==o.UNLOCK){i="unlock"}else if(t==o.LOCK){i="lock"}else{blink.log.error("ERROR: onCursoCambiarTipoAcceso: newType desconocido: "+t)}n.removeClass("lock unlock").addClass(i)}})};theme.onCursoCambiarOnline=function(s){getAJAX("/LMS/ajax.php?op=activity.cambiaronlineactividad&idclase="+s,function(e){if(e.startsWith("ERROR")){standardAJAX(e)}else{var t=$('.js-item[data-id="'+s+'"]'),i=$(".js-online i",t),a=e.substring(2),n="",o={OFFLINE:0,ONLINE:1};if(a==o.ONLINE){n="fa-link"}else if(a==o.OFFLINE){n="fa-unlink"}else{blink.log.error("ERROR: onCursoCambiarOnline: newOnline desconocido: "+a)}i.removeClass("fa-link fa-unlink").addClass(n)}})};theme.updateVisibleActivity=function(o,e,s){getAJAX("/LMS/ajax.php?op=activity.updatevisibleactivity&idclase="+o+"&value="+e,function(e){if(e.startsWith("ERROR")){standardAJAX(e)}else{var t=$('.js-item[data-id="'+o+'"]'),i=e.substring(2),a="",n={NO_VISIBLE:0,VISIBLE:1};if(i==n.VISIBLE){a="visible"}else if(i==n.NO_VISIBLE){a="no-visible"}else{blink.log.error("ERROR: onCursoCambiarOnline: newOnline desconocido: "+i)}t.removeClass("visible no-visible").addClass(a);if(typeof s!=="undefined"){s()}}})};theme.onChangePublicationStatus=function(a,n,o){getAJAX("/LMS/ajax.php?op=activity.updatepublicationstatus&idclase="+a+"&status="+n,function(e){if(e.startsWith("ERROR")){standardAJAX(e)}else{var t=$('.publication-status[data-id="'+a+'"]').val(n);enableDisablePublicationSelect(a);changeColorPublicationSelect(a);if(o){var i="0";if(n==o){i="1"}onCursoCambiarOnlineWithPublicationStatus(a,i)}}})};theme.switchClaseOnline=function(a){var e=a.parents(".js-actividad"),t=e.data("id");getAJAX("/LMS/ajax.php?op=activity.switchallhashclaseonline&idclase="+t,function(e){if(e.startsWith("OK")){var t=!!parseInt(e.substr(2),10);var i=a.closest(".actividad-detalle");a.toggleClass("shared",t);if(t){i.find(".shared-indicator").show();i.find(".shared-not-indicator").hide();i.find(".share-button").hide();i.find(".share-not-button").show()}else{i.find(".shared-indicator").hide();i.find(".shared-not-indicator").show();i.find(".share-button").show();i.find(".share-not-button").hide()}}else{standardAJAX(e)}},false)};theme.toggleCourseShared=function(i){var e=i.closest(".js-course").data("id");blink.ajax("/LMS/ajax.php?op=course.toggleShared&idcurso="+e,function(e){if(e.startsWith("OK")){var t=!!parseInt(e.substr(2),10);i.toggleClass("shared",t)}else{standardAJAX(e)}},{},{waitingElement:null})};theme.addClickToEditActivityButtonAction=function(e){if(typeof e!="object")return false;var t=e.parents(".js-actividad"),i=t.data("id"),a=t.data("state"),n=t.data("id-tema"),o=t.data("id-course"),s=t.data("type"),r=t.data("url-raw");e.unbind("click").click(function(e){if(a==blink.activity.state.ONLINE){_showAlert(textweb("new_edit_class_87"))}else{editActivityButtonAction(i,n,o,s,r)}})};theme.onMensajesEnviarMensaje=function(i,e,t){if(t==undefined||t.length==0)t=nombreusuario;borrarValoresDefecto();var a=$('.js-message-wrapper[data-id="'+i+'"]'),n=a.find(".js-reply-form"),o=n.find(".js-reply-msg"),s=o.val(),r=a.find(".reply-bt button");if(!window.attachments){window.attachments=[]}if(!window.attachments[i]){window.attachments[i]=new Attachment(a)}window.attachments[i].refreshInput();if(trim(s).length>0){var l="";if(e!=undefined&&t!=nombreusuario)l="&idremitente="+e;getAJAX("/LMS/ajax.php?op=message.executeenviarmensaje&output=1&idmsg="+i+l,function(e){if(e.startsWith("OK")){var t=e.substr(2);$("#derivados_"+i).append(t).showBlink();window.attachments[i].onAfterSendMessage();o.val("");a.find(".js-reply-wrapper").show().end().find(".reply-wrapper").slideUp();blink.locale.transformIstimestampToFormatDate();r.find(".waitingImage").remove();r.removeClass("disabled")}else{standardAJAXFunc(e);r.find(".waitingImage").remove();r.removeClass("disabled")}},n,null,"wi"+i);var d=$('<div class="waitingImage" style="display:inline-block">').html(getWaitingHTML());d.find("#responseimg").css({height:"15px",width:"15px"});r.addClass("disabled").prepend(d)}};theme.initCursoDrag=function(){var v={opacity:.5,baseURL:"/LMS/ajax.php?op=course.orderactividadescourse",getOrder:function(e){var a=[];$(".js-item",e).each(function(e,t){var i=$(this);a[e]=i.data("id")});return a},getUnitUrlParams:function(e){var t=$(".js-list-activities",e),i=$(".js-material-items",e),a=v.getOrder(t),n=v.getOrder(i),o=a.concat(n);var s={id:e.data("id"),secuencia:o.join(","),firstResourceIndex:a.length};return s},getUrlAjax:function(e){var t=$("#indice").data("id"),i=v.baseURL,a=[],n=getUrlParameters();if(e.length>1){for(var o=0,s=e.length;o<s;o++){a.push(v.getUnitUrlParams(e[o]))}}else{a.push(v.getUnitUrlParams(e))}i+="&idcurso="+t;i+=typeof n["idgrupo"]!="undefined"?"&idgrupo="+n["idgrupo"]:"";for(var o=0,s=a.length;o<s;o++){var r=o+1,l=a[o];i+="&idtema"+r+"="+l.id;i+="&secuenciastr"+r+"="+l.secuencia;i+="&beginResourceIndex"+r+"="+l.firstResourceIndex}return i},over:function(e,t){$(this).addClass("drag-over")},out:function(e,t){$(this).removeClass("drag-over")},stop:function(e,t){var i=$(this),a=t.item,n=i.parents(".js-unit-content"),o=n.data("id"),s=a.parents(".js-droppable-receiver");if(i.data("drop")){e.stopPropagation();return}i.data("drop",false);if(s.get(0)!==i.get(0)){a.removeAttr("style").find(".nota").hideBlink("invisible")}var r=v.getUrlAjax(n);getAJAX(r,standardAJAXFunc)}};$("#list-units").sortable({helper:"clone",stop:function(e,t){var a=[];$(".js-indice-tema").each(function(e,t){var i=$(this);a[e]=i.data("id");$(".number",i).html(e+1)});var i="/LMS/ajax.php?op=course.ordertemascourse";i+="&idcurso="+idcurso;i+="&secuenciastr="+a.join(",");getAJAX(i,standardAJAXFunc)}});$(".js-indice-tema").droppable({accept:".js-list-activities .js-item, .js-unit-content .js-material-items .js-item",hoverClass:"drag-over",drop:function(e,t){var i=t.helper,a=i.clone(),n=$(this),o=n.data("id"),s=i.parents(".js-unit-content"),r=$('.js-unit-content[data-id="'+o+'"]'),l=i.parents(".js-droppable-receiver"),d=l.data("drag-target"),c=$("."+d,r);l.data("drop",true);i.remove();t.draggable.remove();a.removeAttr("style").removeClass("hover").appendTo(c);var u=$("#indice").data("id"),f=a.data("id"),h=getUrlParameters();if(typeof blink.groupPlanning!="undefined"&&$("#icon_planning_activity_"+f).length>0){blink.theme.printPlanningIcons(f,0,0,blink.groupPlanning.appNameActivity);a.children("#icon_planning_activity_"+f).on("click",function(){blink.rest.connection(function(e){if(e==0){_showAlert(textweb("tablettxt_require_connection"))}else{manageGroupPlanning(u,h["idgrupo"],f,blink.groupPlanning.appNameActivity)}})})}var p=[s,r],m=v.getUrlAjax(p);getAJAX(m,standardAJAXFunc);theme.initCursoDrag()}});$(".js-list-activities").sortable({helper:"clone",connectWith:".js-material-items",cancel:".js-online, .publication-status",opacity:v.opacity,over:v.over,out:v.out,stop:v.stop});$(".js-material-items").sortable({helper:"clone",connectWith:".js-list-activities",cancel:".js-online, .publication-status",opacity:v.opacity,over:v.over,out:v.out,start:function(e,t){$(e.target).data("ui-sortable").floating=true},stop:v.stop})};theme.cambiarModoPadresAlumnos=function(e,t){window.modoUsuarios=e!=null?e:window.modoUsuarios==1?2:1;if(ocultarEventoPadres==null)ocultarEventoPadres=false;if(ocultarEventoProfes==null)ocultarEventoProfes=false;if(window.modoUsuarios==1){$(".js-ficha").removeClass("padre").addClass("alumno");$(".modo_clase_padres").attr("title",textweb("mi_clase_30"));$(".editar_alumno").data("original-title",textweb("mi_clase_19"));if(ocultarEventoPadres&&!ocultarEventoProfes)$(".module_calendar_add_event").removeClass("disabled");if(!ocultarEventoPadres&&ocultarEventoProfes)$(".module_calendar_add_event").addClass("disabled");else $(".module_calendar_add_event").attr("title",textweb("module_calendar_add_event_profesor")).attr("data-original-title",textweb("module_calendar_add_event_profesor"));$(".padre_noreg").removeClass("sin-registrar");$(".hijo_noreg").addClass("sin-registrar");conmutarEstadoBoton("modo_clase_padres",true);$(".crear_clase").removeClass("disabled");if(idgrupo!=""){$(".editar_alumno, .borrar_clase").removeClass("disabled");if(idcurso!="")$(".deberes").removeClass("disabled")}if(t!=null&&!t&&!modoClaseInicial&&!offline){$(".editar_alumno.premium, .editar_alumno.online").removeClass("premium online").unbind("click").attr("hasaccess","on").click(function(){onCreateEditGroup(idgrupo)}).find("a").removeAttr("onclick")}}else{$(".js-ficha").removeClass("alumno").addClass("padre");$(".modo_clase_padres").attr("title",textweb("mi_clase_31"));$(".editar_alumno").data("original-title",textweb("mi_clase_1"));if(ocultarEventoPadres&&!ocultarEventoProfes)$(".module_calendar_add_event").addClass("disabled");if(!ocultarEventoPadres&&ocultarEventoProfes)$(".module_calendar_add_event").removeClass("disabled");else $(".module_calendar_add_event").attr("title",textweb("module_calendar_add_event_tutores")).attr("data-original-title",textweb("module_calendar_add_event_tutores"));$(".hijo_noreg").removeClass("sin-registrar");$(".padre_noreg").addClass("sin-registrar");conmutarEstadoBoton("modo_clase_padres",false);$(".crear_clase, .borrar_clase, .deberes").addClass("disabled");if(esInfantil)$(".editar_alumno").addClass("disabled");if(t!=null&&!t&&!modoClaseInicial){if(offline){$(".editar_alumno").addClass("online").attr("hasaccess","ac_must_be_online")}else{$(".editar_alumno").addClass("premium").attr("hasaccess","ac_only_premium_users")}desactivarVinculosAccessControl()}}$(".modo_clase_padres").tooltip("destroy").tooltip();modoClaseInicial=false};theme.exportarDiagnostico=function(e,t){var i=$("#blocks").length>0?$("#blocks option:selected").val():"";var a=$("#criteria").length>0?$("#criteria option:selected").val():"";var n="";var o=$("#select_attempt").length>0?$("#select_attempt option:selected").val():"";if(o!="")n+="&attempt="+o;var s=$("#checkbox_evaluation").length>0?$("#checkbox_evaluation").is(":checked"):false;var r=$("#checkbox_selfcorrect").length>0?$("#checkbox_selfcorrect").is(":checked"):false;var l=undefined;if(s){if(r){l=4}else{l=2}}else{if(r){l=3}else{l=1}}n+="&slideAverage="+l;blink.rest.openUrl("viewer","/LMS/alumnos.php?idgrupo="+e+"&idcurso="+t+"&idblock="+i+"&idcriteria="+a+"&op=executeexportexcel"+n)};theme.showMsgBox=function(e,i,t,a,n,o){if(i.indexOf("text:")!==0&&i.indexOf("template:")!==0){i=addParamUrl(i,"theme_msgbox",BLINK_THEME);if(a&&typeof a=="string"){i+=a;a=undefined}}var s={backdrop:false},r=$("#remote-modal"),l=function(e,t){if(!e||e.startsWith("ERROR")){standardAJAXFunc(e);theme.hideMask()}else{theme.bindModalEvents(r);r.find(".modal-content").html(e).end().modal(s);if(t&&t.backFunction){t.backFunction();theme.spinner.hide()}$(document).trigger("msgbox_loaded")}theme.spinner.count&&theme.spinner.hide()};theme.showMask();theme.spinner.show();if(i.indexOf("text:")===0){l(decode64(i.substring(5),true))}else if(i.indexOf("template:")===0){if(!B.currentPage.msgbox_template){B.ajax("/LMS/msgbox.js.php",function(e){if(e=="ERROR"){l(e)}else{var t=e.split("|");_.each(t,function(e){var t=e.indexOf("=");if(t!=-1){B.TemplateCache.set(e.substring(0,t),e.substring(t+1))}});B.currentPage.msgbox_template=true;l(B.TemplateCache.fetch(i.substring(9),a))}},{dataType:"html"})}else{l(B.TemplateCache.fetch(i.substring(9),a))}}else{o&&o.back?blink.ajax(i,l,{data:a},{back:o.back}):blink.ajax(i,l,{data:a})}};theme.bindModalEvents=function(t,i){if(!t.data("events")||!t.data("events").loaded){t.on("loaded.bs.modal",function(e){$(this).showBlink().find(".modal-content").showBlink();theme.spinner.hide();theme.resizeModal();if(!blink.isIos){t.find('input[type="text"], select, textarea').each(function(){if($(this).is(":visible")){$(this).focus();return false}})}else{t.find(".wrap-filter-modal").css({top:"-21px"})}}).on("show.bs.modal",function(e){$(this).showBlink().find(".modal-content").showBlink();theme.spinner.count&&theme.spinner.hide();theme.resizeModal()}).on("hide.bs.modal",function(e){$(".js-popover-modal").popover("destroy")}).on("hidden.bs.modal",function(e){var t=$(this);i||t.find(".modal-content").hideBlink();t.find(".modal-lg").removeClass("modal-lg");theme.hideMask()})}};theme.showHelperModal=function(e,t,i){theme.bindModalEvents(e,true);e.attr("data-helpermodal-id",i).find(".modal-body").html(t).end().find(".close").click(function(e){var t="globo_"+i;setSessionAttribute(t,"false");blink.localStorage.set(t,false);hideMask()}).end().modal({show:true,backdrop:false})};theme.showDescargaSelectivaModal=function(t,e,i,a,n,o){theme.bindModalEvents(t,true);t.attr("data-helpermodal-id",o).find(".modal-header").html(i).end().find(".modal-body").html(e).end().find(".modal-footer").html(a).end().find(".close").click(function(e){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();t.modal("hide");blink.theme.hideMask()}).mouseup(function(e){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();t.modal("hide");blink.theme.hideMask()}).end().find(".btn-default").click(function(e){n();t.modal("hide");blink.theme.hideMask()}).mouseup(function(){t.modal("hide");blink.theme.hideMask()}).end().modal({show:true,backdrop:false})};theme.setMsgBoxTitle=function(e){};theme.attachFiltersEvents=function(){};theme.onMiClaseFiltrar=function(e){};theme.seleccionarMiClase=function(e,t){if(!$.trim(e).length)return;var i=e.split(",");$(".js-ficha").removeClass("selected");for(var a=0,n=i.length;a<n;a++){$('.js-ficha[data-id="'+i[a]+'"]').addClass("selected")}};theme.showOKOrErrorMsg=function(e,t){var i=$(".js-alert-modal","#remote-modal");if(!i.length){_showAlert(t);return}var a=e=="OK"?"alert-success":"alert-danger";i.html(t).removeClass("hidden alert-danger").addClass(a);theme.clearWaitingAjax("#waitingImage");$(".modal-body").animate({scrollTop:0},300,"easeInOutSine");if($(".js-alert-modal").hasClass("alert-danger")){$(".wrap-filter-modal").addClass("error")}};theme.hideCourseStyles=function(){var e=$.grep($(document).find("link"),function(e){return e.href&&e.href.includes("c"+idcurso)||e.href.includes("/styles/")});if(e){blink.customCSS=[];for(var t=0;t<e.length;t++){blink.customCSS[t]={tag:e[t],prev:$(e[t]).prev()[0]}}for(var t=0;t<blink.customCSS.length;t++){$(blink.customCSS[t].tag).remove()}}};theme.showCourseStyles=function(){if(blink.customCSS){for(var e=0;e<blink.customCSS.length;e++){$(blink.customCSS[e].prev).after(blink.customCSS[e].tag)}delete blink.customCSS}};theme.showWarningMsg=function(e,t){var i=$(".js-alert-modal","#remote-modal");if(!i.length){_showAlert(t);return}i.html(t).addClass("alert-warning").removeClass("hidden");theme.clearWaitingAjax("#waitingImage");$(".modal-body").animate({scrollTop:0},300,"easeInOutSine")};theme.closeMsgBox=function(){try{$("#remote-modal").modal("hide");$("[id=dlgAJAX_c]").remove();$(".container-close").remove();callOfflinePCParent("events.popup.onAfterHide")}catch(e){}};theme.buscarActividades=function(e,t,i){if(i==undefined||i=="")i=$("#filtrouniverso").attr("value");if(i!==$("#filtrouniverso").attr("value"))$("#filtrouniverso").val(i);var a="";if(idcurso!=undefined&&idclase!=undefined){a="&idcurso="+idcurso;i=3}var n=i!=undefined?"&filtrouniverso="+i:"";if(!t||e>=0&&e<t)getAJAX("/LMS/ajax.php?op=activity.buscaractividades&q="+encodeURIComponent($("#buscador-activities").val())+(!isNaN(e)?"&s="+e:"")+n+a+"&isEmbedded=0",null,false,"lista-actividades")};theme.buscarActividadesEmbebibles=function(e,t,i){if(i==undefined||i=="")i=$("#filtrouniverso").attr("value");if(i!==$("#filtrouniverso").attr("value"))$("#filtrouniverso").val(i);var a="";if(idcurso!=undefined&&idclase!=undefined){a="&idcurso="+idcurso;i=3}var n=i!=undefined?"&filtrouniverso="+i:"";if(!t||e>=0&&e<t)getAJAX("/LMS/ajax.php?op=activity.buscaractividades&q="+encodeURIComponent($("#buscador-activities").val())+(!isNaN(e)?"&s="+e:"")+n+a+"&isEmbedded=1",null,false,"lista-actividades")};theme.buscarNovedadesCurso=function(e,t){getAJAX("/LMS/msgbox.php?op=course.buscarnovedadescurso&idcurso="+e,null,false,"lista-resultados")};theme.imprimirTemas=function(){if($("#dlgForm input[name^='tema']:checked").size()==0){_showAlert(textweb("new_print_slide_8"));return}$("#waitingImage").html(getWaitingHTML());document.dlgForm.submit()};theme.getIDsAlumnosSeleccionados=function(){var e=[];$(".js-ficha.selected").each(function(){e.push($(this).data("id"))});return e};theme.onMiClaustroSendMessage=function(){var e=getIDsAlumnosSeleccionados(),t="/LMS/msgbox.php?op=user.enviarmensaje&idgrupo="+idgrupo+"&modoUsuarios="+modoUsuarios+"&idcentro="+idcentro;if(e.length!=0){t+="&idusers="+e.join(",")}else{e=getIDsProfesoresSeleccionados();if(e.length!=0){t+="&idusers="+e.join(",");t+="&tipo_dest=2"}}showMsgBox("",t,550)};theme.getIDsProfesoresSeleccionados=function(){var e=[];$(".js-profesor.selected").each(function(){e.push($(this).data("id"))});return e};theme.searchPhoto=function(e,t){borrarValoresDefecto();getAJAX("/coursePlayer/getfiles.php?type=blinkdb&numsec=0&idcurso="+e+"&callback="+t+"&q="+document.getElementById("buscador-multimedia").value,null,false,"lista-multimedia")};theme.addUsuario=function(e){borrarValoresDefecto();var t=window.window.modoUsuarios==4?["nombre","apellidos","email"]:["nombre","apellidos"];if(!verificarVacios(t)){prepararCamposTexto();return false}if(window.modoUsuarios==4&&!verificarEmail(["email"])){prepararCamposTexto();return false}var i=false;var a=false;if(document.dlgForm.email.value!=""){$(".tabla_alumno_email").each(function(){if(trim($(this).html()).toLowerCase()==trim(document.dlgForm.email.value).toLowerCase()){a=true}});$(".tabla_alumno_x > input").each(function(){if($(this).val()==document.dlgForm.idusuariohidden.value){i=true}})}if((i||a)&&!esInfantil){_showAlert(textweb("new_edit_group_30"));return false}hayCambiosVentanaClase=true;var n='<div class="userlist-item row">'+'<div class="col-xs-3 form-control-static tabla_alumno_nombre">'+document.dlgForm.nombre.value+"</div>"+'<div class="col-xs-4 form-control-static tabla_alumno_apellidos">'+document.dlgForm.apellidos.value+"</div>"+'<div class="col-xs-4 form-control-static tabla_alumno_email">'+document.dlgForm.email.value+"</div>"+'<div class="col-xs-1 control_alumn tabla_alumno_x">'+'<input id="user'+numUsuariosVentanaClase+'" name="user'+numUsuariosVentanaClase+'" type="hidden">';var o=e;if(o=="")o=document.dlgForm.idusuariohidden.value;if(o!=""){n+='<a class="btn btn-danger" href="javascript:removeUsuarioExistente('+o+","+numUsuariosVentanaClase+')"><i class="fa fa-times"></i></a>'}else{n+='<a class="btn btn-danger" href="javascript:removeUsuario('+numUsuariosVentanaClase+');"><i class="fa fa-times"></i></a>'}n+="</div>";var s=$("input[name=listaProfesores]").val();if(s==1){$("#userlist").showBlink().append(n)}else{$("#userlist").showBlink().prepend(n)}if(o=="")document.getElementById("user"+numUsuariosVentanaClase).value=json_encode({nuevo:1,nombre:document.dlgForm.nombre.value,apellidos:document.dlgForm.apellidos.value,email:document.dlgForm.email.value});else document.getElementById("user"+numUsuariosVentanaClase).value=json_encode({idselected:o,nombre:document.dlgForm.nombre.value,apellidos:document.dlgForm.apellidos.value,email:document.dlgForm.email.value});$("#campos_alumno input").each(function(){$(this).val("")});numUsuariosVentanaClase++;$("#anadir").removeClass("hidden");$("#confirmar").addClass("hidden");prepararCamposTexto();updateHandlersVentanaClase();return true};theme.removeUsuario=function(e){$("#user"+e).parent().parent().remove();hayCambiosVentanaClase=true;$("#anadir").removeClass("hidden");$("#confirmar").addClass("hidden");if(window.modoUsuarios==4)$("#nombre, #apellidos").prop("disabled",false);$("#nombre, #apellidos, #email, #email2").val("");prepararCamposTexto();updateHandlersVentanaClase()};theme.editUsuario=function(t,e){var i=$("#rowselected").val();if(i&&t==i){$("#rowselected").val("");$("#idselected").val("");$("div[id^=fila]").removeClass("selected");$("#anadir").removeClass("hidden");$("#confirmar").addClass("hidden");$("#nombre, #apellidos, #email, #email2").val("");prepararCamposTexto();if(window.modoUsuarios==4)$("#nombre, #apellidos").removeAttr("disabled");if(window.modoUsuarios==2)$("#email, #email2").attr("disabled",true);$("#nombre, #apellidos, #email, #email2").blur()}else{$("#rowselected").val(t);var a=$("#fila"+t+" input[id^=user]").val();if(isNaN(a))a="0";$("#idselected").val(a);$("div[id^=fila]").removeClass("selected");$("#fila"+t).addClass("selected");if(window.modoUsuarios!=2){$(".tabla_alumno_nombre").each(function(e){if(e==t)$("#nombre").val($(this).attr("title")).focus()});$(".tabla_alumno_apellidos").each(function(e){if(e==t)$("#apellidos").val($(this).attr("title")).focus()})}else{$("#email").removeAttr("disabled");$("#email2").removeAttr("disabled")}$(".tabla_alumno_email").each(function(e){if(e==t)$("#email").val($(this).attr("title")).focus()});$(".tabla_alumno_email2").each(function(e){if(e==t)$("#email2").val($(this).attr("title")).focus()});$("#anadir").addClass("hidden");$("#confirmar").removeClass("hidden");if(window.modoUsuarios==4){$("#nombre, #apellidos").prop("disabled",true);$("#email").focus()}else if(window.modoUsuarios==2)$("#email").focus();else $("#"+e).focus()}};theme.updateUsuario=function(){borrarValoresDefecto();var a=parseInt($("#rowselected").val()),e=parseInt($("#idselected").val());if(window.modoUsuarios==1){$(".tabla_alumno_nombre").each(function(e){if(e==a){var t=$(this).html();var i=$("#nombre").val();if(t!=i)hayCambiosVentanaClase=true;$(this).html(i);$(this).attr("title",i)}});$(".tabla_alumno_apellidos").each(function(e){if(e==a){var t=$(this).html();var i=$("#apellidos").val();if(t!=i)hayCambiosVentanaClase=true;$(this).html(i);$(this).attr("title",i)}})}$(".tabla_alumno_email").each(function(e){if(e==a){var t=$(this).html();var i=$("#email").val();if(t!=i)hayCambiosVentanaClase=true;$(this).html(i);$(this).attr("title",i)}});$(".tabla_alumno_email2").each(function(e){if(e==a){var t=$(this).html();var i=$("#email2").val();if(t!=i)hayCambiosVentanaClase=true;$(this).html(i);$(this).attr("title",i)}});if(window.modoUsuarios!=2){var t={nombre:document.dlgForm.nombre.value,apellidos:document.dlgForm.apellidos.value,email:document.dlgForm.email.value};if(e==0)t["nuevo"]=1;else t["idselected"]=e;$("#fila"+a+" input[id^=user]").val(json_encode(t))}else{var i=$("#parent"+(a+1)).val();var n=$("#parent2_"+(a+1)).val();$("#user"+(a+1)).val(json_encode({id:e,idpadre:i,email:document.dlgForm.email.value,idpadre2:n,email2:document.dlgForm.email2.value}));$("#email").prop("disabled",true);$("#email2").prop("disabled",true)}$("#fila"+a).removeClass("selected");$("#anadir").removeClass("hidden");$("#confirmar").addClass("hidden");$("#rowselected").val("");$("#idselected").val("");if(window.modoUsuarios==4)$("#nombre, #apellidos").removeAttr("disabled");$("#nombre, #apellidos, #email, #email2").val("");prepararCamposTexto();return true};theme.restructureTools=function(i){var e=$("#tools");if(i.length==0){e.hide();return}var a=false;e.find("a").each(function(){var e=false;for(var t=0;t<i.length&&!e;t++){e=$(this).hasClass(i[t])}if(e){$(this).parent("li").show();a=true}else{$(this).parent("li").hide()}});if(a){e.show()}else{e.hide()}};theme.onEditarContenido=function(){var e=$("#editar_contenido.active").length>0,i=!e?$.fn.showBlink:$.fn.hideBlink;i.call($(".control.delete, .js-addBook"));i.call($(".btn-compartir"));i.call($(".btn-lapiz_rojo"));i.call($(".edit_category, .delete_category, .manage-buttons"));$(".list-items.books").each(function(e,t){if($(t).attr("data-id")!=2&&$(t).find("li").length<=0){i.call($(t).parent())}});i.call($(".info-icon-show-on-edit"));i.call($(".edit.js-edit-actividad"));e?$(".js-actividad .titulo").css("display","block"):$(".js-actividad .titulo").css("display","inline");conmutarEstadoBoton("editar_contenido",$("#editar_contenido").hasClass("active")||$("#editar_contenido").closest("li").hasClass("active"));$(".items.recursos, .items.cursos").toggleClass("edit-mode");var a="&editar=1";$(".mask .view-icon").each(function(){var e=$(this).attr("onclick"),t;if(e.indexOf(a)!==-1||blink.isOfflinePCApp){t=e.replace(a,"")}else{if(e.indexOf("viewDownloadableCourse")<=-1&&e.indexOf("blink.events.trigger('exelearning")!=0){e=e.split("'");e[1]=e[1]+a;t=e.join("'")}}$(this).attr("onclick",t)});if(blink.domain.allowSelectiveDownload()&&(blink.isOfflinePCApp||blink.isApp)){blink.rest.elementsStatus()}$(".js-eXeLearningActive").toggleClass("hide");$(".js-exeLearningView").toggleClass("hide");$(".js-exeLearningEdit").toggleClass("hide");$(".js-exeLearningInfo").toggleClass("hide")};theme.onFiltrarContenido=function(){$(".sfilter ul.toggable").toggleBlink();conmutarEstadoBoton("filtrar_contenido",$("#filtrar_contenido").hasClass("active")||$("#filtrar_contenido").closest("li").hasClass("active"))};theme.irSubtema=function(e,t,i,a,n,o){var s=null;if($("#select_attempt").length){s=$("#select_attempt").val()}if($('.subtemas[data-subtemas="'+t+'"]').size()==0){theme.onDiagnosticoFinishLoadingDetalle(o,n,t,null,s)}};theme.onDiagnosticoFinishLoadingDetalle=function(e,t,i,a,n){try{var o=json_decode(e),s=_.keys(o[0]).length,r=blink.getReqParam(location.href,"idgrupo"),l=$('div[data-tema="'+i+'"] > .item').size()-2,d='<div class="subtemas';if(t=="4"){d+=" subtemas-deberes"}d+='" data-subtemas="'+i+'" style="display: none">';for(var c=0;c<s;c++){var u=o[0][c],f="";if(u.indexOf("[[")!=-1){var h=u.indexOf("]]");var p=u.substring(2,h);var m=blink.locale.timestampToFormatDate(p,"DD/MM/YYYY");u=m+u.substr(h+2)}if(t=="4"){var v=o[1][c].indexOf("#");if(v!=-1){var g=o[1][c].substring(v+1);o[1][c]=o[1][c].substring(0,v)}var b=u.indexOf("/");if(b!=-1){b=u.indexOf("/",b+1);if(b!=-1)f=u.substring(0,b)}}}d+="</div>";if(t=="4"){$("div.temas").append(d)}else{$("div.tema[data-tema='"+i+"']").after(d)}$("div.subtemas[data-subtemas='"+i+"']").find(".subtema").each(function(){var t=$(this).first().find(".titulo").text();$(this).find(".item").not(".top, .media").each(function(){var e=$(this);if(blink.domain.showTooltipOnGradebook()){e.tooltip({title:t,container:"#wrapTemas"})}$.data(e.get(0),"cache-html",e.html());B.doTick(e)})});if(camposTextoCalificacionesActivados)activarCamposTextoCalificaciones()}catch(e){blink.log.error(e)}};theme.onCalificacionesEditarNotas=function(l){if(l==undefined)l="temas";if($(".has-error .input_calificaciones").size()>0){_showAlert(textweb("calificaciones_1"));return}if($(".input_calificaciones.changed").size()>0){if(!confirm(textweb("calificaciones_2"))){cerrarSinVerificar=true;if(l=="learningStandar"){this.cambiarEstadoBotonNotasLearningStandar();$(".cargar_datos").click()}window.location.reload();return}var e=obtenerArrayActualizacionNotas(l);$("#datos").val(e);var t="/LMS/ajax.php?op=qualifications.cambiarnotas&idcurso="+idcurso;if(l=="learningStandar")t+="&scoreType=ls";getAJAX(t,function(e){if(e.startsWith("ERROR")){var t=e.substr("ERROR".length);if(t.length){var i=t.split("|");if(i.length){for(var a=0;a<i.length;a++){var n=i[a].split(",");if(n.length>2){var o=n[0];var s=n[1];var r=n[2];$('.item[data-alumno="'+o+'"][data-tema="'+r+'"]').addClass("has-error")}}_showAlert(textweb("calificaciones_1"));return}}return}else if(e.indexOf("ERROR")!=-1){_showAlert(textweb("error_general_AJAX"));return}cerrarSinVerificar=true;if(l=="learningStandar"){blink.theme.cambiarEstadoBotonNotasLearningStandar();$(".cargar_datos").click();return}else{standardAJAX(e);cambiarEstadoBotonNotas()}},"form")}else{l!="learningStandar"?cambiarEstadoBotonNotas():this.cambiarEstadoBotonNotasLearningStandar()}};theme.initCompareNotesButton=function(){var e="/LMS/ajax.php?op=course.getNumGradesCompare&idgrupo="+window.idgrupo+"&idcurso="+window.idcurso+"&tipo="+window.tipo;getAJAX(e,function(e){if(e.startsWith("ERROR")||e.substr(0,3)=="OK0"){$("#boton_comparar_notas").addClass("disabled")}else{$("#boton_comparar_notas").removeClass("disabled")}})};theme.compareNotes=function(){if(typeof compare_activate=="undefined"||!compare_activate){var e="/LMS/ajax.php?op=course.getGradesCompare&idgrupo="+window.idgrupo+"&idcurso="+window.idcurso+"&tipo="+window.tipo;getAJAX(e,function(e){if(e.startsWith("ERROR")){if(e.length>5)_showAlert(e.substr(5))}else{var t=jQuery.parseJSON(e);if(t){blink.theme.spinner.show();$(".compare-item").remove();var i=$(".content-wrapper .table .alumnos");var a=$(".content-wrapper .table .temas");i.find(".item.media:not(.compare-item)").addClass("current_class");a.find(".tema .item.media:not(.compare-item)").addClass("current_class");a.find(".subtema .item.media:not(.compare-item)").addClass("current_class");for(var n in t){var o=t[n].nombre_grupo;var s=t[n].media_grupo;if(s===0||s==="0"){s=""}i.find(".item.media:not(.compare-item)").after('<div class="item media compare-item compare-item-closed"><div class="nombre">'+o+'</div><div class="nota">'+s+"</div></div>");for(var r in t[n].media_temas){var l=t[n].media_temas[r];if(l===0||l==="0"){l=""}a.find('.tema[data-tema="'+r+'"] .item.media:not(.compare-item)').after('<div class="item media compare-item compare-item-closed">'+l+"</div>")}for(var d in t[n].media_clases){for(var c in t[n].media_clases[d]){var u=t[n].media_clases[d][c];if(u===0||u==="0"){u=""}a.find('.subtema[data-subtema="'+c+'"] .item.media:not(.compare-item)').after('<div class="item media compare-item compare-item-closed">'+u+"</div>")}}}}setTimeout(function(){$(".compare-item").removeClass("compare-item-closed")},10);blink.theme.spinner.hide();compare_activate=true}})}else{$(".compare-item").addClass("compare-item-closed");$(".content-wrapper .table .alumnos .item.media, .content-wrapper .table .temas .tema .item.media, .content-wrapper .table .temas .subtema .item.media").removeClass("current_class");setTimeout(function(){$(".compare-item").remove()},500);compare_activate=false}};theme.onLearningStandarEditarNotas=function(){this.onCalificacionesEditarNotas("learningStandar")};theme.cambiarEstadoBotonNotasLearningStandar=function(){conmutarEstadoBoton("boton_editar_notas",camposTextoCalificacionesActivados);camposTextoCalificacionesActivados?desactivarCamposTextoCalificaciones():this.activarCamposTextoCalificaciones("div.competencia");blink.currentPage.resizeWrapCompetencias()};theme.obtenerArrayActualizacionNotas=function(s){if(s==undefined)s="temas";if($(".has-error .input_calificaciones").size()){var e=$(".has-error .input_calificaciones").get(0);_showAlert("Error nota");e.focus();if(!isScrolledIntoView(e))e.scrollIntoView();return}var r=Array();$(".input_calificaciones.changed").each(function(){var e=$(this);var t=e.parent();var i=t.data("alumno");var a=0;var n=t.data("tema");var o=t.data("nota");if(s=="learningStandar")r.push({id:i,idls:n,n:o});else r.push({id:i,idt:a,idst:n,n:o,ex:tipo})});return json_encode(r)};theme.activarCamposTextoCalificaciones=function(e){if(e==undefined)e="div.subtema";$(e+" > div.item").not(".media, .top").each(function(){var e=$(this).data("isgclasroom");if(!e){var t=$(this).data("nota");if(t=="-")t="";var i=$(this).find("a");i.hide();$(this).html(i.get(0).outerHTML+'<input class="form-control input_calificaciones" value="'+t+'" type="text">').addClass("en_edicion")}});$(e+" > div.item").not(".media, .top");$(".input_calificaciones").keypress(function(e){if(e.keyCode=="13"){$(this).parent().next().children("input").focus()}}).focus(function(){this.select();if(!isScrolledIntoView(this))this.scrollIntoView()}).change(function(){if(!isFinite(viewToNumGrade(this.value))){$(this).parent().addClass("has-error");return}$(this).parent().removeClass("has-error").data("nota",this.value);$(this).addClass("changed")}).click(function(e){});camposTextoCalificacionesActivados=true};theme.desactivarCamposTextoCalificaciones=function(){$(".input_calificaciones").each(function(){var e=this.value;if(e=="")e="-";if($(this).parent().hasClass("error"))e=$(this).parent().data("nota");var t=$(this).parent().find("a");t.show();$(this).parent().data("nota",e).html(t.get(0).outerHTML).removeClass("en_edicion")});camposTextoCalificacionesActivados=false};theme.conmutarEstadoBoton=function(e,t){if(e=="boton_sonido"||e=="boton_optimizar")this.buttonState.off("#"+e,!t);else this.buttonState.active("#"+e,!t)};theme.habilitarBoton2=function(e,t){this.buttonState.disabled("#"+e,!t)};theme.cambiarEstadoBotonNotas=function(){conmutarEstadoBoton("boton_editar_notas",camposTextoCalificacionesActivados);camposTextoCalificacionesActivados?desactivarCamposTextoCalificaciones():activarCamposTextoCalificaciones();habilitarBoton2("boton_ticks",!camposTextoCalificacionesActivados);habilitarBoton2("descargar_excel",!camposTextoCalificacionesActivados);habilitarBoton2("editar_contenido",!camposTextoCalificacionesActivados)};theme.editarDeberes=function(){blink.theme.onEditarContenido();var e=$("#editar_contenido").hasClass("active")||$("#editar_contenido").closest("li").hasClass("active");habilitarBoton2("boton_editar_notas",!e)};theme.buttonState={_stopFunc:function(e){e.preventDefault();e.stopPropagation();return false},_updateForApp:function(e,t,i){if(!blink.isApp)return;var a=this;$(e).each(function(){var e=$(this).attr("id");if(!e)return;if($.isFunction(i))i=i(this);a._updateButton(e,t,i)})},_updateButton:function(e,t,i){if(!blink.buttons)return;for(var a=0;a<blink.buttons.length;a++){var n=blink.buttons[a];if(n.id==e){if(n[t]!==i){n[t]=i;blink.rest.setButton(n)}break}}},isActive:function(e){return $(e).hasClass("active")},active:function(e,t){$(e).toggleClass("active",t);var i=this;this._updateForApp(e,"active",function(e){return i.isActive(e)})},isHidden:function(e){return $(e).parent().hasClass("hidden")},hidden:function(e,t){$(e).parent().toggleClass("hidden",t);var i=this;this._updateForApp(e,"visible",function(e){return!i.isHidden(e)})},isDisabled:function(e){return $(e).hasClass("disabled")},disabled:function(t,e){var i=$(t);i.toggleClass("disabled",e);var a=this;i.each(function(){var e=$(this);if(a.isDisabled(e)){a.active(t,false);e.parent().on("click",a._stopFunc);if(e.attr("onclick"))e.attr("onclick2",e.attr("onclick"));e.attr("onclick","");a._updateForApp(e,"enabled",false)}else{e.parent().off("click",a._stopFunc);e.attr("onclick",e.attr("onclick2"));a._updateForApp(e,"enabled",true)}})},isOff:function(e){return $(e).hasClass("off")},off:function(e,t){$(e).toggleClass("off",t)}};theme.onLoadDiagnostico=function(){var n=10;$("#move-left").click(function(){var e=$(this).closest(".table");var t=e.find(".temas > .tema:visible, .temas .subtema:visible, .temas .competencia:visible, .actividades .transparencia").length;var i=e.find(".temas").width()+n;var a=i/t/2;if(window.myScroll)if(myScroll.x>=myScroll.maxScrollX+a){myScroll.scrollBy(-a,0)}else{myScroll.scrollTo(myScroll.maxScrollX,0)}});$("#move-right").click(function(){var e=$(this).closest(".table");var t=e.find(".temas > .tema:visible, .temas .subtema:visible, .temas .competencia:visible, .actividades .transparencia").length;var i=e.find(".temas").width()+n;var a=i/t/2;if(window.myScroll)if(myScroll.x<-a/2){myScroll.scrollBy(a,0)}else{myScroll.scrollTo(0,0)}})};theme.saveComentario=function(e,t,i,a,n){var o="/LMS/ajax.php?op=section.savecomentario&idtema="+e+"&idusuario="+t+"&coment="+encodeURIComponent(i),s=!!a&&a!=0?a:"",r=!!n&&n!=0?n:"";if(s!=""){o+="&idgrupo="+s}if(r!=""){o+="&idcurso="+r}getAJAX(o,onFinishSavingComentario);$("#fila_"+e+" .comment-title").text(text_web.ficha_alumno_coment_actualizado+" 0 "+textweb("mensaje_3"))};theme.removeBookFromSchool=function(e,i){var t=window.event;t&&t.stopPropagation();if(confirm(textweb("confirm_borrar_libro"))){getAJAX("/LMS/ajax.php?op=school.removebookfromschool&idcentro="+e+"&idcurso="+i,function(e){if(e.startsWith("OK")){$("li[data-id='"+i+"']").addClass("hidden");var t=parseInt($("#div_nlibros").html());t-=1;$("#div_nlibros").html(t)}else _showAlert(e.substr(5))})}};theme.removeBookFromGroup=function(e,i){var t=window.event;t&&t.stopPropagation();if(confirm(textweb("confirm_borrar_libro_grupo"))){getAJAX("/LMS/ajax.php?op=group.removecontentfromgroup&idgrupo="+e+"&idcurso="+i,function(e){if(!e.startsWith("ERROR")){$("li[data-id='"+i+"']").addClass("hidden");var t=parseInt($("#div_nlibros").html());t-=1;$("#div_nlibros").html(t)}else _showAlert(e.substr(5))})}};theme.mostrarGloboAyuda=function(e,t,i,a,n,o,s,r){var l="globo_"+t;if(blink.localStorage.get(l)===false)return;var d=$("#remote-alert-modal-green"),c="<ul>";for(var u=0;u<i.length;u++){c+='<li><div class="number">'+(i.length>1?u+1:"")+'</div><div class="text">'+i[u]+"</div></li>"}c+="</ul>";theme.showHelperModal(d,c,t);theme.showMask("white")};theme.mostrarRequiereOnline=function(e,t,i){var a=$("#remote-alert-modal-blue"),n=""+"<ul>"+"<li>"+'<h4 style="margin-bottom: 0; margin-top: 0;">'+textweb("license_15")+"</4>"+"</li>"+"<li>"+'<div class="number"><i class="fa fa-warning"></i></div>'+'<div class="text">'+textweb("license_16")+"</div>"+"</li>"+"</ul>";theme.showHelperModal(a,n);theme.showMask("white")};theme.mostrarModalDescargaSelectiva=function(e){if(typeof e!=undefined&&e!=""){switch(e["tipo"]){case"alert":_showAlert(e["titulo"]);break;case"confirm":if(confirm(e["titulo"])){e["botones"]["aceptar"]["accion"]()}break;case"selection":if(confirm(e["titulo"])){e["botones"]["1"]["accion"]()}else{e["botones"]["2"]["accion"]()}break;case"panel":var t=$("#remote-descarga-selectiva-modal");var i="",a="",n="",o="";t.addClass("panel-descarga-selectiva-modal");a=' <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button><h5>'+e["titulo"]+"</h5>";n="<span>"+e["contenido"]+"</span>";if(typeof e["botones"]["tipo_descarga"]!="undefined"){if(typeof e["botones"]["tipo_descarga"]["completa"]!="undefined"){n+='<div class="btn-group btn-group-toggle" data-toggle="buttons">'+'<label class="btn btn-secondary active">'+'<input type="radio" name="options" id="option1" autocomplete="off" value="2" checked> '+e["botones"]["tipo_descarga"]["completa"]["texto"]+" <span>"+e["botones"]["tipo_descarga"]["completa"]["tamano"]+"</span></label></br>"}if(typeof e["botones"]["tipo_descarga"]["ligera"]!="undefined"){n+='<label class="btn btn-secondary"><input type="radio" name="options" id="option2" autocomplete="off" value="1"> '+e["botones"]["tipo_descarga"]["ligera"]["texto"]+" <span>"+e["botones"]["tipo_descarga"]["ligera"]["tamano"]+"</span></label>"+"</div>"}}if(typeof e["botones"]["aceptar"]!="undefined"){i='<button class="btn btn-default" type="button"><span>'+e["botones"]["aceptar"]["texto"]+"</span></button>";o=e["botones"]["aceptar"]["accion"]}theme.showMask("white");theme.showDescargaSelectivaModal(t,n,a,i,o);break}}};theme.mostrarBloqueoLicencia=function(e,t,i){var a=$("#remote-alert-modal-blue"),n=""+"<h2>"+textweb("license_17")+"</h2>"+"<p>"+textweb("license_18")+"</p>";theme.showHelperModal(a,n);theme.showMask("white")};theme.onOlvidoContrasena=function(e){if(!e.length||e==textweb("header_3")){_showAlert(textweb("header_3"));return false}$("#botonolvido").css("cursor","wait");getAJAX("/LMS/ajax.php?op=user.olvidocontrasena&olvidocontrasena="+encodeURIComponent(e),function(e){if(e.startsWith("OK"))$("#alertForgot").removeClass("hidden").addClass("alert-success").html(e.substring(2));else $("#alertForgot").removeClass("hidden").addClass("alert-danger").html(e.substring(5));$("#botonolvido").css("cursor","default");var t=$(".forgot-pass").height()+70;$(".login-box").animate({height:t+"px","margin-top":"-"+t/2+"px"},400,"easeOutCubic")});return false};theme.actualizarCamposFormulario=function(){if($("#selecciona_usuario4").is(":checked")){$(".fecha-nacimiento").removeClass("hidden")}else{$(".fecha-nacimiento").addClass("hidden")}if($("#selecciona_usuario2").is(":checked")){$("#txt_anonimo").addClass("hidden")}else{$("#txt_anonimo").removeClass("hidden")}$("#f input").removeClass("alert-danger")};theme.verificarVacios=function(e,t){var i=true;for(var a=0;a<e.length;a++){var n=document.getElementById(e[a]);if(!n)continue;if($(n).is(":disabled"))continue;var o=n.value;if(trim(o)==""){i=false;$(n).addClass("alert-danger")}else{$(n).removeClass("alert-danger")}}if(!i)$("#alertForm").addClass("alert-danger").removeClass("hidden").html(textweb("registro_code_campo_vacio"));return i};theme.verificarTamanoMinimo=function(e,t){var i=document.getElementById(e[0]);if($(i).is(":disabled"))return true;if(i.value.length<t){_showAlert(textweb("registro_code_campo_demasiado_pequeno"));i.focus();$(i).addClass("alert-danger");return false}return true};theme.centrarTools=function(){var e=$("#tools"),t=blink.windowWidth,i=$(".content-wrapper");var a=44,n=205;if(e.is(":visible")){var o=(blink.windowHeight-e.height()+a)/2,s=i.offset();if(innerWidth>579){if(mainNavOpen){e.css({top:o<n?n:o,bottom:"initial"})}else{e.css({top:o,bottom:"initial"})}}else{e.css({top:"initial",bottom:0})}if(1046<innerWidth){e.css({left:s.left+940})}else if(579<innerWidth&&innerWidth<1047){e.css({left:t-54})}else{e.css("left",0)}}};theme.resizeModal=function(e){var t="";if(typeof e!=="undefined"&&e){t=(e.indexOf(".")!==0?".":"")+e}$(t+" .modal").each(function(){var e=$(this),t=e.find(".modal-content"),i=e.find(".modal-body");if($(this).hasClass("in")==false){$(this).show()}var a=blink.windowHeight-50,n=$(this).find(".modal-header").outerHeight()||2,o=$(this).find(".modal-footer").outerHeight()||2;if(blink.windowWidth<480){t.css({height:blink.windowHeight-10});i.css({"max-height":blink.windowHeight-(n+o)})}else{$(".modal-content").removeAttr("style");t.css({"max-height":a,height:a});i.css({"max-height":a-(n+o)})}$(this).find(".modal-dialog").addClass("modal-dialog-center");if($(this).hasClass("in")==false){$(this).hide()}if(i.hasClass("modal-solapas")){$(".tab-content").css({"max-height":a-(n+o)})}})};theme.arrangeTOC=function(){var e=$(".navbar.libro"),t=$(".content-wrapper.libro");t.css("margin-top",e.height()+14)};theme.getFrameFinalPosition=function(e){var t=$(window).height()-e.height;var i={};i.fintop=t>100?t/2:t/1.5;i.finleft=($(window).width()-e.width)/2;return i};blink.theme.toggleSection=function(e){$(".js-class-section").hideBlink();var t=$(e).data("section");$("."+t).showBlink();theme.toggleAlerts(t)};blink.theme.toggleAlerts=function(e){var t=$(".alumnos-sin-aceptar"),i=$(".clase-sin-contenido");if(e==="js-alumnos-clase"){t.showBlink()}else{i.showBlink();t.hideBlink()}};blink.theme.updateActiveSection=function(e){var t=$(e),i=t.data("section"),a=$("#smenu").find("a"),n=a.filter(".active"),o=a.filter('[data-section="'+i+'"]');if(!o.length)o=t;$(".collapse-menu-active").text(t.text());n.removeClass("active");o.addClass("active")};blink.theme.configureSelector=function(){var e=$("#smenu"),t=e.find("button"),i=e.find("ul"),a=blink.windowWidth;if(a>767){t.hideBlink();i.removeClass("dropdown-menu")}else{t.showBlink();i.addClass("dropdown-menu")}};theme.onMisCursosCambiarEstadoOnline=function(t){var e="/LMS/ajax.php?op=course.cambiarstatusonlinecurso&idcurso="+t;getAJAX(e,function(e){if(e.startsWith("OK")){if($("#online"+t).hasClass("cursoonline")){$("#online"+t).removeClass("cursoonline")}else $("#online"+t).addClass("cursoonline")}else{_showAlert(e.substr(5));$("#online"+t).removeClass("cursoonline").prop("checked",false)}})};theme.onMisCursosCambiarDestacado=function(t){var e="/LMS/ajax.php?op=course.cambiardestacado&idcurso="+t;getAJAX(e,function(e){if(e.startsWith("OK")){if($("#destacado"+t).hasClass("cursodestacado")){$("#destacado"+t).removeClass("cursodestacado")}else{$("#destacado"+t).addClass("cursodestacado")}}else{_showAlert(e.substr(5));$("#destacado"+t).removeClass("cursodestacado").prop("checked",false)}})};theme.onMisCursosCambiarEnCatalogo=function(t){var e="/LMS/ajax.php?op=course.cambiarencatalogo&idcurso="+t;getAJAX(e,function(e){if(e.startsWith("OK")){if($("#catalogo"+t).hasClass("cursoencatalogo")){$("#catalogo"+t).removeClass("cursoencatalogo")}else $("#catalogo"+t).addClass("cursoencatalogo")}else{_showAlert(e.substr(5));$("#catalogo"+t).removeClass("cursoencatalogo").prop("checked",false)}})};theme.writeAudioPlayerButtonInfantil=function(e){var t=e.closest(".js-slide-wrapper").attr("data-slide-index"),i=$("#t"+t+"_panel_sonidos"),a=e.filter("img").attr("alt"),n=e.attr("id");var o=""+'<div class="player_infantil">'+'<a id="playersonido_'+n+'" data-slide-index="'+t+'"href="javascript:buttonPlaySoundPressed(\''+n+"','"+a+"');\">"+"<p>&nbsp;</p>"+"</a>"+"</div>";if(i.html().indexOf(a)==-1){i.append(o);e.remove()}};theme.actualizarBotonesCambioModo=function(){var $review=$(".review");var $botoneraReading=$(".workspace.reading");if(puedeRepetir){$review.addClass("repetible")}else{$review.find(".js-reset").remove();this.buttonState.disabled("#boton_reiniciar",true)}if(window.puedePulsarCorregir||window.esProfesor||!window.esExamen&&(modoClase==3||modoClase==4)){$review.showBlink()}else if($botoneraReading){$botoneraReading.find(".review").showBlink()}else{$review.hideBlink()}if(modoClase==3||modoClase==4){var class_modo=modoClase==3?"modo-rev":"";if(!window.esEditorial&&!window.esEditor)$(".content-wrapper").addClass("modo-revision");$(".modo_revision").showBlink();$(".revision-budget").addClass(class_modo);$(".reloj").hide();$(".duration-wrapper").hide();$(".attemps").find(".remain").hide();$(".attemps").find(".current").show();!window.esWeb&&blink.activity.currentStyle.Slider.removeLastItem()}else $(".modo_revision").hideBlink();if(modoClase==4){$(".mod_rev").removeClass("mod_rev");$(".modo_revision p").html(textweb("edit_slide_59"))}if(esProfesor&&(modoClase!=1&&modoClase!=2))$(".editar_ver").hideBlink();else $(".editar_ver").showBlink();if(window.esEditorial||window.esEditor){$(".editar_ver").showBlink();$(".modo_revision").hideBlink()}for(var i=0;i<secuencia.length;i++){if(eval("window.t"+i+"_slide"))eval("t"+i+"_slide.setMaxIntentos("+numMaxIntentos+");")}actualizarBotonesCambioModo_Aux()};theme.pintaNotaTransp=function(e,t){var i=viewToGrade(e);var a=gradeToView(i,"slide");if(isNaN(e)&&e!=""){a=e}var n=styleClassForGrade(0,"slide");if(typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()===true){a=blink.activity.currentStyle.gradeValue(a)}$("#nota_revision").val(a).removeClass(n).addClass(styleClassForGrade(i,"slide"))};theme.updateNota=function(indexTransp){var currentSlide=blink.activity.currentSection;if(typeof indexTransp!=="undefined"&&indexTransp!==null){currentSlide=indexTransp}var notaSlide=parseFloat($("#nota_revision").val().replace(",","."));if(isNaN(notaSlide)||parseInt(notaSlide)>grade_max){var val_nota=eval("grade_max*t"+currentSlide+"_slide.getClassification();");$("#nota_revision").val(numGradeToView(val_nota,"slide_revision")).show();return false}top.hayCambiosNota=true;hayCorreccionesProfesorSinGrabar=true;window.hayCorreccionesProfesorSinGrabar=true;var nuevaClasificacion=notaSlide/maxclasificacion;pintaNotaTransp(100*nuevaClasificacion);window["t"+window.secuencia[currentSlide]+"_slide"].clasificacionprofesor=nuevaClasificacion;var calificacion=calcularClasificacion();scormAPI.LMSSetValue("cmi.core.score.raw",calificacion);updateSCORM();this.pintaNotaAct(scormAPI.LMSGetValue("cmi.core.score.raw"));$("[name='"+"t"+window.secuencia[currentSlide]+"_clasificacion']").val();return true};theme.pintaNotaAct=function(e){var t=styleClassForGrade(0,"slide");var i=styleClassForGrade(grade_max,"slide");if(typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()){e=blink.activity.currentStyle.gradeValue(e)}if(e==""){$("#nota_revision").val("-").removeClass(i).removeClass(t).addClass(i)}else{$("#nota_revision").val(gradeToView(e,"slide_revision")).removeClass(i).removeClass(t).addClass(styleClassForGrade(e,"slide_act"))}};theme.validaWordSearch=function(e,t,i,a){var n=true;if(i){$(".js-exercise[name^='"+t+"_'] .js-answer").each(function(){var e=$(this);n=$.trim(e.val()).length<=a;n?e.removeClass("error"):e.addClass("error");return n})}return n&&validaPreguntas(e,t)};theme.validaNotaManualValue=function(e){var t=""+e;var i=maxclasificacion;if(typeof grade_max!="undefined"){t=""+viewToNumGrade(t);i=grade_max}return t.match(/\d{1,2}/)&&!isNaN(t)&&parseFloat(t)<=i};theme.updateRevisionSlide=function(e,t,i,a){var n=i.attr("id").split("_")[0],o=this.updateNotaSlide(e,i,n,a),s=this.updateComentarioSlide(t,i,n);top.hayCambiosNota=true;hayCorreccionesProfesorSinGrabar=true;window.hayCorreccionesProfesorSinGrabar=true;o&&s&&updateSCORM()};theme.updateNotaSlide=function(e,t,i,a){if(a===undefined){a=false}var n=function(e){var t=e.style.display;e.style.display="none";e.offsetHeight;e.style.display=t};var o=parseFloat(e);if(isNaN(o)||parseInt(o)>grade_max){return false}else{var s,r=window["t"+t.closest(".js-slide-wrapper").attr("data-slide-index")+"_slide"];s=numGradeToView(o,"slide");t.find("span").text(s);t.find(".js-nota-budget").data("grade",s);if(typeof blink.activity!=="undefined"&&typeof blink.activity.currentStyle!=="undefined"&&typeof blink.activity.currentStyle.styleBudget!=="undefined"){blink.activity.currentStyle.styleBudget(r,t,s)}window[i+"_slide"].clasificacionprofesor=o/grade_max;var l=calcularClasificacion(true);if(scormAPI.LMSGetValue("cmi.core.score.manual_raw")==-1){this.pintaNotaTransp(gradeToView(l,"slide_global"))}else{if(!a)_showAlert(textweb("aviso_updateNotaSlide_hayManual"))}if(!a){scormAPI.LMSSetValue("cmi.core.score.raw",l)}if(t[0]){n(t[0])}return true}};theme.updateComentarioSlide=function(e,t,i){var a=t.find(".js-nota-budget").first();t.find(".js-nota-budget").data("content",e).popover("destroy").popover({container:".content-wrapper",trigger:blink.isTablet?"click":"hover",placement:function(e,t){$(e).addClass("popover-info-nota");return"bottom"}}).on("shown.bs.popover",function(){$(document).one("touchstart",function(){$(".js-nota-budget").popover("hide")})});e==""?$(a).attr("data-original-title",textweb("No_hay_mensajes")).attr("data-title",textweb("No_hay_mensajes")).attr("data-content",""):$(a).attr("data-original-title",textweb("Mensaje_profesor")).attr("data-title",textweb("Mensaje_profesor")).attr("data-content",e);window[i+"_slide"].comentariosprofesor=e;return true};theme.updateRevisionSlideGlobal=function(e,t,i){var a=this.updateNotaSlideGlobal(e,i);var n=this.updateComentarioSlideGlobal(t);top.hayCambiosNota=true;hayCorreccionesProfesorSinGrabar=true;window.hayCorreccionesProfesorSinGrabar=true;if(a&&n){if(typeof func_after_updateRevisionSlideGlobal!="undefined"){var o=scormAPI.LMSGetValue("cmi.core.score.max");var s=e;if(o&&o!=grade_max){s=e/grade_max*o}func_after_updateRevisionSlideGlobal(s,t,i)}else{if(esWeb){if(scormAPI){scormAPI.LMSCommit("")}}else{updateSCORM()}}}};theme.updateNotaSlideGlobal=function(e,t){if(t===undefined){t=false}var i=function(e){var t=e.style.display;e.style.display="none";e.offsetHeight;e.style.display=t};var a=parseFloat(e);if(isNaN(a)||parseInt(a)>grade_max){return false}else{var n=numGradeToGrade(a);this.pintaNotaTransp(gradeToView(n,"slide_global"));var o=scormAPI.LMSGetValue("cmi.core.score.max");var s=n;if(!t){scormAPI.LMSSetValue("cmi.core.score.manual_raw",s);scormAPI.LMSSetValue("cmi.core.lesson_status",LESSON_STATUS_COMPLETED)}return true}};theme.updateComentarioSlideGlobal=function(e){var t=trim(e);$(".revision_container").attr("data-content",t).data("content",t).popover("destroy").popover({container:".modo_revision",trigger:blink.isTablet?"click":"hover",placement:function(e,t){$(e).addClass("popover-info-nota");return"bottom"}}).on("shown.bs.popover",function(){$(document).one("touchstart",function(){$(".revision_container").popover("hide")})});t==""?$(".revision_container").attr("data-original-title",textweb("No_hay_mensajes")):$(".revision_container").attr("data-original-title",textweb("Mensaje_profesor"));scormAPI.LMSSetValue("cmi.comments",t);return true};theme.validaPreguntas=function(e,t){var i="";var a="";$(".js-exercise[name^='"+t+"_']").find(".js-query , .js-answer").each(function(){$(this).val($.trim($(this).val()))});if(e=="ejercicio"||e=="rank"){i=$(".js-exercise[name^='"+t+"_']").filter(function(){return $(this).find(".js-query").val()!=""})}else if(e=="vf"||e=="test"){i=$(".js-exercise[name^='"+t+"_']").filter(function(){return $(this).find(".js-query").val()!=""||$(this).find(".js-answer").val()!=""});a=i.filter(function(){return $(this).find(".js-answer").val()!=""})}else{i=$(".js-exercise[name^='"+t+"_']").filter(function(){return $(this).find(".js-query").val()!=""||$(this).find(".js-answer").val()!=""});a=i.filter(function(){return $(this).find(".js-query").val()!=""&&$(this).find(".js-answer").val()!=""})}switch(e){case"ejercicio":return i.length>1&&i.find(".js-answer:checked").length>0;case"clasificar":var n=$(".js-answer[name^='"+t+"_']:first option").length-1;return a.length>0&&n>1;case"wordsearch":case"test":return a.length>0&&a.length==i.length;case"vf":var o=$(".js-exercises-control[name^='"+t+"_']").filter(function(){return $.trim($(this).val())!=""});return a.length>0&&o.length==2&&a.length==i.length?$.trim(o[0].value)!=$.trim(o[1].value):false;case"matching":return a.length>1&&a.length==i.length;case"rank":return i.length>1;default:return false}};theme.validaBlanks=function(e,t){var i=$("#id"+t+"_"+e).val(),a=$("#"+t+"_respuestaEnLinea").prop("checked"),n=["Formato Incorrecto","Sin respuestas","Respuestas Vacas"],o=function(e,t){return e.split(t).length-1};try{if(!i||o(i,"@@")%2!=0){throw n[0]}var s=i.match(/@@([^@]*)@@/g);if(!s.length){throw n[1]}if(!a){return true}_.each(s,function(e){var t=e.slice(2,e.length-2).split("||"),i=_.find(t,function(e){return e==="*"});if(i){throw n[2]}});return true}catch(e){e===n[2]&&_showAlert(textweb("error_empty_choose_answer_inline"));return false}};theme.validaBlankImages=function(e,t){var i=$("#id"+t+"_"+e).val(),a=["Formato Incorrecto","Sin respuestas","Respuestas Vacas"],n=function(e,t){return e.split(t).length-1};try{if(!i||n(i,"@@")%2!=0){throw a[0]}var o=i.match(/@@([^@]*)@@/g);if(!o.length){throw a[1]}_.each(o,function(e){var t=e.slice(2,e.length-2).split("||"),i=_.find(t,function(e){return!e.match(/((<img){1}[^@]+(src=('|"){1}[^@]+('|"){1}){1}[^@]+(\/>){1})/g)});if(i){throw a[1]}});return true}catch(e){e===a[2]&&_showAlert(textweb("error_empty_choose_answer_inline"));return false}};theme.registerNumericFields=function(e){$("input[name^='"+e+"_operando']").keydown(function(e){if(!checkPressNumerico(e)){e.preventDefault()}});var t=$(".js-one-operation[name^='"+e+"']");t.each(function(e){$(this).change(function(e){var t=validaOperacion($(this));if(t!="ok")_showAlert(textweb(t))})})};theme.validaCrossWordsPuzzle=function(e,t){var i=function(){var a=false;var e=$('[name^="'+t+'_word"]');e.each(function(t){var i=$(this);e.each(function(e){if(t!=e){if($.trim(i.val())!=""&&$.trim(i.val())==$.trim($(this).val())){a=true;return false}}});if(a)return false});return a};if($("#"+t+"_crossword").text().length>0&&!i()){return true}return false};theme.hideHTMLOverflow=function(){var e=$(document).scrollTop();var t=["overflow","overflow-x","overflow-y"];var a=$("html");$.each(t,function(e,t){var i=a.css(t);if(i){a.data(t,i)}a.css(t,"")});a.data("scrollTop",e);$("body").css("top",-e)};theme.restoreHTMLOverflow=function(){var e=["overflow","overflow-x","overflow-y"];var a=$("html");var t=a.data("scrollTop");$.each(e,function(e,t){var i=a.data(t);a.css(t,i);a.data(t,"")});a.data("scrollTop","");$(".modal-open").removeClass("modal-open");if(t)$(document).scrollTop(t);$("body").css("top","initial")};theme.responseCommit=function(e){var t=$("#js-commit-response");if(e.startsWith("ERROR")){if(!t.length){$("body").prepend('<div id="js-commit-response-overlay"></div>');$("body").prepend('<div id="js-commit-response" class="response-commit">'+textweb("problema_conexion_guardar_commit")+'<button type="button" id="" class="btn js-retry-commit">'+textweb("reintentar_guardar_commit")+"</button>"+"</div>");$("#js-commit-response").addClass("error-commit");$(".js-retry-commit").on("click",function(){updateSCORM()})}else if(t.hasClass("success-commit"))t.toggleClass("success-commit error-commit").html(textweb("problema_conexion_guardar_commit")+".")}else{var i=blink.activity.currentStyle;if(i&&i.postCommitScorm){i.postCommitScorm()}if(t.length&&t.hasClass("error-commit")){t.toggleClass("success-commit error-commit").html(textweb("commit_guardado")+".");setTimeout(function(){t.css({opacity:0}).delay(501).remove();$("#js-commit-response-overlay").css({opacity:0}).delay(501).remove()},2e3)}}};theme.completarCamposModoRevisionCorreccion=function(){var e=$(".info-alumno img"),t=$(".nombre-alumno span");if(modoClase==3||modoClase==4){if(!imagenUsuarioRev)e.hideBlink();else{e.attr("src",imagenUsuarioRev).attr("title",nombreUsuarioRev);e.attr("aria-label",nombreUsuarioRev)}if(!nombreUsuarioRev)t.hideBlink();else t.html(cmi.core.student_name+"<br>"+cmi.core.student_surname);if(mostrarNota){var i=calcularClasificacion(true);var a=cmi.manual_raw==-1||offline&&esWeb&&cmi.manual_raw.trim()===""?i:parseFloat(cmi.manual_raw);pintaNotaTransp(gradeToView(a,"slide_global"));$(".revision_container").attr("data-content",cmi.comments);if(cmi.comments!=""&&typeof cmi.comments_date!="undefined"&&cmi.comments_date!=""){$(".revision_container").attr("data-content",cmi.comments_date+"<br/>"+cmi.comments)}cmi.comments==""?$(".revision_container").attr("data-original-title",textweb("No_hay_mensajes")):$(".revision_container").attr("data-original-title",textweb("Mensaje_profesor"))}}};theme.finishClass=function(e,t){var i=false,t=t||"";if(!editar&&(checkModoExamen()||checkModoPracticas())){var a=getMsgConfirmFinishClass();if(a.length&&!window.completed&&!window.scormFailed&&(e||confirm(a))){}else{return false}}stopSlideEffects();if(!editar){setPizarraOff(true);if(checkModoExamen()||checkModoPracticas()){corregirTodaClase();var n=calcularClasificacion();if(!window.completed&&!window.scormFailed){i=true;finishSCORM(t);window.completed=true;formatEndClassScreen()}else{return i}stopClock();pauseBackgroundSound();calculateSCORMSessionTime();$("#fin_tiempo_empleado").html((tiempoEnClase.getUTCHours()>0?tiempoEnClase.getUTCHours()+"h ":"")+pintaDosCifras(tiempoEnClase.getUTCMinutes())+"m "+pintaDosCifras(tiempoEnClase.getUTCSeconds())+"s");$(".duration-wrapper").hideBlink();if(soloContenido){$(".numero_aciertos2").hide()}else if(pendienteCalificacionProfesor&&!ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES)$("#fin_clasificacion").html(textweb("course_50"));else{if(clasificacionManual!=""&&clasificacionManual!=-1)n=clasificacionManual;var o=gradeToView(n,"slides_final");$("#MensajeFinal").html(getFinishMessage(o));if(typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()){o=blink.activity.currentStyle.gradeValue(o)}$("#fin_clasificacion").html(o);formatForCategories(o)}if(modoContinuo){conmutarModoContinuo();$("[id^=transp]").hide()}habilitarBoton("boton_reiniciar",false);habilitarBoton("boton_rotulador",false);habilitarBoton("boton_subrayador",false);habilitarBoton("boton_borrador",false);habilitarBoton("boton_notes",false);habilitarBoton("boton_modo_pizarra",false);habilitarBoton("boton_modoContinuo",false);$("#previous_up").hide();$("#previous_down").hide();$("#next_up").hide();$("#next_down").hide();$("[id=progressbar_text]").hide();$("#paginador").hide();$("#corregir").hide()}}else{if(idcurso)showCurso(idalumno)}return i};theme.finishClassAndLogout=function(e){var t=blink.theme.finishClass(e);if(t){blink.events.once("ajax:success",function(e,t){_showAlert(textweb("onlineexams_send_ok"));redireccionar("/LMS/index.php?logoff=1")})}};theme.setPizarraOn=function(e,t){if(!puedeUsarHerramienta(e,t))return false;pizarraOff=false;if(e)setSessionAttribute("PIZARRA","true");herramientaPizarra=t;var i=t==blink.tools.DRAW,a=t==blink.tools.HIGHLIGHT,n=t==blink.tools.BRUSH,o=t==blink.tools.NOTE,s=t==blink.tools.ERASER;$("canvas").removeClass("canvaspintar canvassubrayar canvasbrocha canvasnote canvasborrar");if(i)$("canvas").addClass("canvaspintar");else if(a)$("canvas").addClass("canvassubrayar");else if(n)$("canvas").addClass("canvasbrocha");else if(o)$("canvas").addClass("canvasnote");else if(s)$("canvas").addClass("canvasborrar");$(document.body).not(".canvas_events_loaded").addClass("canvas_events_loaded").each(function(){if(blink.hasTouch){this.addEventListener("touchstart",blink.tools.closeNotesOnEvent,false)}else{$(this).mousedown(function(e){blink.tools.closeNotesOnEvent(e)})}});$(".canvasdivclass").addClass("active").css("pointer-events",t!=0?"auto":"none").show().not(".canvas_events_loaded").addClass("canvas_events_loaded");if(!blink.theme.useIndependentEraser&&t!=0){$(".borrador").show();posicionarBorrador()}};theme.setPizarraOff=function(e){pizarraOff=true;hidePopupColores();if(e)setSessionAttribute("PIZARRA","false");$("canvas").removeClass("canvaspintar canvassubrayar canvasbrocha canvasnote canvasborrar");if(window.hideCanvasElement){if(herramientaPizarra!=blink.tools.NOTE){if(typeof id!="undefined")$("canvas").eq(id).hide();$(".canvasdivclass").hide()}else pizarraOff=false}else{$(".canvasdivclass").css("pointer-events","none").removeClass("active")}$(".borrador").hide();herramientaPizarra=0};theme.cleanRichText=function(e){blink.utils.cleanTextareaCKEDITOR(e)};theme.ocultarHilo=function(e){$('.js-message-wrapper[data-id="'+e+'"] > .js-reply-form').hide()};theme.generarExcelCentrosDemo=function(){redireccionar('/admin/admin.php?op=listadocentros&excelDemo="1"')};theme.marcarCursoDemoElegido=function(e){var t=e.attr("id");var i=t.substring(9);if(e.hasClass("estrella_demo_vacia")){if(!textweb("marcar_libro_favorito")||confirm(textweb("marcar_libro_favorito"))){blink.ajax("/LMS/ajax.php?op=backpack.registrarCursoDemoElegido&idcurso="+i,function(e){if(e.startsWith("ERROR"))if(e.length>5)alert(e.substr(5));else alert(e);else{var t=JSON.parse(e.substr(2));$(t).each(function(e,t){$("#estrella_"+t).removeClass("estrella_demo_vacia").addClass("estrella_demo_llena")})}})}}else if(e.hasClass("estrella_demo_llena")){borrarCursoDemo(i,e,"profe")}};theme.borrarCursoDemo=function(e,i,a){if(!textweb("confirm_borrar_libro_demo")||confirm(textweb("confirm_borrar_libro_demo"))){blink.ajax("/LMS/ajax.php?op=course.borrarCursoDemoElegido&idcurso="+e,function(e){if(e.startsWith("ERROR")){if(e.length>5)alert(e.substr(5));else alert(e)}else{if(a=="profe"){i.removeClass("estrella_demo_llena").addClass("estrella_demo_vacia")}else{i.closest("div.un_curso_tiny_icon").hide();var t=parseInt($("#div_nlibros").html());t-=1;$("#div_nlibros").html(t)}}})}};theme.marcarCursoPrescritoElegido=function(e){var t=e.attr("id");var i=t.substring(9);if(e.hasClass("estrella_demo_vacia")){if(!textweb("marcar_libro_favorito")||confirm(textweb("marcar_libro_favorito"))){blink.ajax("/LMS/ajax.php?op=eschPaperBookPrescriptions.registrarCursoPrescritoElegido&idcurso="+i,function(e){if(e.startsWith("ERROR"))if(e.length>5)alert(e.substr(5));else alert(e);else{var t=JSON.parse(e.substr(2));$(t).each(function(e,t){$("#estrella_"+t).removeClass("estrella_demo_vacia").addClass("estrella_demo_llena")})}})}}else if(e.hasClass("estrella_demo_llena")){borrarCursoPrescrito(i,e,"profe")}};theme.borrarCursoPrescrito=function(e,i,a){if(!textweb("confirm_borrar_libro_demo")||confirm(textweb("confirm_borrar_libro_demo"))){blink.ajax("/LMS/ajax.php?op=course.borrarCursoDemoElegido&idcurso="+e,function(e){if(e.startsWith("ERROR")){if(e.length>5)alert(e.substr(5));else alert(e)}else{if(a=="profe"){i.removeClass("estrella_demo_llena").addClass("estrella_demo_vacia")}else{i.closest("div.un_curso_tiny_icon").hide();var t=parseInt($("#div_nlibros").html());t-=1;$("#div_nlibros").html(t)}}})}};theme.toolsDrawNote=function(t,e,i,a){t.visible="1";var n=blink.tools;var o=parseInt(n.mmToPx(n.startw))/2,s=parseInt(n.mmToPx(n.starth))/2;var r=parseInt(n.mmToPx(4*3));var l=parseInt(n.mmToPx(3.5*3));var d=parseInt(n.mmToPx(n.startw)),c=parseInt(n.mmToPx(n.starth)),u=n.mmToPx(n.endw),f=n.mmToPx(n.endh),h=parseInt(n.mmToPx(t.x)),p=parseInt(n.mmToPx(t.y));t.txt=t.txt.replace(/\\n/g,"\n");theme.toolsAddNewNote(t,e,a);var m=t.txt.replace(/\n/g,"<br/>");m=n.urlify(m);$(e).find("#pos_"+t.ID+" .note-text").html(m);$(document).on("tap","#postitedit"+t.ID,function(){theme.toolsEditNote(t)});var v=function(e){e.stopPropagation();e.stopImmediatePropagation();return};$("#pos_"+t.ID).css({left:h,top:p}).draggable({opacity:.5,containment:"parent",cancel:".deletedigitalnote, .postit-edit-content, .digitalnote",start:function(e,t){blink.activity.currentStyle.Slider.stop();window.isDragging=true;$(".item").width("auto")},stop:function(e,t){blink.activity.currentStyle.Slider.stop();n.onEndDrag(notesArray,e,t);window.isDragging=false}});$("#pos_"+t.ID).on("tap",function(e){theme.toolsOpenNote(t,u,f)});$(document).on("tap","#postitsave"+t.ID,function(){theme.toolsSaveNote(t,n)});theme.toolsSaveOnBlurNote(t);$("#"+t.ID).width(d).height(c);$("#borrarNota"+t.ID).on("tap",function(e){e.preventDefault();e.stopPropagation();if(confirm(textweb("confirm_borrar_nota")))n.deleteNote(t.ID);else theme.toolsCloseNotes()});if(i){$("#"+t.ID).trigger("tap");$("#boton_notes").removeClass("btn-on");$("#postitedit"+t.ID).trigger("tap");window.setPizarraOff(false)}};theme.toolsAddNewNote=function(e,t){var i=""+'<div id="pos_'+e.ID+'" class="nota_pos">'+'<div id="'+e.ID+'" class="nota">'+'<div class="nota_content">'+'<a class="deletedigitalnote control delete" id="borrarNota'+e.ID+'" href="javascript:void(0);">'+textweb("mensaje_10")+"</a>"+'<div  class="js-save postit-save hidden" style="height: 100%;">'+'<textarea rows="6" maxlength="'+blink.theme.maxAnnotLength+'" id="postittext'+e.ID+'" class="digitalnote">'+e.txt+"</textarea><br>"+'<span id="postitsave'+e.ID+'"  class="save btn-postit">'+textweb("postit_close")+"</span>"+"</div>"+'<div class="js-edit" style="height: 100%;">'+'<div class="note-text"></div><br>'+'<span id="postitedit'+e.ID+'" class="btn-postit">'+textweb("postit_edit")+"</span>"+"</div>"+"</div>"+"</div>"+"</div>";$(t).append(i)};theme.limitLinesPosit=function(e,t){var i=1;if(window.event){i=t.keyCode}else if(t.which){i=t.which}var a=e.value;if(i!=46&&i!=8){var n=(a.match(/\r?\n/g)||[]).length*20;var o=a.length+n;var s=this.maxAnnotLength;if(o>=s){if(blink.isAndroid&&$(e).val().length>s){$(e).val($(e).val().substr(0,s))}t.stopPropagation();t.preventDefault();return false}}};theme.toolsOpenNote=function(e,t,i){var a=$("#pos_"+e.ID);var n=$("#"+e.ID);a.css("opacity",1);if(!a.hasClass("ui-draggable-dragging")){theme.toolsShowNote(e);theme.toolsSizingNote(e,t,i);blink.tools.allocateInContainment(n,true);if(blink.isIos){n.find("textarea").select()}}};theme.toolsShowNote=function(e){var t=$("#"+e.ID);t.addClass("note_opened").find("div").show()};theme.toolsSizingNote=function(e,t,i){var a=$("#"+e.ID);a.width(t).height(i)};theme.toolsSaveNote=function(e,t){var i=$("#"+e.ID).find(".nota_content");var a=i.find("textarea").val();a=a.replace(/\n/g,"<br/>");a=t.urlify(a);$(i).find(".js-edit .note-text").html(a);$(i).find(".js-save").hideBlink();$(i).find(".js-edit").showBlink();$(i).find("textarea").blur();blink.tools.updateNote(e.Id)};theme.toolsSaveOnBlurNote=function(e){$("#"+e.ID).find("textarea").on("blur",function(e){var t=$(this).parents(".nota").attr("id");blink.tools.updateNote(t)})};theme.toolsCancelSaveNote=function(e){};theme.toolsEditNote=function(e){var t=$("#"+e.ID).find(".nota_content");$(t).find(".js-save").showBlink();$(t).find(".js-edit").hideBlink();$(t).find("textarea").focus()};theme.toolsCloseNotes=function(){var a=blink.tools;if($(".js-edit").hasClass("hidden"))$('[id^="postitsave"]').trigger("tap");$(".note_opened").each(function(){var e=parseInt(a.mmToPx(20)),t=parseInt(a.mmToPx(0));var i=parseInt(a.mmToPx(50));$(this).removeClass("note_opened").width(parseInt(a.mmToPx(a.startw))).height(parseInt(a.mmToPx(a.starth))).find("div").hide().parents(".nota_pos").draggable("enable");a.allocateInContainment($(this),false)})};theme.editarPerfil=function(e,t){if(typeof e=="undefined"){e=[]}if(typeof t=="undefined"){t=[]}$(".main .edit button").hide();$(".name").hide();$("#msgRegister").addClass("hidden");$("#externals").hide();$("#profile .main .image a.edit").show();$("#profile .main .image > img").css({opacity:"0.4"});$(".content-box-profile input, .content-box-profile select, .content-box-profile textarea, .content-box-profile text").prop("readonly",false).removeAttr("readonly");$(".content-box-profile input:not(.password), .content-box-profile textarea").removeClass("hidden");$(".content-box-profile .data .datas").addClass("hidden");$('.content-box-profile input[type="radio"], .content-box-profile select, .content-box-profile input[type="text"]').prop("disabled",false);$(".rpassword, .name-edit input").show();$("#pais, #lengua").removeClass("selectToText").attr("dir","ltr");$("#buscadorcentro").prop("disabled",bCheckCentroT);$(".confirm-buttons").slideDown();if(usuarioAlumno&&regNombreCentro!=""&&!$("input[name=regbar]").length){$("#nombre, #apellidos").prop("disabled",true)}if(usuarioExternoDeXimdex){$("#nombre, #apellidos, #email").prop("readonly",true)}if(esUsuarioDemo){$(document.f).find("input, textarea, select, a").prop("disabled",true);$("#botonOK").unbind("click").click(function(){_showAlert(textweb("registro.error.usuario_demo"))});return}theme.editUserProfileRules(e,t)};theme.editUserProfileRules=function(e,t){if(typeof e!="undefined"&&e.length>0){for(var i=0;i<e.length;i++){$("#"+e[i]).prop("disabled",false)}}if(typeof t!="undefined"&&t.length>0){for(var i=0;i<t.length;i++){$("#"+t[i]).prop("disabled",true)}}};theme.noEditarPerfil=function(){$(".main .edit button").show();$(".name").show();$("#profile .main .image a.edit").hide();$("#profile .main .image > img").css({opacity:"1"});$(".content-box-profile input, .content-box-profile select, .content-box-profile textarea").prop("readonly",true);$(".content-box-profile input:not(.password), .content-box-profile textarea").addClass("hidden");$(".content-box-profile .data .datas").removeClass("hidden");$('.content-box-profile input[type="radio"],.content-box-profile input[type="checkbox"], .content-box-profile select').prop("disabled",true);$(".rpassword, .name-edit input").hide();$("#pais, #lengua").addClass("selectToText").attr("dir","rtl").attr("readonly","readonly");$(".confirm-buttons").slideUp();$("#externals").show()};theme.activateImageZoom=function(){$(".slide-wrapper").on("dblclick",".floating:has(.image_slide)",function(e){var t=$(this).find(".image_slide").attr("src");var i=$(this).index();if(blink.isApp&&!blink.isOfflinePC){blink.rest.image(t)}else{blink.Pictures.goFullScreen($(this),i)}e.stopPropagation()}).on("mouseover",".floating:has(.image_slide)",function(){if(blink.activity.currentStyle.canSeeZoomFlag()){$(this).find(".zoom_flag").stop(true).fadeIn("fast")}}).on("mouseout",".floating:has(.image_slide)",function(e){if(!$(e.relatedTarget).hasClass("zoom_flag_img")){$(this).find(".zoom_flag").stop(true).fadeOut("fast")}}).on("click",".js-zoom-flag",function(e){$(this).closest(".floating").dblclick()}).on("click","img:not(.image_slide):not(.Wirisformula)",function(){if($(this).hasClass("bck-i-fullscreen-enabled")||$(this).closest("figure").hasClass("bck-i-fullscreen-enabled")){if(!$(this).closest("a").length&&!$(this).closest(".bck-link").length&&!$(this).closest(".bck-activity-link").length&&!$(this).hasClass("blink-fullscreen-active")){theme.zoomImage($(this))}}else if(!$(this).hasClass("bck-i-fullscreen")&&!$(this).closest("figure").hasClass("bck-i-fullscreen")){if($(this).closest(".js-slide-wrapper").data("type")!=24)return;if(!$(this).parent().hasClass("player")){var e=$(this).attr("src"),t=300,i=50,a=$(".item .item-container").innerWidth()/2,n=100,o=$(this).height(),s=$(this).width();if(s<a&&s>n&&o<t&&o>i){blink.rest.image(e)}}}});$(".bck-i-fullscreen-wrapper").mouseenter(function(){$(this).find(".zoom_flag").fadeIn()}).mouseleave(function(){$(this).find(".zoom_flag").fadeOut()}).on("click",".zoom_flag",function(e){blink.theme.zoomImage($(this).next("img"))})};theme.zoomImage=function(e){var t=e.attr("src");var i=e.index();var a=1e3;var n=new Image;n.src=e.attr("src");if(blink.isApp&&!blink.isOfflinePC){var o=e.closest("figure").find("figcaption").text();var s=o&&blink.domain.allowCKEdShowCaption()?o:"";blink.rest.image(t,s)}else{blink.Pictures.goFullScreen(e,i);if(a<n.naturalWidth&&a<n.naturalHeight){setTimeout(function(){gallery.updateSize(true)},300);screenfull.request()}}};theme.togglePanel=function(e,t,i){$(window).trigger("panel."+e);var a=$("#"+e);if(a.hasClass("active")||i){a.removeClass("active");conmutarEstadoBoton(t,true)}else{a.addClass("active");conmutarEstadoBoton(t,false);if($("#info-libro").hasClass("active")&&typeof openInfoLibro!="undefined"){openInfoLibro()}if($("#book-index").hasClass("active")&&typeof openIndexLibro!="undefined"){openIndexLibro()}}};theme.getStyleGradebook=function(){if(!blink.gradebook)return;var e=blink.theme.styles[blink.gradebook.cursoJSON.style_name],t;if(e){t=new e}else if(blink.activity.currentStyle){t=blink.activity.currentStyle}else{t=new blink.theme.styles["basic"]}return t};theme.generaThumbSlide=function(e,t,i,a){var n="";if(a)n+='<a href="javascript:void(0);" id="linkSlide_'+e+'" '+(a?'onClick="return showSlideFromID('+e+')" onDblClick="return showSlideGenerator('+e+')"':"")+">";n+='<div class="thumbslide type_'+t+'">';n+='<span class="slide_miniatura" id="slide_miniatura_'+e+'"';n+=getCommonThumb(e,t,i,false);if(a)n+='<span id="labelSlide_'+e+'">'+(e+1)+"</span></a>";return n};theme.generaThumbActivity=function(e,t,i,a){var n="";if(t==7&&!isExternalURL(a)){var o=getMediaType(a);switch(o){case"image":t=3;break;case"video":t=7;break;case"sound":t=5;break;default:t=2;break}}if(t==7&&isExternalURL(a)){t=6}n+='<div class="thumbactivity type_'+t+'">';n+='<span class="activity_miniatura" id="activity_miniatura_'+e+'"';n+=getCommonThumb(e,t,i,true);return n};theme.generaPanelColores=function(e){var t=blink.tools.manager.colors,i='<div class="colors"><ul>',a=$("#"+e).addClass("popover-content");$.each(t,function(e,t){i+="<li "+'class="color '+t.className+'" '+'data-color="'+e+'" '+'style="background-color:'+t.hex+'">'+"</li>"});i+="</ul></div>";return $(i).appendTo("#"+e)};theme.generaPanelGomets=function(n){var o=["circulo_rojo.png","circulo_verde.png","circulo_amarillo.png","circulo_azul.png","cuadrado_rojo.png","cuadrado_verde.png","cuadrado_amarillo.png","cuadrado_azul.png","triangulo_rojo.png","triangulo_verde.png","triangulo_amarillo.png","triangulo_azul.png"];var s='<div class="panel-gomets"><ul>';$.each(o,function(e,t){var i=n+"_gomet_"+e+"_0",a=e%4==3?" last-of-shape":"";s+='<li class="gomet'+a+'">';s+='<img id="'+i+'" '+'class="gomet-img draggable" '+'src="../images/i/gomets/'+o[e]+'" '+'onmousedown="setSelectedGomet(this);">';s+="</li>"});s+="</ul></div>";$("#"+n).append(s)},theme.setTopByHeight=function(e,t){if(e===undefined||e===""||t===undefined||t===""){return false}else{if($(e).css("display")!=="none"){var i=$(e).css("height");$(t).css("top",i)}return true}};theme.autoscript=function(e,t){var i=document.getElementById(e);if(i){var a=t();var n=document.getElementById(e);if(n.outerHTML){n.outerHTML=a}else{var o=document.createElement("div");o.innerHTML="\x3c!--TO REPLACE--\x3e";var s=n.parentNode;s.replaceChild(o,n);s.innerHTML=s.innerHTML.replace("<div>\x3c!--TO REPLAC--\x3e</div>",a)}}};theme.displayDrop=function(){var e=function(e,t){return e+$(t).outerWidth()},t=$(".subjects .btn-group")[0],i=$(".subjects .btn-group")[1],a=$(".subjects").outerWidth(),n=$(t).find(".btn").toArray().reduce(e,0);if(n>a){$(t).hide();$(i).removeClass("visible-xs").css("display","inline-block").css("width","100%").find("button").css({width:"100%",maxWidth:"100%"});$("#tools").css("z-index",1001)}};theme.onAfterUnloadVentana=function(){if(blink.activity&&blink.activity.currentStyle){blink.activity.currentStyle.onAfterUnloadVentana()}};theme.navigateDigitalBooks=function(){blink.events.on("digitalbook:viewerLoaded",function(){blink.getCourse(window.idcurso).done(function(e){bpdf.curso=e;if(blink.activity.currentStyle&&blink.activity.currentStyle.navigateOnlyUnitDigitalBooks&&blink.activity.currentStyle.navigateOnlyUnitDigitalBooks()){var i=_.findWhere(bpdf.curso.units,{id:idtema.toString()}),t=_.reduce(bpdf.curso.units,function(e,t){return i.subunits},[])}else{var t=_.reduce(bpdf.curso.units,function(e,t){return e.concat(t.subunits)},[])}var a=_.filter(t,function(e){return e.type=="libro"});bpdf.book={data:function(){return _.find(a,function(e){return e.id==window.idclase})},actualIndex:function(){var e=this.data();return _.indexOf(a,e)},isFirst:function(){var e=this.actualIndex();return!e},isLast:function(){var e=this.actualIndex();return e+1==a.length},next:function(){var e=this.actualIndex();var t=e+1;return a[t]},prev:function(){var e=this.actualIndex();var t=e-1;return a[t]}};bpdf.pagination.isFirst=function(){var e=bpdf.isMobileTheme()?bpdf.rc.getVisibleZoomedPages():bpdf.getVisiblePages();return e[0]==0};bpdf.pagination.isLast=function(){var e=bpdf.isMobileTheme()?bpdf.rc.getVisibleZoomedPages():bpdf.getVisiblePages(),t=bpdf.pageMode.isContinous()?bpdf.rc.getCurrentPageNumber():Math.max.apply(null,e)+1;return t==bpdf.getPageCount()};bpdf.pagination.carousel.update=function(){var e=$("#page-prev"),t=$("#page-next"),i=e.add(t);var a=bpdf.pagination.isFirst(),n=bpdf.pagination.isLast();if(bpdf.pageMode.isContinous()||bpdf.isMobileTheme()){bpdf.pageMode.isContinous()&&i.addClass("continuo").hideBlink();a?e.showBlink():e.hideBlink();n?t.showBlink():t.hideBlink()}else{i.removeClass("continuo").showBlink()}var o=a&&bpdf.book.isFirst(),s=n&&bpdf.book.isLast();e.toggleClass("disabled",o);t.toggleClass("disabled",s)};bpdf.pagination.carousel.update();$(bpdf.viewerElement).bind("pageChanged",function(){bpdf.isMobileTheme()&&setTimeout(function(){bpdf.pagination.carousel.update()},50)});bpdf.changePageDesktop.nextBook=function(){if(bpdf.book.isLast())return;var e=bpdf.book.next();this.goNext(e)};bpdf.changePageDesktop.prevBook=function(){if(bpdf.book.isFirst())return;var e=bpdf.book.prev();this.goPrev(e)};bpdf.changePageDesktop.goNext=function(e){bpdf.pagination.savePage(1,e.id,window.idcurso);var t=e.url;if(bpdf.pageMode.isContinous())t=addParamUrl(t,"_continuo",1);redireccionar(t)};bpdf.changePageDesktop.goPrev=function(e){var t=addParamUrl(e.url,"_lastPage",1);if(bpdf.pageMode.isContinous())t=addParamUrl(t,"_continuo",1);redireccionar(t)};bpdf.changePageDesktop.getNext=function(){if(bpdf.pageMode.isContinous()&&!bpdf.pagination.isVisible())return false;var e=bpdf.getVisiblePages();var t=_.max(e)+1;var i=t+1;return!bpdf.pagination.isLast()&&i};bpdf.changePageDesktop.getPrev=function(){if(bpdf.pageMode.isContinous()&&!bpdf.pagination.isVisible())return false;var e=bpdf.getVisiblePages();var t=_.min(e)+1;var i=t-1;return!bpdf.pagination.isFirst()&&i};bpdf.changePageDesktop.next=function(){var e=this.getNext();e?this.set(e):this.nextBook()};bpdf.changePageDesktop.prev=function(){var e=this.getPrev();e?this.set(e):this.prevBook()};bpdf.prevPage=function(){bpdf.changePageDesktop.prev()};bpdf.nextPage=function(){bpdf.changePageDesktop.next()}})})};theme.insertarImagenSlide=function(e){if(e.file&&e.ruta){$(".image-name-drop").text(e.file).removeClass("image-name-drop");$(".image-input-path-drop").val(e.ruta).removeClass("image-input-path-drop");$(".image-delete-drop").removeClass("image-delete-drop hidden")}};theme.calculateOffset=function(e,t,i){var a=parseInt(e.units[t].subunits[i].offset);if(a&&a>-1){return a}else{var n=0;var o=0;for(var s=0;s<=t;s++){for(var r=0;r<e.units[s].subunits.length;r++){if(s==t&&r==i){return n+o}if(e.units[s].subunits[r].type=="libro"){if(typeof e.units[s].subunits[r].offset!="undefined"&&parseInt(e.units[s].subunits[r].offset)>-1){n=parseInt(e.units[s].subunits[r].offset);o=parseInt(e.units[s].subunits[r].pags.length)}else{o+=parseInt(e.units[s].subunits[r].pags.length)}}}}}return 0};theme.initTags=function(e,t,i){if(!e||typeof e!="object"){return false}var a;for(a in e){if(e.hasOwnProperty(a)){this.showTag(a,e[a],t,i)}}return true};theme.setTag=function(e,t,i){if(e&&this.addKeyValue(e,e,i)){var a=e.trim();switch(t){case"hidden":this.addKeyValue(a,a,i);break;case"tag":default:this.showTag(a,a,t,i)}return true}return false};theme.showTag=function(e,t,i,a){var n=$(".label-wrap");if(i=="keyword"){n=$(".klabel-wrap")}n.prepend("<span class='"+i+"' id='"+e+"'>"+t+"<em class='remove-"+i+"'></em></span>");this.addKeyValue(e,t,a);return};theme.removeTag=function(e,t){var i=t.val();if(!i||!(i=JSON.parse(i))){i={}}if(i.hasOwnProperty(e)){delete i[e]}t.val(JSON.stringify(i))};theme.addKeyValue=function(e,t,i){var a=i.val();if(!a||!(a=JSON.parse(a))){a={}}e=e.trim();t=t.trim();var n;for(n in a){if(a.hasOwnProperty(n)){if(n==e||a[n]==e||n==t||a[n]==t){return false}}}a[e]=t;i.val(JSON.stringify(a));return true}})(blink);(function(e){"use strict";e.popovers={};var t=e.popovers;t.list=[];t.register=function(e){this.list.push(e.get(0))};t.deregister=function(e){_.without(this.list,e.get(0))};t.hideAll=function(e){if(!e)e=[];var t=[];for(var i=0;i<e.length;i++){t.push(e[i].get(0))}e=t;for(var i=0;i<this.list.length;i++){var a=this.list[i];if(e.indexOf(a)==-1){$(a).popover("hide").closest("li").removeClass("active")}}};t.isVisible=function(e){if(e.data("bs.popover")!==null)return e.data("bs.popover").tip().hasClass("in");else return false};t.is=function(e){return!!e.data("bs.popover")}})(blink);(function(e){"use strict";var t=new e.Event("showBlink");e.fn.hideBlink=function(){return e(this).addClass("hidden")};e.fn.showBlink=function(){return e(this).removeClass("hidden").trigger(t)};e.fn.toggleBlink=function(){return e(this).toggleClass("hidden")};e.fn.disable=function(){return e(this).prop("disabled",true)};e.fn.enable=function(){return e(this).prop("disabled",false)}})(jQuery);$(function(){$(document).on("blur",'.search input[type="search"]',function(){var e=$(this);if(e.val()!=""){e.css("width",95)}else{e.css("width",55)}});$(".js-tooltip").tooltip();$(document).on("keydown",".digitalnote",function(e){blink.theme.limitLinesPosit(this,e)})});function getCommonThumb(e,t,i,a){var n=getMediaType(i);var o="";if(t==3&&!a){o+='style="background-image: url(../images/video.gif)"></span>'}else if(i!=""&&i!=undefined){if(n=="doc"){if(i.indexOf(".zip")!=-1){o+='style="background-image: url(../images/i/zip.png)"></span>'}else{o+='style="background-image: url(../images/i/documentos.png)"></span>'}}else if(n=="other"||n=="geogebra"){o+='style="background-image: url(../images/i/download.gif)"></span>'}else if(n!="image"){o+='style="background-image: url(../images/video.gif)"></span>'}else{o+='style="background-image: url('+i+')"></span>'}}else{o+='style="background-image: url(../images/Imagenes/gif1x1.gif)"></span>'}o+="</div>";return o}blink.dictionary={name:"Common Dictionary",isAvailable:function(){return!blink.user.esAnonimo()&&window.BLINKDOMAIN==="centropruebas"}};blink.selectiveDownload={isSelectiveDownload:function(e){if(e&&e.error){return false}return true},findCourseJSON:function(t,e){var i=false;if(typeof e!=="undefined"){i=e.find(function(e){return e.elemId==t})}if(typeof i==="undefined"){i=false}return i},status:function(){blink.selectiveDownload.updater.clearSyncs();blink.rest.elementsStatus()},updater:{shortSync:0,longSync:0,longRefresh:1e4,shortRefresh:1e3,courseElementType:0,downloadingPhaseWeight:75,installingPhaseWeight:20,movingFilesPhaseWeight:5,elementsWithErrorNoSpace:Array(),clearSyncs:function(){clearTimeout(this.shortSync);this.shortSync=0;clearTimeout(this.longSync);this.longSync=0},load:function(e){this.clearSyncs();var u=false;var f=$(".items.cursos").hasClass("edit-mode");var h=0;if(!blink.selectiveDownload.isSelectiveDownload(e)){return}usingSelectiveDownload=true;var p=e;var m="download paused downloaded download_blocked delete error";var v="green orange gray red small";blink.rest.getParam("firstInstallation",function(e){if(e!=false&&e!="false"){modal={titulo:textweb("sd_info_title"),contenido:textweb("sd_info_text"),tipo:"panel",botones:{aceptar:{texto:textweb("tablettxt_accept"),accion:function(){blink.rest.setParam("firstInstallation",false)}}}};mostrarModalDescargaSelectiva(modal)}});var g=this;selectiveDownloadCourses.forEach(function(t){var i="",a="",e="",n="green",o=t["idcurso"];$("#view_button_"+o).addClass("downloadable");$(".status.wrapper").removeClass("hidden");var s=blink.selectiveDownload.findCourseJSON(o,p);var r='div[data-id="status_progress_'+o+'"]';if(!$(r).hasClass("hidden")){$(r).addClass("hidden")}var l='div[data-id="status_loader_'+o+'"]';if(!$(l).hasClass("hidden")){$(l).addClass("hidden")}$('div[data-id="status_icon_'+o+'"]').removeClass(m);$('div[data-id="status_text_'+o+'"]').removeClass(v);var r='div[data-id="status_progress_'+o+'"]';$(r).removeClass("over50");for(var d=0;d<=100;d++){$(r).removeClass("p"+d)}r='[data-id="status_progress_'+o+'"]';$(".sd-progress-circle"+r).removeClass(m);$(".sd-value-bar"+r).removeClass(m);$(".over50"+r).removeClass(m);$(".sd-first50-bar"+r).removeClass(m);if(!s){i=e="download";title=textweb("sd_status_download");$('div[data-id="status_'+o+'"]').off("click").on("click",function(){blink.rest.connection(function(e){if(e&&t["tipo"]=="completa"){blink.rest.downloadElement(o,g.courseElementType,2)}else{if(e&&t["tipo"]=="ligera"){a={titulo:textweb("sd_download_type_title"),contenido:textweb("sd_download_type_text"),tipo:"panel",botones:{aceptar:{texto:textweb("tablettxt_accept"),accion:function(){blink.rest.downloadElement(o,0,$("input[name=options]:checked").val())}},tipo_descarga:{completa:{texto:textweb("sd_download_type_full"),tamano:t["tamano"]["completa"]>0?t["tamano"]["completa"]+" MB":""},ligera:{texto:textweb("sd_download_type_light"),tamano:t["tamano"]["ligera"]>0?t["tamano"]["ligera"]+" MB":""}}}}}if(!e){a={titulo:textweb("tablettxt_require_connection"),tipo:"alert"}}mostrarModalDescargaSelectiva(a)}})});$('div[data-id="status_icon_'+o+'"]').addClass("download");$('div[data-id="status_text_'+o+'"]').html(title);$('div[data-id="status_text_'+o+'"]').addClass("green")}else{if(f&&s.status.code!="READY_TO_DELETE"&&s.status.code!="DELETING"){i=e="delete";title=textweb("sd_status_delete");$('div[data-id="status_icon_'+s.elemId+'"]').addClass(e);$('div[data-id="status_text_'+s.elemId+'"]').html(title);$('div[data-id="status_text_'+s.elemId+'"]').addClass("gray");$('div[data-id="status_text_'+s.elemId+'"]').addClass("small");$('div[data-id="status_'+s.elemId+'"]').off("click").on("click",function(){if(confirm(textweb("sd_status_delete_message"))){blink.rest.deleteElement(s.elemId,g.courseElementType)}});return}switch(s.status.code){case"READY_TO_DOWNLOAD":case"WORKING":case"PAUSED":var c=0;i="working";u=true;if(s.status.code=="READY_TO_DOWNLOAD"){title=textweb("sd_status_ready")}else{if(s.status.code=="WORKING"){title=textweb("sd_status_working")}else{title=textweb("sd_status_paused");i="paused";n="orange";u=false}switch(s.status.phase){case"DOWNLOADING":c=s.status.value*(g.downloadingPhaseWeight/100);break;case"INSTALLING":c=g.downloadingPhaseWeight+s.status.value*(g.installingPhaseWeight/100);break;case"MOVING_FILES":c=g.downloadingPhaseWeight+g.installingPhaseWeight+s.status.value*(g.movingFilesPhaseWeight/100);break}if(c<3&&i!="paused"){c=3}}var r='div[data-id="status_progress_'+s.elemId+'"]';$(r).removeClass("hidden");if(Math.round(c)>50){$(r).addClass("over50")}$(r).addClass("p"+Math.round(c));if(i=="paused"){r='[data-id="status_progress_'+s.elemId+'"]';$(".sd-progress-circle"+r).addClass("paused");$(".sd-value-bar"+r).addClass("paused");$(".over50"+r).addClass("paused");$(".sd-first50-bar"+r).addClass("paused")}break;case"UPDATED":i=e="downloaded";title=textweb("sd_status_uploaded");break;case"READY_TO_DELETE":case"DELETING":title=textweb("sd_status_deleting");i=e="deleting";n="gray";var r='div[data-id="status_loader_'+s.elemId+'"]';$(r).removeClass("hidden");break;case"ERROR":case"UNKNOWN":title=textweb("sd_status_error");i=e="error";n="red";if(s.status.error=="NO_SPACE"&&!g.elementsWithErrorNoSpace.includes(s.elemId)){g.elementsWithErrorNoSpace.push(s.elemId);h++}break}if(typeof e!="undefined"&&e!=""){$('div[data-id="status_icon_'+s.elemId+'"]').addClass(e)}$('div[data-id="status_text_'+o+'"]').html(title);$('div[data-id="status_text_'+o+'"]').addClass(n);$('div[data-id="status_'+s.elemId+'"]').off("click").on("click",function(){blink.rest.connection(function(e){if(i=="error"||i=="paused"){if(!e){a={titulo:textweb("tablettxt_require_connection"),tipo:"alert"}}else{if(i=="error"){var t=g.elementsWithErrorNoSpace.indexOf(s.elemId);g.elementsWithErrorNoSpace.splice(t,1);blink.rest.downloadElement(s.elemId,g.courseElementType,s.downloadType)}else if(i=="paused"){blink.rest.resumeDownloadElement(s.elemId,g.courseElementType)}}}if(i=="working"){blink.rest.pauseDownloadElement(s.elemId,g.courseElementType)}mostrarModalDescargaSelectiva(a)})})}});if(h>0){_showAlert(textweb("sd_status_error_no_space"))}if(u){blink.selectiveDownload.updater.doShort()}else{blink.selectiveDownload.updater.doLong()}},doLong:function(){this.longSync=setTimeout(blink.selectiveDownload.status,this.longRefresh)},doShort:function(){this.shortSync=setTimeout(blink.selectiveDownload.status,this.shortRefresh)}}};(function(e){"use strict";var t={};function filterDims(e,t,i){var a=$(window).width()-60;var n=$(window).height()-60;if(!e)e=a;if(!t)t=n;if(e>a||t>n){var o=e/a;var s=t/n;var r=Math.max(o,s);e/=r;t/=r}var l={width:e,height:t};if(i||i===undefined)l=addPosition(l);return l}function addPosition(e){var t=$.extend({},e);t.left=($(window).width()-e.width)/2;var i=$(window).height()-e.height;t.top=i>100?i/2:i/1.5;return t}function prepareDimsForCss(e){var t=$.extend({},e);t["z-index"]=9e3;t.position="fixed";return t}function showParent(e,t,i){blink.events.trigger("iframe:show:before");var a=$("#iframe_div"),n=$("#multimedia_iframe"),o=$("#class_iframe"),s=i?n:o;a.removeClass("audio").css("margin-left","").css(prepareDimsForCss(e));o.add(n).hideBlink();if(e.width)s.width(e.width);if(e.height)s.height(e.height);if(e.cssClass)a.addClass(e.cssClass);if(e.cssClass==="audio"){$("#iframe_div").find(".btn-close-iframe").hideBlink()}else{$("#iframe_div").find(".btn-close-iframe").showBlink()}if(t||t===undefined)showMask();$("#iframe_div").show();s.showBlink()}function resizeParent(e,t){var i=$("#iframe_div"),a=$("#multimedia_iframe"),n=$("#class_iframe"),o=t?a:n;i.css(prepareDimsForCss(e));if(e.width)o.width(e.width);if(e.height)o.height(e.height)}function resizeClose(){var e=$("#iframe_div .btn-close-iframe");e.css({position:"absolute",top:"-"+(e.height()+7)+"px",right:"-"+e.width()/4+"px","z-index":9999})}t.audio=function(t,i,a,n){if(!shouldShowUrlInIframe(t)){return blink.rest.openUrl("viewer",t)}window.cerrarIframe(a);blink.events.once("audio:close",function(){hideIFrame()});var o=sonido_ultimo_id_abierto==t,e=blink.windowWidth<1024?20:30,s=!blink.isTablet,r={bottom:e,width:360,"margin-left":-150,left:"50%",cssClass:"audio"};sonido_ultimo_id_abierto=t;blink.events.once("iframe:hide:after",function(){if(!o){showParent(r,false,true);var e="multimedia_iframe";if(typeof a==="string"&&a!==null&&a!=""){e=a}writeAudioPlayer(e,t,s,i,n)}})};t.video=function(e,t,i){if(!shouldShowUrlInIframe(e)){blink.rest.openUrl("viewer",e)}else{var a=filterDims();window.cerrarIframe();blink.events.once("iframe:hide:after",function(){showParent(a,true,true);writeVideoPlayer("multimedia_iframe",e,false,a.height,true,i,t)})}};t.flash=function(e){if(!shouldShowUrlInIframe(e)){blink.rest.openUrl("viewer",e);return}var t=filterDims();showParent(t,true,true);writeFlashPlayer("multimedia_iframe",e,t.height)};t.image=function(i,a,e){if(!shouldShowUrlInIframe(i)){blink.rest.openUrl("viewer",i);return}var t=new Image,n,o;if(!e){window.cerrarIframe()}t.onload=function(){n=this.width;o=this.height;var t=filterDims(n,o);t["cssClass"]="image";var e=$('<img src="'+i+'" style="width:'+t.width+"px;height:"+t.height+'px" />');e.on("load",function(){showParent(t,true,true);$("#multimedia_iframe").append($(this)).show();if(typeof a!=="undefined"&&""!=a){var e='<div class="pswp__caption__center">'+a+"</div>";$("#multimedia_iframe").append(e)}})};t.src=i;$(window).resize(function(){if($("#iframe_div").hasClass("image")){var e=filterDims(n,o);resizeParent(e,true)}})};e.rest=t})(blink.theme);(function(e){if(blink.isApp){e.rest=$.extend({},blink.rest,blink.theme.rest,blink.restApp)}else{e.rest=$.extend({},blink.rest,blink.theme.rest)}})(blink);Slide.prototype.update=function(e,t){blink.events.trigger("slide:update:after",this);var i=$("#"+this.prefijo+"-attempts"),a=$("#"+this.prefijo+"-remain-attempts"),n=$("#"+this.prefijo+"-used-attempts");if(this.esEjercicio){if(!checkPuedeEditar()||this.clasificacionprofesor!=-1){this.setDisabled(this.prefijo)}this.setReviewButtons();if(this.esAutocorregible||this.tienePistas||this.esJuegoAutoevaluable){if(checkPuedePulsarCorregir()){if(this.esEjercicioNoEvaluable){this.numMaxIntentos=this.allowInfinityAttempts()?Infinity:this.numMaxIntentos;n.text(Math.max(0,this.intentos)).parent().attr("style","");a.parent().attr("style","display: none;")}else{a.text(Math.max(0,this.numMaxIntentos-this.intentos))}if($(".o-attempts").length){i.attr("data-o-count",Math.max(0,this.numMaxIntentos-this.intentos))}if(this.getClassification()==1||this.intentos>=this.numMaxIntentos||this.esEjercicioNoEvaluable){this.solutionShown=false;!this.esEjercicioNoEvaluable&&this.setDisabled(this.prefijo);if(this.checkSendToCorrectIndividual()){this.showSolution();this.solutionShown=true}else{this.refreshSolutionButton(e)}}}else if(checkModoCorreccion()||checkModoRevision()){n.text(this.intentos);if($(".o-attempts").length){i.attr("data-o-count",Math.max(0,this.numMaxIntentos-this.intentos))}this.refreshSolutionButton(e)}else if(window.completed){this.refreshSolutionButton(e)}}else if(checkPuedePulsarCorregir()){a.text(Math.max(0,this.numMaxIntentos-this.intentos));this.isDone()&&this.setDisabled(this.prefijo)}if(!this.esJuegoAutoevaluable||this.esJuegoAutoevaluable&&!esExamen){this.setBudget(this.prefijo,true)}if(this.esJuegoAutoevaluable&&this.clasificacion==1){a.text(this.numMaxIntentos-1)}if(mostrarNota){if(!puedeCorregir&&this.getClassification()==0&&!this.tieneRespuestas()){$(".corregir_nota").hideBlink()}else{$(".corregir_nota").showBlink()}}if(this.comentariosprofesor)pintaComentariosProfesor(this.comentariosprofesor,this.prefijo);$("[name="+this.prefijo+"_clasificacion]").val(this.getClassification())}else{this.clasificacion=1;this.setReviewButtons()}blink.events.trigger("slide:updated",this)};Slide.prototype.refreshSolutionButton=function(e){if(checkMostrarSoluciones()){var t=$("#"+this.prefijo+"-btn-solution"),i=this.solutionShown?textweb("edit_slide_45"):textweb("edit_slide_44");t.text(i)}};Slide.prototype.onBeforeShow=function(){this.detectSlideChanges(this.prefijo);if(blink.isIos){blink.theme.video.restartPlayers();blink.events.once("showSection:after",function(){var e=blink.activity.getIndexsFromSection(blink.activity.currentSection);blink.theme.video.recreateVideoJS(e)}.bind(this))}};function switchSolution(e,t){var i=window[e+"_slide"];if(i.solutionShown||t){i.solutionShown=false;i.solutionPartialShown=false;i.hideSolution()}else{i.showSolution();i.solutionShown=true}i.refreshSolutionButton(true);i.setReviewButtons();if(blink.activity&&blink.activity.currentStyle&&blink.activity.currentStyle.onClickSolution){blink.activity.currentStyle.onClickSolution(i.solutionShown,e)}}function goBusquedaMisMensajes(e,t,i){borrarValoresDefecto();e||(e="buscador_mensajes");i||(i="0");var a=$("#"+e).val(),n=$("#mensajes_list"),o="/LMS/mensajes.php?busqueda="+encodeURIComponent(a)+"&fm="+i+"&g="+t+"&icons=1",s=function(e){n.replaceWith(e);$(".mensajes_pagination").hideBlink()};n.html('<div id="msg-waiting"></div>');o=adjustOnlineURL(o);blink.ajax(o,s,{},{waitingElement:"#msg-waiting",urlMode:"noDijest"})}function onAfterShowSlide(e){setPizarraOff();blink.popovers&&blink.popovers.hideAll();blink.events.trigger("showSlide:after",e);var t=window["t"+e+"_slide"];t&&t.onAfterShowSlide&&t.onAfterShowSlide()}function msgboxSlideProperties(){var e=$('input[name="idcurso"]').val();var t=$("#transp"+blink.activity.currentSection).data("id");showMsgBox("","/LMS/msgbox.php?op=slide.slideproperties&slide_id="+t+"&idcurso="+e)}function onAfterInicializarTransparencias(){if(window.completed){$("#fin_tiempo_empleado").html(function(){var e=window.cmi.core.total_time.split(":"),t="";if(e[0]>0)t+=e[0]+"h ";t+=e[1]+"m ";t+=e[2].split(".")[0]+"s";return t});var e=calcularClasificacion(true),t=$("#nota_revision");if(soloContenido){$(".numero_aciertos2").hide()}else{var i=scormAPI.LMSGetValue("cmi.core.score.manual_raw");if(i!=""&&i!=-1)e=i;var a=gradeToView(e,"slides_global");if(pendienteCalificacionProfesor&&!ACTIVITY_GRADE_IGNORE_NOTGRADED_SLIDES){$("#fin_clasificacion").html(textweb("course_50"))}else{$("#fin_clasificacion").html(a)}t.val(a);notafinal_100=viewToGrade(a);if(esAprobado(notafinal_100)){$("#MensajeFinal").html(textweb("course_64"));t.removeClass("r_suspenso")}else{$("#MensajeFinal").html(textweb("course_65"));t.addClass("r_suspenso")}if(typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()){t.removeClass("r_suspenso");t.addClass("r_aprobado")}formatForCategories(a);$(".numero_aciertos2").show()}}for(var n=0,o=window.secuencia.length;n<o;n++){this.setBudget("t"+n)}!editar&&blink.theme.completarCamposModoRevisionCorreccion();blink.events.trigger("initSlides:after")}function setBudget(e,t){if(editar)return;var i=window[e+"_slide"],a=$("#"+e+"_revision-budget"),n=a.find(".js-nota-budget"),o=i.comentariosprofesor!=""?textweb("Mensaje_profesor"):textweb("No_hay_mensajes"),s=i.clasificacionprofesor!=-1;var r=!i.esEjercicio?"":parseInt(i.getClassification(),10)<0||!i.esAutocorregible&&!s&&!i.esJuegoAutoevaluable?"P":grade_max*i.getClassification();r=numGradeToView(r,"slide_budget");if(typeof blink.activity.currentStyle.hideGrade!=="undefined"&&blink.activity.currentStyle.hideGrade()){r=blink.activity.currentStyle.gradeValue(r)}n.data({grade:r,content:i.comentariosprofesor}).attr({"data-title":i.comentariosprofesor==""&&blink.user.esAlumno()&&!blink.domain.showCommentPopover()?"":o,"data-grade":r,"data-content":i.comentariosprofesor}).find("span").text(i.tipo!=TIPOS_TRANSPARENCIAS.TEXTO?n.data("grade"):"");if(typeof blink.activity.currentStyle.styleBudget!=="undefined"){blink.activity.currentStyle.styleBudget(i,n,r)}if(i.tipo==TIPOS_TRANSPARENCIAS.TEXTO||i.tipo==TIPOS_TRANSPARENCIAS.IMAGEN)a.hideBlink();if(estadoCompletado>1||i.tieneRespuestas()&&!i.esAutocorregible||s||i.isDone()||t&&blink.theme.showGradeOnCorrect()&&i.intentos)a.addClass("modo-rev").show();if(i.esEjercicioNoEvaluable&&i.intentos>0){a.addClass("modo-rev no-evaluable").show();setCheckBudget(n,r==10||r=="100%")}if(i.tipo==TIPOS_TRANSPARENCIAS.ARCHIVO_ENTREGABLE&&(!i.tieneRespuestas()||blink.activity.esActividadEntregable))a.hideBlink();if(ALUMNO_SIN_PROFESOR&&r=="P"){a.hideBlink()}if(modoVisualizacionLabel=="standalone"&&esPopup){a.hideBlink()}if(i.esEvaluableManual==SLIDE_NO_EVALUABLE&&!i.esAutocorregible&&!blink.activity.esdeber&&!esExamen){a.hideBlink()}n[0]&&redraw(n[0])}function setCheckBudget(e,t){var i=e,a="right";if(t){$(i).css("filter","hue-rotate(130deg) brightness(1.3)")}else{a="wrong";$(i).css("filter","none")}i.html('<span class="no-evaluable-'+a+'"></span>')}function stopButtonPlaySoundPressed(){hideIFrame()}function buttonPlaySoundPressed(e,t,i,a){if(blink.isApp){if(t.startsWith("../"))t=t.substr(2);if(!t.startsWith("/")&&!t.match(/^https?:\/\//)){t="/"+t}}blink.theme.destroyVideoJS(e);pausePlayingAudio();blink.rest.audio(t,e,i,a)}function validaOperacion(e){var t=parseInt(e.find(".js-oper1").val(),10);var i=e.find(".js-operator").val();var a=parseInt(e.find(".js-oper2").val(),10);if(a>t){if(i=="-")return"edit_slide_74";else if(i=="/")return"edit_slide_75"}if(i=="/"&&a==0)return"edit_slide_100";return"ok"}function actualizarModoClaseFin(){if(!esWeb)blink.activity.currentStyle.setMinHeightToSlide();if(!checkModoCorreccion()&&!checkModoRevision()){$(".duration-wrapper").showBlink()}}function finishTime(){_showAlert(textweb("edit_slide_48"));blink.activity.finishClass(true)}var redraw=function(e){e.style.display="none";e.offsetHeight;e.style.display=""};$(document).ready(function(){"use strict";blink.events.trigger("docReady:before");blink.theme.updateWindowSizes();blink.theme.setMainContainerDimensionForDefaultHeader();if(blink.isIos){$(document).on("touchmove","#remote-modal",function(e){if(e.currentTarget==e.originalEvent.target){e.preventDefault()}}).on("touchmove",".modal-header, .modal-footer",function(e){e.preventDefault()})}$(".fillblanks-draggable-wrapper, .fillblanks-wrapper").addClass(function(){return navigator.userAgent.toLowerCase().contains("iphone")?"iphone":""});$(".contenido").on("click",".imagen.actividad , .img-course",function(e){e.preventDefault();if(blink.isTablet||MobileEsp.isMobilePhone||blink.isTabletApp){var mask=$(this).siblings(".mask").length?$(this).siblings(".mask"):$(this).find(".mask"),img=$(this),icons=mask.find("a").not(".control"),maskHeight=img.height(),maskWidth=img.width(),posY=(maskHeight-icons.length*50)/2,posX=(maskWidth-icons.length*50)/2,j=0,i=icons.length;if(!mask.hasClass("active")){if(icons.length==1){eval(icons.first().attr("onclick"))}else{mask.showBlink().addClass("active").animate({opacity:1},400,function(){$("body").one("click",function(){icons.each(function(){$(this).stop(true).animate({opacity:0,bottom:-50},350,"easeInOutQuad")});mask.removeClass("active").addClass("hidden")})});if(posY<0){icons.each(function(){$(this).css("left",posX+50*j++).stop(true).animate({bottom:(maskHeight-50)/2,opacity:1},350+50*j,"easeInOutQuad")})}else{icons.css("left",(maskWidth-50)/2);icons.each(function(){var e=posY+50*--i;$(this).stop(true).animate({bottom:e,opacity:1},350+50*i,"easeInOutQuad")})}}}}});if(!blink.isTablet&&!MobileEsp.isMobilePhone&&!blink.isTabletApp){$(document).on("mouseenter",".wrap-mask",function(){$(this).find(".mask").css("cursor",$(this).find(".mask").children("a:visible").length==1?"pointer":"auto");var e=$(this),t=e.find("img"),i=t.height(),a=t.width(),n=e.find("a:visible").not(".control"),o=(i-n.length*50)/2,s=(a-n.length*50)/2,r=n.length;if(o<0){n.each(function(e){$(this).css("left",s+50*e).stop(true).animate({opacity:1,bottom:(i-50)/2},350+50*(e+1),"easeInOutQuad")})}else{n.css("left",(a-50)/2);n.each(function(){var e=o+50*--r;$(this).stop(true).animate({opacity:1,bottom:e},350+50*r,"easeInOutQuad")})}});$(document).on("mouseleave",".wrap-mask",function(){var e=$(this),t=e.find("a").not(".control");t.each(function(){$(this).stop(true).animate({opacity:0,bottom:-50},350,"easeInOutQuad")})})}$(".mask").click(function(e){e.preventDefault();if($(this).children("a:visible").length==1){eval($(this).find("a:visible").first().attr("onclick"))}}).each(function(){$(this).css("cursor",$(this).children("a:visible").length==1?"pointer":"auto")});$(".mask a").click(function(e){e.stopPropagation()});$("#remote-modal").on("shown.bs.tab",'a[data-toggle="tab"]',function(e){blink.theme.resizeModal()});blink.events.on("ajax:complete",function(){blink.theme.resizeModal()});blink.events.on("afterShortanswersUpdate",function(e){$("#"+e+"_saq").add("#"+e+"_html-book").find("textarea").not($(".wrapped")).addClass("form-control wrapped").wrap('<div class="textarea-answer" data-caracteres="0" data-text-caracter="'+textweb("caracteres")+'"></div>').parent("textarea-answer").attr("maxlength")});$(window).on("orientationchange",function(e){blink.currentPage.lastOrientation=window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape";blink.theme.updateWindowSizes();var t=$(".ui-autocomplete");if(t.is(":visible")){t.hide()}blink.theme.resizeModal();if(!blink.isApp)resizeIframe();blink.popovers&&blink.popovers.hideAll();blink.theme.centrarTools();blink.currentPage.onOrientationChange&&blink.currentPage.onOrientationChange(e);if(blink.isIosApp){setTimeout(function(){$(window).trigger("resize")},500)}setTimeout(showNavTabs,200)}).on("resize",function(e){blink.theme.updateWindowSizes();blink.theme.resizeModal();if(!blink.isApp||blink.isOfflinePC)resizeIframe();blink.popovers&&blink.popovers.hideAll();blink.theme.centrarTools();blink.currentPage.onResize&&blink.currentPage.onResize(e);setTimeout(showNavTabs,200)}).on("load",function(){blink.isLoaded=true});if(blink.isChromebookApp&&false){var $viewport=null;var content="";$("head meta").each(function(e,t){var i=$(t);if(i.attr("name")=="viewport"){$viewport=i;content=i.attr("content");return false}});var reloadAndroidViewport=function(){$viewport.attr("content",isOrientationPortrait()||$(window).width()<500?content:"")};$(window).on("resize",function(e){reloadAndroidViewport()});reloadAndroidViewport()}$(document).ajaxError(function(e,t,i,a){if(i.url.match(/msgbox.php/gi)){try{blink.theme.hideMask();$(".modal").hideBlink()}catch(e){blink.log.error(e)}standardAJAX("ERROR")}});showNavTabs();$(".blink-hover").on("mouseenter",function(){$(this).addClass("blink-hover-active")}).on("mouseleave touchend",function(){$(this).removeClass("blink-hover-active")});window.uploadStart=function(e){this.pb=$(this.movieElement).closest(".pb-container").find(".progress");this.pb.showBlink();return true};window.uploadProgress=function(e,t,i){var a=Math.ceil(t/i*100);this.pb.find(".progress-bar").css({width:a+"%"})};window.uploadComplete=function(e,t){this.pb.hideBlink().attr("id","")};if(blink.isIpad||blink.isIphone){var $body=jQuery("body");$(document).on("focus","input",function(e){$body.addClass("fixfixed")}).on("blur","input",function(e){$body.removeClass("fixfixed")})}});$(document).ready(function(){blink.events.on("ajax:begin",function(e,t){if(!t.animation)return;blink.theme.spinner.show()});blink.events.on("ajax:success",function(e,t,i){if(!t.animation)return;if(typeof i=="string"&&(i.startsWith("RELOAD")||i.startsWith("GO")))return;blink.theme.spinner.hide()});blink.events.on("ajax:error",function(e,t){if(!t.animation)return;blink.theme.spinner.hide()})});function showNavTabs(){var e=$(".content-main-tabs.nav.nav-tabs > li:not(.active)");if(e.length){e.each(function(e){$(this).delay(200*e).animate({opacity:1},400)})}}var mywindow=$(window),windowWidth=mywindow.width(),windowHeight=mywindow.height(),mainNavOpen=false,switchMenuWidth=580,mobile=false;isPhone=false;$(document).ready(function(){var e=$("#main-nav"),t=$("#main-nav-launcher"),i=$("#desktop-launcher"),a=$(".content-wrapper"),n=$("#tools"),o;var s=MobileEsp.DetectAndroid();var r=MobileEsp.DetectIos();var l=MobileEsp.DetectWindowsPhone();if(s==true||r==true||l==true){mobile=true}var d=MobileEsp.DetectAndroidPhone();var c=MobileEsp.DetectIphoneOrIpod();if(d==true||c==true||l==true){isPhone=true}if(window.addEventListener){window.addEventListener("load",function(){FastClick.attach(document.body)},false)}$(".alert").alert();$(".navbar-user").on("shown.bs.popover",function(){$("body").on("click",function(e){$(this).unbind("click");$(".navbar-user").popover("hide")})});if(windowWidth>580){$("#goup").goup({appear:300,scrolltime:600,imgsrc:"../themes/responsive/images/shared/goup.png",width:50,place:"bottom-right",fadein:500,fadeout:500,opacity:.5,marginX:2,marginY:5})}t.click(function(e){blink.theme.toggleMainNav()});if(windowWidth<switchMenuWidth){e.addClass("mobile");$(".wrap-contenido-indice").addClass("mini")}$(window).resize(function(){if(window.innerWidth<switchMenuWidth){e.removeClass("mobile");$(".wrap-contenido-indice").removeClass("mini");e.addClass("mobile");$(".wrap-contenido-indice").addClass("mini")}else{e.removeClass("mobile");$(".wrap-contenido-indice").removeClass("mini")}});function loadDesktop(){$("#desktop").css({opacity:1,"z-index":101}).load("desktop.html").fadeIn(1e3,"easeOutQuad")}i.click(function(e){e.preventDefault();loadDesktop()});if(!mobile)$("#tools a").tooltip({html:true})});(function(e){"use strict";var t=function(){function Main(){}return Main}();e.Domains=e.Domains||{};e.Domains.main=t})(window.blink);(function(e){"use strict";var t=e.Domains.main;var i=function(){function WirisDecorator(){this.extraPlugins=["ckeditor_wiris"];this.toolbar={name:"dominio",items:["ckeditor_wiris_formulaEditor","ckeditor_wiris_formulaEditorChemistry"]}}WirisDecorator.prototype=new t;WirisDecorator.prototype.constructor=WirisDecorator;return WirisDecorator}();e.Domains.iomaristascl=i;e.Domains.smchile=i;e.Domains.colombobritanico=i})(window.blink);(function(m){m.activity=_.extend(m.activity||{},{currentSection:0,numSlides:0,originalNumberSlides:0,initSecuencia:[],secuencia:[],secuencia_inicial:[],sections:[],changedSlideTitles:{},$wrapper:null,$leftControl:null,$rightControl:null,$indicators:null,lastChange:null,myScroll:null,navigation:null,offsetX:0,currentUploadSection:null,slidePreview:false,resourcesList:null,resourcesModal:null,pageIsLoading:false,pull:false,random:false,hasFinalSlide:false,init:function(e,t){if(e&&e!=undefined){this.esdeber=e}else{this.esdeber=false}if(typeof t!=="undefined"&&t!==null&&t){this.idClaseOriginal=t}else{this.idClaseOriginal=0}var i=this.style||this.defaultStyle;if(!window.esWeb){this.reloadData();this.bindDomEvents()}this.initSecuencia=Array.from(window.secuencia);this.originalNumberSlides=$("#actividad-data > div").length-$("#actividad-data div[id=final]").length;if(typeof i=="undefined")i=m.theme.styles["basic"];this.currentStyle=new i(window.esWeb?"":new blink.Slider);this.currentStyle.init();this.currentStyle.loadedAfterInit&&blink.events.trigger(true,"style:loaded");var a=this.currentStyle;if(!window.esWeb){this.pull=$("#slidesPull").val()>=1;this.random=$("#ordenAleatorio").val()==1;var n=this;blink.events.on("style:loaded",function(){blink.tools.manager.initialize(n.currentStyle.tools);a.changeHighBar();var e="onorientationchange"in window,t=e?"orientationchange":"resize";window.addEventListener(t,function(){a.changeHighBar()});blink.activity.optionsActivity();n.bindBlinkEvents();n.hasFinalSlide=$("#actividad-data div[id=final]").length>0||$("#actividad div[id=final]").length>0;var i=$("#activitySequencing");if(esAlumno&&3!=window.modoClase&&1==i.val())n.initSequencingBehaviour()});blink.events.on("managerTools:inited",function(){blink.events.trigger(true,"activity:loaded")})}this.showDigitalObejct()},showDigitalObejct:function(){editar&&typeof CKEDITOR!=="undefined"&&CKEDITOR.on("instanceReady",function(e){!blink.activity.allowsSantillanaGO?$(".cke_button__santillana_digital_object").hide():$(".cke_button__santillana_digital_object").show()})},optionsActivity:function(){var e=[];if((this.pull||this.random)&&!window.editar&&(blink.user.esAlumno()||idalumno)){var t=[],i=[],a=0,n=false;if($("#slidesPull").val()>=1){a=parseInt($("#slidesPull").val())}for(var o=0;o<window.numSlides;o++){if(window["t"+o+"_slide"].intentos>0)n=true}if(suspdata.hasOwnProperty("secuencia")&&suspdata.secuencia.length>0&&(this.pull||this.random&&n)){t=suspdata.secuencia}else{for(var o=0;o<this.originalNumberSlides;o++){t[o]=o}t=t.sort(function(){return Math.random()-.5})}if(a){i=t.slice(0);if(a<this.originalNumberSlides){if(a<=i.length){i.splice(a-i.length)}else if(a>i.length){var s=this.secuencia.filter(function(e){return!i.includes(e)});i=i.concat(s.filter(function(e,t){return t<a-i.length}))}}}suspdata.secuencia=t;this.secuencia_inicial=this.secuencia;this.secuencia=i;window.secuencia=t;window.secuenciaPull=i;if(a){var r;var l;for(o=0;o<this.originalNumberSlides;o++){var d=jQuery.inArray(o,i);if(d==-1){$ckeditors=$("#slider-item-"+o).find(".bck-ckeditor").each(function(){r=$(this).attr("id");l=r.replace("id","editor_");if(CKEDITOR.instances[r]!==undefined&&CKEDITOR.instances[r]!==null){CKEDITOR.instances[r].removeAllListeners();CKEDITOR.remove(CKEDITOR.instances[r]);$(window).removeProp(l)}});this.recalculateSliderData();this.$indicators.last().remove();this.formatCarouselControl(this.currentSection);window["t"+o+"_slide"].includedInPull=false}else{window["t"+o+"_slide"].includedInPull=true;window["t"+o+"_slide"].onShow();window["t"+o+"_slide"].onAfterShowSlide()}}}suspdata.secuencia=window.secuencia;this.recalculateSliderData();this.onAfterShowSection();if(modoClase==3||modoClase==4){blink.theme.completarCamposModoRevisionCorreccion()}if(this.hasFinalSlide){this.$data=$("#actividad-data");$("#slider-item-"+window.secuencia.length).appendTo(this.$data)}}},recalculateSliderData:function(){blink.activity.reloadData();blink.activity.currentStyle.Slider.clearMasterPages();blink.activity.currentStyle.Slider.refreshSliderItems();blink.activity.currentStyle.Slider.refreshData()},bindDomEvents:function(){var i=this;if(!editar){var e=i.sections,a=false;e.forEach(function(e){if(e[0].tipo==29){a=true}})}this.$leftControl.on("click",function(e){i.showPrevSection()});this.$rightControl.on("click",function(e){i.showNextSection()});this.$indicators.closest(".slider-indicators").on("click",".slider-indicator",function(e){var t=$(this).data("go-to");if(this.pull){t=window.secuencia[t]}if(!editar&&a){setTimeout(function(){i.showSection(t)},100)}else{i.showSection(t)}})},bindBlinkEvents:function(){var r=this;blink.events.on("slider:change",function(e){if(this.lastChange===e)return;if(r.editMode){r.notifyEditData(e)}else if(r.currentSection!=e){this.lastChange=e;if(suspendDataChanged()){updateSCORM()}}});blink.events.on("slider:changed",function(e,t){if(r.isGradeSection(t)&&!window.completed){r.onFinalSection(t)}if(blink.isApp&&blink.isIosApp){blink.rest.closeAudio()}var i=window.location.href.substr(window.location.href.indexOf("?")+1).split("&");var a=false;i.forEach(function(e){var t="_phantom=";if(e.indexOf(t)!=-1){a=!!e.substr(e.indexOf(t,1));return}});if(a){r.sections.forEach(function(e,t){var i=e,a;if(typeof i!=="undefined"&&i){for(var n=0;n<i.length;n++){a=i[n];if(a){a.onBeforeShow();a.onShow();a.onAfterShowSlide()}}}})}else{var n=r.sections[t],o;if(typeof n!=="undefined"&&n){for(var s=0;s<n.length;s++){o=n[s];if(o){o.onBeforeShow();o.onShow();o.onAfterShowSlide()}}if(editar){Slide.prototype.refreshFailedImages(t)}}}r.currentSection=t;window.activeSlide=t;if(!window.hideCanvasElement){window.setPizarraOn(false,0)}r.formatCarouselControl(r.currentSection);r.setCanvasSize(r.currentSection);r.onAfterShowSection();if(typeof n!=="undefined"&&n){n[0]&&blink.events.trigger("section:shown",n[0].prefijo)}blink.events.trigger("slider:change-end",t)});blink.events.on("style:loaded",function(){r.formatCarouselControl(r.currentSection)})},onFinalSection:function(e){var t=this;var i=t.finishClass();if(!i){setTimeout(function(){t.showSection(e-1)},0)}return},onAfterShowSection:function(){var e=this.sections[this.currentSection];if(!e)return;for(var t=0;t<e.length;t++){var i=!editar?e[t].prefijo.substr(1,1):t;window.onAfterShowSlide(i)}if(this.pull){$("#slider").scrollLeft(0)}this.currentStyle.allocateCanvas(this.currentSection);this.currentStyle.drawNotes(this.getFirstSlideIndex(window.activeSlide));for(t=0;t<3;t++){var a=$("#swipeview-masterpage-"+t).find("*:focusable");for(j=0;j<a.length;j++){var n=a[j];if($(n).attr("tabindex")!=""&&parseInt($(n).attr("tabindex"))>0){$(n).attr("data-backup-tabindex",$(n).attr("tabindex"))}if($("#swipeview-masterpage-"+t).hasClass("swipeview-active")){if($(n).attr("data-backup-tabindex")!=""&&parseInt($(n).attr("data-backup-tabindex"))>0){$(n).attr("tabindex",$(n).attr("data-backup-tabindex"))}else{$(n).attr("tabindex","")}}else{$(n).attr("tabindex","-1")}}}digitalObjectWidth();blink.events.trigger("showSection:after",e)},setCanvasSize:function(e){var t=this.sections[e],i;if(t){for(var a=0;a<t.length;a++){i=t[a];i&&this.currentStyle.setCanvasSize(i.prefijo.substring(1))}}},updateCanvasSize:function(){this.setCanvasSize(this.currentSection)},notifyEditData:function(e){window.idtransact=$("#transpid"+secuencia[e]).attr("value")||$("#t"+secuencia[e]+"_idtransp").attr("value"),url="/LMS/ajax.php?op=slide.updatetransparenciaenedicion"+"&idtransact="+window.idtransact+"&idclaseact="+this.id;blink.ajax(url,function(){},{async:false})},reloadData:function(){this.numSlides=window.numSlides;this.secuencia=window.secuencia;this.reloadSectionData();this.$wrapper=$("#mainform");this.$leftControl=this.$wrapper.find(".slider-control.left");this.$rightControl=this.$wrapper.find(".slider-control.right");this.$indicators=this.$wrapper.find(".slider-indicators").find("li")},reloadSectionData:function(){var e=0,t=window["t"+window.secuencia[e]+"_slide"],i=[],a;this.sections.length=0;i.push(t);if(this.secuencia_inicial.length>this.secuencia.length){while(e<this.secuencia_inicial.length){var n=jQuery.inArray(window.secuencia[e],this.secuencia);if(n>-1){t=window["t"+window.secuencia[e]+"_slide"];this.sections.push(i);i=[t]}e++}}else{e++;while(e<this.secuencia.length){t=window["t"+window.secuencia[e]+"_slide"];if(t&&t.isConcatenate&&(this.esdeber?this.idClaseOriginal!=0:true)&&!this.slidePreview){i.push(t)}else{this.sections.push(i);i=[t]}e++}i.length&&this.sections.push(i)}},getContainerWidth:function(){return $(".swipeview-active").find(".item-container").eq(0).find(".js-slide-wrapper").width()},handleScrollEnd:function(e){jQuery("#top-navigator").removeClass("show_left").removeClass("show_right");if(this.x<0){jQuery("#top-navigator").addClass("show_left")}if(this.x>this.maxScrollX){jQuery("#top-navigator").addClass("show_right")}},formatCarouselControl:function(e){e||(e=this.currentSection);if(e===0){this.$leftControl.addClass("disabled")}else{this.$leftControl.removeClass("disabled")}if(e===this.getActivityLength()-1&&!this.hasFinalSlide){this.$rightControl.addClass("disabled")}else{this.$rightControl.removeClass("disabled")}this.$indicators.removeClass("active").eq(e).addClass("active");if(this.myScroll===null&&(jQuery("#top-navigator").length>0||jQuery("#bottom-navigator").length>0)){var i=0;navigation="top";if(jQuery("#bottom-navigator").length>0){navigation="bottom"}jQuery("#"+navigation+"-navigator li").each(function(e,t){i+=jQuery(t).outerWidth(true)});jQuery("#"+navigation+"-navigator ol").css("width",i*1.1);this.myScroll=new IScroll("#"+navigation+"-navigator",{scrollX:true,scrollY:false,eventPassthrough:true});this.myScroll.on("scrollEnd",this.handleScrollEnd);this.handleScrollEnd.call(this.myScroll);offsetX=$("#"+navigation+"-navigator").outerWidth()/-2+$("#"+navigation+"-navigator li").outerWidth()*2;$(window).resize(function(){offsetX=$("#"+navigation+"-navigator").outerWidth()/-2+$("#"+navigation+"-navigator li").outerWidth()*2})}else if(this.myScroll!==null){this.myScroll.scrollToElement("li:nth-child("+e+")",0,offsetX)}},showNextSection:function(){this.showSection(parseInt(this.currentSection)+1)},showPrevSection:function(){this.showSection(parseInt(this.currentSection)-1)},isGradeSection:function(e){return e===this.sections.length},showSection:function(e,t){if(blink.isApp){blink.rest.closeAudio()}if(this.currentStyle.Slider.isValidSection(e)){blink.theme.video.restartPlayers();blink.events.once("showSection:after",function(e){var t=blink.activity.getIndexsFromSection(blink.activity.currentSection);if(e&&e[0]){e[0].setUrlForEmbeddedIframes()}blink.theme.video.recreateVideoJS(t)}.bind(this));if((blink.user.esAlumno()||idalumno)&&!editar&&this.pull&&typeof window.secuencia[e]!=="undefined"&&!window["t"+window.secuencia[e]+"_slide"].includedInPull){this.showSection(e+1,t)}else{if(this.isGradeSection(e)){if(blink.activity.esVideoInteractivo){blink.theme.confirmFinishClass()}else{this.finishClass()}}else{this.currentStyle.Slider.goTo(e,!!t)}}}},showSlide:function(e,t){this.showSection(this.getSectionFromSlide(e),t)},finishClass:function(e,t){if(blink.events&&blink.events.finishSlide){blink.events.finishSlide()}var t=t||"";if(window._permitirFinishClass&&!window.completed&&window.finishClass(e,t)){this.currentStyle.Slider.goTo(this.sections.length);this.currentStyle.Slider.destroy();this.$leftControl.add(this.$rightControl).add(this.$indicators.closest("ol")).hideBlink();return true}this.pageIsLoading=false;return false},getSectionFromSlide:function(e){if(e<1)return 1;if(this.editMode)return e;if(!this.sections.length)this.reloadData();var t=0,i,a=0;for(a=0;a<this.sections.length;a++){i=this.sections[a];t+=i.length;if(e<=t)return++a}return a},getEditSectionNumSec:function(){var e=0,t=0;for(t=0;t<this.currentSection;t++){e+=this.sections[t].length}return e+1},getViewSectionNumSec:function(){return this.currentSection+1},getFirstSlideIndex:function(e){var t=this.sections[e];if(!t){return"0"}var i=t[0];if(i)return i.prefijo.substring(1)},deleteSection:function(e,t){this.currentStyle.Slider.removeItem(e);this.currentStyle.Slider.refreshData();this.$indicators.last().remove();if(typeof t=="undefined"||!t){window.secuencia.splice(activeSlide,1)}this.reloadData();this.formatCarouselControl(this.currentSection)},getIndexsFromSection:function(e){var t=[],i=this.sections[e];if(!i)return t;for(var a=0;a<i.length;a++){i[a]&&t.push(parseInt(i[a].prefijo.replace("t",""),10))}return t},createNewSlide:function(e,t,i,a){t||(t=1);var n=secuencia.max()+1,o=$("#actividad-data"),s=$(document.createElement("div")),r=$(document.createElement("div")),l=$(document.createElement("div"));s.addClass("item js-slider-item");r.addClass("item-container");l.addClass("js-slide-wrapper class_slide slide_content_type_"+e);for(var d=0;d<t;d++){var c=s.clone(),u=r.clone(),f=l.clone();f.attr({id:"transp"+(n+d),"data-slide-index":n+d}).data({type:e,"slide-index":n+d}).appendTo(u);c.attr({"data-slide-index":n+d,id:"slider-item-"+(n+d)}).data({"slide-index":n+d});c.append(u);o.append(c)}var h="/LMS/msgbox.php";h+="?op=slide.getnewslideHTML";h+="&id="+n;h+="&idcurso="+idcurso;h+="&idclase="+idclase;h+="&tipo="+e;h+="&slideId="+a;var p=function(e){if(e.startsWith("ERROR"))standardAJAXPopup(e);else{m.theme.onFinishCreatingNewSlide(e,n,t,i)}};m.ajax(h,p);return n},onFinishCreatingNewSlide:function(e,t,i,a){i||(i=1);var n,o=blink.activity.currentSection+i;for(var s=0;s<i;s++){n=t+s;window.setAndExecute("transp"+n,e.replace(new RegExp("####IDTRANSP####","g"),n));window.secuencia.splice(o,0,n)}a&&a(t);var r=$(".slider-indicators"),l=r.find("li").last().clone(),d=l.data("go-to")+i;l.removeClass("concat").data("go-to",d).attr("data-go-to",d).appendTo(r);this.currentStyle.Slider.clearMasterPages();this.currentStyle.Slider.refreshData();this.currentStyle.Slider.slider.updatePageCount(this.currentStyle.Slider.slider.options.numberOfPages+i);this.currentStyle.Slider.refreshSliderItems();this.reloadData();this.edit.updateCarouselIndicatorsIndex();this.edit.setResizable();var c=this;m.events.once("slider:changed",function(e,t){c.edit.setPanelWidth("t"+n)});this.currentStyle.Slider.slider.goToPage(o);setTimeout("prepararCamposTexto()",500);window.closeMsgBox();if($("#mainform").serializeArray().length>MIV){_showAlert(textweb("edit_slide_111"));mostrarMensajeTransp(textweb("edit_slide_110"))}window.marcarHaCambiado()},deleteSlide:function(){if(window.secuencia.length<=1){_showAlert(textweb("edit_slide_46"));return}if(!confirm(textweb("js_borrar_slide")))return false;try{for(var t in CKEDITOR.instances){if(t.indexOf("idt"+blink.activity.currentSection)==0){CKEDITOR.instances[t].destroy()}}}catch(e){m.log.error("ERROR at deleteSlide: Fail to remove CKEDITOR instance: "+t,e)}var e=this.currentSection==0,i=this.currentSection,a=e?this.currentSection:this.currentSection-1;if(this.esVideoInteractivo&&e){_showAlert(textweb("edit_slide_134"));return false}this.deleteSection(i);var n=this;m.events.once("slider:changed",function(e,t){n.edit.formatConcatenateOption();n.edit.updateCarouselIndicatorsIndex()});this.showSection(a);window.marcarHaCambiado();return false},getPrefijos:function(){var e=[];for(var t=0;t<secuencia.length;t++){e.push("t"+t)}return e},onChangeWindowSize:function(){this.currentStyle.onChangeWindowSize();var e=this.sections[this.currentSection],t;if(e){for(var i=0;i<e.length;i++){t=e[i];t&&t.onChangeWindowSize&&t.onChangeWindowSize(t.prefijo)}}if(blink.isApp&&!blink.isOfflinePC)this.configureResourcesButton()},configureResourcesButton:function(){if(!this.resourcesList)return false;if(shouldShowPopoverResources(this.resourcesList)){blink.theme.buttonState.hidden("#tool-resources",false);if(this.resourcesModal){$("#tool-resources").popoverRecursos(this.resourcesModal)}}else{blink.theme.buttonState.hidden("#tool-resources",true)}if(window.esPopup){blink.theme.buttonState.hidden("#tool-resources",true)}},shouldAllowToolsPopover:function(){return true},getActivityLength:function(){return this.pull&&(blink.user.esAlumno()||idalumno)?parseInt($("#slidesPull").val()):blink.activity.sections.length},getActivityPages:function(e){return e.slidesPull!==null&&(blink.user.esAlumno()||idalumno)?parseInt(e.slidesPull):parseInt(e.pags)},seqChanged:function(){var e=window.secuencia,t=this.initSecuencia;if(e){if(t.length!=e.length){this.initSecuencia=Array.from(e);return true}for(index=0;index<e.length;index++){if(e[index]!=t[index]){this.initSecuencia=Array.from(e);return true}}}return false},titlesChanged:function(){return _.size(this.changedSlideTitles)>0},navigateBetweenActivities:function(s,r){var r=r||false;var l=this;blink.events.on("section:shown course_loaded",function(){var t=[],i;if(s){for(var e=0;e<s.length;e+=1){var a=s[e].subunits;for(var n=0;n<a.length;n+=1){t.push(a[n]);if(a[n].id&&a[n].id==idclase){i=t.length-1}}}}else{t=blink.activity.currentStyle.subunits||t;for(var e=0;e<t.length;e+=1){if(t[e].id&&t[e].id==idclase){i=e}}}$(".slider-control, .slider-navigator").removeClass("disabled");if(t.length!==0&&(modoVisualizacionLabel!="standalone"||r)){if((typeof i==="undefined"||i===0)&&blink.activity.currentSection===0){$(".slider-control.left, .slider-navigator.left").addClass("disabled")}var o=blink.activity.pull?activeSlide===secuenciaPull.length-1:blink.activity.currentSection===blink.activity.sections.length-1;if((typeof i==="undefined"||i===t.length-1)&&o){$(".slider-control.right, .slider-navigator.right").addClass("disabled")}}else{if(window.activeSlide==0){$(".slider-control.left, .slider-navigator.left").addClass("disabled")}if(window.activeSlide==t.length-1){$(".slider-control.right, .slider-navigator.right").addClass("disabled")}}$(".slider-control, .slider-navigator").off("click");if(t.length!==0){if(i!==0||blink.activity.currentSection!==0){$(".left.slider-control:not(.disabled), .left.slider-navigator:not(.disabled)").click(function(){l.previousSlide(t,i)})}if(i!==t.length-1||blink.activity.currentSection!==blink.activity.sections.length-1){$(".right.slider-control:not(.disabled), .right.slider-navigator:not(.disabled)").click(function(){l.nextSlide(t,i)})}}else{$(".left.slider-control, .left.slider-navigator").click(function(){l.showPrevSection()});$(".right.slider-control, .right.slider-navigator").click(function(){l.showNextSection()})}document.addEventListener("swipe:first:previousActivity",function(e){l.previousSlide(t,i)},false);document.addEventListener("swipe:last:nextActivity",function(e){l.nextSlide(t,i)},false);if(blink.isApp){blink.events.on("slider:changed",function(){blink.rest.closeAudio()})}})},previousSlide:function(e,t){this.sliderControlClick("left");var i=window.idgrupo,a=window.idalumno,n="";if(i)n+="&idgrupo="+i;if(a)n+="&idalumno="+a;if(blink.isApp){blink.rest.closeAudio()}if(activeSlide==0){var o=e[t-1].numSlides;if(typeof o==="undefined"){o=e[t-1].pags}if(typeof o!=="undefined"){n+="&numSec="+o}redireccionar(e[parseInt(t)-1].url+n,false,undefined)}else{this.showPrevSection()}},nextSlide:function(e,t){this.sliderControlClick("right");var i=window.idgrupo,a=window.idalumno,n="",o=activeSlide===this.getActivityLength()-1;if(i)n+="&idgrupo="+i;if(a)n+="&idalumno="+a;if(blink.isApp){blink.rest.closeAudio()}if(o){redireccionar(e[parseInt(t)+1].url+"&numSec=1"+(typeof window.esPopup!=="undefined"&&window.esPopup?"&popup=1":"")+n,false,undefined)}else{this.showNextSection()}},sliderControlClick:function(e){$("."+e+" .slder-navigator").addClass("pressed");if(blink.isApp){blink.rest.closeAudio()}var t=e==="right"?"left":"right";var i=blink.activity.currentStyle.getActualSlideNumber(blink.activity.currentStyle.subunits);e==="right"?i++:i--;if(i<blink.activity.currentStyle.totalSlides&&e=="right"||i>1&&e=="left"){$("."+e+".slider-navigator").addClass("slider-navigator-animation");setTimeout(function(){$("."+e+".slider-navigator").removeClass("slider-navigator-animation");$("."+e+".slider-navigator").css("opacity","1")},1e3)}else{$("."+e+".slider-navigator").css("opacity",".5")}$("."+t+".slider-navigator").css("opacity","1")},initSequencingBehaviour:function(){if(blink.isIosApp){$(".slider-control").addClass("forced-in-sequencing")}$(".slider-indicators").off("click");$("#swipeview-slider").on("touchstart",function(e){e.stopPropagation();e.stopImmediatePropagation();return});this.sequencingNavigation();this.sequencingNavigationEvents();blink.events.on("slide:update:after section:shown",function(){this.sequencingNavigationEvents();this.pageIsLoading=false}.bind(this));blink.events.on("slide:update:after",function(){this.sequencingNavigation();this.pageIsLoading=false}.bind(this))},sequencingNavigation:function(){var e=$(".right.slider-control");e.removeClass("not-allowed");if(!this.isAllSliderActivitiesCompleted()){e.addClass("not-allowed")}},sequencingNavigationEvents:function(){var e=this;$(".slider-control").off("click");$(".navigator").off("click",".left.slider-control");$(".navigator").off("click",".right.slider-control");$(".left.slider-control").on("click",function(){if(!e.pageIsLoading){e.showPrevSection();e.pageIsLoading=true}});$(".right.slider-control").on("click",function(){if(!e.pageIsLoading&&!$(this).hasClass("not-allowed")){e.pageIsLoading=true;e.showNextSection()}else{if($(this).hasClass("not-allowed")){_showAlert(textweb("new_edit_class_sequencing_msg"))}e.pageIsLoading=false}})},isAllSliderActivitiesCompleted:function(){var e=$("#slider-item-"+window.secuencia[window.activeSlide]),t=e.find(".js-slide-wrapper"),a=true;if(t.length!=0){t.each(function(){var e=$(this),t=e[0].id,i=t.split("transp")[1];if(window["t"+i+"_slide"].esEvaluable){if(!window["t"+i+"_slide"].isDone()){a=false;return false}}})}return a},cloneSlide:function(){if(window.verificarHaCambiado()){alert(textweb("clonar_slide_mensaje_error"))}else{var e="/LMS/ajax.php?op=slide.cloneSlideActivity"+"&originalSlideId="+window.idtransact;blink.ajax(e,function(e){if(e.startsWith("OK")){var t=JSON.parse(e.substr(2));blink.activity.createNewSlide(t.TIPO_TRANSPARENCIA,null,initClone,t.IDTRANSPARENCIA)}},{async:false})}}})})(blink);(function(d){var e=function(){function Slider(){var a=this;$(document).ready(function(){var e=["touchstart"],t=[".ui-draggable-handle",".ui-sortable-handle",".ui-resizable-handle",".rf-tablegrid-wrap",".cke_inner","input","textarea","select",".sintaxis_frase",".jwplayer",".bck-table-responsive",".note.rangy",".nota_pos",".workspace.matching.blocks.zoom-in"],i=$("#swipeview-slider");i.on(e.join(" "),t.join(","),a.prevent).on("mousedown",a.prevent);if(d.lowPerformanceDevice){i.on("touchstart",a.prevent)}else{d.events.on("rangy:enable",function(){a.stop()});d.events.on("rangy:disable",function(){a.unstop()})}});this.$slider=$("#slider");this.prevent=function(e){e.stopPropagation();e.stopImmediatePropagation();return};this.stop=function(){a.$slider.on("touchstart",a.prevent)};this.unstop=function(){a.$slider.off("touchstart",a.prevent)};this.$data=$("#actividad-data");this.$items=this.$data.children(".js-slider-item");this.slider=new SwipeView("#slider",{numberOfPages:this.$items.length,loop:false});var e,t,i,n=this.$items.length,o=n<4,s;var r=[[],[null,0,null],[null,0,1],[2,0,1]];for(t=0;t<3;t++){if(d.lowPerformanceDevice&&(t==0||t==2)){continue}e=o?r[n][t]:t==0?this.$items.length-1:t-1;i=getSliderItem(e);s=this.slider.masterPages[t].className;/(^|\s)swipeview-loading(\s|$)/.test(s)||(this.slider.masterPages[t].className=!s?"swipeview-loading":s+" swipeview-loading");e!==null&&this.slider.masterPages[t].appendChild(i.get(0))}var a=this;$("#slider").one("swipeview-flip",function(){a.slider.refreshSize()});var l=this.getCurrentSection();this.slider.onFlip(function(e){var t=a.getCurrentSection();if(!editar&&t===l)return;l=t;d.events.trigger("slider:change",a.getCurrentSection());a.refreshSliderItems()&&d.events.trigger("slider:changed",e,a.getCurrentSection())});this.slider.onMoveOut(function(){d.events.trigger("slider:moveOut",a.getCurrentSection());a.slider.masterPages[a.slider.currentMasterPage].className=a.slider.masterPages[a.slider.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"")});this.slider.onMoveIn(function(){var e=a.slider.masterPages[a.slider.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(e)||(a.slider.masterPages[a.slider.currentMasterPage].className=!e?"swipeview-active":e+" swipeview-active")})}Slider.prototype.getCurrentSection=function(){return this.slider.page};Slider.prototype.refreshData=function(){this.$items=$(".js-slider-item").not(".final")};Slider.prototype.removeItem=function(e){var t;getSliderItem(e).remove();this.slider.updatePageCount(this.slider.options.numberOfPages-1);this.refreshSliderItems();this.refreshData();t=e==0?0:e-1};Slider.prototype.clearMasterPages=function(){var e;for(var t=0;t<this.slider.masterPages.length;t++){e=$(this.slider.masterPages[t]).children(".item");e.appendTo(this.$data)}};Slider.prototype.removeLastItem=function(){var e=this.$items.last(),t=!!e.find("#final").length;t&&this.removeItem(this.$items.length-1)};Slider.prototype.isValidSection=function(e){return e<this.slider.options.numberOfPages};Slider.prototype.isLastSection=function(e){return e===this.slider.options.numberOfPages-1};Slider.prototype.goTo=function(e,t){if(typeof d.activity.currentSection!=="undefined"){var i=window["t"+d.activity.currentSection+"_slide"];if(i&&i.onBeforeChangeSlide)i.onBeforeChangeSlide(d.activity.currentSection)}var a=d.activity.currentSection-e,n=e===d.activity.currentSection;if(t||d.lowPerformanceDevice){a=0}if(a==1){this.slider.prev()}else if(a==-1){this.slider.next()}else{this.slider.goToPage(e)}d.events.trigger("slider:change",e);n&&d.events.trigger("slider:changed",null,e)};Slider.prototype.destroy=function(){this.$slider.addClass("destroyed");this.slider.destroy()};Slider.prototype.getSecuencia=function(){var e=[];$.each(this.$items,function(){e.push($(this).data("index"))});return e};Slider.prototype.refreshSliderItems=function(){var e;e=refreshSliderItems.call(this);return e};Slider.prototype.getSectionWrapper=function(e){return getSliderItem(e)};function refreshSliderItemsLowPerformance(){var e,t,i,a,n,o=0,s=this.$items.length,r=s<4;var l=[[],[{upcoming:null,current:null},{upcoming:0,current:0},{upcoming:null,current:null}],[{upcoming:null,current:null},{upcoming:0,current:0},{upcoming:1,current:1}],[{upcoming:2,current:2},{upcoming:0,current:0},{upcoming:1,current:1}]];for(i=0;i<3;i++){a=r?l[s][i].current:this.slider.masterPages[i].dataset.pageIndex;n=getSliderItem(a);n.appendTo(this.$data)}n=null;var d=this.slider.currentMasterPage;e=r?l[s][d].upcoming:this.slider.masterPages[d].dataset.upcomingPageIndex;if(e!==null&&!$(this.slider.masterPages[d].querySelector(".item")).length){t=getSliderItem(e);$(this.slider.masterPages[d]).append(t)}return true}function refreshSliderItems(){var e,t,i,a,n,o=0,s=this.$items.length,r=s<4;var l=[[],[{upcoming:null,current:null},{upcoming:0,current:0},{upcoming:null,current:null}],[{upcoming:null,current:null},{upcoming:0,current:0},{upcoming:1,current:1}],[{upcoming:2,current:2},{upcoming:0,current:0},{upcoming:1,current:1}]];for(i=0;i<3;i++){e=r?l[s][i].upcoming:this.slider.masterPages[i].dataset.upcomingPageIndex;a=r?l[s][i].current:this.slider.masterPages[i].dataset.pageIndex;if(e!=a||e===null){n=getSliderItem(a);n.appendTo(this.$data);o++}}n=null;for(i=0;i<3;i++){e=r?l[s][i].upcoming:this.slider.masterPages[i].dataset.upcomingPageIndex;a=r?l[s][i].current:this.slider.masterPages[i].dataset.pageIndex;if(e===null)continue;if(e!=a||!$(this.slider.masterPages[i].querySelector(".item")).length){t=getSliderItem(e);$(this.slider.masterPages[i]).append(t)}}return!!(o||r)}function getSliderItem(e){var t;if(e==d.activity.secuencia.length){return $("#slider-item-"+e)}return $("#slider-item-"+d.activity.secuencia[e])}return Slider}();d.Slider=e})(window.blink);(function(e){"use strict";e.gradebook={cursoJSON:{},calificacionesJSON:{},globalIdTemas:[],globalIdAlumnos:[],globalEjes:[],attempts_selector_on:false,averages_selector_on:false,globalCalificaciones:{},globalMedias:{},DIAGNOSTICO_EXERCISE:1,DIAGNOSTICO_EXAM:2,DIAGNOSTICO_HOMEWORK:3,DIAGNOSTICO_EJES:4,PENDIENTE_DE_REVISION:"PDTE",MODO_NAVEGACION_ALL:1,MODO_NAVEGACION_PENDING:2,ID_ACTIVIDAD:"IDAC",NOTA:"NOTA",default_attempts_to_show:null,default_attempts_to_show_map:["L","F","B"],tipoGradeBook:["DIAGNOSTICO_NOEVAL","DIAGNOSTICO_EXAM","DIAGNOSTICO_EXERCISE","DIAGNOSTICO_EJES","DIAGNOSTICO_HOMEWORK"],temp:"",esDeber:false,estiloGradebook:null,fichaAlumnoGraficoExamenes:true,inicializarGradebook:function(a){!a&&$(".table").css("display","none");blink.getCourse(idcurso).done(function(e){if(!idgrupo||!idcurso)return;var t=blink.gradebook.tipoGradeBook[parseInt(tipo)],i="/LMS/calificaciones_json.php?idGroup="+idgrupo+"&idCourse="+idcurso;blink.gradebook.esDeber=blink.gradebook[t]==blink.gradebook.DIAGNOSTICO_HOMEWORK;i+=blink.gradebook.esDeber?"&homework=1":"";this.cursoJSON=e;this.estiloGradebook=blink.theme.getStyleGradebook();this.cursoJSON.units.map(function(e){this.globalIdTemas.push(e.id)}.bind(this));blink.getJSON(i,function(e){if(e!="ERROR"){this.calificacionesJSON=e;var t=[];$(".alumnos .item .nota").each(function(e){$(this).data("user")!==undefined&&t.push($(this).data("user"))});t.map(function(e){!~blink.gradebook.globalIdAlumnos.indexOf(e)&&blink.gradebook.globalIdAlumnos.push(e)});if(!blink.gradebook.cursoJSON.units.length){$(".descargar_excel").removeClass("on").addClass("disabled")}if(!a){this.generarTablaGradebook()}else{this.showGradebookResult();this.showTooltipsGradebook();this.setTicksButton();this.pendingRevision();$(".subtema.abierto .item.top").trigger("myCustomTapEvent").trigger("myCustomTapEvent")}}}.bind(this))}.bind(this))},inicializarFichaAlumno:function(e){var t=window.idcurso;blink.getCourse(t).done(function(e){blink.gradebook.cursoJSON=e},false,true);this.estiloGradebook=blink.theme.getStyleGradebook();this.showFichaAlumnoResult()},getHtml:function(){var s=this,r="",l=this.tipoGradeBook[parseInt(tipo)];s.globalIdTemas.map(function(n,o){s.cursoJSON.units.map(function(e){if(e.id===n&&(typeof e.esIndiceCurso==="undefined"||!e.esIndiceCurso)){var t=blink.gradebook.esDeber?"subtemas subtemas-deberes":"subtemas",i=false;e.subunits=e.subunits.filter(function(e){return blink.gradebook.tipoGradeBook[e.evalType]!==l});i=e.subunits.every(function(e){return e.onlyVisibleTeachers});var a=i||!(e.subunits.length||e.resources.length)?" hideSlides":"";if(!blink.gradebook.esDeber){r+='<div class="tema avSel " data-alias="T'+e.number+'" data-index="'+o+'" data-num="'+e.number+'" data-tema="'+e.id+'" data-titulo="'+e.title+'">';r+='<div class="item top '+a+'"><span class="titulo">'+e.title+"</span></div>";r+='<div id="tema_avSel_'+e.id+'" class="item media">';r+="-";r+="</div>";s.globalIdAlumnos.map(function(e){r+='<div class="item" data-alumno="'+e+'" data-aprobado="" id="item_tema_'+e+"_"+n+'" data-nota="" data-tema="'+n+'" data-original-title="" title="">';r+="-";r+="</div>"});r+="</div>"}r+='<div class="'+t+'" data-subtemas="'+n+'" '+(!blink.gradebook.esDeber?'style="display: none"':"")+">";e.subunits.map(function(e){if(!e.onlyVisibleTeachers)r+=s.generarSubunidadHtml(e,blink.gradebook.esDeber)});e.resources.map(function(e){if(!e.onlyVisibleTeachers)r+=s.generarSubunidadHtml(e,blink.gradebook.esDeber)});r+="</div>";if(!blink.gradebook.esDeber){r+="</div>"}}})});return r},activityTypeShowSlides:function(e){switch(e.activityType){case 17:return false;default:return true}},generarSubunidadHtml:function(a,e){var n="",t=this.tipoGradeBook[parseInt(tipo)],i=true,o=true;if(a){i=this.activityTypeShowSlides(a)}if(typeof blink.gradebook!=="undefined"&&typeof blink.gradebook.estiloGradebook!=="undefined"){var s=blink.gradebook.estiloGradebook;i=s.showSlidesGradebook(a);o=s.canOpenActivity()}var r=blink.domain.showSlidesGradebook()&&a.typeInt==6&&i?"":"hideSlides";if(a.evalType==blink.gradebook[t]){n+='<div class="subtema" data-subtema="'+a.id+'">';if(e){n+='<a class="control delete no_modo_drm hidden" href="javascript:void(0)" onclick="javascript:return deleteHomework('+a.idExt+","+window.idgrupo+');"></a>'}n+='<div class="item top '+r+'">';n+='<span class="titulo">'+a.title+"</span>";if(blink.domain.allowEditHomeworksFromCalifications()){n+=blink.isOfflinePCApp||blink.isApp?"":'<a class="btn-lapiz_rojo hidden"  href="javascript:void(0)" onclick="javascript:return openHomeworkEditDateMsgBox('+a.idExt+');"></a>'}n+='<div id="act-pterevisar-'+a.id+'" class="ico-pdterevisar hidden">';n+="</div>";n+="</div>";n+='<div class="item media" id="item_media_'+a.id+'" data-tema="'+a.id+'">';n+="-";n+="</div>";this.globalIdAlumnos.map(function(e){blink.gradebook.temp=a.id;var t=blink.gradebook.calificacionesJSON[e].some(function(e){return blink.gradebook.temp==e.IDAC&&e.HMWK});var i=t?"delayed":"";n+='<div class="item subtema '+i+'" id="itemSubtema_'+e+"_"+a.id+'" data-alumno="'+e+'" data-peter="" data-aprobado="" data-nota="" data-tema="'+a.id+'" data-original-title="" title="" data-isgclasroom="'+a.isGClassRoomActivity+'">';n+='<a href="javascript:void(0)" id="subtema_'+a.id+"_"+e+'" data-subunidad='+a.id+" data-alumno="+e+" data-subunidad="+a.id+' data-peter="" data-nota="" data-aprobado="" >';n+="-";n+="</a>";n+="</div>"});n+="</div>"}return n},generarActividadesHtml:function(e,h,p,a){var m='<div class="actividades">',v={},t=[],i=[],n=[],o=[],s=0;for(var r in e){if(e.hasOwnProperty(r)){v[r]={};e[r].map(function(e){t.indexOf(e.IDTR)==-1&&t.push(e.IDTR);v[r][e.IDTR]={nota:e.NOTA[0],pending:e.PDTE,intentos:e.NUMI[0],numElementos:e.NUME,hidden:e.HIDD};e.PDTE==1&&(o[e.IDTR]="slidePending");n[e.IDTR]=n[e.IDTR]||0;i[e.IDTR]=i[e.IDTR]+1||0;n[e.IDTR]=(n[e.IDTR]*i[e.IDTR]+parseFloat(e.NOTA[0]))/(i[e.IDTR]+1)})}}blink.gradebook.temp=t;a.map(function(e){blink.gradebook.temp.indexOf(parseInt(e.ID))==-1&&blink.gradebook.temp.push(parseInt(e.ID))});var l=[];a.forEach(function(t){blink.gradebook.temp.forEach(function(e){if(e==t.ID){l.push(e)}})});t=l;t.map(function(u,e){var f=a.some(function(e){return e.ID==u})&&a.find(function(e){return e.ID==u});if(f){var t=f.hasOwnProperty("show_no_valuable")&&f.show_no_valuable?true:false;f.concatenada!=="0"&&s++;var i=o[u]||"";m+='<div class="transparencia '+i+'" data-transparencia="'+u+'" >';m+='<div class="item top" data-tema="'+p+'" data-prefijoSlide="'+f.prefijo+'">';m+='<span class="titulo">'+(f.titulo_mostrar?f.titulo_mostrar:f.type_alias)+"</span>";m+="</div>";m+='<div class="item media '+(t?"not_eval":"")+'" data-transparencia="'+u+'" >';if(t){m+=textweb("no_valuable")}else{m+=gradeToView(n[u],"diagnostico")}m+="</div>";blink.gradebook.globalIdAlumnos.map(function(e){var t=v[e][u],i=t&&t.nota,a=!!(t&&t.pending),n=t&&t.intentos,o=blink.gradebook.activitySlidesPullEnabled(h,p)&&(!t||t.hidden),s=a?returnPending():gradeToView(i,"diagnostico",a),r=f.numElementosEvaluables?f.numElementosEvaluables:t&&t.numElementos!=-1&&t.numElementos,l=r?blink.gradebook.specialFormat(s,r,f):s,d=i!==null?esAprobado(i):"",c=d?"ok":"ko";m+='<div class="item '+c+'" data-prefijoSlide="'+f.prefijo+'" data-tema="'+p+'" data-transp="'+u+'" data-alumno="'+e+'" data-peter="'+a+'" data-aprobado="'+d+'" data-nota="'+s+'">';o&&(m+='<div class="slide-out-of-pull"></div>'+'<div class="inner-triangle"></div>');m+='<a href="javascript:void(0)" class="nota-slide" " data-peter="'+a+'" data-nota="'+s+'" data-aprobado="" >';m+=l;m+="</a>";n&&(m+='<span class="attempts">'+n+" "+textweb("gradebook_attempts")+"</span>");m+="</div>"});m+="</div>"}});m+="</div>";return m},generarTablaGradebook:function(){!!document.querySelector(".temas")&&(document.querySelector(".temas").innerHTML=this.getHtml());this.calcularTamanoTemas();this.showGradebookResult();this.showTooltipsGradebook();this.setTicksButton();this.pendingRevision();!!document.querySelector(".gradebook-loading")&&(document.querySelector(".gradebook-loading").outerHTML="");$(".table").slideDown(400,function(){indexLoaded()})},showGradebookResult:function(){var e=this.calificacionesJSON,c=this.getSelectedSlideAverage(),u,f={},h={},p=this.tipoGradeBook[parseInt(tipo)];for(var m in e){if(e.hasOwnProperty(m)){this.globalMedias[m]={};e[m].map(function(e){var t=false,i=e[this.NOTA];if(this.averages_selector_on&&!this.attempts_selector_on){t=!!parseInt(e[this.PENDIENTE_DE_REVISION])&&(c==1||c==2||this.attempts_selector_on)&&typeof i[c]==="undefined"}else{t=!isNaN(n)&&(c==this.default_attempts_to_show_map[1]||c==this.default_attempts_to_show_map[2])?0:!!parseInt(e[this.PENDIENTE_DE_REVISION])}var a=e[this.ID_ACTIVIDAD],n=t&&blink.domain.countPendingNote()?0:i[0]&&parseInt(i[0]),n=isNaN(n)?i[c]&&parseInt(i[c]<0?0:i[c]):n,o=_.find(this.cursoJSON.units,function(e){return _.find(e.subunits,function(e){return e.id===a&&e.evalType==blink.gradebook[p]})}),s=_.find(this.cursoJSON.units,function(e){return _.find(e.resources,function(e){return e.id===a&&e.evalType==blink.gradebook[p]})}),r=o||s;if(r!==undefined){u=document.getElementById("subtema_"+a+"_"+m);this.pintarNota(u,n,"diagnostico",t,m);if(n!==undefined&&!t){f[a]=f[a]||0;h[a]=h[a]||0;f[a]=(f[a]*h[a]+n)/++h[a]}u=document.getElementById("item_media_"+a);this.pintarNota(u,f[a],"diagnostico");var l=$("#itemSubtema_"+m+"_"+a).text();var d=l!="-"&&typeof n!=="undefined"&&viewToGrade(l)!=n;if(n!==undefined||d){this.globalMedias[m][r.id]||(this.globalMedias[m][r.id]=[]);this.globalMedias[m][r.id].push(n)}}}.bind(this))}}var t=0,i={},a={};for(var m in this.globalMedias){if(this.globalMedias.hasOwnProperty(m)){var n=null,o=0;for(var s in this.globalMedias[m]){n=n||0;if(this.globalMedias[m].hasOwnProperty(s)){var r=0,l=false;this.globalMedias[m][s].map(function(e,t){l=l||e!==undefined;e!==undefined&&(r=(r*t+e)/(t+1))});r=l?r:undefined;a[s]=a[s]+1||0;i[s]=i[s]||0;i[s]=(i[s]*a[s]+r)/(a[s]+1);if(typeof r!=="undefined"){n=(n*o+r)/++o}u=document.getElementById("item_tema_"+m+"_"+s);this.pintarNota(u,r,"diagnostico")}}u=document.getElementById("nota_"+m);!!n&&this.pintarNota(u,n,"diagnostico")}}var d=0,v=0;for(var s in i){u=document.getElementById("tema_avSel_"+s);this.pintarNota(u,i[s],"diagnostico");if(typeof i[s]!=="undefined"){d=(d*v+i[s])/++v}}u=document.getElementById("itemMediaNotaGlobal");this.pintarNota(u,d,"diagnostico")},showTooltipsGradebook:function(){if(blink.domain.showTooltipOnGradebook()){this.globalIdTemas.map(function(e,t){$("div.subtemas[data-subtemas='"+e+"']").find(".subtema").each(function(){var e=$(this).first().find(".titulo").text();$(this).find(".item").not(".top, .media").each(function(){$(this).tooltip({title:e,container:"#wrapTemas"})})})});$(".tema").each(function(e,t){var i=$(t),a=i.data("tema"),n=i.first().find(".titulo").text();i.find(".item").not(".top, .media").each(function(){$(this).tooltip({title:n,container:"#wrapTemas"})})});$(".transparencia").each(function(e,t){var i=$(t),a=i.first().find(".titulo").text();i.find(".item").not(".top, .media").each(function(){$(this).tooltip({title:a,container:"#wrapTemas"})})})}},checkConditionalPending:function(e,t){return e},pintarNota:function(e,t,i,a,n){var o=t!==null?esAprobado(t)?"ok":"ko":"",a=this.checkConditionalPending(a,t),s=gradeToView(t,i,a,n);if($(e).text()==s)return;if(typeof blink.courseInfo!=="undefined"&&typeof blink.courseInfo.originalStyleName!=="undefined"&&typeof blink.theme.styles[blink.courseInfo.originalStyleName]!=="undefined"){var r=blink.theme.styles[blink.courseInfo.originalStyleName],l=r?new r:new blink.theme.styles["basic"];if(typeof l.hideGrade!=="undefined"){if(l.hideGrade()){s=l.gradeValue(s)}}}$(e).html(s).data("nota",s).data("aprobado",o=="ok").removeClass("ok ko").addClass(!isNaN(parseInt(s))&&o);if($(e).is("a")){$(e).parent().attr("data-nota",typeof s!=="undefined"&&s==="Pending"?"P":t).data("nota",s).data("aprobado",o=="ok").removeClass("ok ko").addClass(!isNaN(parseInt(s))&&o)}},specialFormat:function(e,t,i){return blink.gradebook.estiloGradebook.formatearNotaGradebook(e,t,i)},getSelectedSlideAverage:function(){if(this.averages_selector_on){var e=$("#checkbox_evaluation").length>0&&$("#checkbox_evaluation").is(":checked"),t=$("#checkbox_selfcorrect").length>0&&$("#checkbox_selfcorrect").is(":checked"),i=0;if(e){if(t){i=4}else{i=2}}else{if(t){i=3}else{i=1}}return i}else if(this.attempts_selector_on){var a=$("#select_attempt").length?$("#select_attempt").val().substr(0,1).toUpperCase():this.default_attempts_to_show;return a}else{return 0}},setTicksButton:function(){this.ticksOn=false;$("#boton_ticks").attr("onclick","").on("click",function(){this.ticksOn=!this.ticksOn;conmutarEstadoBoton("boton_ticks",!this.ticksOn);this.toggleTicks()}.bind(this))},toggleTicks:function(){$(".temas .item, .transparencia .item").not(".top, .media").each(function(){var e=$(this),t=e.text(),i=e.data("aprobado"),a=!!e.find(".ticks").length,n=blink.gradebook.ticksOn,o="tick_"+(i?"green":"red");if(a&&n||t==="-"||~t.indexOf("P")){return}if(n){!a&&$.data(e.get(0),"cache-html",e.html());e.html('<span class="ticks '+o+'"></span>')}else{e.html(e.data("cache-html"))}})},showFichaAlumnoResult:function(){var s=this.getSelectedSlideAverage(),r={},l={},e=Object.keys(actividades),d=["","ejercicios","examenes"],t=[],c=[],i=[],u=[],a=[],n=[],f;e.map(function(e){var t=actividades[e].notas&&parseInt(actividades[e].notas[0]),t=isNaN(t)?actividades[e].notas&&parseInt(actividades[e].notas[s]):t,i=actividades[e].idtema;var a=false;if(this.averages_selector_on&&!this.attempts_selector_on){a=!!parseInt(actividades[e].pte_revisar)&&(s==1||s==2)||this.attempts_selector_on}else{a=!isNaN(t)&&(s==this.default_attempts_to_show_map[1]||s==this.default_attempts_to_show_map[2])?0:!!parseInt(actividades[e].pte_revisar)}if(!isNaN(t)||a){var n=!isNaN(t);t=isNaN(t)?0:t;f=$("#nota_"+e);var o=f.parents(".actividad").data("evaltype")||actividades[e].tipo;this.pintarNota(f,t,"diag_activity",a);i=i||f.parents(".item").attr("id").replace("fila_","");l[o]=l[o]||[];r[o]=r[o]||[];if(!a||blink.domain.countPendingNote()){l[o][i]=l[o][i]+1||0;r[o][i]=r[o][i]||0;r[o][i]=(r[o][i]*l[o][i]+t)/(l[o][i]+1)}if(n||!n&&blink.domain.countPendingNote()){u[o]=u[o]||[];u[o][i]=r[o][i]}f=$("#media_"+d[o]+"_"+i+".nota");this.pintarNota(f,r[o][i],"diagnostico");c.indexOf(i)===-1&&c.push(i)}}.bind(this));u.map(function(e,i){e.map(function(e){a[i]=a[i]+1||0;n[i]=n[i]||0;n[i]=(n[i]*a[i]+e)/(a[i]+1);var t=$("#media_"+d[i]+" .nota");this.pintarNota(t,n[i],"diagnostico")}.bind(this))}.bind(this));var o=[];var h=blink.gradebook.DIAGNOSTICO_EXERCISE;if(blink.gradebook.fichaAlumnoGraficoExamenes){var p=[];var m=blink.gradebook.DIAGNOSTICO_EXAM}c=c.filter(function(e){return e!=0}).map(function(e){return parseInt(e)}).sort(function(e,t){return blink.gradebook.globalIdTemas.indexOf(e)-blink.gradebook.globalIdTemas.indexOf(t)});c.map(function(e){o.push(r[h]&&r[h][e]?parseFloat(gradeToNumGrade(r[h][e]).toFixed(2)):0);if(blink.gradebook.fichaAlumnoGraficoExamenes)p.push(r[m]&&r[m][e]?parseFloat(gradeToNumGrade(r[m][e]).toFixed(2)):0)});i.push({fillColor:"rgba(133,201,57,.1)",strokeColor:"rgba(133,201,57,1)",pointColor:"rgba(133,201,57,1)",pointStrokeColor:"#8CC63F",data:o});if(blink.gradebook.fichaAlumnoGraficoExamenes){i.push({fillColor:"rgba(41,171,226,.1)",strokeColor:"rgba(41,171,226,1)",pointColor:"rgba(41,171,226,1)",pointStrokeColor:"#29abe2",data:p})}charts.ejercicios&&charts.ejercicios.init(c,i)},openTema:function(t,e,i){var a=t.find(".top .titulo"),n=t.next(),o=n.children("div"),s=n.is(":visible");$(".temas").css("height",$(".temas").css("height"));var r=$(".tema");if(blink.domain.showSlidesGradebook()){r=r.filter(function(e){return $(this).data("alias")!=t.data("alias")})}var l=n.find(".subtema.abierto");l.length&&this.openActividad(l);$(".temas").css("width",1e4);l.length&&t.find(".actividades").remove();if(blink.domain.showSlidesGradebook()){r.toggle().promise().done(function(){n.toggle();t.toggleClass("abierto");blink.gradebook.calcularTamanoTemas(t)})}else{n.toggle(function(){t.toggleClass("abierto");blink.gradebook.calcularTamanoTemas(t)})}},calcularTamanoTemas:function(e){var t=$(".temas"),i=$(".tema:visible").length?$(".tema:visible"):$(".tema"),a=0,n=!blink.gradebook.esDeber?$(".subtemas:visible"):$(".subtema:visible").length?$(".subtema:visible"):$(".subtema");a=i.length*(5+i.outerWidth(true));n.each(function(){a+=5+$(this).outerWidth(true)});if(blink.gradebook.esDeber){var o=$(".transparencia");a+=o.length*(5+o.outerWidth(true))}t.css("width",a);t.css("height","auto");window.myScroll&&window.myScroll.refresh()},openActividad:function(e,t,i){$(".temas").css("width",1e4);var a=e.parent(),n=a.data("subtemas"),o=e.data("subtema"),s=e.parent().find(".subtema").not(".item"),r=t&&this.generarActividadesHtml(t,n,o,i);e.removeClass("plusLoading");e.toggleClass("abierto");s=s.filter(function(e){return $(this).data("subtema")!=o});s.toggle();e.hasClass("abierto")?$(r).insertAfter(e):e.parent().find(".actividades").remove();$(".temas").css("height",$(".temas").css("height"));this.calcularTamanoTemas(e);this.showTooltipsGradebook();this.toggleTicks()},pendingRevision:function(){$(".numTotPteRevisarInfo").hideBlink();blink.getJSON("/LMS/ajax.php?op=course.getClasesPteRevisar&idcurso="+idcurso+"&idgrupo="+idgrupo,function(e){if(typeof e==="object"&&!$.isEmptyObject(e)){blink.domain.showPendingReview(e)}})},abrirTemasFichaAlumno:function(e){if(!blink.domain.showGradebookDropDowns()){return}var t=e.parent(),i=t.find(".wDate-activity"),a=t.find(".more"),n=e.find("i.fa"),o=t.find(".comment-box");if(n.hasClass("disabled"))return;i.toggleClass("hidden");t.toggleClass("closed");if(i.hasClass("hidden")){n.removeClass("fa-minus").addClass("fa-plus");o.css("display","none");if(t.find(".row.actividad").length>maxactividades)a.addClass("hidden")}else{n.removeClass("fa-plus").addClass("fa-minus");if(t.find(".row.actividad").length>maxactividades)a.removeClass("hidden")}},desplegarNivelSlides:function(i,e){var t=i.data("tema"),a=i.data("subtema");$(".temas").css("width",1e4);if(e){if(i.hasClass("abierto")){blink.gradebook.openActividad(i)}else{var n="/LMS/calificaciones_json.php?idGroup="+idgrupo+"&idCourse="+idcurso+"&idActivity="+a;i.addClass("plusLoading");blink.getJSON(n,function(t){blink.getJSON("/LMS/ajax.php?op=activity.getSlides&idActivity="+a+"&excludeContentSlides=true",function(e){if(e!="ERROR"){blink.gradebook.openActividad(i,t,e)}else{i.removeClass("plusLoading")}},{},{onError:function(){_showAlert(textweb("gradebook_error_abrir_actividades"));i.removeClass("plusLoading")}})})}}},activitySlidesPullEnabled:function(t,i){var a=null;blink.gradebook.cursoJSON.units.map(function(e){if(e.id==t){e.subunits.map(function(e){if(e.id==i){a=e.slidesPull}})}});return a},formatearNotasExcel:function(e){if(this.nota_pendiente===e||blink.gradebook.notas_letras[e]&&blink.gradebook.notas_letras[e].length){return e}else{var t=e.replace(",",".").replace(/[^0-9.,\/]+/,"");return!isNaN(t)||/^[0-9]*\/[0-9]*/.test(e)?t:"-"}},inizializarExcelGradebook:function(){var t=!!$(".actividades .transparencia").length,e=this.tipoGradeBook[parseInt(tipo)]==this.DIAGNOSTICO_EJES,i=false;if(offline){blink.rest.connection(function(e){if(parseInt(e)){blink.gradebook.onBeforeGenerarExcel(t)}else{_showAlert(textweb("tablettxt_require_connection"))}})}else{blink.gradebook.onBeforeGenerarExcel(t)}},onBeforeGenerarExcel:function(e){blink.theme.spinner.show();if(e){showMsgBox(null,"/LMS/msgbox.php?op=AlertModal.showDialog",undefined,{title:textweb("filename_diagnostic_sheet"),text:textweb("gradebook_xls_msgAlert"),funcionEjecutar:"generar_excel_gradebook"})}else{this.generarExcelGradebook()}},itemExcel:function(e,t,i,a){var n={string:0,imagen:1,idalum:2,number:3},o=i||n[typeof t],s={};s.estilo=e;s.valor=t;s.tipo=o;a&&(s.comentario=a);return s},generarExcelGradebook:function(){var e=blink.gradebook.customizeExcelRows&&blink.gradebook.customizeExcelRows();var t="/LMS/SpreadSheetGeneration.php?idgroup="+idgrupo+"&serve=0",i=!!$(".actividades .transparencia").length,a={},n={string:0,imagen:1,idalum:2,number:3},o={1:"gradebook_examenes",2:"gradebook_ejercicios",3:"gradebook_competencias",4:"gradebook_deberes"},s=blink.gradebook[blink.gradebook.tipoGradeBook[parseInt(tipo)]]==blink.gradebook.DIAGNOSTICO_EJES,r=".xlsx",l="-",d=idcurso||idgrupo,c=$(".content-main-tabs .active").text().trim()||"",u=blink.gradebook.cursoJSON.title||!!$(".title-buttons .btn-primary").length&&$(".title-buttons .btn-primary")[0].innerText||textweb("gradebook_deberes"),f=textweb("filename_diagnostic_sheet")+l+c+l+u,h=textweb("filename_diagnostic_sheet")+": "+c+l+u,p={height:95,"image-width":205,"image-height":95},m=e&&e.eBasic?e.eBasic:{"background-color":"ffffff"},v=e&&e.eCabecera?e.eCabecera:{"background-color":"808080",color:"ffffff"},g=e&&e.eMedias?e.eMedias:{"background-color":"e9f1d3"},b=e&&e.eSubtema?e.eSubtema:{"background-color":"E0E0E0"},k={alignment:{vertical:"center",horizontal:"center"}},w=$.extend({},m,k),_=$.extend({},g,k),y=textweb(o[tipo]);if(cleanWhites(f).length>=maxNombreExcel-r.length){var C=l.length*2,S=r.length,x=Math.floor((maxNombreExcel-(textweb("filename_diagnostic_sheet").length+C+S))/2);if(cleanWhites(c).length>x){c=formatoTitulosExcel(c,x)}if(cleanWhites(u).length>x){u=formatoTitulosExcel(u,x)}f=textweb("filename_diagnostic_sheet")+l+c+l+u}a.nombre=cleanWhites(f)+r;a.estilo={color:"4D4D4D"};a.hojas=[];var A=!s?blink.gradebook.formatearNotasExcel($(".table .alumnos .item.media .nota")[0].innerText):"";a.hojas[0]={anchoColumnas:[10,30,10],nombre:y,contenido:[{posicion:{x:0,y:0},filas:[[blink.gradebook.itemExcel(p,"",1)],[blink.gradebook.itemExcel("",h)],[blink.gradebook.itemExcel("","")],[blink.gradebook.itemExcel(v,textweb("gradebook_xls_picture")),blink.gradebook.itemExcel(v,textweb("gradebook_xls_alumno")),blink.gradebook.itemExcel(v,!s?textweb("gradebook_xls_nota_media"):"")],[blink.gradebook.itemExcel(g,""),blink.gradebook.itemExcel(g,textweb("gradebook_xls_media_clase")),blink.gradebook.itemExcel(_,A)]]}]};var I=a.hojas[0].contenido[0].filas[3],T=a.hojas[0].contenido[0].filas[4],E=a.hojas[0].contenido[0].filas;if(s){I.pop();T.pop()}if(i){var P=$(".tema.abierto"),M=P.next(".subtemas:visible");if(!blink.gradebook.esDeber){A=P.find(".titulo").text()||"T1";I.push(blink.gradebook.itemExcel(v,A));A=blink.gradebook.formatearNotasExcel(P.find(".item.media").text());T.push(blink.gradebook.itemExcel(_,A))}var O=$(".subtema.abierto");A=O.find(".titulo").text()||"A1";I.push(blink.gradebook.itemExcel(b,A));A=blink.gradebook.formatearNotasExcel(O.find(".item.media").text());T.push(blink.gradebook.itemExcel(_,A));O.next(".actividades").find(".transparencia").each(function(e){A=$(this).find(".item.top .titulo").text()||"S"+e;I.push(blink.gradebook.itemExcel(m,A));A=blink.gradebook.formatearNotasExcel($(this).find(".item.media").text());T.push(blink.gradebook.itemExcel(w,A))})}else{for(var B in this.globalIdTemas){if(this.globalIdTemas.hasOwnProperty(B)){var N=blink.gradebook.globalIdTemas[B];if(!blink.gradebook.esDeber){A=$(".temas .tema[data-tema="+N+"] .titulo").text()||"T"+B;I.push(blink.gradebook.itemExcel(v,A));A=blink.gradebook.formatearNotasExcel($("#tema_avSel_"+N).text());T.push(blink.gradebook.itemExcel(_,A))}$(".subtemas[data-subtemas="+N+"] .subtema .titulo").each(function(){A=this.innerText||"A"+B;I.push(blink.gradebook.itemExcel(b,A));A=blink.gradebook.formatearNotasExcel($(this).parent().next(".item.media").text());T.push(blink.gradebook.itemExcel(_,A))})}}for(var D=0;D<this.globalEjes.length;D++){if(this.globalEjes.hasOwnProperty(D)){var j=blink.gradebook.globalEjes[D]["id"];var R=blink.gradebook.globalEjes[D]["name"];I.push(blink.gradebook.itemExcel(v,R));A=blink.gradebook.formatearNotasExcel($(".competencia[data-ejecode='"+j+"'] .nmedia").text());T.push(blink.gradebook.itemExcel(_,A))}}}var L=5;for(var F in blink.gradebook.globalIdAlumnos){if(blink.gradebook.globalIdAlumnos.hasOwnProperty(F)){var U=L+parseInt(F);E[U]=[];var W=blink.gradebook.globalIdAlumnos[F],V=["ffffff","ededed"],z={"background-color":V[F%2]},G=$.extend({},z,{height:25,"image-height":27,"image-width":27}),H=$.extend({},z,k);E[U].push(blink.gradebook.itemExcel(G,W,2));var J=$(".item:not(.media) .name"),K=J.find("a").length?J.find("a")[F].innerText.replace("\n"," "):J[F].innerText.replace("\n"," ");E[U].push(blink.gradebook.itemExcel(z,K));if(!s){A=blink.gradebook.formatearNotasExcel($("#nota_"+W).text());E[U].push(blink.gradebook.itemExcel(H,A))}if(s){for(var D=0;D<blink.gradebook.globalEjes.length;D++){if(blink.gradebook.globalEjes.hasOwnProperty(D)){var j=blink.gradebook.globalEjes[D]["id"],X=$("#competencia_"+W+"_"+j);A=blink.gradebook.formatearNotasExcel(X.text());E[U].push(blink.gradebook.itemExcel(H,A))}}}else if(i){var P=$(".tema.abierto"),N=P.data("tema");M=P.next(".subtemas:visible"),X=P.find("#item_tema_"+W+"_"+N);if(!blink.gradebook.esDeber){A=blink.gradebook.formatearNotasExcel(X.text());E[U].push(blink.gradebook.itemExcel(H,A))}X=!blink.gradebook.esDeber?M.find(".subtema.abierto .item[data-alumno="+W+"]"):$(".temas .subtema.abierto .item[data-alumno="+W+"]");A=blink.gradebook.formatearNotasExcel(X.text());E[U].push(blink.gradebook.itemExcel(H,A));var q=!blink.gradebook.esDeber?O.next(".actividades").find(".transparencia"):$(".transparencia");q.each(function(e){X=$(this).find(".item[data-alumno="+W+"] a");A=blink.gradebook.formatearNotasExcel(X.text());E[U].push(blink.gradebook.itemExcel(H,A))})}else if(!blink.gradebook.esDeber){for(var B in blink.gradebook.globalIdTemas){if(blink.gradebook.globalIdTemas.hasOwnProperty(B)){var N=blink.gradebook.globalIdTemas[B];var X=$("#item_tema_"+W+"_"+N);A=blink.gradebook.formatearNotasExcel(X.text());E[U].push(blink.gradebook.itemExcel(H,A));X=!blink.gradebook.esDeber?$(X).parent().next(".subtemas").find(".subtema .item[data-alumno="+W+"]"):$(".transparencia .item[data-alumno="+W+"]");$(X).each(function(){A=blink.gradebook.formatearNotasExcel($(this).text());E[U].push(blink.gradebook.itemExcel(H,A))})}}}else{$(".item[data-alumno="+W+"]").each(function(){A=blink.gradebook.formatearNotasExcel($(this).text());E[U].push(blink.gradebook.itemExcel(H,A))})}}}var Y="dataSS="+encodeURIComponent(json_encode(a));blink.ajax(t,function(e){if(e.startsWith("GO")){location=e.substring(3);blink.theme.spinner.hide()}else{_showAlert("Error al generar el excel");blink.theme.spinner.hide()}},{data:Y})}}})(window.blink);$(document).ready(function(){$(document).on("change",".inputFiltros, #select_attempt",function(e){e.preventDefault();e.stopPropagation();if(!(typeof idalumno!=="undefined")){var t=$("#boton_ticks"),i=t.hasClass("active");i&&t.click();blink.gradebook.showGradebookResult();i&&t.click();blink.gradebook.pendingRevision()}else{blink.gradebook.showFichaAlumnoResult()}});$(document).on("myCustomTapEvent",".slidePending .item.top",function(e){e.preventDefault();e.stopPropagation();blink.checkConnection(function(){getAlumnosPendientes($(this).attr("data-prefijoSlide"),$(this).attr("data-tema"));alumnos_correccion.alumno_actual=alumnos_correccion.alumnos[0];var e=parseInt($(this).attr("data-prefijoSlide").replace("t","")),t=!$("#ficha-alumno").length,i=blink.gradebook.MODO_NAVEGACION_PENDING,a=$(this).parent().data("transparencia");diagIrClase($(this).attr("data-tema"),alumnos_correccion.alumnos[0],idcurso,e,false,"",t,i,a)}.bind(this),function(){_showAlert(textweb("tablettxt_require_connection"))})});$(document).on("myCustomTapEvent",".item.top.hideSlides.revisable",function(e){e.preventDefault();e.stopPropagation();blink.checkConnection(function(){var e=$(this).parent().data("subtema");getAlumnosPendientes(null,e);alumnos_correccion.alumno_actual=alumnos_correccion.alumnos[0];var t=!$("#ficha-alumno").length,i=blink.gradebook.MODO_NAVEGACION_PENDING;diagIrClase(e,alumnos_correccion.alumnos[0],idcurso,0,false,"",t,i)}.bind(this),function(){_showAlert(textweb("tablettxt_require_connection"))})});$(document).on("myCustomTapEvent",".tema",function(e){var t=$(this);var i=t.data("tema");if($('.subtemas[data-subtemas="'+i+'"] .subtema').size()>0){blink.gradebook.openTema(t,t.data("alias"),t.data("titulo"))}});$(document).on("myCustomTapEvent",".subtema .item.top:not(.hideSlides)",function(e){if(!blink.domain.showSlidesGradebook()||$(".plusLoading").length)return;if(e.target!==this)return;var t=false,i=$(this).parent();if(offline){blink.rest.connection(function(e){!parseInt(e)?_showAlert(textweb("tablettxt_require_connection")):t=true;blink.gradebook.desplegarNivelSlides(i,t)})}else{t=true;blink.gradebook.desplegarNivelSlides(i,t)}});$(document).on("myCustomTapEvent",".table .item a",function(e){alumnos_correccion.alumno_actual=$(this).parent().attr("data-alumno");getAlumnosCorreccion($(this).parent().attr("data-tema"))});$(document).on("click","#ficha-alumno .show-chart",function(e){if(!blink.domain.showGradebookDropDowns()){return}var t=$(this).parent().siblings(".ejercicios"),i=$(this).find("i.fa");t.toggleClass("hidden");if(t.hasClass("hidden")){i.removeClass("fa-chevron-down").addClass("fa-chevron-up")}else{i.removeClass("fa-chevron-up").addClass("fa-chevron-down")}});$(document).on("click","#ficha_ejercicios .container-drop-down",function(e){blink.gradebook.abrirTemasFichaAlumno($(this))});$(document).on("myCustomTapEvent",".nota-slide",function(){var e=$(this).parent();var t=e.attr("data-tema"),i=e.attr("data-alumno"),a=parseInt(e.attr("data-prefijoSlide").replace("t","")),n=!$("#ficha-alumno").length;blink.domain.openActivity(t,i,"",a,false,"",n)});$(".temas").on("myCustomTapEvent",".subtemas .subtema .item.subtema a",function(){var e=$(this).data("subunidad");var t=$(this).data("alumno");if(typeof e!=="undefined"&&typeof t!=="undefined"){blink.domain.openActivity(e,t,"","",false,"",true,"")}})});(function(m){"use strict";var e=function(e){this.Slider=e},o=m.currentPage;var t=[{name:"Tabla centrada",element:"table",type:"bck-stack-class",attributes:{class:"bck-table-center"}},{name:"Versalitas",element:"span",attributes:{class:"bck-versalitas"}}];m.events.on("user:editorEspecial",function(){if($(".editespecial1").length){t.push({name:"wordBank",element:"span",attributes:{class:"ws-responses-top"}})}});e.prototype={bodyClassName:"content_type_clase_basic",extraPlugins:["image2"],removePlugins:{admin:"blink_iframe_embedder,blink_music_editor"},customColors:{DEFAULT:{className:"white",hex:"#fff"},RED:{className:"red",hex:"#fc4236"},PINK:{className:"pink",hex:"#ff7bac"},PURPLE:{className:"purple",hex:"#81007f"},DARK_BLUE:{className:"dark-blue",hex:"#0071bd"},LIGHT_BLUE:{className:"light-blue",hex:"#29aae3"},BROWN:{className:"brown",hex:"#a67c52"},ORANGE:{className:"orange",hex:"#ff931e"},YELLOW:{className:"yellow",hex:"#ffff01"},LIGHT_GREEN:{className:"light-green",hex:"#79c942"},DARK_GREEN:{className:"dark-green",hex:"#009345"},WHITE:{className:"white",hex:"#fff"},GREY:{className:"grey",hex:"#9e9e9c"},BLACK:{className:"black",hex:"#000"}},ckEditorStyles:{name:"basic",styles:t},newFonts:false,canvasMaxWidth:883,$canvasWrapper:null,tools:[m.tools.pencil,m.tools.highlighter,m.tools.note],pencil:null,isLonelyActivityStandalone:function(){return typeof m.activity.sections!=="undefined"&&m.activity.sections.length==1&&modoVisualizacion==2&&classexported},setLayoutOnLonelyActivityStandAlone:function(){return false},loadedAfterInit:true,filterTags:[],filterStyles:[],popoverPlacement:"bottom",allowGroupPlanningBlockContent:function(){return true},init:function(){this.$canvasWrapper=$("#canvas-wrapper");if(this.showBookIndexInClass()){m.theme.buttonState.hidden("#btn-book-index",false)}this.setBodyClassName(this.bodyClassName);this.setPanelsWidth();this.setPanelsHeight();this.setPanelsBackground();this.setEventPanelsBackgroundPosition();this.setEventPanels();this.assignHandlerBlinkEvents();this.onChangeWindowSize();this.setCanvasWidth();this.setCanvasSize(m.activity.currentSection);this.allocateCanvas(m.activity.currentSection);this.reallocateSectionImgsAux();this.cleanEmptyTitlesOfCancatenatedSlides();this.setTooltip();this.autoGrow();this.initDropdown();this.initFontSizeTool();this.initFlipBox();this.initNextButton();this.initTabs();this.initMusicEditor();this.initInfoPopover();this.initSlideNavigationToolbar();this.hideOnlyForTeachersItems();if(this.isSlidePreview()){this.preventTouchCarousel()}},configEditor:function(e){e.dtd.$removeEmpty["span"]=false},preventTouchCarousel:function(){$("#swipeview-slider").on("touchstart",function(e){e.stopPropagation();e.stopImmediatePropagation();return})},initSlideNavigationToolbar:function(){if(this.isSlidePreview()){$(".navbar-bottom").attr("class","no-navbar").css("display","none")}},isSlidePreview:function(){var e=getQueryParamValue("_slidePreview");if(e==="1"){return true}else{return false}},initEventSequencing:function(){m.events.once("section:shown",function(){var e=$("#activitySequencing");if(esAlumno&&3!=window.modoClase&&1==e.val())this.initSequencingBehaviour()}.bind(this))},initSequencingBehaviour:function(){if(m.isIosApp){$(".slider-control").addClass("forced-in-sequencing")}$(".slider-indicators").off("click");$("#swipeview-slider").on("touchstart",function(e){e.stopPropagation();e.stopImmediatePropagation();return});this.sequencingNavigation();this.sequencingNavigationEvents();m.events.on("slide:update:after section:shown",function(){this.sequencingNavigationEvents();this.pageIsLoading=false}.bind(this));m.events.on("slide:update:after",function(){this.sequencingNavigation();this.pageIsLoading=false}.bind(this))},isAllSliderActivitiesCompleted:function(){var e=$("#slider-item-"+activeSlide),t=e.find(".js-slide-wrapper"),a=true;if(t.length!=0){t.each(function(){var e=$(this),t=e[0].id,i=t.split("transp")[1];if(window["t"+window.secuencia[i]+"_slide"].esEvaluable){if(!window["t"+window.secuencia[i]+"_slide"].isDone()){a=false;return false}}})}return a},sequencingNavigation:function(){var e=$(".right.slider-control");e.removeClass("not-allowed");if(!this.isAllSliderActivitiesCompleted()){e.addClass("not-allowed")}},sequencingNavigationEvents:function(){var e=this;$(".slider-control").off("click");$(".left.slider-control").on("click",function(){if(!e.pageIsLoading){m.activity.showPrevSection();e.pageIsLoading=true}});$(".right.slider-control").on("click",function(){if(!e.pageIsLoading&&!$(this).hasClass("not-allowed")){m.activity.showNextSection();e.pageIsLoading=true}else{_showAlert(textweb("new_edit_class_sequencing_msg"))}})},setCanvasWidth:function(){var e=this;m.events.on("managerTools:inited",function(){e.pencil=m.tools.manager.tools.pencil;e.pencil&&e.pencil.setWidthToAllCanvas(e.canvasMaxWidth)})},changeHighBar:function(){if($(".publisher-navbar").length&&$(".navbar").length){m.theme.setTopByHeight(".navbar",".publisher-navbar")}},getEditorStyles:function(){if(typeof this.parent!="undefined"){var e=this.ckEditorStyles.stylesToRemove;if(typeof e!=="undefined"&&e){var t=this.parent.ckEditorStyles.styles;if(typeof t!=="undefined"&&t){for(var i=0;i<t.length;i++){if(e.indexOf(t[i].name)>-1){t.splice(i,1);i--}}this.parent.ckEditorStyles.styles=t}}this.ckEditorStyles.styles=typeof this.ckEditorStyles.styles!=="undefined"?this.parent.getEditorStyles().styles.concat(this.ckEditorStyles.styles):this.parent.getEditorStyles().styles}return this.ckEditorStyles},getEditorMaxHeight:function(){return 250},getSlideProperties:function(e){var t=$("#transp"+e);var i="";if(editar){var a=!t.find(".image-aux-pos").hasClass("hidden"),n=t.find(".js-image-aux-pos"),o=t.find(".js-image-aux-size"),s=t.find(".js-image-aux-range"),r=a&&parseInt(n.val()),l=a&&parseInt(o.val()),d=a&&parseInt(s.val())}else{var r=parseInt(window["t"+e+"_slide"].imgAuxPosition),l=parseInt(window["t"+e+"_slide"].imgAuxSize),d=parseInt(window["t"+e+"_slide"].imgAuxRange),a=window["t"+e+"_slide"].hasAuxImg;i=a?"":window["t"+e+"_slide"].imagenBackSlide}var c=t.find(".slide_aux .video-js"),u=t.data("columnaUnica")==1,f=!!t.closest(".slide-concatenate").length,h=false;if(!f){var p=t.closest(".item-container");h=!!p.find(".slide-concatenate").length}var m={hasAuxImg:a,isAuto:r==0,isRight:r==1,isLeft:r==2,isTop:r==3,isBottom:r==4,isColumnaUnica:u,isConcatenate:f,hasConcatenate:h};var v={isBckg:d==1,isFit:d==2||d==0&&!m.isAuto&&!m.isColumnaUnica,isFullScreen:d==3};var g={isLarge:l==1,isMedium:l==2||l==0&&(m.isRight||m.isLeft)&&(!m.isAuto&&!m.isColumnaUnica),isSmall:l==3};var b={isVideo:c.length>=1};return{hasAuxImg:a,imgAux:m,imgAuxSize:g,imgAuxRange:v,imgAuxContent:b,imgBack:i}},reallocateSectionImgsAux:function(){var i=this;var a;var n;_.each(m.activity.sections,function(e,t){if(editar){i.reallocateImgAux(t)}else{if(e.length>1){_.each(e,function(e){a=e.prefijo;n=parseInt(a.replace("t",""));i.reallocateImgAux(n)})}else{a=e[0].prefijo;n=parseInt(a.replace("t",""));i.reallocateImgAux(n)}}})},reallocateImgAux:function(e){var t=$("#transp"+e),i=t.find("#t"+e+"left"),a=t.find("#t"+e+"right"),n=i.add(a),o=t.closest(".item-container"),s=this.getSlideProperties(e);if(s.imgAux.isConcatenate){o=t.closest(".slide-concatenate")}a.insertAfter(i);(s.imgAux.isLeft||s.imgAux.isTop)&&i.insertAfter(a);a.toggleClass("aux-left",s.imgAux.isLeft);n.toggleClass("fill",s.imgAux.isBottom||s.imgAux.isTop);if(!editar){s.imgAuxSize.isLarge&&o.addClass("is-large");s.imgAuxSize.isMedium&&o.addClass("is-medium");s.imgAuxSize.isSmall&&o.addClass("is-small");!s.imgAux.hasAuxImg&&o.addClass("no-image");s.imgAux.isAuto&&o.addClass("automatic");s.imgAux.isLeft&&o.addClass("is-left");s.imgAux.isRight&&o.addClass("is-right");s.imgAux.isTop&&o.addClass("is-top");s.imgAux.isBottom&&o.addClass("is-bottom");s.imgAux.hasConcatenate&&o.addClass("has-concatenate");s.imgAuxRange.isFullScreen&&o.addClass("aux-fullscreen");s.imgAuxRange.isBckg&&o.addClass("aux-bckg");s.imgAuxRange.isFit&&o.addClass("aux-fit");if(isset(s.imgBack)&&s.imgBack!==""){o.addClass("aux-bckg");o.addClass("is-top")}s.imgAuxContent.isVideo&&o.addClass("is-video");if(s.imgAux.isColumnaUnica){o.removeClass("automatic");o.addClass("is-bottom");o.addClass("aux-fit")}}},setPanelsWidth:function(){var l=this;if(!$(".print-mode").length){$("#swipeview-slider .slide-wrapper").each(function(e,t){var i=$(this),a=i.closest(".js-slide-wrapper").attr("data-slide-index"),n=l.getSlideProperties(a),o=i.closest(".item-container"),s=o.hasClass("aux-fullscreen"),r=o.hasClass("is-top")||o.hasClass("is-bottom");if(n.imgAux.isConcatenate&&(!s||!r)){l.setPanelWidthConcatenate(i);return true}if(n.imgAuxRange.isFit&&(n.imgAux.isLeft||n.imgAux.isRight)){l.setPanelWidthFitRightLeft(i);return true}if(n.imgAuxRange.isFit&&(n.imgAux.isTop||n.imgAux.isBottom)){l.setPanelWidthFitTopBottom(i);return true}if(n.imgAux.isColumnaUnica){l.setPanelWidthFitTopBottom(i);return true}if(n.imgAux.isAuto){l.setPanelWidthAuto(i);return true}})}},setPanelWidthConcatenate:function(e){var t=e.find(".layout-panel.right"),i=e.find(".layout-panel.left");t.css("width","");i.css("width","")},setPanelWidthFitRightLeft:function(e){var t=e.find(".layout-panel.right");t.css("width","");var i=this.calculateLeftPanelWidth(e),a=e.find(".layout-panel.left");if(i>0)a.outerWidth(i)},setPanelWidthFitTopBottom:function(e){var t=e.find(".layout-panel.right");t.css("width","")},setPanelWidthAuto:function(e){var t=this.calculateLeftPanelWidth(e),i=e.find(".layout-panel.left");if(t>0)i.outerWidth(t)},calculateLeftPanelWidth:function(e){var t=e.closest(".js-slide-wrapper").width(),i=e.find(".layout-panel.right"),a=i.outerWidth(),n=t-a-(a?o.SPACE_INTER_PANELS:0);return n},setPanelsHeight:function(){var o=this;if(!$(".print-mode").length){$("#swipeview-slider .slide-wrapper").each(function(e,t){var i=$(this),a=i.closest(".js-slide-wrapper").attr("data-slide-index"),n=o.getSlideProperties(a);if(n.imgAuxRange.isFullScreen&&(n.imgAux.isLeft||m.windowWidth>=1024&&n.imgAux.isRight)){if(n.imgAux.hasConcatenate){o.setPanelHeightFullRightLeftWithConcatenate(i);return true}else{o.setPanelHeightFullRightLeft(i);return true}}})}},setPanelHeightFullRightLeftWithConcatenate:function(e){var t=e.closest(".js-slide-wrapper");t.css("min-height","")},setPanelHeightFullRightLeft:function(e){var t=e.closest(".js-slide-wrapper");t.css("min-height","");var i=this.calculateLeftPanelHeight(e);t.css("min-height",i)},calculateLeftPanelHeight:function(e){var t=e.closest(".item-container").innerHeight();return t},setEventPanels:function(){var a=this;var n=$("video.video-aux");m.events.on("showSection:after",function(){if($(".slide-wrapper").length>0&&typeof a.Slider.slider!=="undefined"){var e=$("#slider-item-"+window.secuencia[a.Slider.slider.page]).find(".video-background");var t=$("#slider-item-"+window.secuencia[a.Slider.slider.page]).find(".video-fullscreen");var i=!!e.length?e.get(0):t.get(0)}if(typeof n!="undefined"){n.each(function(){this.pause()})}a.setPanelsWidth();a.setPanelsHeight();a.setPanelsBackgroundPosition();if(typeof i!="undefined")i.play()})},setPanelsBackground:function(){var o=this;if(!$(".print-mode").length){$(".slide-wrapper").each(function(e,t){var i=$(this),a=i.closest(".js-slide-wrapper").attr("data-slide-index"),n=o.getSlideProperties(a);if((n.imgAuxRange.isFullScreen||n.imgAuxRange.isBckg)&&n.hasAuxImg){o.createFullscreenBackgroundMedia(i,a)}else if(isset(n.imgBack)&&n.imgBack!==""){o.createFullScreenImagen(i,a)}})}},createFullScreenImagen:function(e,t){var i=e.closest(".item-container"),a=this.getSlideProperties(t);var n="url('"+a.imgBack+"')";i.prepend('<div class="fs-img-container img-back-slide" id="slider-'+t+'-img-container"></div>');i.find(".fs-img-container").css("background-image",n)},createFullscreenBackgroundMedia:function(e,t){var i=e.closest(".item-container"),a=this.getSlideProperties(t);i.prepend('<div class="fs-img-container" id="slider-'+t+'-img-container"></div>');if(!a.imgAuxContent.isVideo){var n=e.find("#t"+t+"_multimedia").find(":first-child").attr("src");var o="url('"+n+"')";i.find(".fs-img-container").css("background-image",o);var s=m.utils&&m.utils.imgOnError?'onerror="blink.utils.imgOnError(this)"':"";i.prepend('<div class="fs-img-container-mobile"><img src="'+n+'" '+s+" /></div>")}else{var r=null,l=i.find(".slide_aux .video-js").data("setup").sources[0].src;if(a.imgAuxRange.isBckg){r='<video loop muted id="t'+t+'-video-background" class="video-background video-aux" src="'+l+'" width="100%" height="100%"></video>';i.find(".fs-img-container").append(r);$('<div class="fs-img-container-mobile"></div>').insertAfter(i.find(".fs-img-container"))}else{if(a.imgAux.isLeft||a.imgAux.isRight){if(m.windowWidth<1024){r='<video loop muted id="t'+t+'-video-background" class="video-fullscreen video-aux" src="'+l+'" width="100%" height="100%"></video>';i.prepend('<div class="fs-img-container-mobile">'+r+"</div>")}else{r='<video loop muted id="t'+t+'-video-background" class="video-background video-aux" src="'+l+'" width="100%" height="100%"></video>';i.find(".fs-img-container").append(r);$('<div class="fs-img-container-mobile"></div>').insertAfter(i.find(".fs-img-container"))}}else{r='<video loop muted id="t'+t+'-video-background" class="video-fullscreen video-aux" src="'+l+'" width="100%" height="100%"></video>';i.prepend('<div class="fs-img-container-mobile">'+r+"</div>")}}}e.append('<div class="clearfix">');i.append('<div class="clearfix">')},setEventPanelsBackgroundPosition:function(){var e=this;window.onload=function(){e.setPanelsBackgroundPosition()}},deshabilitarMenuContextualGaleria:function(){return false},setPanelsBackgroundPosition:function(){var o=this;if(!$(".print-mode").length){$(".slide-wrapper").each(function(e,t){var i=$(this),a=i.closest(".js-slide-wrapper").attr("data-slide-index");if(!a){return}var n=o.getSlideProperties(a);if(m.windowWidth<1024&&(n.imgAuxRange.isFullScreen||n.imgAuxRange.isBckg)){if(n.imgAux.isLeft||n.imgAux.isTop){o.setBackgroundPositionLeftTop(i)}if(n.imgAux.isRight||n.imgAux.isBottom){o.setBackgroundPositionBottomConcatenate(i)}}if(m.windowWidth>=1024&&(n.imgAuxRange.isFullScreen||n.imgAuxRange.isBckg)){o.resetBackgroundPosition(i)}if(m.windowWidth>=1024){if(n.imgAuxRange.isFullScreen&&n.imgAux.isTop){o.setBackgroundPositionLeftTop(i)}if(n.imgAuxRange.isFullScreen&&n.imgAux.isBottom){o.setBackgroundPositionBottomConcatenate(i)}}})}},setBackgroundPositionLeftTop:function(e){var t=e.find(".slide_main"),i=this.getImgAuxHeight(e),a=this.calculatePixelsTitle(e),n=e.closest(".item-container"),o=n.find(".fs-img-container-mobile");o.css({"margin-top":a+20+"px"});t.css({"margin-top":i+30+"px"})},setBackgroundPositionRightBottom:function(e){var t=e.find(".slide_main"),i=this.getImgAuxHeight(e);t.css({"margin-bottom":i+30+"px"})},setBackgroundPositionRightBottomConcatenate:function(e){var t=e.find(".slide_main"),i=this.getImgAuxHeight(e);t.css({"margin-bottom":"30px"})},setBackgroundPositionBottomConcatenate:function(e){var t=e.closest(".item-container"),i=this.getImgAuxHeight(e);t.css({"padding-bottom":i+30+"px"})},resetBackgroundPosition:function(e){var t=e.find(".slide_main"),i=e.closest(".item-container"),a=i.find(".fs-img-container-mobile");a.css({"margin-top":""});i.css({"padding-bottom":""});t.css({"margin-top":"","margin-bottom":"","padding-bottom":""})},calculatePixelsTitle:function(e){var t=e.closest(".item-container"),i=t.find(".header"),a=i.innerHeight();return a},getImgAuxHeight:function(e){var t=e.closest(".item-container"),i=t.find(".fs-img-container-mobile img, .fs-img-container-mobile video"),a=i.innerHeight();return a},setBodyClassName:function(e){$("body").removeClass(function(e,t){return $.trim(t.match(/(content_type_clase_)[\w\-]*/g))}).addClass(e)},onChangeWindowSize:function(){this.reallocateSlideAuxForSection(m.activity.currentSection);this.setSlidesDimensions();this.configureDrawToolsButtons();this.setCanvasSize(m.activity.currentSection);this.setPanelsBackgroundPosition();this.setPanelsWidth();this.setPanelsHeight();this.reallocateSlideVideosAux();m.activity.edit&&m.activity.edit.setPanelsWidth&&m.activity.edit.setPanelsWidth()},allocateCanvas:function(e){if(!window.esWeb){var t=this.Slider.getSectionWrapper(e),i=this;if(i.$canvasWrapper!==null){setTimeout(function(){i.$canvasWrapper.prependTo(t.find(".js-slide-wrapper").get(0))},0)}}},drawNotes:function(e){m.tools.note.drawNotes(e)},shouldCleanCanvasOnSectionChange:function(){return true},assignHandlerBlinkEvents:function(){var e=this.onAfterShowSlide;m.events.on("showSlide:after",e.bind(this))},reallocateSlideAuxForSection:function(e){var t=m.activity.getIndexsFromSection(e);for(var i=0;i<t.length;i++){this.reallocateSlideAux(t[i])}},reallocateSlideAux:function(e,t){var i=e,a=$("#transp"+i);if(!a.length){return}var n=a.data("type"),o=a.find("#t"+i+"left"),s=a.find(".js-multimedia-column"),r=a.find("#t"+i+"right"),l=o.next().get(0),d=!!r.length&&r.get(0)===l,c=m.windowWidth;if(n==5||n==34){if(editar){r.css("width","").find(".ui-resizable-handle").hideBlink();s.closest(".layout-panel").css("width","")}r.insertAfter(o)}else if(c<1024){if(r.hasClass("left")){r.appendTo(s);r.insertBefore(o)}}else{editar&&!d&&r.insertAfter(o)}if(typeof t==="function")t()},reallocateSlideVideosAux:function(){var n=this;$(".js-slide-wrapper").each(function(){var e=$(this),t=e.attr("data-slide-index"),i=n.getSlideProperties(t);if(i.imgAux.isRight||i.imgAux.isLeft||i.imgAuxRange.isBckg){var a=$("video#t"+t+"-video-background");if(m.windowWidth<1024){a.removeClass("video-background").addClass("video-fullscreen");a.appendTo(a.parent().siblings(".fs-img-container-mobile"))}else{a.removeClass("video-fullscreen").addClass("video-background");a.appendTo(a.parent().siblings(".fs-img-container"))}}});if($(".js-slide-wrapper").length>0&&typeof n.Slider.slider!=="undefined"){var e=$("#slider-item-"+window.secuencia[n.Slider.slider.page]).find(".video-background");var t=$("#slider-item-"+window.secuencia[n.Slider.slider.page]).find(".video-fullscreen");var i=!!e.length?e.get(0):t.get(0);if(typeof i!=="undefined")i.play()}},setSlidesDimensions:function(){this.setMinHeightToSlide()},setMinHeightToSlide:function(){var e=$(".navbar-bottom").height()||$(".publisher-navbar").height(),t=$(".navbar").height(),i=$(".modo_revision"),a=!window.checkModoPracticas()?i.height():0,n=$(".item-container"),o=40,s=m.windowHeight-t-o-e-a;n.css({minHeight:s})},configureDrawToolsButtons:function(){var e=window.location.search.includes("_fromUX");var t=$("#boton_rotulador").add("#boton_borrador").add("#boton_notes");if((typeof window.MIN_CANVAS_SIZE==="undefined"||m.windowWidth<window.MIN_CANVAS_SIZE||isPhone)&&!e){m.theme.buttonState.hidden(t,true);window.setPizarraOff(true)}else{m.theme.buttonState.hidden(t,false)}},setCanvasSize:function(e){if(window.editar)return;if(typeof window.MIN_CANVAS_SIZE==="undefined"||m.windowWidth<window.MIN_CANVAS_SIZE)return;if(!this.pencil)return;var t="t"+e,i=$("#transp"+e),a=i.closest(".item-container").show(),n=a.height(),o=a.find("#transp"+e).width();if(o){this.pencil.setCanvasSize(t,n,o)}else{this.pencil.setCanvasHeight(t,n)}redrawCanvas()},onAfterShowSlide:function(e){this.reallocateSlideAuxForSection(e);$(document).scrollTop(0);if(checkModoRevision()||checkModoCorreccion()){$("textarea:not(.digitalnote)").trigger("keyup")}if(!!$(".bck-gallery-images").length){if(!editar){galleryManager=initPhotoSwipeFromDOM(".bck-gallery-images");_.each(galleryManager.galleryList,function(e,t){e.init()})}}},cleanEmptyTitlesOfCancatenatedSlides:function(){$(".slide-concatenate").find(".title").has("h3.empty").hideBlink()},setTooltip:function(){$(".slider-indicators > li").tooltip({placement:"top"})},autoGrow:function(){jQuery(function(){$("textarea:not(.digitalnote):not(.cke_source):not(.bck-ckeditor)").autogrow()})},removeFinalSlide:function(e){e=e||false;if(!(window.esExamen!==null&&window.esExamen===true)&&e){if(!checkModoCorreccion()&&!checkModoRevision()){this.Slider&&this.Slider.removeLastItem&&this.Slider.removeLastItem()}}},addSlideNavigators:function(){var d=$('<div class="navigator"><div class="main-navigator"><div class="left"></div><div class="right"></div></div></div>'),c=$(".left.slider-control").clone(),u=$(".right.slider-control").clone();var f=m.activity.esdeber;var h=m.activity.idClaseOriginal;c.add(u).find("span").remove();var p=0;var t=$(".item-container");t=t.filter(function(e){if($(t[e]).find("#final").length>0){return false}return true});t.each(function(e,t){var i=d.clone(),a,n,o=false;var s,r=p-1;while(r>=0){if(s=window["t"+r+"_slide"]){if(s.isConcatenate&&(f?h!=0:true)){r--}else{a=c.clone();a.append('<span class="title">'+stripHTML(s.title)+"</span>");i.find(".left").append(a);o=true;break}}else{break}}p++;var l;while(p<window.secuencia.length){if(l=window["t"+p+"_slide"]){if(l.isConcatenate&&(f?h!=0:true)){p++}else{n=u.clone();n.prepend('<span class="title">'+stripHTML(l.title)+"</span>");i.find(".right").append(n);o&&n.parent(".right").addClass("separator");break}}else{break}}$(t).append(i)});$(".navigator").on("click",".left.slider-control",function(){m.activity.showPrevSection()}).on("click",".right.slider-control",function(){m.activity.showNextSection()})},goToNextActivity:function(){this.goToNextURL("next","actividad")},goToPrevActivity:function(){this.goToNextURL("prev","actividad")},goToNextURL:function(o,n){var s=this;n=n||false;var r=function(e,t,i){i=e=="next"?i+1:i-1;for(var a=i;a>=0&&a<t.length;e==="next"?a++:a--){if((!n||t[a].type===n)&&s.filterTags.indexOf(t[a].tag)<0&&s.filterStyles.indexOf(t[a].contentStyle)<0&&t[a].openNewIframe!=true){return t[a]}}};var l=function(e,t){var i=_.reduce(e.units,function(e,t){return e.concat(t.subunits)},[]);var a=_.pluck(i,"id"),n=_.indexOf(a,t),o=r("prev",i,n),s=r("next",i,n);return{prev:o,next:s}};m.getCourse(idcurso).done(function(e){var t=l(e,window.idclase);if(t[o]){var i=t[o].url+(typeof window.esPopup!=="undefined"&&window.esPopup?"&popup=1":"");var a=parseInt(m.getReqParam(location.href,"idalumno"));if(a)i+="&idalumno="+a;var n=m.getReqParam(location.href,"attempt");if(n&&n!="")i+="&attempt="+n;window.redireccionar(i)}else{_showAlert(o==="next"?textweb("fin_libro"):textweb("inicio_libro"))}})},initDropdown:function(){if(!editar){var e=$("span.bck-dropdown");if(e.length>0){e.find("span").removeAttr("style");for(i=0;i<e.length;i++){var t=$(e[i]).attr("class");var a=$(e[i]).html().replace(/span/g,"div");$(e[i]).replaceWith('<div class="'+(t?t:"bck-dropdown")+'">'+a+"</div>")}}}$(".bck-dropdown-button").find(".fa").text("").end().toggle(function(){$(this).parent(".bck-dropdown").addClass("open").find(".fa").removeClass("fa-chevron-down").addClass("fa-chevron-up").end().find(".bck-dropdown-content").slideDown(300)},function(){$(this).parent(".bck-dropdown").removeClass("open").find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down").end().find(".bck-dropdown-content").slideUp(300)})},addExtraToolbarButtons:function(){},removeToolbarButtons:function(e){return e},showBookIndexInClass:function(){return false},matchingLinesColors:function(e){switch(e){case"ok":return"#9bc470";case"ko":return"#b96e6e";case"sol":return"#56c2dd";default:return"#000"}},getAdditionalVarsScriptOffline:function(e){return""},getClasificacionActividadWeb:function(e){var t="";if(e.core.score.raw||e.core.score.raw===0)t=e.core.score.max>0?e.core.score.raw*100/e.core.score.max:"0";if(e.core.score.manual_raw!=""&&e.core.score.manual_raw!="-1"){t=e.core.score.manual_raw}return t},correctionModeClickable:function(){return true},correctionModeShowComments:function(){return true},postCommitScorm:function(){},isPopup:function(){return m.getReqParam(location.href,"popup")!=""},showKeyboard:function(){return true},showRepeatedSolutionsCountAlways:function(){return false},specificPrintMode:function(){return false},readSuspendData:function(){return false},isEmbeddedAudio:function(){return false},isEmbeddedVideo:function(){return true},getToolbar:function(e){if(e){var s=this;$.each(e,function(e,t){if(!s.isEmbeddedAudio()||!s.toolbarAllow(e)){return}var i=_.filter(t,function(e){return e.name=="insert"});if(!i.length){return}var a=i[0].items,n=a.indexOf("blink_sound"),o=n!==-1?n:a.length;a[o]="Blink_sound"})}return e},toolbarAllow:function(e){return true},initInfoPopover:function(){var d=this;if(!$("body").hasClass("edit")){m.events.on("section:shown",function(){var n=0,e=$(".swipeview-active").find(".info-popover"),t=$("#slider-item-"+m.activity.currentSection);if($(e).length>0){$(e).each(function(){var e=$(this);!(e.hasClass("is-inline")||e.hasClass("is-floating"))&&e.addClass("is-floating")})}var i=t.find(".is-floating"),a=t.find(".is-floating.only-teacher"),o=m.user.esAlumno(),s=i.length-a.length>=1,r=$(".content"),l='<div class="popover-background">'+'<div class="popover-template">'+'<div class="popover-container">'+"</div>"+'<button type="button" class="close-popover fa fa-times"></button>'+"</div>"+"</div>";$(".info-button").remove();$(".info-template").remove();$(".popover-background").remove();if(!!i.length&&(!o||s&&o)){r.prepend('<div class="info-template"></div>')}$(".info-template").html('<p class="info-icon fa fa-info"></p>').removeClass("shown");if($(e).length>0){r.prepend(l);$(e).each(function(){var e=$(this),t=e.find(".popover-title-text").first().html(),i='<div class="info-title info-show" data-index="'+n+'">'+t+"</div>",a='<span class="info-button info-show fa-info" data-index="'+n+'" data-title="'+t+'"></span>';e.attr("data-index",n);if(!m.user.esAlumno()||!e.hasClass("only-teacher")){if(e.hasClass("is-floating")){$(".info-template").append(i);if(e.hasClass("only-teacher")){$('.info-title[data-index="'+n+'"]').addClass("only-teacher")}}else{e.after(a);if(e.hasClass("left")){$('.info-button[data-index="'+n+'"]').addClass("float-left")}else if(e.hasClass("right")){$('.info-button[data-index="'+n+'"]').addClass("float-right")}if(e.hasClass("only-teacher")){$('.info-button[data-index="'+n+'"]').addClass("only-teacher")}}}n+=1});$(".info-title").each(function(){var e=$(this);if(!e.text().trim().length||e.text()==="undefined"){e.text(textweb("plugins_popover_default_message"))}});$(".close-popover").click(function(){d.popoverToggle($(".popover-container").attr("data-index"))})}d.infoToggle();$(".info-show").click(function(){d.popoverToggle($(this).attr("data-index"))})});$(".js-slider-item").scroll(function(){d.infoToggle()})}$(window).resize(function(){var e=$(".swipeview-active").height()-120+"px";$(".popover-template .popover-content").css("max-height",e)})},infoToggle:function(){var e=$(".swipeview-active").find(".info-popover.is-floating");if($(e).length>0){var n=$(".content").offset().top,o=$(".content").height();$(e).each(function(){var e=$(this),t=e.data("index");if(e.next(".info-popover.is-floating").length==1||e.next().length==0){e.after("<p></p>")}var i=e.next().offset().top,a=i-n;if(a>=0&&a<o){$('.info-show[data-index="'+t+'"]:not(.shown)').addClass("shown");$(".info-template:not(.shown)").delay(500).addClass("shown")}else{$('.info-show[data-index="'+t+'"]').removeClass("shown");if($(".info-show.shown").length<=0){$(".info-template").removeClass("shown")}}t++})}},popoverToggle:function(e){var t=this,i=$(".swipeview-active").height()-120+"px",a=$(".swipeview-active").find(".info-popover"),n=$(a)[e],o=$(".popover-template").css("max-height");if(!$(".popover-background").hasClass("shown")){$(".popover-container").attr("data-index",e).empty().append($(n).find(".popover-title").first(),$(n).find(".popover-content").first());$(".popover-template").attr("style",$(n).attr("style"));$(".popover-template .popover-content").css("max-height",i);$(".popover-background").delay(500).addClass("shown")}else{$(".popover-background").removeClass("shown");$(".popover-template").attr("style","max-height:"+o);$(n).append($(".popover-container").find(".popover-title").first(),$(".popover-container").find(".popover-content").first());$(".popover-container").attr("data-index","");$(n).find(".popover-content").first().css("max-height","")}},getPhotoSwipeDOM:function(){return""+'<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">'+'<div class="pswp__bg"></div>'+'<div class="pswp__scroll-wrap">'+'<div class="pswp__container">'+'<div class="pswp__item"></div>'+'<div class="pswp__item"></div>'+'<div class="pswp__item"></div>'+"</div>"+'<div class="pswp__ui pswp__ui--hidden">'+'<div class="pswp__top-bar">'+'<div class="pswp__counter"></div>'+'<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>'+'<button class="pswp__button pswp__button--share" title="Share"></button>'+'<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>'+'<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>'+'<div class="pswp__preloader">'+'<div class="pswp__preloader__icn">'+'<div class="pswp__preloader__cut">'+'<div class="pswp__preloader__donut"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">'+'<div class="pswp__share-tooltip"></div>'+"</div>"+'<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">'+"</button>"+'<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">'+"</button>"+'<div class="pswp__caption">'+'<div class="pswp__caption__center"></div>'+"</div>"+"</div>"+"</div>"+"</div>"},hideDefaultSlideColorBackground:function(){return false},allowSlideImageBackground:function(){return false},shouldUseTranscript:function(){return false},initFontSizeTool:function(){var e=$("#boton_tamano_letra");e.length&&m.toolsNew.fontSize.init()},formatearNotaGradebook:function(e){return e},checkNotaPendiente:function(e){return e},repeatAlertText:function(){return textweb("course_56")},recordedAudioModalText:function(){return textweb("slide_audiorecorder_player_message")},hideAudioButtonOk:function(){return false},slideScoreText:function(){return textweb("Nota_slide")},slideGlobalScoreText:function(){return textweb("editNotaGlobal.title")},saveAudioButtonText:function(){return false},calculateTopOffsetSlide:function(e){if(typeof e.offset==="function"){return e.offset().top}return false},onAfterUnloadVentana:function(){return false},hideGrade:function(){return false},processHash:function(){return""},showSlidesGradebook:function(e){if(typeof e!=="undefined"){switch(e.activityType){case 17:return false;default:return true}}else{return true}},canOpenActivity:function(){return true},canSeeZoomFlag:function(){return!esInfantil},customizedMultimediaImageSlider:function(){return false},setActivePane:function(){return false},navigateOnlyUnitDigitalBooks:function(){return false},canNavigateDigitalBooks:function(){return false},initFlipBox:function(){if(!editar&&$(".bck-flipbox").length>0){var e=function(e){var t;if(typeof e==="undefined"||!e){return}var i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i){if(e.style[t]!==undefined){return i[t]}}};var i=e($(".bck-flipbox")[0]);$(".bck-flipbox").on("mouseenter",function(){var t=$(this);t.data("hasMouseOver",true);t.data("transitionEnd",false);t.find(".front").addClass("animate");t.find(".back").addClass("animate");t.one(i,function(e){if(!t.data("hasMouseOver")){t.find(".front").removeClass("animate");t.find(".back").removeClass("animate")}t.data("transitionEnd",true)})}).on("mouseleave",function(){var e=$(this);e.data("hasMouseOver",false);if(e.data("transitionEnd")==true){e.find(".front").removeClass("animate");e.find(".back").removeClass("animate");e.data("transitionEnd",false)}}).on("tap",function(){var e=$(this);if(e.find(".front").hasClass("animate")){e.find(".front").removeClass("animate");e.find(".back").removeClass("animate")}else{e.find(".front").addClass("animate");e.find(".back").addClass("animate")}});$(".bck-flipbox").css("opacity",0)}},initNextButton:function(){if(!editar&&$(".nextbutton-warp").length>0){$(".nextbutton-warp").on("click",function(){m.activity.showNextSection()})}},initTabs:function(){$(".bck-tabtitles").on("click",function(){var e=$("#"+$(this).closest(".bck-tabs-box").attr("id"));e.find(".div-contents").css("display","none");$("#"+$(this).data("idcontent")).closest(".div-contents").css("display","block")})},initMusicEditor:function(){var e=m.activity.secuencia;e.forEach(function(e){var t="t"+e,i=t+"_slide",a=document.getElementById(t+"pg"),n=a.getElementsByClassName("bck-music-editor");if(n.length==0){return}window[i].musicEditor=new InteractiveEditor({auxWrapper:t+"_musicEditorAux",headless:true,prefix:t+"_interactiveEditor",viewMode:true});window[i].musicEditor._init();window.onload=function(){m.isEdge&&document.querySelectorAll("[id*=-midi_download]").forEach(function(e){e.setAttribute("hidden","true")})};for(var o=0;o<n.length;o++){var s=n[o],r=s.getAttribute("data-abcjs-config");if(!r)continue;var l=JSON.parse(decodeURIComponent(r));while(s.childElementCount>0){s.children.item(0).remove()}window[i].musicEditor.createScore(s,l)}})},zipPineOpenInSameWindow:function(){return false},disableHighlighter:function(){return false},showResetConfirmation:function(){return false},shouldHideTOCFromPine:function(){return false},adaptSliderImageHeight:function(){return true},showPluginsByStyleUser:function(e){return e=="admin"&&m.user.esSAdmin()},focusFirstShortAnswer:function(){return true},addCustomPopoverTitle:function(){return false},styleDraggableContainment:function(e){return e.closest(".item-container ")},customTargetLink:function(e){return false},showRecordRemainingTime:function(){return true},hideOnlyForTeachersItems:function(){if(m.user.esAlumno()&&!!$(".visible-by-teacher").length){$(".visible-by-teacher").remove()}},addActivityTitle:function(){return false},getActualSlideNumber:function(e){var t=$(".swipeview-active").attr("data-page-index"),i=1;for(var a in e){if(e[a].id&&parseInt(e[a].id)!=idclase){i+=parseInt(e[a].pags)}else{i+=parseInt(t);break}}return i},wirisEditorConfig:function(){return{}},activateCaptionsbyDefault:function(){return false},popoverPlacementNavbar:function(){var e="bottom";if(typeof this.popoverPlacement!=="undefined"){e=this.popoverPlacement}return e},customTriggerScrollCocatenate:function(){return false},customContainerScroll:function(){return false},pineHoverBGColor:function(){return"rgba(255,255,255,0.01)"},adjustPopoverResources:function(){return false},preparePdf:function(){return false},getFooterTemplate:function(){return"<div></div>"},getHeaderTemplate:function(){return"<div></div>"},showSpinner:function(e){var t=$("#spinner-backdrop"),i=$("#spinner");if(e){t.removeClass("hidden");i.removeClass("hidden")}else{t.addClass("hidden");i.addClass("hidden")}},permiteVerUltimaSlide:function(){return true}};m.theme.styles=m.theme.styles||{};m.theme.styles.basic=e;m.events.on("style:endFormatCarousel",function(){if(window.t0_slide&&window.t0_slide.seccion.contains("no-intro")){$(".slider-indicators li").find("span").each(function(e,t){var i=$(this);i.html(e+1);i.removeClass()});$(".dropdown-menu li").find("span.num").each(function(e,t){var i=$(this);i.html(e+1);i.parent("a").find("span.title").html(i.data("title"));i.removeClass()})}})})(blink);$(document).ready(function(){if(window.matchMedia){var e=window.matchMedia("print");if(e.matches&&blink.getReqParam(window.location,"_puppeteer")==1){window.alert=function(){};blink.events.once("showSlide:after",function(){if(typeof blink.activity!=="undefined"&&typeof blink.activity.currentStyle!=="undefined"&&typeof blink.activity.currentStyle.preparePdf!=="undefined"){blink.activity.currentStyle.preparePdf()}})}}});(function(e){"use strict";e.colors=function(){this.list=_.clone(this.getColorsList("basic"));_.extend(this.list,this.getColorsList())};var t=e.colors;t.prototype.list={};t.prototype.activeColor={color:"DEFAULT",opacity:0};t.prototype.getColorsList=function(e){var t=e?e:blink.activity.originalStyleName;if(blink.theme.styles[t])return blink.theme.styles[t].prototype.customColors;else return blink.theme.styles.basic.prototype.customColors};t.prototype.setColorsList=function(e){this.list=e};t.prototype.getColorPickerMarkUp=function(){var e=this.getColorsList("basic"),t=this.getColorsList();var i=function(e){var i='<li class="color default" data-color="DEFAULT"></li>';$.each(e,function(e,t){i+='<li class="color '+t.className+'" data-color="'+e+'" style="background-color:'+t.hex+'"></li>'});return i};var a='<div class="color-picker-container">'+'<div class="opacity-parent">'+"<div>"+textweb("color_picker_opacity")+': <span class="opacity-value"></span></div>'+'<input class="opacity-slider" type="text" '+'data-slider-min="0" data-slider-max="100" data-slider-step="1" data-slider-value="100" '+'data-slider-tooltip="hide"'+"/>"+"</div>";a+='<div class="colors-list colors-default">'+"<ul>"+i(e)+"</ul>"+"</div>";if(!_.isMatch(e,t)){a+='<div class="colors-list">'+"<label>"+textweb("color_picker_custom_colors")+"</label>"+"<ul>"+i(t)+"</ul>"+"</div>"}a+="</div>";return a};t.prototype.setColor=function(e){this.activeColor.color=e};t.prototype.setOpacity=function(e){this.activeColor.opacity=parseInt(e)};t.prototype.getColorObj=function(){return this.activeColor};t.prototype.setColorObj=function(e){this.activeColor=e};t.prototype.getCssColor=function(e){var t=e&&(this.list[e.color]||isValidHex(e.color))?e:this.activeColor,i=isValidHex(t.color)?t.color.substr(1):this.list[t.color].hex.substr(1),a=hex2rgb(hex2dec(i)),n=t.opacity/100,o=a[0],s=a[1],r=a[2];return"rgba("+o+","+s+","+r+","+n.toFixed(2)+")"};t.prototype.init=function(e){var n=this,t=$(".color-picker-container");this.setColor(e.color.length>0?e.color:"DEFAULT");this.setOpacity(e.opacity.length>0?e.opacity:0);t.find(".opacity-value").text(n.activeColor.opacity+" %").end().find("li").on("click",function(){var e=$(this),t=e.closest(".color-picker-container"),i=t.find(".opacity-slider");if(e.data("color")=="DEFAULT"){i.bootstrapSlider("setValue",0).trigger("change")}else{if(i.bootstrapSlider("getValue")==0){i.bootstrapSlider("setValue",20).trigger("change")}}n.setColor(e.data("color"));t.find("li").removeClass("active");e.addClass("active")}).end().find("[data-color = "+n.activeColor.color+"]").addClass("active").end().find(".opacity-parent").find(".opacity-slider").bootstrapSlider().bootstrapSlider("setValue",n.activeColor.opacity).on("change",function(e){var t=$(this),i=t.closest(".opacity-parent"),a=t.bootstrapSlider("getValue");i.find(".opacity-value").text(a+" %");n.setOpacity(a)}).end()}})(blink);(function(e){"use strict";e.theme.video.transcript={};var o=e.theme.video.transcript;o.captions=[];o.query="";o.matches=[];o.cycle=-1;o.init=function(e,t,i){var a={showTitle:false,showTrackSelector:false},n=e.transcript(a),o=$(n.el()),s=$(this.getMarkup()),r=t.find(".bck-sidebar-transcript"),l=s.find(".bck-transcript");r.length&&r.remove();t.find(".bck-subtitles").after(s);l.append(o);i&&this.togglePanel(s,t);this.initSearch(t)};o.getMarkup=function(){return"<div class='bck-sidebar-transcript'>"+"<div id='searchbox'>"+"<span id='match'>0 of 0</span><input type='search' id='search' />"+"</div>"+"<div class='bck-transcript' id='transcript'></div>"+"</div>"};o.setButton=function(e){var t=$(e.el_).parents(".bck-video-container2"),i=e.addChild("button"),a='<i class="fa fa-file-text-o" /i>';$(i.el_).html(a);if(blink.isAndroid||blink.isIos){i.off("touchend")}i.addClass("vjs-transcript-button").on("click",function(){var e=$(".bck-sidebar-transcript");this.togglePanel(e,t)}.bind(this))};o.togglePanel=function(e,t){e.toggleClass("showing");t.toggleClass("left transcript");var i=e.hasClass("showing"),a="plugins_video_view_transcript"+(i?"_off":"");t.find(".vjs-transcript-button").attr("title",textweb(a))};o.initSearch=function(n){n.find("#search").keyup(function(e){var t=this.value.toLowerCase(),i=o.captions;!i.length&&o.loadCaptions(n);if(e.keyCode==27||!t.length){return o.resetSearch()}if(e.keyCode==13&&t==o.query){var a=o.cycle>=o.matches.length-1?0:o.cycle+1;o.cycleSearch(a)}else{o.resetSearch();o.search(t)}})};o.loadCaptions=function(e){e.find(".transcript-line").each(function(e){var t=$(this).find(".transcript-text"),i=t.text();o.captions.push(i);t.attr("id","caption-"+e)})};o.search=function(e){this.matches=[];this.query=e;for(var t=0;t<this.captions.length;t++){var i=o.captions[t].toLowerCase().indexOf(e);if(i>-1){document.getElementById("caption-"+t).innerHTML=this.captions[t].substr(0,i)+"<em>"+this.captions[t].substr(i,e.length)+"</em>"+this.captions[t].substr(i+e.length);this.matches.push(t)}}this.matches.length?this.cycleSearch(0):this.resetSearch()};o.cycleSearch=function(e){if(this.cycle>-1){var t=document.getElementById("caption-"+this.matches[this.cycle]);t.getElementsByTagName("em")[0].className=""}var i=document.getElementById("caption-"+this.matches[e]);i.getElementsByTagName("em")[0].className="current";document.getElementById("match").innerHTML=e+1+" of "+this.matches.length;this.cycle=e};o.resetSearch=function(){if(this.matches.length){for(var e=0;e<this.captions.length;e++){document.getElementById("caption-"+e).innerHTML=this.captions[e]}}this.query="";this.matches=[];document.getElementById("match").innerHTML="0 of 0";this.cycle=-1}})(blink);(function(e){"use strict";e.locale=e.locale||{};var t=e.locale;t.timestampToFormatDate=function(e,t,i){if(typeof t=="undefined"||!t||t===""){t="DD-MM-YYYY HH:mm"}if(typeof i=="undefined"){i="YYYY-MM-DD HH:mm:ss"}var a;if(""+e===""+parseInt(e)){i="X";a=moment.unix(parseInt(e))}else{a=moment(e,i)}if(t=="fromnow"){var n=a.locale(IDIOMA_ISO).fromNow(true)}else{var n=a.locale(IDIOMA_ISO).format(t)}if(n=="Invalid date"){blink.log.error("ERROR (timestampToFormatDate): Fecha invlida "+e);n=""}return n};t.dateTimeToTimestamp=function(e,t){if(typeof t=="undefined"){t="DD/MM/YYYY HH:mm"}var i=moment(e,t).format("X");if(i=="Invalid date"){blink.log.error("ERROR (dateTimeToTimestamp): Fecha invlida "+e);i=""}return i};t.guessTimeZone=function(){var e=moment.tz.guess();return e};t.timestampToClient=function(e,t){var i=moment.tz.guess();var a=moment.unix(e);var n="YYYY-MM-DD HH:mm";var o=a.tz(i).format(n);if(t){o+=" "+t+" "+i;o=o.replace("_"," ")}return o};t.transformIstimestampToFormatDate=function(){$(".istimestamp").each(function(){var e=null;if($(this).attr("date_format")){e=$(this).attr("date_format")}$(this).html(blink.locale.timestampToFormatDate($(this).html(),e)).removeClass("istimestamp").addClass("doneistimestamp")})}})(blink);(function(e){"use strict";e.editorConfig=e.editorConfig||{};var t=e.editorConfig;t.config={};t.toolbars=t.toolbars||{};t.toolbars.basic=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TextColor","BGColor"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent"]},{name:"paragraph2",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","Table"]},{name:"clipboard",items:["Undo","Redo","HorizontalRule"]}];t.toolbars.standard=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TransformTextSwitcher","TextColor","BGColor","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent","lineheight"]},{name:"paragraph2",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert",items:["Link","Table","blink_sound","Blink_video2","blink_image","blink_file","Blink_enlace_transparencia","ckeditor_wiris_formulaEditor","Santillana_digital_object","ckeditor_wiris_formulaEditorChemistry","SpecialChar","Blink_popover"]},{name:"clipboard",items:["Copy","Paste","PasteText","Undo","Redo","HorizontalRule"]},{name:"styles",items:["Styles","Font","FontSize"]},{name:"tools",items:["blink_nextbutton"]},{name:"editorial",items:["Blink_box"]}];t.toolbars.standard_escho=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TransformTextSwitcher","TextColor","BGColor","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent","lineheight"]},{name:"paragraph2",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert",items:["Link","Table","blink_sound","Blink_video2","blink_image","blink_file","fmath_formula","SpecialChar","Blink_popover"]},{name:"clipboard",items:["Copy","Paste","PasteText","Undo","Redo","HorizontalRule"]},{name:"styles",items:["Styles","Font","FontSize"]},{name:"tools",items:["Maximize"]},{name:"editorial",items:["Blink_box"]}];t.toolbars.admin=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TransformTextSwitcher","TextColor","BGColor","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"clipboard",items:["Copy","Paste","PasteText","Undo","Redo","Source","Scayt"]},{name:"insert",items:["Link","Table","blink_tables","blink_sound","Blink_video2","blink_image","Blink_activity","Blink_enlace_transparencia","Blink_iframe_embedder","Santillana_digital_object","blink_file","ckeditor_wiris_formulaEditor","ckeditor_wiris_formulaEditorChemistry","Blink_music_editor","SpecialChar","Blink_tooltip","Blink_popover"]},{name:"styles",items:["Styles","Format","Font","FontSize","lineheight"]},{name:"tools",items:["Maximize","ShowBlocks","HorizontalRule","blink_nextbutton"]},{name:"editorial",items:["Blink_box","Blink_simple_grid","Blink_dropdown","Blink_flipbox","blink_tabs"]}];t.toolbars.admin_escho=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TransformTextSwitcher","TextColor","BGColor","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"clipboard",items:["Copy","Paste","PasteText","Undo","Redo","Source","Scayt"]},{name:"insert",items:["Link","Table","blink_tables","blink_sound","Blink_video2","blink_image","Blink_activity","Blink_gallery","blink_file","fmath_formula","SpecialChar","Blink_tooltip"]},{name:"styles",items:["Styles","Format","Font","FontSize","lineheight"]},{name:"tools",items:["Maximize","ShowBlocks","HorizontalRule"]},{name:"editorial",items:["Blink_box","Blink_simple_grid","Blink_dropdown"]}];t.toolbars.rich_editor=[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","TransformTextSwitcher","TextColor","BGColor","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent","lineheight"]},{name:"paragraph2",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert",items:["Link","Table","blink_sound","blink_image","blink_file","ckeditor_wiris_formulaEditor","ckeditor_wiris_formulaEditorChemistry","SpecialChar","Blink_popover"]},{name:"styles",items:["Font","FontSize"]},{name:"editorial",items:["Blink_box"]}];t.plugins=t.plugins||{};t.plugins=["divarea","lineutils","widget","abbr"];t.extraPlugins=t.extraPlugins||{};t.extraPlugins.basic=[];t.extraPlugins.standard=["blink_sound","blink_video","blink_video2","blink_video_inline","blink_file","blink_enlace_transparencia","blink_image","texttransform","blink_tables","specialchar","lineheight","blink_box","confighelper","ckeditor_wiris"];t.extraPlugins.standard_escho=["blink_sound","blink_video2","blink_file","blink_image","texttransform","fmath_formula","specialchar","lineheight","confighelper"];t.extraPlugins.admin=["blink_sound","blink_video","blink_video2","blink_video_inline","blink_image","blink_file","blink_activity","blink_enlace_transparencia","blink_tooltip","specialchar","santillana_digital_object","texttransform","blink_tables","lineheight","blink_box","blink_simple_grid","blink_dropdown","confighelper","blink_flipbox","blink_tabs","blink_iframe_embedder","blink_popover","blink_music_editor","ckeditor_wiris"];t.extraPlugins.admin_escho=["blink_sound","blink_video2","blink_image","fmath_formula","blink_file","specialchar","texttransform","lineheight","confighelper"];t.extraPlugins.rich_editor=["blink_file","blink_image","texttransform","blink_tables","specialchar","lineheight","blink_box","confighelper","ckeditor_wiris"];t.remove=t.remove||{};t.remove="elementspath";t.removePlugins=t.removePlugins||{};t.removePlugins.basic="elementspath";t.removePlugins.standard="elementspath";t.removePlugins.standard_escho="elementspath";t.removePlugins.admin="elementspath";t.removePlugins.admin_escho="elementspath";t.init=function(e,t,i){var a=t.getToolbar(this.toolbars);var n=typeof a!=="undefined"&&a?a[e]:t.getToolbar(this.toolbars[e]);var o=this.plugins.concat(this.extraPlugins[e]);if(e=="admin"){t.toolbar&&n.push(t.toolbar);i.toolbar&&n.push(i.toolbar);t.extraPlugins&&(o=o.concat(t.extraPlugins));i.extraPlugins&&(o=o.concat(i.extraPlugins))}var s=false;if(t.getEditorStyles){s=t.getEditorStyles();s.styles.sort(orderAssociativeArray("name"));CKEDITOR.stylesSet.add(s.name,s.styles);this.config.stylesSet=s.name}if(typeof t.newFonts!=="undefined"&&t.newFonts){CKEDITOR.config.font_names+=";"+t.newFonts}if(t.getPluginsByEditorMode&&t.getPluginsByEditorMode(e)){o=o.concat(t.getPluginsByEditorMode(e))}if(t.showPluginsByStyleUser(e)){t.removePlugins=undefined}else{Object.keys(this.removePlugins).forEach(function(e){t.removePlugins[e]=t.removePlugins[e]?this.removePlugins[e].concat(",",t.removePlugins[e]):this.removePlugins[e]},this)}if(t.removePlugins&&t.bodyClassName.indexOf("blink-innovacion")==-1){Object.keys(t.removePlugins).forEach(function(e){t.removePlugins[e].indexOf("blink_music_editor")==-1&&(t.removePlugins[e]=t.removePlugins[e].concat(",","blink_music_editor"))})}var r=o.indexOf("ckeditor_wiris");if(r>=0){o.splice(r,1);o.push("ckeditor_wiris")}this.config={toolbar:n,skin:"moono-dark",extraPlugins:o.join(","),removePlugins:s&&t.removePlugins?t.removePlugins[e]:this.removePlugins[e],stylesSet:s?s.name:"default"};this.config.mathTypeParameters={editorParameters:t.wirisEditorConfig()};this.initializeCustomStyles()};t.initializeCustomStyles=function(){function getOverrides(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},i=e._.definition.overrides;if(i){if(!CKEDITOR.tools.isArray(i))i=[i];for(var a=0;a<i.length;a++){var n=i[a],o,s,r;if(typeof n=="string")o=n.toLowerCase();else{o=n.element?n.element.toLowerCase():e.element;r=n.attributes}s=t[o]||(t[o]={});if(r){var l=s.attributes=s.attributes||[];for(var d in r){l.push([d.toLowerCase(),r[d]])}}}}return t}function getAttributesForComparison(e){var t=e._AC;if(t)return t;t={};var i=0;var a=e.attributes;if(a){for(var n in a){i++;t[n]=a[n]}}var o=CKEDITOR.style.getStyleText(e);if(o){if(!t.style)i++;t.style=o}t._length=i;return e._AC=t}function applyStyleOnSelection(e,t,i){var a=e.document,n=e.getRanges(),o=t?this.removeFromRange:this.applyToRange,s;var r=n.createIterator();while(s=r.getNextRange())o.call(this,s,i);e.selectRanges(n);a.removeCustomData("doc_processing_style")}function applyStyle(e){var t=e.getEnclosedNode()||e.getCommonAncestor(false,true),i=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1);i&&!i.isReadOnly()&&setupElement(i,this,true)}function removeStyle(e){var t=e.getEnclosedNode()||e.getCommonAncestor(false,true),i=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1);i&&!i.isReadOnly()&&setupElement(i,this,false)}function setupElement(t,e,i){var a=e._.definition,n=a.attributes,o=CKEDITOR.style.getStyleText(a),s=i?t.addClass:t.removeClass;if(n&&n["class"]){var r=n["class"].split(" ");r.forEach(function(e){e&&s.call(t,e)})}return t}var e=CKEDITOR.style.addCustomHandler({type:"bck-stack-class",apply:function(e){if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;if(!t)this._.enterMode=e.activeEnterMode;applyStyleOnSelection.call(this,e.getSelection(),0,e);this._.enterMode=t}},remove:function(e){if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;if(!t)this._.enterMode=e.activeEnterMode;applyStyleOnSelection.call(this,e.getSelection(),1,e);this._.enterMode=t}},applyToRange:function(e,t){applyStyle.call(this,e,t)},removeFromRange:function(e,t){removeStyle.call(this,e,t)},checkElementMatch:function(e,t){var i=this._.definition;if(!e||!i.ignoreReadonly&&e.isReadOnly())return false;var a,n=e.getName();this.element=i.element;if(typeof this.element=="string"?n==this.element:n in this.element){if(!t&&!e.hasAttributes())return true;a=getAttributesForComparison(i);if(a._length){for(var o in a){if(o=="_length")continue;var s=e.getAttribute(o)||"";if(o=="class"){var r=_.every(a[o].split(" "),function(e){return _.contains(s.split(" "),e)});if(!t||!r)return r}else if(o=="style"?compareCssText(a[o],s):s.split(" ").indexOf(a[o])!==-1){if(!t)return true}else if(t){return false}}if(t)return true}else{return true}}return false},setup:function(e){this.name=e.name;this.element=e.element;this.attributes=e.attributes;this.type=3}})}})(window.blink);(function(){function DateFromTag(n){this.init=function(e){this.dom=e;this.setText()};this.setText=function(){var e=jQuery(this.dom).data("date-from-tag");var t=moment.tz(e,blink.timezone);var i=(moment().toDate().getTimezoneOffset()+t.utcOffset())*6e4;var a=moment(e).toDate().getTime()-i;fechaMostrar=moment(a).toDate().toUTCString();if(typeof noMostrarFecha!=="undefined"&&noMostrarFecha){jQuery(n).html(moment(a).locale(window.IDIOMA).fromNow(true))}else{jQuery(n).html(moment(a).locale(window.IDIOMA).fromNow(true)+" <span class='fecha-hora'>("+moment(fechaMostrar).format("DD/MM/YY HH:mm:ss")+")</span>")}};this.init(n);jQuery(this.dom).removeAttr("data-date-from-tag");return this}function DateTag(t){this.init=function(e){this.dom=e;this.setText()};this.setText=function(){var e=jQuery(this.dom).data("date-tag");jQuery(t).html(moment(e).locale(window.IDIOMA).format("DD MMMM YYYY"))};this.init(t);return this}function initializeAll(){jQuery("[data-date-from-tag]").each(function(){new DateFromTag(this)});jQuery("[data-date-tag]").each(function(){new DateTag(this)})}jQuery(function(){initializeAll();blink.events.on("ajax:complete",initializeAll)});blink.DateTag=DateTag;blink.DateFromTag=DateFromTag})();window.maxWindowThresholdForWindow=720;var filters=[];$(window).load(function(){$(".checkbox-list input[type='checkbox'].supracategoria").each(function(){checkSupracategory($(this).data("supracat"),true)})});$(document).ready(function(){$(document).on("click",function(e){if($(".popover").length>0){$triggerpopover=$(".finder_selector").parent();$popover=$(".popover");if(e.target!=$triggerpopover&&$triggerpopover.find(e.target).length==0&&e.target!=$popover&&$popover.find(e.target).length==0){$(".finder_selector").popover("hide")}}});$(".finder_selector").on("click",function(){$(".finder_selector").not(this).popover("hide")});$("body").on("shown.bs.popover",".finder_selector",function(e){$(this).data("bs.popover").$tip.find(".popover-content").html("").append($("#"+$(this).attr("data-layer-content")));$("#"+$(this).attr("data-layer-content")).removeClass("hidden")});$("body").on("hide.bs.popover",".finder_selector",function(e){$("body").append($("#"+$(this).attr("data-layer-content")));$("#"+$(this).attr("data-layer-content")).addClass("hidden");$(this).data("bs.popover").$tip.find(".popover-title").find(".buscador-select-filter").val("").trigger("keyup")});$("body").on("click",".checkbox-list label",function(){if($(this).find("input[type='checkbox']:checked").length>0){$(this).addClass("checked")}else{$(this).removeClass("checked")}});$("body").on("keyup",".buscador-select-filter",function(){var i=$(this).val();if($(".popover").length>0)var e=$(this).closest(".popover-lg").find(".checkbox-list label");if($(".modal:visible").length>0)var e=$(this).closest(".modal-body").find(".checkbox-list label");if(i.length>0){e.each(function(){var e=i.toLowerCase().removeAccents();var t=$(this).html().substring($(this).html().indexOf(">")+1);t=t.toLowerCase().removeAccents();if(t.indexOf(e)>-1){$(this).css("display","block")}else{$(this).css("display","none")}})}else{$(".checkbox-list label").css("display","block")}});$("body").on("click",".clean-filters",function(){if($(".popover").length>0){var e=$(this).closest(".popover").find(".popover-content");var t=e.find("input[type='checkbox']:checked")}if($(".modal:visible").length>0){var i=$(this).closest(".modal-body");var t=i.find(".checkbox-list input[type='checkbox']:checked")}t.closest("label").removeClass("checked");var a=t.attr("checked",false);$(a[0]).trigger("change")});$("body").on("change",".checkbox-list input[type='checkbox'].supracategoria",function(){var e=$(".checkbox-list input[data-cat='"+$(this).data("supracat")+"']");if($(this).prop("checked")){e.prop("checked",true);e.parent().addClass("checked")}else{e.prop("checked",false);e.parent().removeClass("checked")}cargaLibrosFiltro($(this).data("supracat"),$(this).prop("checked"))});$("body").on("change",".checkbox-list input[type='checkbox']:not(.supracategoria)",function(){if($(".levels_checkboxs").length==0){cargaLibrosFiltro($(this).data("cat"),$(this).prop("checked"))}});if($(document).width()>window.maxWindowThresholdForWindow){setPopover()}else{$("body").on("click",".finder_selector",setMsgBox)}});function cargaLibrosFiltro(e,t){blink.theme.spinner.show();var i=$(".search input");var a=i.val();var n={selected:{},filters:{}};if(filters&&filters.length>0){filters.forEach(function(e){n.selected[e+"_selected"]=$(".checkbox-list input[type='checkbox'][name='"+e+"[]']:checked");var t=n["selected"][e+"_selected"].length;$("[data-layer-content='"+e+"'] .filter-counter").html(t>0?"("+t+")":"");if(t>0){$("[data-layer-content='"+e+"'] .filter-icon").addClass("blinkicon-filter")}else{$("[data-layer-content='"+e+"'] .filter-icon").removeClass("blinkicon-filter")}$(".modal-header."+e+" .filter-counter").html(t>0?"("+t+")":"");t>0?$(".finder_selector[data-layer-content='"+e+"']").addClass("active"):$(".finder_selector[data-layer-content='"+e+"']").removeClass("active");var i=[];n["selected"][e+"_selected"].each(function(){i.push($(this).val())});n["filters"][e]=i.join(",")})}checkSupracategory(e,t);var o={busqueda:a};if(filters&&filters.length>0){filters.forEach(function(e){if(n.filters[e]!==""){o[e]=n.filters[e]}})}$.ajax({type:"GET",dataType:"html",data:o,url:window.location.pathname+window.location.search,complete:function(e){var t;if(window.location.search.indexOf("resources=1")!=-1){t=".container_items"}else{t="#catalogo_cursos"}if(e.status==200){$(t).html($(e.responseText).find(t).html())}else{$(t).html("<div class='alert alert-warning text-center'>"+textweb("err_ajax")+"</div>")}jQuery.ias().reinitialize();blink.theme.spinner.hide()}})}function checkSupracategory(e,t){var i=$(".checkbox-list input[data-cat='"+e+"']").length;var a=$(".checkbox-list input[data-cat='"+e+"']:checked").length;var n=$(".checkbox-list input[type='checkbox'][data-supracat='"+e+"'].supracategoria");if(t&&a==i){n.prop("checked",true);n.parent().addClass("checked")}else if(!t&&a==i-1){n.prop("checked",false);n.parent().removeClass("checked")}}$(window).resize(function(){if(blink.isIos||blink.isAndroid){return false}if($(".finder_selector").length>0&&$(".modal:visible").length>0&&$(".checkboxtpl:visible").length>0){$(".modal:visible").find(".close").trigger("click")}if($(document).width()>window.maxWindowThresholdForWindow){$("body").off("click",".finder_selector",setMsgBox);$(".finder_selector").popover("destroy");setPopover()}else{$(".finder_selector").popover("destroy");$("body").off("click",".finder_selector",setMsgBox);$("body").on("click",".finder_selector",setMsgBox)}});String.prototype.removeAccents=function(){return this.replace(/[]/gi,"a").replace(/[]/gi,"e").replace(/[]/gi,"i").replace(/[]/gi,"o").replace(/[]/gi,"u").replace(/[]/gi,"c").replace(/[]/gi,"n").replace(/[^a-zA-Z0-9]/g," ")};function setPopover(){$(".finder_selector").popover({animation:true,html:true,template:'<div class="popover popover-lg" role="tooltip"><div class="arrow"></div><h3 class="popover-title clearfix"></h3><div class="popover-content"></div></div>',title:'<div class="container-search"><input type="search" class="buscador-select-filter" placeholder="'+textweb("buscador.placeholder")+'" ><a href="javascript:void(0)"><i class="fa fa-search"></i></a></div><i class="blinkicon-reload clean-filters" title="'+textweb("limpiar-filtros")+'"></i>',placement:"bottom"})}function setMsgBox(){showMsgBox("","/LMS/msgbox.php?op=search.selectfilter&namecheckbox="+$(this).attr("data-layer-content")+'&labelname="'+$(this).find(".labelname").html()+'"',550)}$(document).ready(function(){var e=blink.tools.manager.colors;var i="<ul>";$.each(e,function(e,t){i+='<li class="color '+t.className+'" data-color="'+e+'" style="background-color:'+t.hex+'"></li>'});i+="</ul>";$("#popover-colors .colors").html(i)});(function(){jQuery.fn.popoverColors=function(a,e){var t=this;var i=blink.tools;var n=blink.user.getID();var o={placement:"bottom",container:".navbar",html:true,trigger:"manual",content:function(){return $("#popover-colors").html()}};e=$.extend(o,e||{});var s={setColor:function(e){this.tool.color=i.manager.colors[e]?i.manager.colors[e].hex:e},getColor:function(){return this.tool.color},getDefaultColor:function(){return this.tool.defaultColor},toolIsActive:function(){return this.tool.enabled},onEnabled:function(){this.getActualTool(t);if(a.tool.name=="pencil")this.setUserThickness();this.setUserColor()},setUserColor:function(){var e=getUserColor(a.actualTool)||this.getColor()||this.getDefaultColor();e=e.hex||e;this.setColor(e,t)},setUserThickness:function(){var e=getUserThickness()||a.getThickness();a.setThickness(e)},onDisabled:function(){},onAfterShow:function(){}};a=$.extend(s,a||{});t.popover(e).on("shown.bs.popover",function(){refresh();a.getActualTool(t);$(".popover-content .colors li").click(function(){color=$(this).data("color");saveUserColor(color,a.actualTool);a.setColor(color,t);a.hide()});$(document).off("click:popoverColorsPencil").on("click:popoverColorsPencil",function(e){if(!$(e.target).closest(".popover.in").length&&!$(e.target).closest(t).length){a.hide()}});(function(){if(!a.setThickness)return;a.setUserThickness();var t=$(".popover-content .thickness-slider");t.bootstrapSlider();var e=getUserThickness()||a.getThickness()||t.bootstrapSlider("getValue");t.bootstrapSlider("setValue",parseInt(e));$(".popover-content .thickness-value").text(e);function applyThickness(e){$(".popover-content .thickness-value").text(e);saveUserThickness(e);a.setThickness(e)}t.on("slide",function(e){applyThickness(e.value)});$(".thickness-parent").on("click",".slider.slider-horizontal",function(){var e=t.bootstrapSlider("getValue");applyThickness(e)});$(".popover-content .thickness-parent").showBlink()})();a.onAfterShow()});blink.popovers&&blink.popovers.register(t);var r=0;t.on("taphold",function(e){e.preventDefault();e.stopPropagation();r=(new Date).getTime();if(!isVisible()){t.popover("show");if(!a.toolIsActive())blink.tools.manager.buttonPress(t.get(0).id);blink.tools.manager.discardNextAction(t.get(0).id);if(!isEnabled())toggleEnable(true)}});t.on("click",function(e){var t=(new Date).getTime()-r;if(t<1e3)return;toggleEnable()});function isEnabled(){return blink.theme.buttonState.isActive(t)}function toggleEnable(e){if(isEnabled()){a.onEnabled()}else{a.onDisabled();if(isVisible())t.popover("hide")}}function isVisible(){return blink.popovers&&blink.popovers.isVisible(t)}function refresh(){var t=getUserColor(a.actualTool)||a.getColor()||a.getDefaultColor();t=t.hex||t;var e=_.find(i.manager.colors,function(e){return e.hex===t});if(!e)e=a.getDefaultColor();a.setColor(e.hex);$(".popover-content .colors").find("li").removeClass("active").end().find("."+e.className).addClass("active")}function saveUserColor(e,t){blink.localStorage.set("user"+n+"_toolcolor_"+t,i.manager.colors[e].hex)}function getUserColor(e){return blink.localStorage.get("user"+n+"_toolcolor_"+e)}function saveUserThickness(e){blink.localStorage.set("user"+n+"_toolthickness",e)}function getUserThickness(){return blink.localStorage.get("user"+n+"_toolthickness")}a.getActualTool=function(e){var t=4,i=0;if(e.hasClass("icontool-"+t)){a.actualTool="pencil"}else if(e.hasClass("icontool-"+i)){a.actualTool="highlight"}else{a.actualTool=""}};a.hide=function(){t.popover("hide")};a.refresh=function(){refresh()};a.element=t}})();(function(){jQuery.fn.popoverFontsizeTool=function(){var t=this,i=blink.toolsNew.fontSize,e=blink.user.getID(),a=parseInt($(".fontsize-slider").attr("data-slider-max"))/(i.MAX-i.MIN),n=0,o,s=blink.isApp&&!blink.isOfflinePC?"body":".navbar";var r={placement:"bottom",container:s,html:true,trigger:"manual",content:function(){return $("#popover-fontsize").html()}};var l={setFontsize:function(e){var t=Math.round(e/a+i.MIN);i.apply(t)},getFontsize:function(){o=parseInt($("html").css("font-size"))-i.MIN;return Math.round(o*a)},toolIsActive:function(){return this.enabled},hide:function(){t.popover("hide")},show:function(){t.popover("show")}};t.popover(r).on("shown.bs.popover",function(){$(document).off("click").on("click",function(e){if(!$(e.target).closest(".popover.in").length&&!$(e.target).closest(t).length){l.hide()}});(function(){var t=$(".popover-content .fontsize-slider"),e=l.getFontsize()||0;t.bootstrapSlider();t.bootstrapSlider("setValue",parseInt(e));$(".popover-content .fontsize-value").text(e);function applyFontsize(e){$(".popover-content .fontsize-value").text(e);l.setFontsize(e)}t.on("slide",function(e){applyFontsize(e.value)});$(".fontsize-parent").on("click",".slider.slider-horizontal",function(){var e=t.bootstrapSlider("getValue");applyFontsize(e)});$(".fontsize-reset").click(function(){t.bootstrapSlider("setValue",0);applyFontsize(0)});$(".popover-content .fontsize-parent").showBlink()})()}).on("hidden.bs.popover",function(){blink.theme.buttonState.active(t,false)});if(blink.isApp&&!blink.isOfflinePC){var d=t.data("bs.popover").options.template,c='<div class="arrow"></div>';d=d.replace(c,"");t.data("bs.popover").options.template=d}blink.popovers&&blink.popovers.register(t);t.on("taphold",function(e){e.preventDefault();e.stopPropagation();n=(new Date).getTime();if(!isVisible()&&!isEnabled()){toggleEnable(true)}});t.on("click",function(e){var t=(new Date).getTime()-n;blink.tools.manager.disableTools();blink.tools.manager.disableButtons();if(t<1e3){return}if(isVisible()){toggleEnable(false)}else{l.hide();i.gapClick()}});function isVisible(){return blink.popovers&&blink.popovers.isVisible(t)}function isEnabled(){return blink.theme.buttonState.isActive(t)}function toggleEnable(e){if(isVisible()||e==false){l.hide();blink.theme.buttonState.active(t,false)}else{l.show();appsOffset(blink.isApp&&!blink.isOfflinePC);blink.theme.buttonState.active(t)}}function appsOffset(e){if(!e){return}$(".popover").css({top:"0px",left:"unset",right:"65px","max-width":"unset",width:"380px"})}}})();(function(){var e={0:{cl:"archivo",bg:"archivo"},1:{cl:"actividad",bg:"actividad"},2:{cl:"video",bg:"multimedia"},3:{cl:"musica",bg:"multimedia"},7:{cl:"url",bg:"url"},8:{cl:"img",bg:"multimedia"}};function getTypes(){return blink.specialicons?$.extend(e,blink.specialicons):e}function clearType(e){e=parseInt(e);if(e==17||e==18)return 2;if(e==6||e==9||e>=10)return 1;else if($.inArray(e,[1,2,3,7,8])!=-1)return e;else return 0}function getClassByType(e){var t=getTypes();return t[clearType(e).toString()].cl}function getBGByType(e){var t=getTypes();return"../themes/responsive/images/contenido/recurso-bg-"+t[clearType(e)].bg+".jpg"}function inDropZone(e,t){var i=t.position();i.bottom=i.top+t.height();i.bottomRight=i.left+t.width();if(e.position.top>=i.top&&e.position.top<=i.bottom&&e.position.left>=i.left&&e.position.left<=i.bottomRight){return true}else{return false}}function createResourcesEvents(s){if(window.editar||window.soloRecursos){if(s.onStopDrag){$(".popover-content .recursos .resource-drag").css("cursor","pointer").draggable({handle:".resource-info",helper:"clone",start:function(e,t){$(".controls",t.helper).remove();$(t.helper).css("border",0)},stop:function(e,t){if(!inDropZone(t,$(".popover-content .recursos"))){s.onStopDrag(e,t,this);if($(this).attr("data-id")==""){$(this).find(".controls .edit").first().css("display","inline-block")}}$(this).draggable("option","revert",false)}})}var n=s.getAll();$(".popover-content ul").sortable({handle:".sort",update:function(e,t){$(".resource-drag").each(function(e){$(this).attr("data-orden",e)});n.map(function(e,t){if($("li[data-id='"+e.ID+"']").length)e.orden=parseInt($("li[data-id='"+e.ID+"']").attr("data-orden"));else e.orden=parseInt("1000"+t)});n.sort(function(e,t){if(e.orden!=undefined&&t.orden!=undefined)return e.orden-t.orden});n.map(function(e){delete e.orden});var i={};for(var a=0;a<n.length;a++){i[a]=n[a]}blink.ajax("/LMS/ajax.php?op=activity.storedigitalbook",null,{data:{idcurso:idcurso,idclase:idclase,str:JSON.stringify(i)}})}});$(".controls").css("display","inline-block");$('.popover-content .recursos .resource-drag[data-id!=""]').each(function(){$(this).find(".controls .delete").css("display","inline-block")});$('.popover-content .recursos .resource-drag[data-id=""]').each(function(){var e=$(this).attr("data-url"),t=false;for(var i=0;i<n.length;i++){if(n[i].url==e){$(this).attr("data-id",n[i].ID);t=true}}if(!t){$(this).find(".controls .edit").css("display","none")}});$(".popover-content .recursos .edit").click(function(){var e=$(this).parents("li"),t=e.data("id"),i=e.data("url");s.onEdit(t,e,i)});$(".popover-content .recursos .delete").click(function(){var e=$(this).parents("li");var t=e.data("id");s.onDelete(t,e)})}if(!window.editar||!s.onStopDrag){$(".popover-content .recursos .resource-info").css("cursor","pointer").on("click keyup",function(e){if(e.type==="click"||e.type==="keyup"&&e.which===13){var t={id:$(this).parent().data("id"),type:$(this).parent().data("type"),pintype:$(this).parent().data("pintype"),title:$(this).parent().data("title"),open_in:$(this).parent().data("open-in"),url_real:$(this).parent().data("url-real")};$(".navbar.libro").removeClass("popover_resources_active");s.onClick(e,$(this).parent().data("url"),t)}})}else{var r=300;var l=2;var d=0;var c=0;var u=0;$(".popover-recursos-wrapper .resource-info .imagen").mousedown(function(e){d=(new Date).getTime();c=e.screenX;u=e.screenY}).mouseup(function(e){var t=(new Date).getTime()-d;var i=Math.abs(e.screenX-c);var a=Math.abs(e.screenY-u);if(t<r&&i<l&&a<l){var n=$(this).closest(".resource-drag");var o={id:n.data("id"),type:n.data("type"),pintype:n.data("pintype"),title:n.data("title"),open_in:n.data("open-in"),url_real:n.data("url-real")};s.onClick(e,n.data("url"),o)}})}}var n={showOnlyVisiblePages:false,_getHTML:function(e){var t=$($("#popover-recursos").html());this._addResources(t.find("ul"),e);return t.wrap("<p/>").parent().html()},_addResources:function(e,t){e.html("");for(var i=0;i<t.length;i++){var a=t[i];var n=a.role?'data-role="'+a.role+'" ':"";var o=a.specialicon?'data-specialicon="'+a.specialicon+'" ':"";var s=a.url_real?'data-url-real="'+a.url_real+'" ':"";var r='<li class="resource-drag" data-pintype="'+a.pintype+'" data-id="'+a.id+'" data-type="'+a.type+'" '+o+n+' data-url="'+a.url+'" data-mediatype="'+a.mediatype+'" data-open-in="'+a.open_in+'" '+s+">";var l=a.desc?"":"resource-hidden-desc";if(window.editar||window.soloRecursos){r+='\t\t\t\t\t\t<div class="controls controles2" style="display: none">\t\t\t\t\t\t\t<a href="javascript:void(0)" class="edit"></a>\t\t\t\t\t\t\t<a href="javascript:void(0)" class="delete" style="display: none"></a>\t\t\t\t\t\t\t<br>\t\t\t\t\t\t\t\x3c!--a href="javascript:void(0)" class="drag"></a--\x3e\t\t\t\t\t\t\t\x3c!--a href="javascript:void(0)" class="sort"></a--\x3e\t\t\t\t\t\t</div>';r+='<a href="javascript:void(0)" class="sort"></a>'}var d=a.specialicon&&a.specialicon!=-1?a.specialicon:a.type;r+='<div class="resource-info '+l+'" role="button" tabindex="0" aria-label="'+escapeQuotes(a.nombre)+'">';r+='<span class="imagen '+getClassByType(d)+'"><img src="'+getBGByType(d)+'" /></span>';r+='<div style="overflow: hidden;"><span class="resource-nombre resource-text">'+(a.nombre||"&nbsp;")+"</span>";r+='<span class="resource-desc resource-text">'+(a.desc||"")+"</span></div>";r+="</div>";r+='<div class="clear"></div>';r+="</li>";e.append(r)}},_getPagesByMenuPine:function(e,t){var i=this.getByURL(e.url);var a=[];var n=[];this.filter(i,function(e){if(e.menu==1)return;if(e.page===0||e.page>0){a.push(e.page);n.push(e)}});return t?n:a},getResources:function(){var e=this.getAll();var t=[];var i=null;if(window.editar||window.soloRecursos){var a=this.getAdditionalPines();for(var n=0;n<a.length;n++){var o=a[n];var s=this.getNombreDescPage(o);o.nombre=s.nombre;o.desc=s.desc;o.page=s.page;t.push(o)}}else{e=e.slice();var a=this.getAdditionalPines();for(var n=0;n<a.length;n++){var o=a[n];var r=this._getPagesByMenuPine(o,true);if(r.length>0){if(r[0].open_in)o.open_in=r[0].open_in;if(r[0].url_real)o.url_real=r[0].url_real;e.push(o)}}}if((!window.editar||!window.soloRecursos)&&this.showOnlyVisiblePages){i=this.getVisiblePages()}for(var n=0;n<e.length;n++){var o=e[n];if(!o.menu||o.borrado||o.visible!==undefined&&!o.visible)continue;var l=o.mediatype?o.mediatype:window.getMediaType(o.url);if(i){var d=this._getPagesByMenuPine(o);if(d.length===0)continue;if(_.intersection(i,d).length===0)continue}var s=this.getNombreDescPage(o);var c={nombre:s.nombre,desc:s.desc,page:s.page,type:o.type,url:o.url,mediatype:l,id:o.ID,pintype:o.pintype,open_in:o.open_in,url_real:o.url_real};if(o.role!==undefined)c.role=o.role;if(o.specialicon!==undefined){c.specialicon=o.specialicon}t.push(c)}return t},onClick:function(e,t,i){this.showPine(t,i)},onEdit:function(e,t,i){var a="/LMS/msgbox.php?op=activity.editdigitalbookfile&idcurso="+idcurso+"&idclase="+idclase,n,o;if(e!==""){n=this.getByID(e),o="../images/icons/"+(n.mediatype?n.mediatype:"externo")+".png";a+="&idelem="+e+"&thumb="+o}else if(i!==""){a+="&urlData="+i}a+="&tipoFichero=archivo";showMsgBox("",a,770)},showPine:function(e,t){cerrarIframe();e=adjustUseruploadsUrl(e,"a",idclase);var i=t.url_real||false;var a=t.title||"";var n=t.type;var o={behaviour:t.pintype};if(n==5&&t.pintype=="popover"){var s=t.mediatype=="html"?e:i||e;if(blink.activity.currentStyle&&blink.activity.currentStyle.addCustomPopoverTitle&&blink.activity.currentStyle.addCustomPopoverTitle()!=false){a=blink.activity.currentStyle.addCustomPopoverTitle()}blink.rest.panel(s,a,true)}else if(t.open_in&&t.open_in=="iframe"){o.fullscreen=true;if(modoVisualizacion==4&&blink.isApp&&!blink.isOfflinePCApp){redireccionar(i,false,undefined)}else{showIFrame(i||e,0,0,0,0,0,o)}}else if(n<=0){return""}else if(n==1){blink.rest.flash(e)}else if(n==6||n==9){blink.tools.manager.disableTools();if(blink.activity.currentStyle&&blink.activity.currentStyle.zipPineOpenInSameWindow&&blink.activity.currentStyle.zipPineOpenInSameWindow()){i?redireccionar(i,false,undefined):blink.rest.tarea(e)}else{i?openPopup(i):blink.rest.tarea(e)}}else if(n==2){blink.rest.video(e,t.id)}else if(n==3){blink.rest.audio(e,t.id);setTimeout(function(){blink.tools.manager.disableTools()},500)}else if(n==7){blink.tools.manager.disableTools();if(e.indexOf("page://")!==-1){if(e.split("page://")[1]=="related"){bpdf.goRelatedPage(true)}else{blink.rest.goToPageFromToc(e.split("page://")[1],true)}}else{window.open(e)}}else if(n==8){blink.rest.image(e)}else{blink.tools.manager.disableTools();window.open(e)}},filter:function(e,t){var i=[];this.each(e,function(e){if(t(e)){i.push(e)}});return i},each:function(e,t){for(var i=0;i<e.length;i++){if(t(e[i])===false){break}}},getDuplicado:function(t){var i=null;if(t.menu)return i;var e=this.getAdditionalPines();this.each(e,function(e){if(e.url==t.url){i=$.extend(t,e);i.menu=0;if(!i.borrado)return false}});return i},getTypeString:function(e){var t=e.type;if(t==-1)return"";else if($.inArray(t,[1,6,9])!=-1)return textweb("tablettxt_Exercises");else if(t==2)return textweb("tablettxt_video");else if(t==3)return textweb("tablettxt_audio");else if(t==7)return textweb("tablettxt_link");else if(t==8)return textweb("tablettxt_image");else if(t==10)return textweb("wikiurl.wikipedia");else return textweb("tablettxt_document")},getTitleByUrl:function(e){var t=e.url;if(!t)return null;if(t.match(/https?:\/\//)&&isExternalURL(t))return getHost(t);else return null},getNombreDescPage:function(e,t){if(t===undefined)t=true;var i=this.getDuplicado(e);var a="";var n="";var o=-1;if(i==null){n=trim(e.nombre);a=trim(e.desc)||this.getTitleByUrl(e)}else{n=trim(e.nombre)||trim(i.nombre);a=trim(e.desc)||trim(i.desc)||this.getTitleByUrl(e);if(!a&&t){}}if(n==a)a="";if(!n){if(a){n=a;a=""}else{n=this.getTypeString(e)||textweb("tablettxt_titleForMenuAnnotations")}}if(e.menu==0){o=e.page}else if(e.menu==1&&i!=null){o=i.page}return{nombre:n,page:o,desc:a}},getByID:function(t){var e=this.filter(this.getAll(),function(e){return e.ID==t});if(e.length==0){blink.log.error("No se ha encontrado ningn pine con ID "+t);return null}else{if(e.length>1)blink.log.error("Se han encontrado "+e.length+" con el ID "+t);return e[0]}},getByURL:function(t){return this.filter(this.getAll(),function(e){return e.url==t})},onAdd:function(e){if(e==0){seleccionarMultimedia(idcurso,"","finSeleccionarMultimediaDigitalBook",null,null,"","digital_book")}else if(e==1){dlgCopyClass("dbook.onSelectActivity")}else if(e==2){seleccionarMultimedia(idcurso,"","finSeleccionarMultimediaDigitalBook",null,"video","","digital_book")}else if(e==3){seleccionarMultimedia(idcurso,"","finSeleccionarMultimediaDigitalBook",null,"sound","","digital_book")}else if(e==7){dlgNewDigitalBookLink()}else if(e==8){seleccionarMultimedia(idcurso,"","finSeleccionarMultimediaDigitalBook",null,"image","","digital_book")}else if(e==10){var t="/LMS/msgbox.php?op=wikiurl.buscaWikipedia";if(idcurso)t+="&idcurso="+idcurso;if(idclase)t+="&idclase="+idclase;t+="&pin=1";showMsgBox("",t)}},onDelete:function(e,t){var i=this.getByID(e);var a=$('.popover-content .recursos li[data-id="'+e+'"]');var n=this.getByURL(i.url);var o=this.filter(n,function(e){return e.menu!=1&&e.borrado!=1}).length;if(!i||!a.length||!n.length){blink.log.error("Error borrando recursos");return false}else if(o>0){if(!confirm(window.textweb("libroDigital_editar_8")+" "+o))return false}else{if(!confirm(window.textweb("libroDigital_editar_7")))return false}var s=[];for(var r=0;r<n.length;r++){var l=n[r];if(l.borrado==1)continue;l.borrado=1;l.lastupdated=getTime();if(s.indexOf(l.url)==-1){s.push(l.url)}}this.deleteByUrls(s);var d=getStandardUrlResourceFile(i.url);this.save();blink.ajax("/LMS/ajax.php?op=activity.deletefiledigitalbook&filename="+d+"&idclase="+idclase,function(){});a.remove();this.resize()},deleteByUrls:function(e){},onBeforeShow:function(){},getAdditionalPines:function(){return[]},refresh:function(){if(!this.isVisible())return;this._addResources($(".popover-content .recursos ul"),this.getResources());createResourcesEvents(this);this.resize()},resize:function(){if(!this.isVisible())return;var e=$("#popover-recursos-empty-msg");if($(".popover-content .recursos li:visible").size()===0)e.showBlink();else e.hideBlink();$content=$(".popover-recursos-wrapper");$content.height("auto");$(".recursos .resource-drag .resource-text").css("max-width","auto");var t=$content.position().top+$(".popover").position().top;var i=$(window).innerHeight()-t-10;if($content.height()>i){$content.height(i)}},scrollToBottom:function(){if(!this.isVisible())return;var e=$(".popover-recursos-wrapper");e.animate({scrollTop:e.height()})},hide:function(){this.element.popover("hide")},isVisible:function(){return blink.popovers&&blink.popovers.isVisible(this.element)},addPineMenu:function(e,t,i,a,n,o,s){var r=getTime();if(typeof n=="undefined")n="new";var l={x:0,y:0,width:0,height:0,type:e,url:t,ID:this.getNewID(),menu:1,created:r,lastupdated:r,open_in:n,orden:s};if(e==6){l["idactivity"]=t.split("-")[0]}if(typeof i!="undefined")l.desc=i;if(typeof a!="undefined")l.mediatype=a;if(typeof o!="undefined")l.url_real=o;this.addPineMenuObj(l);closeMsgBox();this.refresh();this.scrollToBottom();this.save()},getNewID:function(){var e=0;var t=this.getAll();for(var i=0;i<t.length;i++){var a=t[i];if(a.ID>e)e=a.ID}e++;return e}};jQuery.fn.popoverRecursos=function(e){var t=this;var i=function(){$(".popover-content .recursos li").css("border-top","").show();e.resize()};e=$.extend({},n,e);var a=blink.activity.currentStyle&&typeof blink.activity.currentStyle.popoverPlacementNavbar!=="undefined"?blink.activity.currentStyle.popoverPlacementNavbar():"bottom";t.popover({placement:a,container:".navbar",html:true,trigger:"manual",content:function(){return e._getHTML(e.getResources())}}).on("shown.bs.popover",function(){createResourcesEvents(e);if(window.editar||window.soloRecursos){$(".popover-content .recursos .add").tooltip({placement:"left"}).click(function(e){e.preventDefault();$(".popover-content .recursos .filter").slideToggle("default",i)});$(".popover-content .recursos .filter a").click(function(){e.onAdd($(this).data("type"))});$(".js-tooltip").tooltip();if(window.soloRecursos){$(".popover-content .recursos .resource-info").css({"margin-left":"20px","margin-right":"60px"})}}else{$(".popover-content .recursos .recursos-filter").tooltip({placement:"left"}).click(function(e){e.preventDefault();$(".popover-content .recursos .filter").slideToggle("default",i)});$(".popover-content .recursos .filter a").click(function(){var i=$(this).data("type");$(".popover-content .recursos li").css("border-top","").each(function(){var e=$(this).data("specialicon");var t=e&&e!=-1?e:$(this).data("type");clearType(t)==i?$(this).show():$(this).hide()});e.resize()})}$(".resource-info").first().focus();e.resize()});blink.popovers&&blink.popovers.register(t);t.click(function(){if(e.isVisible()){t.popover("hide");if($(".body_clase:not(.edit) .navbar.libro").length>0)$(".body_clase:not(.edit) .navbar.libro").removeClass("popover_resources_active");if(window.soloRecursos){$(".body_clase .navbar.libro").removeClass("popover_resources_active")}}else{e.onBeforeShow();blink.popovers&&blink.popovers.hideAll([t]);blink.tools.manager.disableTools();t.popover("show");if($(".body_clase:not(.edit) .navbar.libro").length>0)$(".body_clase:not(.edit) .navbar.libro").addClass("popover_resources_active");if(window.soloRecursos){$(".body_clase .navbar.libro").removeClass("popover_resources_active")}if((blink.isAndroid||blink.isIos)&&typeof blink.activity.currentStyle.adjustPopoverResources!=="undefined"){blink.activity.currentStyle.adjustPopoverResources()}}});e.element=t;window.resourcesModal=e}})();function createDefaultPopopverResources(e){if(typeof e!="undefined"&&e){blink.theme.buttonState.hidden("#tool-resources",true);return}var t=[];var i={addPineMenuObj:function(e){t.push(e)},getAll:function(){return t},save:function(){blink.ajax("/LMS/ajax.php?op=activity.storedigitalbook",null,{data:{idcurso:idcurso,idclase:idclase,str:JSON.stringify(t)}})}};var a="../coursePlayer/librodigital_json.php?type=json&xdevice=ipadapp&idclase="+idclase+"&idcurso="+idcurso;if(window.editar||window.soloRecursos)a+="&editar=1";else a+="&abs=1";var n={},o={onError:function(){blink.theme.buttonState.hidden("#tool-resources",true);$("#tool-resources").parent().hide()}};blink.getJSON(a,function(e){if(e&&e.elements){t=e.elements;blink.activity.resourcesList=t;blink.activity.resourcesModal=i}blink.activity.configureResourcesButton()},n,o)}function shouldShowPopoverResources(e){var t=window.editar||window.soloRecursos;if(!t){for(var i=0;i<e.length;i++){var a=e[i];if(!a.menu||a.borrado||a.visible!==undefined&&!a.visible)continue;t=true;break}}return t}_libroDigital={nuevoID:function(){return resourcesModal.getNewID()}};function finEditaFileDigitalBook(e,t,i,a,n,o,s){closeMsgBox();var r=resourcesModal.getByID(e);var l=$('.popover-content .recursos li[data-id="'+e+'"]');var d=resourcesModal.getByURL(r.url);if(!d.length){blink.log.error("Error editando recursos");return}for(var c=0;c<d.length;c++){var u=d[c];u.desc=t;u.nombre=n;u.lastupdated=window.getTime();if(i==1)u.role="p";else delete u.role;if(s==1)u.pintype="popover";else delete u.pintype;if(a=="-1")u.specialicon="-1";else if(a=="default"){if(u.pintype&&u.type==5)u.specialicon=6;else delete u.specialicon}}var f=resourcesModal.getNombreDescPage(r);if(l.size()){$(".resource-nombre",l).text(f.nombre||"&nbsp;");$(".resource-desc",l).text(f.desc||"");$(".resource-info",l).toggleClass("resource-hidden-desc",!f.desc)}resourcesModal.save()}function checkUrlExisteJSON(e){var t=e.substr(e.lastIndexOf("/"));var i=resourcesModal.getAll();for(var a=0;a<i.length;a++){var n=i[a];if(n.url.indexOf(t)!=-1&&n.borrado!="1"&&n.visible!="0"&&n.menu=="1"){return true}}return false}function salvaLinkJSON(e,t){resourcesModal.addPineMenu(e,t)}function finSeleccionarMultimediaDigitalBook_create(e,t,i,a,n,o,s){closeMsgBox()}function finCreaVinculoActividadDigitalBook(e,t,i,a,n){var o=e+"-0";resourcesModal.addPineMenu(6,o,t,undefined,a,n)}function getTypeByMediaType(e){if(e=="video")return 2;else if(e=="image")return 8;else if(e=="sound")return 3;else if(e=="flash")return 1;else return}function finCreaVinculoDigitalBook(e,t){var i=getMediaType(e);var a=getTypeByMediaType(i)||7;resourcesModal.addPineMenu(a,e,t,i)}$(function(){$(".bck-tooltip").popover({html:true,placement:"auto top",trigger:"manual",container:"body"}).on("mouseenter",function(){var e=this;$(this).popover("show");$(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){if(!$(".popover:hover").length){$(e).popover("hide")}},300)})});